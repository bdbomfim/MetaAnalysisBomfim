

getRversion()
if(!require(devtools)) install.packages("devtools")
devtools::install_github("kassambara/ggcorrplot")
install.packages('ggcorrplot')
library(ggcorrplot)
library(relaimpo)
library(lavaan)
library(eqs2lavaan)
library(ggplot2)
library(ggstatsplot)
library(DescTools)
library(nlme)
library(gapminder)
library(tidyverse)
library(ggrepel)
library(patchwork)
library(ggpubr)
library(magrittr)
library(mgcv)
library(nlme)
library(dplyr)
library(hrbrthemes)
library(PerformanceAnalytics)
library(viridis)
library(viridisLite)
library(lsmeans)
library(lme4)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(lattice)
library(lmerTest)
library(aod)
library(corrplot)
library(modelsummary)
library(tidyr)
library(plyr)
library(fs)
library(readr)
library(dygraphs)
library(xts)
library(plot3D)
library(forcats)
library(ggridges)
library("forcats")
library("broom")
library(lmerTest)
library(metafor)
library(forestmodel)
library(metaforest)
library(caret)
library(ranger)
library(dmetar)
library(MuMIn)
library(rJava)
library(leaps)
library(glmulti)
library(metaviz)
library(Matrix)
library(ggExtra)
library(RColorBrewer)
library(scales)
library(tibble)
citation()
#"black"   "#DF536B" "#61D04F" "#2297E6" "#28E2E5" "#CD0BBC" "#F5C710" "gray62" 
show_col(palette("R4"))

library(hrbrthemes)
ggsave(filename, plot = last_plot(), device = NULL, path = NULL,
       scale = 1, width = NA, height = NA, units = c("in", "cm", "mm"),
       dpi = 300, limitsize = TRUE, ...)

install.packages("devtools")
devtools::install_github("daniel1noble/metaDigitise")
library(metaDigitise)

devtools::install_github("MathiasHarrer/dmetar")

####STEP 0 Upload data####

metadat<-read.csv(file.choose())#20210415_Litterfall_Mass_Flux
attach(metadat)
str(metadat)#2370 obs of 77 variables
names(metadat)
summary(metadat)
levels(metadat$Site)
2370-414
metadat$Case_ID=as.factor(metadat$Case_ID)
metadat$Study_ID =as.factor(metadat$Study_ID )

#Colors for the countries +scale_colour_manual(values=c("#1dabe6","#b35a2d","#c3ced0","#ffa600","#665191","#af060f"))

nutmeta<-read.csv(file.choose())#20210224_Nutrient_Meta_updated
attach(nutmeta)
str(nutmeta)#2551 of 79 variables
summary(nutmeta)

nutmeta$Total_Soil_P..Bicarb....NaOH.Pt.=as.numeric(nutmeta$Total_Soil_P..Bicarb....NaOH.Pt.)
nutmeta$MAP_mm=as.numeric(nutmeta$MAP_mm)
nutmeta$Elevation_m=as.numeric(nutmeta$Elevation_m)



######## STEP 1 #### Resilience Wrangling Data for Calculations #######

#including data for recovery and resilience calculations

rec <- metadat %>% filter(Cat_TSD_months == "Rec")
rec

res_all<- rec %>% filter(Case_ID!="25.2")%>% filter (TSD_months < 37)
str(res_all)

#This is for Resilience calculations for litterfall mass flux, excluding the duplicated study in Bisley

res <- rec %>% filter(Fraction=="TotLitfall") %>% filter(Case_ID!="25.2")%>% filter (TSD_months < 37) #%>%filter(DisturbanceName!="Luis")%>%filter(DisturbanceName!="Ivor") #%>% mutate (Res = (Resilience)*100, ResS = (ResilienceS)*100, deltaRes = Res - ResS)
str(res)

res_amb<-res %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
str(res_amb)#296

res_metafor<- res %>% filter (TSD_months < 15)
str(res_metafor)

res_metaforS<- res_metafor %>% filter(Pre_Mean_MonthSpecific!="NA")
str(res_metaforS)#n = 197

res_temp<-  res
str(res_temp)

## Leaf fall

reslf<- rec %>% filter(Fraction=="Leaf fall") %>% filter(Case_ID!="25.2")%>% filter (TSD_months < 37)
str(reslf)
reslf$Fraction

## Wood fall

reswf<- rec %>% filter(Fraction=="Wood fall") %>% filter(Case_ID!="25.2")%>% filter (TSD_months < 37)
str(reswf)

## FFS fall

resff<- rec %>% filter(Fraction=="FFS fall") %>% filter(Case_ID!="25.2")%>% filter (TSD_months < 37)
str(resff)#209

##Nutrient Data wrangling ####

nutrec <- nutmeta %>% filter(Cat_TSD_months == "Rec")
str(nutrec)#2430

##Nutrient fluxes less than 25 months due to lack of observations for all regions

## P

res_pf<-nutrec %>%filter(Variable=="P")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)

restpf<- nutrec %>% filter(Fraction=="TotLitfall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(restpf)#125

reslpf<- nutrec %>% filter(Fraction=="Leaf fall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(reslpf)#132

reswpf<- nutrec %>% filter(Fraction=="Wood fall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(reswpf)#117

resffpf<- nutrec %>% filter(Fraction=="FFS fall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(resffpf)#59

## N

res_nf<-nutrec %>%filter(Variable=="N")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months <25)

restnf<- nutrec %>% filter(Fraction=="TotLitfall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(restnf)#124

reslnf<- nutrec %>% filter(Fraction=="Leaf fall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(reslnf)#131

reswnf<- nutrec %>% filter(Fraction=="Wood fall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(reswnf)#116

resffnf<- nutrec %>% filter(Fraction=="FFS fall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/m2/day")%>% filter (TSD_months < 25)
str(resffnf)#59

##Nutrient concentrations

##P

res_pc<-nutrec %>%filter(Variable=="P")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)

reslpc<- nutrec %>% filter(Fraction=="Leaf fall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)
str(reslpc)#78

reswpc<- nutrec %>% filter(Fraction=="Wood fall") %>% filter(Variable=="P")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)
str(reswpc)#22

##N

res_nc<-nutrec %>%filter(Variable=="N")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)

reslnc<- nutrec %>% filter(Fraction=="Leaf fall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)
str(reslnc)#76

reswnc<- nutrec %>% filter(Fraction=="Wood fall") %>% filter(Variable=="N")%>% filter(Raw_Unit=="mg/g")%>% filter (TSD_months < 37)
str(reswnc)#22


#######STEP 1A #### Total Litterfall Effect Sizes#######

## Site-level trajectories to check end point for resilience

levels(res$Site)

##All data 1 to 36 months

data_res<-res

#### RESILIENCE without and with Seasonality ####

data1<-res %>% filter(TSD_months=="1"|TSD_months=="2")
str(data1)#37
data1$Effectsize_ID
data1S<- data1%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data1S)#28 observations
data1S$Effectsize_ID
data1SS<-data1 %>% filter(Effectsize_ID == "52"|Effectsize_ID == "53"|Effectsize_ID == "520"|Effectsize_ID == "584"|
                              Effectsize_ID == "601"|Effectsize_ID == "602"|Effectsize_ID == "628"|Effectsize_ID == "629"|Effectsize_ID == "653"|Effectsize_ID == "654"|
                              Effectsize_ID == "678"|Effectsize_ID == "679"|Effectsize_ID=="702"|Effectsize_ID == "1016"|Effectsize_ID == "1017"|Effectsize_ID == "1318"|Effectsize_ID == "1319"|Effectsize_ID == "1739"|Effectsize_ID == "1740"|Effectsize_ID == "1849"|Effectsize_ID == "1850"|
                              Effectsize_ID == "2135"|Effectsize_ID == "2136"|Effectsize_ID == "2144"|Effectsize_ID == "2145"|Effectsize_ID == "2160"|Effectsize_ID == "2353"|Effectsize_ID == "2354")
str(data1SS)
data2<-res %>% filter(TSD_months=="3"|TSD_months=="4")
str(data2)#38
data2S<- data2%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
data2S$Effectsize_ID#26 observations
str(data2S)
data2SS<- data2 %>% filter(Effectsize_ID == "54"|Effectsize_ID == "55"|Effectsize_ID == "603"|Effectsize_ID == "604"|
                                     Effectsize_ID == "630"|Effectsize_ID == "631"|Effectsize_ID == "655"|Effectsize_ID == "656"|Effectsize_ID == "680"|Effectsize_ID == "681"|
                                     Effectsize_ID == "703"|Effectsize_ID == "704"|Effectsize_ID == "1018"|Effectsize_ID == "1019"|Effectsize_ID == "1320"|Effectsize_ID == "1321"|Effectsize_ID == "1741"|Effectsize_ID == "1742"|Effectsize_ID == "1851"|Effectsize_ID == "1852"|Effectsize_ID == "2137"|Effectsize_ID == "2138"|
                                     Effectsize_ID == "2146"|Effectsize_ID == "2147"|Effectsize_ID == "2355"|Effectsize_ID == "2356")
str(data2SS)

data3<-res %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3)#37
data3S<- data3%>% filter(Pre_Mean_MonthSpecific!="NA")
str(data3S)#31 observations
data3SS<- data3 %>% filter(Effectsize_ID == "56"|Effectsize_ID == "57"|Effectsize_ID == "521"|Effectsize_ID == "585"|
                              Effectsize_ID == "605"|Effectsize_ID == "606"|Effectsize_ID == "632"|Effectsize_ID == "633"|Effectsize_ID == "657"|Effectsize_ID == "658"|
                              Effectsize_ID == "682"|Effectsize_ID == "683"|Effectsize_ID == "705"|Effectsize_ID == "706"|Effectsize_ID == "1020"|Effectsize_ID == "1021"|Effectsize_ID == "1322"|Effectsize_ID == "1323"|Effectsize_ID == "1623"|Effectsize_ID == "1624"|Effectsize_ID == "1743"|Effectsize_ID == "1744"|Effectsize_ID == "1853"|
                              Effectsize_ID == "1854"|Effectsize_ID == "2139"|Effectsize_ID == "2140"|Effectsize_ID == "2148"|Effectsize_ID == "2149"|Effectsize_ID == "2161"|Effectsize_ID == "2357"|Effectsize_ID == "2358")
data3S$Effectsize_ID
str(data3SS)

data4<-res %>%filter(TSD_months=="7"|TSD_months=="8")
str(data4)#40
levels(data4$Fraction)
data4$Effectsize_ID
data4S<- data4%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data4S)#34 observations
data4S$Effectsize_ID
data4SS<- data4S %>% filter(Effectsize_ID == "58"|Effectsize_ID == "59"|Effectsize_ID == "337"|Effectsize_ID == "397"||Effectsize_ID == "457"|Effectsize_ID == "522"|
                              Effectsize_ID == "586"|Effectsize_ID == "607"|Effectsize_ID == "608"|Effectsize_ID == "634"|Effectsize_ID == "635"|Effectsize_ID == "659"|
                              Effectsize_ID == "660"|Effectsize_ID == "684"|Effectsize_ID == "685"|Effectsize_ID == "707"|Effectsize_ID == "708"|Effectsize_ID == "1022"|Effectsize_ID == "1023"|Effectsize_ID == "1324"|Effectsize_ID == "1325"|Effectsize_ID == "1625"|Effectsize_ID == "1626"|Effectsize_ID == "1745"|Effectsize_ID == "1746"|
                              Effectsize_ID == "1855"|Effectsize_ID == "1856"|Effectsize_ID == "2141"|Effectsize_ID == "2142"|Effectsize_ID == "2150"|Effectsize_ID == "2151"|Effectsize_ID == "2162"|Effectsize_ID == "2359"|Effectsize_ID == "2360")
str(data4SS)
data4SS$Effectsize_ID

data5<-res %>%filter(TSD_months=="9"|TSD_months=="10")
str(data5)#29
data5S<- data5%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data5S)#25 observations
data5SS<- data5 %>% filter(Effectsize_ID == "60"|Effectsize_ID == "61"|Effectsize_ID == "609"|Effectsize_ID == "610"|
                              Effectsize_ID == "636"|Effectsize_ID == "637"|Effectsize_ID == "661"|Effectsize_ID == "662"|Effectsize_ID == "686"|Effectsize_ID == "687"|
                              Effectsize_ID == "709"|Effectsize_ID == "710"|Effectsize_ID == "1024"|Effectsize_ID == "1025"|Effectsize_ID == "1326"|Effectsize_ID == "1327"|Effectsize_ID == "1627"|Effectsize_ID == "1628"|Effectsize_ID == "1747"|Effectsize_ID == "1748"|Effectsize_ID == "1857"|Effectsize_ID == "1858"|
                              Effectsize_ID == "2163"|Effectsize_ID == "2361"|Effectsize_ID == "2362")
data5S$Effectsize_ID
str(data5SS)#25

data6<-res %>%filter(TSD_months=="11"|TSD_months=="12")
str(data6)#35
data6S<- data6 %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data6S)#25 observations
data6SS<- data6 %>% filter(Effectsize_ID == "62"|Effectsize_ID == "63"|Effectsize_ID == "338"|Effectsize_ID == "398"|
                              Effectsize_ID == "458"|Effectsize_ID == "523"|Effectsize_ID == "587"|Effectsize_ID == "611"|Effectsize_ID == "638"|Effectsize_ID == "663"|
                              Effectsize_ID == "688"|Effectsize_ID == "711"|Effectsize_ID == "712"|Effectsize_ID == "1026"|Effectsize_ID == "1027"|Effectsize_ID == "1328"|Effectsize_ID == "1329"|Effectsize_ID == "1629"|Effectsize_ID == "1749"|Effectsize_ID == "1750"|Effectsize_ID == "1859"|Effectsize_ID == "1860"|
                              Effectsize_ID == "2164"|Effectsize_ID == "2363"|Effectsize_ID == "2364")
data6S$Effectsize_ID
str(data6SS)#25

data7<-res %>%filter(TSD_months=="13"|TSD_months=="14")
str(data7)#32
data7S<- data7%>% filter(Pre_Mean_MonthSpecific!="NA")
str(data7S)#28 observations
data7SS<- data7 %>% filter(Effectsize_ID == "64"|Effectsize_ID == "65"|Effectsize_ID == "339"|Effectsize_ID == "399"|
                              Effectsize_ID == "459"|Effectsize_ID == "524"|Effectsize_ID == "588"|Effectsize_ID == "613"|Effectsize_ID == "614"|Effectsize_ID == "640"|
                              Effectsize_ID == "641"|Effectsize_ID == "665"|Effectsize_ID == "666"|Effectsize_ID == "690"|Effectsize_ID == "691"|Effectsize_ID == "713"|Effectsize_ID == "714"|Effectsize_ID == "1028"|Effectsize_ID == "1029"|Effectsize_ID == "1330"|Effectsize_ID == "1331"|Effectsize_ID == "1751"|
                              Effectsize_ID == "1752"|Effectsize_ID == "1861"|Effectsize_ID == "1862"|Effectsize_ID == "2165"|Effectsize_ID == "2365"|Effectsize_ID == "2366")
data7S$Effectsize_ID
str(data7SS)#28

data8<-res %>%filter(TSD_months=="15"|TSD_months=="16")
str(data8)#25
data8S<- data8%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data8S)#23 observations
data8SS<- data8 %>% filter(Effectsize_ID == "66"|Effectsize_ID == "67"|Effectsize_ID == "615"|Effectsize_ID == "616"|
                              Effectsize_ID == "642"|Effectsize_ID == "643"|Effectsize_ID == "667"|Effectsize_ID == "668"|Effectsize_ID == "692"|Effectsize_ID == "693"|Effectsize_ID == "715"|Effectsize_ID == "716"|Effectsize_ID == "1030"|Effectsize_ID == "1031"|Effectsize_ID == "1332"|Effectsize_ID == "1333"|
                              Effectsize_ID == "1753"|Effectsize_ID == "1754"|Effectsize_ID == "1863"|Effectsize_ID == "1864"|Effectsize_ID == "2166"|Effectsize_ID == "2367"|Effectsize_ID == "2368")
data8S$Effectsize_ID
str(data8SS)#23

data9<-res %>%filter(TSD_months=="17"|TSD_months=="18")
str(data9)#30
data9S<- data9%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data9S)#30 observations
data9SS<- data9 %>% filter(Effectsize_ID == "68"|Effectsize_ID == "69"|Effectsize_ID == "340"|Effectsize_ID == "400"||Effectsize_ID == "460"|Effectsize_ID == "525"|
                              Effectsize_ID == "589"|Effectsize_ID == "617"|Effectsize_ID == "618"|Effectsize_ID == "644"|Effectsize_ID == "645"|Effectsize_ID == "669"|Effectsize_ID == "670"|Effectsize_ID == "694"|Effectsize_ID == "695"|Effectsize_ID == "717"|Effectsize_ID == "718"|Effectsize_ID == "1032"|
                              Effectsize_ID == "1033"|Effectsize_ID == "1334"|Effectsize_ID == "1335"|Effectsize_ID == "1635"|Effectsize_ID == "1636"|Effectsize_ID == "1755"|Effectsize_ID == "1756"|Effectsize_ID == "1865"|Effectsize_ID == "1866"|Effectsize_ID == "2151"|Effectsize_ID == "2345"|Effectsize_ID == "2346")
data9S$Effectsize_ID
str(data9SS)

data10<-res %>%filter(TSD_months=="19"|TSD_months=="20")
str(data10)#28
data10S<- data10%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data10S)#28 observations
data10SS<- data10 %>% filter(Effectsize_ID == "70"|Effectsize_ID == "71"|Effectsize_ID == "341"|Effectsize_ID == "401"||Effectsize_ID == "461"|Effectsize_ID == "526"|
                              Effectsize_ID == "590"|Effectsize_ID == "619"|Effectsize_ID == "620"|Effectsize_ID == "646"|Effectsize_ID == "647"|Effectsize_ID == "671"|Effectsize_ID == "672"|Effectsize_ID == "696"|Effectsize_ID == "697"|Effectsize_ID == "719"|Effectsize_ID == "720"|Effectsize_ID == "1034"|
                              Effectsize_ID == "1035"|Effectsize_ID == "1336"|Effectsize_ID == "1337"|Effectsize_ID == "1637"|Effectsize_ID == "1638"|Effectsize_ID == "1757"|Effectsize_ID == "1758"|Effectsize_ID == "1867"|Effectsize_ID == "1868"|Effectsize_ID == "2152")
data10S$Effectsize_ID
str(data10SS)

data11<-res %>%filter(TSD_months=="21"|TSD_months=="22")
str(data11)#20
data11S<- data11%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data11S)#20 observations
data11S$Effectsize_ID
data11$Effectsize_ID
data11SS<- data11

data12<-res %>%filter(TSD_months=="23"|TSD_months=="24")
str(data12)#22
data12S<- data12%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data12S)#17 observations
data12SS<- data12S %>% filter(Effectsize_ID == "74"|Effectsize_ID == "75"|Effectsize_ID == "342"|Effectsize_ID == "402"||Effectsize_ID == "462"|Effectsize_ID == "527"|
                                Effectsize_ID == "591"|Effectsize_ID == "623"|Effectsize_ID == "650"|Effectsize_ID == "675"|Effectsize_ID == "700"|
                                Effectsize_ID == "723"|Effectsize_ID == "724"|Effectsize_ID == "1038"|Effectsize_ID == "1039"|Effectsize_ID == "1340"|Effectsize_ID == "1341")
data12SS$Effectsize_ID
str(data12SS)

data13<-res %>% filter(TSD_months=="25"|TSD_months=="26")
str(data13)#13
data13S<- data13%>% filter(Pre_Mean_MonthSpecific!="NA")
str(data13S)#13 observations
data13SS<- data13

data14<-res %>%filter(TSD_months=="27"|TSD_months=="28")
str(data14)#8
data14S<- data14%>% filter(Pre_Mean_MonthSpecific!="NA")
str(data14S)#8 observations
data14S$Effectsize_ID
data14$Effectsize_ID
data14SS<- data14

data15<-res %>%filter(TSD_months=="29"|TSD_months=="30")
str(data15)#13
data15S<- data15%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data15S)#13 observations
data15S$Effectsize_ID
data15$Effectsize_ID
data15SS<- data15

data16<-res %>%filter(TSD_months=="31"|TSD_months=="32")
str(data16)#11
data16S<- data16%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data16S)#11 observations
data16S$Effectsize_ID
data16$Effectsize_ID
data16SS<- data16

data17<-res %>%filter(TSD_months=="33"|TSD_months=="34")
str(data17)#6
data17S<- data17%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data17S)#6 observations
data17S$Effectsize_ID
data17$Effectsize_ID
data17SS<- data17

data18<-res %>%filter(TSD_months=="35"|TSD_months=="36")
str(data18)#12
data18S<- data18%>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data18S)#11 observations
data18$Effectsize_ID
data18S$Effectsize_ID
data18SS<- data18 %>% filter(Effectsize_ID!="2275")
data18SS$Effectsize_ID


#### 3 to 6 months Ambient####

res_amb<-res %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")%>% filter (TSD_months < 37)
str(res_amb)

data3to6iamb <- res_amb %>% filter(TSD_months=="3"|TSD_months=="4"|TSD_months=="5"|TSD_months=="6")
str(data3to6iamb)#58
data3to6iamb$TSD_months
data3to6iambS <- res_amb %>% filter(TSD_months=="3"|TSD_months=="4"|TSD_months=="5"|TSD_months=="6") %>% filter (Pre_Mean_MonthSpecific!="NA")
str(data3to6iambS)#40
data3to6iambS$TSD_months

#### 1 to  6 months Ambient ####

data1to6iamb <- res_amb %>% filter(TSD_months<7)
data1to6iambS <- res_amb %>% filter(TSD_months<7) %>% filter (Pre_Mean_MonthSpecific!="NA")

#### 3 to  6 months all treatments ####

data3to6i <- res %>% filter(TSD_months=="3"|TSD_months=="4"|TSD_months=="5"|TSD_months=="6")
str(data3to6i)#75
data3to6i$TSD_months
data3to6iS <- res %>% filter(TSD_months=="3"|TSD_months=="4"|TSD_months=="5"|TSD_months=="6") %>% filter (Pre_Mean_MonthSpecific!="NA")
str(data3to6iS)#57
data3to6iS$TSD_months

#### 7 to  12 months Ambient ####

data7to12iamb <- res_amb %>% filter(TSD_months=="7"|TSD_months=="8"|TSD_months=="9"|TSD_months=="10"|TSD_months=="11"|TSD_months=="12")
data7to12iambS <- res_amb %>% filter(TSD_months=="7"|TSD_months=="8"|TSD_months=="9"|TSD_months=="10"|TSD_months=="11"|TSD_months=="12") %>% filter (Pre_Mean_MonthSpecific!="NA")
str(data_es7to12iamb)#74

data13to18iamb <- res_amb %>% filter(TSD_months=="13"|TSD_months=="14"|TSD_months=="15"|TSD_months=="16"|TSD_months=="17"|TSD_months=="18")
data13to18iambS <- res_amb %>% filter(TSD_months=="13"|TSD_months=="14"|TSD_months=="15"|TSD_months=="16"|TSD_months=="17"|TSD_months=="18") %>% filter (Pre_Mean_MonthSpecific!="NA")
str(data13to18iambS)

data19to24iamb <- res_amb %>% filter(TSD_months=="19"|TSD_months=="20"|TSD_months=="21"|TSD_months=="22"|TSD_months=="23"|TSD_months=="24")
data19to24iambS <- res_amb %>% filter(TSD_months=="19"|TSD_months=="20"|TSD_months=="21"|TSD_months=="22"|TSD_months=="23"|TSD_months=="24")%>% filter (Pre_Mean_MonthSpecific!="NA")
str(data19to24iamb)#38
str(data19to24iambS)#38

#### 14 MONTHS Resilience first year data####

res_metafor<- res %>% filter (TSD_months < 15)
str(res_metafor)
res_metafor$Fraction

data11to14<- allres %>% filter(TSD_months > "10" | TSD_months < "15")
str(data11to14)#359

data11ato14a<- recov %>% filter(TSD_months > "10" | TSD_months < "15")
str(data11ato14a)#465

##### Resilience Leaf fall ####

##Resilience Leaf fall##

data1lf<-reslf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1lf)#22
data1lfS<- data1lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data1lfS)#12 observations
data1lfS$Effectsize_ID
data1lfSS<-data1lf %>% filter(Effectsize_ID == "112"|Effectsize_ID == "113"|Effectsize_ID == "472"|Effectsize_ID == "780"|
                            Effectsize_ID == "1077"|Effectsize_ID == "1078"|Effectsize_ID == "1761"|Effectsize_ID == "1762"|Effectsize_ID == "1871"|Effectsize_ID == "1872"|Effectsize_ID == "2155"|Effectsize_ID == "2156")
str(data1lfSS)#12

data2lf<-reslf %>% filter(TSD_months=="3"|TSD_months=="4")
str(data2lf)#25
data2lfS<- data2lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data2lfS)#15 observations
data2lfS$Effectsize_ID
data2lfSS<-data2lf %>% filter(Effectsize_ID == "114"|Effectsize_ID == "115"|Effectsize_ID == "781"|Effectsize_ID == "782"|
                                Effectsize_ID == "1079"|Effectsize_ID == "1080"|Effectsize_ID == "1380"|Effectsize_ID == "1381"|Effectsize_ID == "1763"|Effectsize_ID == "1764"|Effectsize_ID == "1873"|Effectsize_ID == "1874"|Effectsize_ID == "2173"|Effectsize_ID == "2174"|Effectsize_ID == "2295")
str(data2lfSS)#12


data3lf<-reslf %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3lf)#26
data3lfS<- data3lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data3lfS)#18 observations
data3lfS$Effectsize_ID
data3lfSS<-data3lf %>% filter(Effectsize_ID == "1"|Effectsize_ID == "116"|Effectsize_ID == "117"|Effectsize_ID == "473"|Effectsize_ID == "783"|Effectsize_ID == "784"|
                                Effectsize_ID == "1081"|Effectsize_ID == "1082"|Effectsize_ID == "1645"|Effectsize_ID == "1646"|Effectsize_ID == "1765"|Effectsize_ID == "1766"|Effectsize_ID == "1875"|Effectsize_ID == "1876"|Effectsize_ID == "2159"|Effectsize_ID == "2160"|Effectsize_ID == "2280"|Effectsize_ID == "2281")
str(data3lfSS)#18

data4lf<-reslf %>%filter(TSD_months=="7"|TSD_months=="8")
str(data4lf)
data4lfS<- data4lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data4lfS)#23 observations
data4lfS$Effectsize_ID
data4lfSS<-data4lf %>% filter(Effectsize_ID == "118"|Effectsize_ID == "119"|Effectsize_ID == "292"|Effectsize_ID == "352"|Effectsize_ID == "412"|
                                Effectsize_ID == "474"|Effectsize_ID == "538"|Effectsize_ID == "785"|Effectsize_ID == "786"|Effectsize_ID == "1083"|Effectsize_ID == "1084"|Effectsize_ID == "1384"|Effectsize_ID == "1385"|Effectsize_ID == "1647"|Effectsize_ID == "1648"|Effectsize_ID == "1767"|Effectsize_ID == "1768"|Effectsize_ID == "1877"|Effectsize_ID == "1878"|Effectsize_ID == "2177"|Effectsize_ID == "2178"|Effectsize_ID == "2298"|Effectsize_ID == "2299")
str(data4lfSS)#23

data5lf<-reslf %>%filter(TSD_months=="9"|TSD_months=="10")
str(data5lf)#25
data5lfS<- data5lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data5lfS)#21 observations
data5lfS$Effectsize_ID
data5lfSS<-data5lf %>% filter(Effectsize_ID == "2"|Effectsize_ID == "13"|Effectsize_ID == "24"|Effectsize_ID == "120"|Effectsize_ID == "121"|
                                Effectsize_ID == "787"|Effectsize_ID == "788"|Effectsize_ID == "1085"|Effectsize_ID == "1086"|Effectsize_ID == "1386"|Effectsize_ID == "1387"|Effectsize_ID == "1649"|Effectsize_ID == "1650"|Effectsize_ID == "1769"|Effectsize_ID == "1770"|Effectsize_ID == "1879"|Effectsize_ID == "1880"|Effectsize_ID == "2179"|Effectsize_ID == "2180"|Effectsize_ID == "2300"|Effectsize_ID == "2301")
str(data5lfSS)#21

data6lf<-reslf %>%filter(TSD_months=="11"|TSD_months=="12")
str(data6lf)#30
data6lfS<- data6lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data6lfS)#26 observations
data6lfS$Effectsize_ID
data6lfSS<-data6lf %>% filter(Effectsize_ID == "3"|Effectsize_ID == "14"|Effectsize_ID == "25"|Effectsize_ID == "122"|Effectsize_ID == "123"|
                                Effectsize_ID == "293"|Effectsize_ID == "353"|Effectsize_ID == "413"|Effectsize_ID == "475"|Effectsize_ID == "539"|Effectsize_ID == "789"|Effectsize_ID == "790"|Effectsize_ID == "1087"|Effectsize_ID == "1088"|Effectsize_ID == "1388"|Effectsize_ID == "1389"|Effectsize_ID == "1880"|Effectsize_ID == "1651"|Effectsize_ID == "1771"|Effectsize_ID == "1772"|
                                Effectsize_ID == "1881"| Effectsize_ID == "1882"|Effectsize_ID == "2155"|Effectsize_ID == "2181"|Effectsize_ID == "2182"|Effectsize_ID == "2302"|Effectsize_ID == "2303")
str(data6lfSS)#26

data7lf<reslf %>%filter(TSD_months=="13"|TSD_months=="14")
str(data7lf)
data7lfS<- data7lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data7lfS)#14 observations
data7lfS$Effectsize_ID
data7lfSS<-data7lf %>% filter(Effectsize_ID == "124"|Effectsize_ID == "125"|Effectsize_ID == "354"|Effectsize_ID == "476"|Effectsize_ID == "791"|Effectsize_ID == "792"|Effectsize_ID == "1089"|Effectsize_ID == "1090"|Effectsize_ID == "1773"|Effectsize_ID == "1774"|
                                Effectsize_ID == "1883"|Effectsize_ID == "1884"|Effectsize_ID == "2167"|Effectsize_ID == "2168")
str(data7lfSS)#14

data8lf<-reslf %>%filter(TSD_months=="15"|TSD_months=="16")
str(data8lf)#19
data8lf$Effectsize_ID
data8lfS<- data8lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data8lfS)#17
data8lfS$Effectsize_ID
data8lfSS<- data8lf %>% filter(Effectsize_ID!="1655")%>% filter(Effectsize_ID!="1656")#to exclude a factor level
str(data8lfSS)#17
data8lfSS$Effectsize_ID

data9lf<-reslf %>%filter(TSD_months=="17"|TSD_months=="18")
str(data9lf)#24
data9lfS<- data9lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data9lfS)#24
data9lfSS<- data9lfS
str(data9lfSS)#24

data10lf<-reslf %>%filter(TSD_months=="19"|TSD_months=="20")
str(data10lf)#21
data10lfS<- data10lf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data10lfS)
data10lfSS<- data10lfS
str(data10lfSS)

data11lf<-reslf %>%filter(TSD_months=="21"|TSD_months=="22")
str(data11lf)
data11lfS<- data11lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data11lfS)
data11lfSS <- data11lfS
str(data11lfSS)

data12lf<-reslf %>%filter(TSD_months=="23"|TSD_months=="24")
str(data12lf)#18
data12lfS<- data12lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data12lfS)#18
data12lfSS <- data12lfS
str(data12lfSS)

data13lf<-reslf %>%filter(TSD_months=="25"|TSD_months=="26")
str(data13lf)#15
data13lfS<- data13lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data13lfS)#15
data13lfSS <- data13lfS
str(data13lfSS)#15

data14lf<-reslf %>%filter(TSD_months=="27"|TSD_months=="28")
str(data14lf)#13
data14lfS<- data14lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data14lfS)#13
data14lfSS <- data14lfS
str(data14lfSS)#13

data15lf<-reslf %>%filter(TSD_months=="29"|TSD_months=="30")
str(data15lf)#18
data15lfS<- data15lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data15lfS)#18
data15lfSS <- data15lfS
str(data15lfSS)#18

data16lf<-reslf %>%filter(TSD_months=="31"|TSD_months=="32")
str(data16lf)#13
data16lfS<- data16lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data16lfS)#13
data16lfSS <- data16lfS
str(data16lfSS)#13

data17lf<-reslf %>%filter(TSD_months=="33"|TSD_months=="34")
str(data17lf)#11
data17lfS<- data17lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data17lfS)#11
data17lfSS <- data17lfS
str(data17lfSS)#11

data18lf<-reslf %>%filter(TSD_months=="35"|TSD_months=="36")
str(data18lf)#17
data18lfS<- data18lf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data18lfS)#17
data18lfSS <- data18lfS
str(data18lfSS)#17

####### Resilience Wood fall#####

str(reswf)

## Resilience and Recovery wood fall ##

data1wf<-reswf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1wf)#23
data1wfS<- data1wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data1wfS)#13 observations
data1wfS$Effectsize_ID
data1wfSS<-data1wf %>% filter(Effectsize_ID == "172"|Effectsize_ID == "173"|Effectsize_ID == "488"|Effectsize_ID == "552"|
                                Effectsize_ID == "937"|Effectsize_ID == "1198"|Effectsize_ID == "1199"|Effectsize_ID == "1438"|Effectsize_ID == "1439"|Effectsize_ID == "1783"|Effectsize_ID == "1784"|Effectsize_ID == "1893"|Effectsize_ID == "1894")
str(data1wfSS)#13

data2wf<-reswf %>% filter(TSD_months=="3"|TSD_months=="4")
str(data2wf)#22
data2wfS<- data2wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data2wfS)#12 observations
data2wfS$Effectsize_ID
data2wfSS<-data2wf %>% filter(Effectsize_ID == "174"|Effectsize_ID == "175"|Effectsize_ID == "938"|Effectsize_ID == "939"|
                                Effectsize_ID == "1200"|Effectsize_ID == "1201"|Effectsize_ID == "1440"|Effectsize_ID == "1441"|Effectsize_ID == "1785"|Effectsize_ID == "1786"|Effectsize_ID == "1895"|Effectsize_ID == "1896")
str(data2wfSS)#12

data3wf<-reswf %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3wf)#20
data3wfS<- data3wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data3wfS)#14 observations
data3wfS$Effectsize_ID
data3wfSS<-data3wf %>% filter(Effectsize_ID == "176"|Effectsize_ID == "177"|Effectsize_ID == "489"|Effectsize_ID == "553"|
                                Effectsize_ID == "940"|Effectsize_ID == "941"|Effectsize_ID == "1202"|Effectsize_ID == "1203"|Effectsize_ID == "1442"|Effectsize_ID == "1443"|Effectsize_ID == "1787"|Effectsize_ID == "1788"|Effectsize_ID == "1897"|Effectsize_ID == "1898")
str(data3wfSS)#14

data4wf<-reswf %>%filter(TSD_months=="7"|TSD_months=="8")
str(data4wf)
data4wfS<- data4wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data4wfS)#17 observations
data4wfS$Effectsize_ID
data4wfSS<-data4wf %>% filter(Effectsize_ID == "178"|Effectsize_ID == "179"|Effectsize_ID == "307"|Effectsize_ID == "367"|
                                Effectsize_ID == "427"|Effectsize_ID == "490"|Effectsize_ID == "554"|Effectsize_ID == "942"|Effectsize_ID == "943"|Effectsize_ID == "1204"|Effectsize_ID == "1205"|Effectsize_ID == "1444"|Effectsize_ID == "1445"|Effectsize_ID == "1789"|Effectsize_ID == "1790"|Effectsize_ID == "1899"|Effectsize_ID == "1900")
str(data4wfSS)#17


data5wf<-reswf %>%filter(TSD_months=="9"|TSD_months=="10")
str(data5wf)#16
data5wfS<- data5wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data5wfS)#12 observations
data5wfS$Effectsize_ID
data5wfSS<-data5wf %>% filter(Effectsize_ID == "180"|Effectsize_ID == "181"|Effectsize_ID == "944"|Effectsize_ID == "945"|
                                Effectsize_ID == "1206"|Effectsize_ID == "1207"|Effectsize_ID == "1446"|Effectsize_ID == "1447"|Effectsize_ID == "1791"|Effectsize_ID == "1792"|Effectsize_ID == "1901"|Effectsize_ID == "1902")
str(data5wfSS)#12

data6wf<-reswf %>%filter(TSD_months=="11"|TSD_months=="12")
str(data6wf)#22
data6wfS<- data6wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data6wfS)#18observations
data6wfS$Effectsize_ID
data6wfSS<-data6wf %>% filter(Effectsize_ID == "182"|Effectsize_ID == "183"|Effectsize_ID == "308"|Effectsize_ID == "368"|Effectsize_ID == "428"|Effectsize_ID == "491"|
                                Effectsize_ID == "555"|Effectsize_ID == "946"|Effectsize_ID == "947"|Effectsize_ID == "1208"|Effectsize_ID == "1209"|Effectsize_ID == "1448"|Effectsize_ID == "1449"|Effectsize_ID == "1793"|Effectsize_ID == "1794"|Effectsize_ID == "1903"|Effectsize_ID == "1904"|Effectsize_ID == "2159")
str(data6wfSS)#18

data7wf<reswf %>%filter(TSD_months=="13"|TSD_months=="14")
str(data7wf)
data7wfS<- data7wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data7wfS)#12 observations
data7wfS$Effectsize_ID
data7wfSS<-data7wf %>% filter(Effectsize_ID == "184"|Effectsize_ID == "185"|Effectsize_ID == "369"|Effectsize_ID == "492"|Effectsize_ID == "948"|Effectsize_ID == "949"|Effectsize_ID == "1210"|Effectsize_ID == "1211"|Effectsize_ID == "1795"|Effectsize_ID == "1796"|
                                Effectsize_ID == "1905"|Effectsize_ID == "1906")
str(data7wfSS)#12

data8wf<-reswf %>%filter(TSD_months=="15"|TSD_months=="16")
str(data8wf)#12
data8wf$Effectsize_ID
data8wfS<- data8wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data8wfS)#12
data8wfS$Effectsize_ID
data8wfSS<- data8wf %>% filter(Effectsize_ID == "186"|Effectsize_ID == "187"|Effectsize_ID == "950"|Effectsize_ID == "951"|Effectsize_ID == "1212"|Effectsize_ID == "1213"|Effectsize_ID == "1452"|Effectsize_ID == "1453"|Effectsize_ID == "1797"|Effectsize_ID == "1798"|
                                 Effectsize_ID == "1907"|Effectsize_ID == "1908")
str(data8wfSS)#12
data8wfSS$Effectsize_ID

data9wf<-reswf %>%filter(TSD_months=="17"|TSD_months=="18")
str(data9wf)#17
data9wfS<- data9wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data9wfS)#17
data9wfSS<- data9wfS
str(data9wfSS)#24

data10wf<-reswf %>%filter(TSD_months=="19"|TSD_months=="20")
str(data10wf)#17
data10wfS<- data10wf %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data10wfS)#17
data10wfSS<- data10wfS
str(data10wfSS)#17

data11wf<-reswf %>%filter(TSD_months=="21"|TSD_months=="22")
str(data11wf)#10
data11wfS<- data11wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data11wfS)#10
data11wfSS <- data11wfS
str(data11wfSS)

data12wf<-reswf %>%filter(TSD_months=="23"|TSD_months=="24")
str(data12wf)#13
data12wf$Effectsize_ID
data12wfS<- data12wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data12wfS)#12
data12wfS$Effectsize_ID
data12wfSS <- data12wf %>% filter (Effectsize_ID!="2284")
str(data12wfSS)#12

data13wf<-reswf %>%filter(TSD_months=="25"|TSD_months=="26")
str(data13wf)#13
data13wfS<- data13wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data13wfS)#13
data13wfSS <- data13wfS
str(data13wfSS)#15

data14wf<-reswf %>%filter(TSD_months=="27"|TSD_months=="28")
str(data14wf)#8
data14wfS<- data14wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data14wfS)#8
data14wfSS <- data14wfS
str(data14wfSS)#8

data15wf<-reswf %>%filter(TSD_months=="29"|TSD_months=="30")
str(data15wf)#13
data15wfS<- data15wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data15wfS)#13
data15wfSS <- data15wfS
str(data15wfSS)#13

data16wf<-reswf %>%filter(TSD_months=="31"|TSD_months=="32")
str(data16wf)#12
data16wfS<- data16wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data16wfS)#12
data16wfSS <- data16wfS
str(data16wfSS)#12

data17wf<-reswf %>%filter(TSD_months=="33"|TSD_months=="34")
str(data17wf)#6
data17wfS<- data17wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data17wfS)#6
data17wfSS <- data17wfS
str(data17wfSS)#6

data18wf<-reswf %>%filter(TSD_months=="35"|TSD_months=="36")
str(data18wf)#13
data18wfS<- data18wf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data18wfS)#12
data18wf$Effectsize_ID
data18wfS$Effectsize_ID
data18wfSS <- data18wf %>% filter (Effectsize_ID!="2285")
str(data18wfSS)#12

##### Resilience FFS fall ####

data1ff<-resff %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1ff)#17
data1ffS<- data1ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data1ffS)#10 observations
data1ffS$Effectsize_ID
data1ffSS<-data1ff %>% filter(Effectsize_ID == "1258"|Effectsize_ID == "1259"|Effectsize_ID == "1558"|Effectsize_ID == "1559"|
                                Effectsize_ID == "1805"|Effectsize_ID == "1806"|Effectsize_ID == "1915"|Effectsize_ID == "1916"|Effectsize_ID == "2233"|Effectsize_ID == "2234")
str(data1ffSS)#10

data2ff<-resff %>% filter(TSD_months=="3"|TSD_months=="4")
str(data2ff)#17
data2ffS<- data2ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data2ffS)#11 observations
data2ffS$Effectsize_ID
data2ffSS<-data2ff %>% filter(Effectsize_ID == "1260"|Effectsize_ID == "1261"|Effectsize_ID == "1560"|Effectsize_ID == "1561"|
                                Effectsize_ID == "1807"|Effectsize_ID == "1808"|Effectsize_ID == "1917"|Effectsize_ID == "1918"|Effectsize_ID == "2235"|Effectsize_ID == "2236"|Effectsize_ID == "2304")
str(data2ffSS)#11

data3ff<-resff %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3ff)#18
data3ffS<- data3ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data3ffS)#14 observations
data3ffS$Effectsize_ID
data3ffSS<-data3ff %>% filter(Effectsize_ID == "1262"|Effectsize_ID == "1263"|Effectsize_ID == "1562"|Effectsize_ID == "1563"|
                                Effectsize_ID == "1694"|Effectsize_ID == "1695"|Effectsize_ID == "1809"|Effectsize_ID == "1810"|Effectsize_ID == "1919"|Effectsize_ID == "1920"|Effectsize_ID == "2237"|
                              Effectsize_ID == "2238"|Effectsize_ID == "2305"|Effectsize_ID == "2306")
str(data3ffSS)#14

data4ff<-resff %>%filter(TSD_months=="7"|TSD_months=="8")
str(data4ff)#18
data4ffS<- data4ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data4ffS)#14 observations
data4ffS$Effectsize_ID
data4ffSS<-data4ff %>% filter(Effectsize_ID == "1264"|Effectsize_ID == "1265"|Effectsize_ID == "1564"|Effectsize_ID == "1565"|
                                Effectsize_ID == "1696"|Effectsize_ID == "1697"|Effectsize_ID == "1811"|Effectsize_ID == "1812"|Effectsize_ID == "1921"|Effectsize_ID == "1922"|Effectsize_ID == "2239"|
                                Effectsize_ID == "2240"|Effectsize_ID == "2307"|Effectsize_ID == "2309")
str(data4ffSS)#14

data5ff<-resff %>%filter(TSD_months=="9"|TSD_months=="10")
str(data5ff)#16
data5ffS<- data5ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data5ffS)#12 observations
data5ffS$Effectsize_ID
data5ffSS<-data5ff %>% filter(Effectsize_ID == "1266"|Effectsize_ID == "1267"|Effectsize_ID == "1566"|Effectsize_ID == "1567"|
                                Effectsize_ID == "1698"|Effectsize_ID == "1699"|Effectsize_ID == "1813"|Effectsize_ID == "1814"|Effectsize_ID == "1923"|Effectsize_ID == "1924"|Effectsize_ID == "2241"|
                                Effectsize_ID == "2242"|Effectsize_ID == "2309"|Effectsize_ID == "2310")
str(data5ffSS)#14

data6ff<-resff %>%filter(TSD_months=="11"|TSD_months=="12")
str(data6ff)#17
data6ffS<- data6ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data6ffS)#13 observations
data6ffS$Effectsize_ID
data6ffSS<-data6ff %>% filter(Effectsize_ID == "1268"|Effectsize_ID == "1269"|Effectsize_ID == "1568"|Effectsize_ID == "1569"|
                                Effectsize_ID == "1700"|Effectsize_ID == "1815"|Effectsize_ID == "1816"|Effectsize_ID == "1925"|Effectsize_ID == "1926"|Effectsize_ID == "2243"|
                                Effectsize_ID == "2244"|Effectsize_ID == "2311"|Effectsize_ID == "2312")
str(data6ffSS)#13

data7ff<resff %>%filter(TSD_months=="13"|TSD_months=="14")
str(data7ff)#14
data7ffS<- data7ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data7ffS)#10 observations
data7ffS$Effectsize_ID
data7ffSS<-data7ff %>% filter(Effectsize_ID == "1270"|Effectsize_ID == "1271"|Effectsize_ID == "1817"|Effectsize_ID == "1818"|
                                Effectsize_ID == "1927"|Effectsize_ID == "1928"|Effectsize_ID == "2229"|Effectsize_ID == "2230"|Effectsize_ID == "2297"|Effectsize_ID == "2298")
str(data7ffSS)#10

data8ff<-resff %>%filter(TSD_months=="15"|TSD_months=="16")
str(data8ff)#13
data8ff$Effectsize_ID
data8ffS<- data8ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data8ffS)#11
data8ffS$Effectsize_ID
data8ffSS<- data8ff %>% filter(Effectsize_ID == "1272"|Effectsize_ID == "1273"|Effectsize_ID == "1572"|Effectsize_ID == "1573"|
                                 Effectsize_ID == "1819"|Effectsize_ID == "1820"|Effectsize_ID == "1929"|Effectsize_ID == "1930"|Effectsize_ID == "2247"|Effectsize_ID == "2248"|Effectsize_ID == "2315")
str(data8ffSS)#11

data9ff<-resff %>%filter(TSD_months=="17"|TSD_months=="18")
str(data9ff)#12
data9ffS<- data9ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data9ffS)#12
data9ffSS<- data9ffS
str(data9ffSS)#12

data10ff<-resff %>%filter(TSD_months=="19"|TSD_months=="20")
str(data10ff)#12
data10ffS<- data10ff %>% filter(Pre_Mean_MonthSpecific!="NA")#to exclude a factor level
str(data10ffS)#12
data10ffSS<- data10ffS
str(data10ffSS)#12

data11ff<-resff %>%filter(TSD_months=="21"|TSD_months=="22")
str(data11ff)#9
data11ffS<- data11ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data11ffS)#9
data11ffSS <- data11ffS
str(data11ffSS)

data12ff<-resff %>%filter(TSD_months=="23"|TSD_months=="24")
str(data12ff)#6
data12ff$Effectsize_ID
data12ffS<- data12ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data12ffS)#6
data12ffS$Effectsize_ID
data12ffSS <- data12ffS
str(data12ffSS)#12

data13ff<-resff %>%filter(TSD_months=="25"|TSD_months=="26")
str(data13ff)#6
data13ffS<- data13ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data13ffS)#6
data13ffSS <- data13ffS
str(data13ffSS)#15

data14ff<-resff %>%filter(TSD_months=="27"|TSD_months=="28")
str(data14ff)#6
data14ffS<- data14ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data14ffS)#6
data14ffSS <- data14ffS
str(data14ffSS)#6

data15ff<-resff %>%filter(TSD_months=="29"|TSD_months=="30")
str(data15ff)#6
data15ffS<- data15ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data15ffS)#6
data15ffSS <- data15ffS
str(data15ffSS)#6

data16ff<-resff %>%filter(TSD_months=="31"|TSD_months=="32")
str(data16ff)#6
data16ffS<- data16ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data16ffS)#6
data16ffSS <- data16ffS
str(data16ffSS)#12

data17ff<-resff %>%filter(TSD_months=="33"|TSD_months=="34")
str(data17ff)#6
data17ffS<- data17ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data17ffS)#6
data17ffSS <- data17ffS
str(data17ffSS)#6

data18ff<-resff %>%filter(TSD_months=="35"|TSD_months=="36")
str(data18ff)#6
data18ffS<- data18ff %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data18ffS)#6
data18ffSS <- data18ffS
str(data18ffSS)#12


####Resilience Miscellaneous fall####


data1mf<-resmf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1mf)#29
data2mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2mf)#35
data3mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3mf)#32
data4mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4mf)#33
data5mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5mf)#25
data6mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6mf)#28
data7mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7mf)#24
data8mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8mf)#21
data9mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9mf)#23
data10mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10mf)#23
data11mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11mf)#18
data12mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12mf)#16
data13mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13mf)#12
data14mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14mf)#6
data15mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15mf)#12
data16mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16mf)#8
data17mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17mf)#5
data18mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="35"|TSD_months=="36")
str(data1mf)#9
data19mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="37"|TSD_months=="38")
str(data19mf)#8
data20mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="39"|TSD_months=="40")
str(data20mf)#6
data21mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="41"|TSD_months=="42")
str(data21mf)#8
data22mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="43"|TSD_months=="44")
str(data22mf)#8
data23mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="45"|TSD_months=="46")
str(data23mf)#6
data24mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="47"|TSD_months=="48")
str(data24mf)#9
data25mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="49"|TSD_months=="50")
str(data25mf)#7
data26mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="51"|TSD_months=="52")
str(data26mf)#6
data27mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="53"|TSD_months=="54")
str(data27mf)#6
data28mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="55"|TSD_months=="56")
str(data28mf)#6
data29mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="57"|TSD_months=="58")
str(data29mf)#8
data30mf<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="Misc fall")%>%filter(TSD_months=="59"|TSD_months=="60")
str(data30mf)#9


#### Total Litterfall P flux ####

data1tpf<-restpf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1tpf)#10
data2tpf<-restpf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2tpf)#13
data3tpf<-restpf %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3tpf)#11
data4tpf<-restpf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4tpf)#8
data5tpf<-restpf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5tpf)#9
data6tpf<-restpf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6tpf)#9
data7tpf<-restpf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7tpf)#6
data8tpf<-restpf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8tpf)#7
data9tpf<-restpf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9tpf)#6
data10tpf<-restpf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10tpf)#6
data11tpf<-restpf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11tpf)#6
data12tpf<-restpf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12tpf)#6
data13tpf<-restpf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13tpf)#6
data14tpf<-restpf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14tpf)#6
data15tpf<-restpf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15tpf)#6
data16tpf<-restpf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16tpf)#5
data17tpf<-restpf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17tpf)#3
data18tpf<-restpf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18tpf)#2

#### Leaf fall P flux ####

data1lpf<-reslpf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1lpf)#10
data2lpf<-reslpf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2lpf)#13
data3lpf<-reslpf %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3tpf)#11
data4lpf<-reslpf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4lpf)#8
data5lpf<-reslpf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5lpf)#9
data6lpf<-reslpf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6lpf)#9
data7lpf<-reslpf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7lpf)#6
data8lpf<-reslpf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8lpf)#7
data9lpf<-reslpf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9lpf)#6
data10lpf<-reslpf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10lpf)#6
data11lpf<-reslpf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11lpf)#6
data12lpf<-reslpf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12lpf)#6
data13lpf<-reslpf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13lpf)#6
data14lpf<-reslpf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14lpf)#6
data15lpf<-reslpf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15lpf)#6
data16lpf<-reslpf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16lpf)#5
data17lpf<-reslpf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17lpf)#3
data18lpf<-reslpf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18lpf)#2


#### Wood fall P flux ####

data1wpf<-reswpf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1wpf)#8
data2wpf<-reswpf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2wpf)#13
data3wpf<-reswpf %>%filter(TSD_months=="5"|TSD_months=="6")
str(data3wpf)#11
data4wpf<-reswpf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4wpf)#8
data5wpf<-reswpf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5wpf)#9
data6wpf<-reswpf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6wpf)#9
data7wpf<-reswpf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7wpf)#6
data8wpf<-reswpf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8wpf)#7
data9wpf<-reswpf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9wpf)#6
data10wpf<-reswpf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10wpf)#6
data11wpf<-reswpf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11wpf)#6
data12wpf<-reswpf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12wpf)#6
data13wpf<-reswpf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13wpf)#6
data14wpf<-reswpf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14wpf)#6
data15wpf<-reswpf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15wpf)#6
data16wpf<-reswpf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16wpf)#5
data17wpf<-reswpf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17wpf)#3
data18wpf<-reswpf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18wpf)#2

##FFS fall P flux####

data1ffpf<-resffpf %>%filter(TSD_months=="1"|TSD_months=="2")
str(data1ffpf)#5
data2ffpf<-resffpf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2ffpf)#13
data3ffpf<-resffpf%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3ffpf)#11
data4ffpf<-resffpf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4ffpf)#8
data5ffpf<-resffpf %>%filter(TSD_months=="9"|TSD_months=="10")
str(data5ffpf)#9
data6ffpf<-resffpf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6ffpf)#9
data7ffpf<-resffpf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7ffpf)#6
data8ffpf<-resffpf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8ffpf)#7
data9ffpf<-resffpf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9ffpf)#6
data10ffpf<-resffpf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10ffpf)#6
data11ffpf<-resffpf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11ffpf)#6
data12ffpf<-resffpf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12ffpf)#6
data13ffpf<-resffpf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13ffpf)#6
data14ffpf<-resffpf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14ffpf)#6
data15ffpf<-resffpf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15ffpf)#6
data16ffpf<-resffpf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16ffpf)#5
data17ffpf<-resffpf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17ffpf)#3
data18ffpf<-resffpf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18ffpf)#2

####Litterfall C flux####

data1tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1tcf)#6
data2tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2tcf)#6
data3tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3tcf)#11
data4tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4tcf)#8
data5tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5tcf)#9
data6tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6tcf)#9
data7tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7tcf)#6
data8tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8tcf)#7
data9tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9tcf)#6
data10tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10tcf)#6
data11tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11tcf)#6
data12tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12tcf)#6
data13tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13tcf)#6
data14tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14tcf)#6
data15tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15tcf)#6
data16tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16tcf)#5
data17tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17tcf)#3
data18tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18tcf)#2
data19tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="37"|TSD_months=="38")
str(data19tcf)#2
data20tpf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="39"|TSD_months=="40")
str(data20tcf)#2
data21tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="41"|TSD_months=="42")
str(data21tcf)#2
data22tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="43"|TSD_months=="44")
str(data22tcf)#2
data23tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="45"|TSD_months=="46")
str(data23tcf)#2
data24tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="47"|TSD_months=="48")
str(data24tcf)#2
data25tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="49"|TSD_months=="50")
str(data25tcf)#2
data26tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="51"|TSD_months=="52")
str(data26tcf)#2
data27tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="53"|TSD_months=="54")
str(data27tcf)#2
data28tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="55"|TSD_months=="56")
str(data28tcf)#2
data29tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="57"|TSD_months=="58")
str(data29tcf)#2
data30tcf<-nutmeta %>%filter(Fraction=="TotLitfall")%>%filter(Variable=="C") %>%filter(Raw_Unit=="mg/m2/day")%>%filter(TSD_months=="59"|TSD_months=="60")
str(data30tcf)#2


#### P concentration ####

## Resilience ##

data1lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1lpc)#2
data2lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2lpc)#13
data3lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3lpc)#11
data4lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4lpc)#8
data5lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5lpc)#9
data6lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6lpc)#9
data7lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7lpc)#6
data8lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8lpc)#7
data9lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9lpc)#6
data10lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10lpc)#6
data11lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11lpc)#6
data12lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12lpc)#6
data13lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13lpc)#6
data14lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14lpc)#6
data15lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15lpc)#6
data16lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16lpc)#5
data17lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17lpc)#3
data18lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18lpc)#2
data19lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="37"|TSD_months=="38")
str(data19lpc)#2
data20lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="39"|TSD_months=="40")
str(data20lpc)#2
data21lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="41"|TSD_months=="42")
str(data21lpc)#2
data22lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="43"|TSD_months=="44")
str(data22lpc)#2
data23lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="45"|TSD_months=="46")
str(data23lpc)#2
data24lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="47"|TSD_months=="48")
str(data24lpc)#2
data25lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="49"|TSD_months=="50")
str(data25lpc)#2
data26lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="51"|TSD_months=="52")
str(data26lpc)#2
data27lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="53"|TSD_months=="54")
str(data27lpc)#2
data28lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="55"|TSD_months=="56")
str(data28lpc)#2
data29lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="57"|TSD_months=="58")
str(data29lpc)#2
data30lpc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="P") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="59"|TSD_months=="60")
str(data30lpc)#2


#### Total Litterfall N flux ####

data1tnf<-restnf%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1tnf)#10
data2tnf<-restnf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2tnf)#13
data3tnf<-restnf%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3tnf)#11
data4tnf<-restnf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4tnf)#8
data5tnf<-restnf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5tnf)#9
data6tnf<-restnf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6tnf)#9
data7tnf<-restnf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7tnf)#6
data8tnf<-restnf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8tnf)#7
data9tnf<-restnf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9tnf)#6
data10tnf<-restnf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10tnf)#6
data11tnf<-restnf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11tnf)#6
data12tnf<-restnf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12tnf)#6
data13tnf<-restnf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13tnf)#6
data14tnf<-restnf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14tnf)#6
data15tnf<-restnf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15tnf)#6
data16tnf<-restnf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16tnf)#5
data17tnf<-restnf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17tnf)#3
data18tnf<-restnf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18tnf)#2

#### Leaf fall N flux ####

data1lnf<-reslnf%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1lnf)#10
data2lnf<-reslnf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2lnf)#13
data3lnf<-reslnf%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3lnf)#11
data4lnf<-reslnf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4lnf)#8
data5lnf<-reslnf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5lnf)#9
data6lnf<-reslnf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6lnf)#9
data7lnf<-reslnf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7lnf)#6
data8lnf<-reslnf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8lnf)#7
data9lnf<-reslnf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9lnf)#6
data10lnf<-reslnf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10lnf)#6
data11lnf<-reslnf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11lnf)#6
data12lnf<-reslnf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12lnf)#6
data13lnf<-reslnf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13lnf)#6
data14lnf<-reslnf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14lnf)#6
data15lnf<-reslnf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15lnf)#6
data16lnf<-reslnf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16lnf)#5
data17lnf<-reslnf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17lnf)#3
data18lnf<-reslnf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18lnf)#2

##Wood fall N flux####

data1wnf<-reswnf%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1wnf)#8
data2wnf<-reswnf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2wnf)#13
data3wnf<-reswnf%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3wnf)#11
data4wnf<-reswnf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4wnf)#8
data5wnf<-reswnf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5wnf)#9
data6wnf<-reswnf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6wnf)#9
data7wnf<-reswnf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7wnf)#6
data8wnf<-reswnf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8wnf)#7
data9wnf<-reswnf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9wnf)#6
data10wnf<-reswnf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10wnf)#6
data11wnf<-reswnf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11wnf)#6
data12wnf<-reswnf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12wnf)#6
data13wnf<-reswnf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13wnf)#6
data14wnf<-reswnf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14wnf)#6
data15wnf<-reswnf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15wnf)#6
data16wnf<-reswnf%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16wnf)#5
data17wnf<-reswnf%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17wnf)#3
data18wnf<-reswnf%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18wnf)#2

##FFS fall N flux####

data1ffnf<-resffnf%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1ffnf)#5
data2ffnf<-resffnf%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2ffnf)#6
data3ffnf<-resffnf%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3ffnf)#11
data4ffnf<-resffnf%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4ffnf)#8
data5ffnf<-resffnf%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5ffnf)#9
data6ffnf<-resffnf%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6ffnf)#9
data7ffnf<-resffnf%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7ffnf)#6
data8ffnf<-resffnf%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8ffnf)#7
data9ffnf<-resffnf%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9ffnf)#6
data10ffnf<-resffnf%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10ffnf)#6
data11ffnf<-resffnf%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11ffnf)#6
data12ffnf<-resffnf%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12ffnf)#4
data13ffnf<-resffnf%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13ffnf)#6
data14ffnf<-resffnf%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14ffnf)#6
data15ffnf<-resffnf%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15ffnf)#4
data16ffnf<-resffnf%>%filter(TSD_months=="31"|TSD_months=="33")
str(data16ffnf)#2

## N concentration ##

data1lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="1"|TSD_months=="2")
str(data1lnc)#2
data2lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="3"|TSD_months=="4")
str(data2lnc)#13
data3lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="5"|TSD_months=="6")
str(data3lnc)#11
data4lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="7"|TSD_months=="8")
str(data4lnc)#8
data5lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="9"|TSD_months=="10")
str(data5lnc)#9
data6lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="11"|TSD_months=="12")
str(data6lnc)#9
data7lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="13"|TSD_months=="14")
str(data7lnc)#6
data8lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="15"|TSD_months=="16")
str(data8lnc)#7
data9lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="17"|TSD_months=="18")
str(data9lnc)#6
data10lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="19"|TSD_months=="20")
str(data10lnc)#6
data11lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="21"|TSD_months=="22")
str(data11lnc)#6
data12lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="23"|TSD_months=="24")
str(data12lnc)#6
data13lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="25"|TSD_months=="26")
str(data13lnc)#6
data14lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="27"|TSD_months=="28")
str(data14lnc)#6
data15lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="29"|TSD_months=="30")
str(data15lnc)#6
data16lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="31"|TSD_months=="32")
str(data16lnc)#5
data17lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="33"|TSD_months=="34")
str(data17lnc)#3
data18lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="35"|TSD_months=="36")
str(data18lnc)#2
data19lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="37"|TSD_months=="38")
str(data19lnc)#2
data20lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="39"|TSD_months=="40")
str(data20lnc)#2
data21lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="41"|TSD_months=="42")
str(data21lnc)#2
data22lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="43"|TSD_months=="44")
str(data22lnc)#2
data23lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="45"|TSD_months=="46")
str(data23lnc)#2
data24lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="47"|TSD_months=="48")
str(data24lnc)#2
data25lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="49"|TSD_months=="50")
str(data25lnc)#2
data26lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="51"|TSD_months=="52")
str(data26lnc)#2
data27lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="53"|TSD_months=="54")
str(data27lnc)#2
data28lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="55"|TSD_months=="56")
str(data28lnc)#2
data29lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="57"|TSD_months=="58")
str(data29lnc)#2
data30lnc<-nutmeta %>%filter(Fraction=="Leaf fall")%>%filter(Variable=="N") %>%filter(Raw_Unit=="mg/g")%>%filter(TSD_months=="59"|TSD_months=="60")
str(data30lnc)#2


######### STEP 2 ###### Calculating Effect sizes #####

##Mass All Effect sizes 1 to 36####

data_esall <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = res_all, measure = "ROM")
str(data_esall)#1570 obs.

res_allS<-res_all %>% filter(Pre_Mean_MonthSpecific!="NA")

data_esallS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = res_allS, measure = "ROM")
str(data_esallS)#1353

data_esallSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = res_allS, measure = "ROM")
str(data_esallSS)#1353

##Nutrients All Effect sizes 1 to 36####

##P flux all

data_es_pf_all <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = res_pf, measure = "ROM")
str(data_es_pf_all)#561 obs.

data_pf_allS<-res_pf %>% filter(Pre_Mean_MonthSpecific!="NA")
str(data_pf_allS)

data_es_pf_allS <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data_pf_allS, measure = "ROM")
str(data_es_pf_allS)#72

data_es_pf_allSS <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data_pf_allS, measure = "ROM")
str(data_es_pf_allSS )#72

##N flux all

data_es_nf_all <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                          sd1i = Post_SD, sd2i = Pre_SD, data = res_nf, measure = "ROM")
str(data_es_nf_all)#558 obs.

data_nf_allS<-res_nf %>% filter(Pre_Mean_MonthSpecific!="NA")

data_es_nf_allS <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                           sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data_nf_allS, measure = "ROM")
str(data_es_nf_allS)#144

data_es_nf_allSS <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data_nf_allS, measure = "ROM")
str(data_es_nf_allSS)#144

##P concentration all

data_es_pc_all <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = res_pc, measure = "ROM")
str(data_es_pc_all)#182 obs.

##N concentration all

data_es_nc_all <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = res_nc, measure = "ROM")
str(data_es_nc_all)#181 obs.

####RESILIENCE Total Literfall####

#long-term pre mean with all sites
data_es1i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data1, measure = "ROM")
#including only sites with pre-mean specific for the disturbance month
data_es1iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1S, measure = "ROM")
#long-term pre mean for sites that also have subannual data
data_es1iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data1SS, measure = "ROM")

data_es2i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data2, measure = "ROM")
data_es2iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data2S, measure = "ROM")
data_es2iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data2SS, measure = "ROM")

data_es3i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data3, measure = "ROM")
data_es3iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3S, measure = "ROM")
data_es3iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data3SS, measure = "ROM")


data_es4i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data4, measure = "ROM")
data_es4iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data4S, measure = "ROM")
data_es4iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i =Pre_SD, data = data4SS, measure = "ROM")

data_es5i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data5, measure = "ROM")
data_es5iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data5S, measure = "ROM")
data_es5iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data5SS, measure = "ROM")


data_es6i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data6, measure = "ROM")
data_es6iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data6S, measure = "ROM")
data_es6iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data6SS, measure = "ROM")


data_es7i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data7, measure = "ROM")
data_es7iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data7S, measure = "ROM")
data_es7iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data7SS, measure = "ROM")

data_es8i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data8, measure = "ROM")
data_es8iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data8S, measure = "ROM")
data_es8iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data8SS, measure = "ROM")

data_es9i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data9, measure = "ROM")
data_es9iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data9S, measure = "ROM")
data_es9iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data9SS, measure = "ROM")

data_es10i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data10, measure = "ROM")
data_es10iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data10S, measure = "ROM")
data_es10iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data10SS, measure = "ROM")

data_es11i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data11, measure = "ROM")
data_es11iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data11S, measure = "ROM")
data_es11iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i =Pre_SD, data = data11SS, measure = "ROM")

data_es12i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data12, measure = "ROM")
data_es12iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data12S, measure = "ROM")
data_es12iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data12SS, measure = "ROM")

data_es13i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data13, measure = "ROM")
data_es13iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data13S, measure = "ROM")
data_es13iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data13SS, measure = "ROM")

data_es14i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data14, measure = "ROM")
data_es14iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data14S, measure = "ROM")
data_es14iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data14SS, measure = "ROM")

data_es15i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data15, measure = "ROM")
data_es15iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data15S, measure = "ROM")
data_es15iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data15SS, measure = "ROM")

data_es16i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data16, measure = "ROM")
data_es16iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data16S, measure = "ROM")
data_es16iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data16SS, measure = "ROM")

data_es17i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data17, measure = "ROM")
data_es17iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data17S, measure = "ROM")
data_es17iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data17SS, measure = "ROM")

data_es18i <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data18, measure = "ROM")
data_es18iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data18S, measure = "ROM")
data_es18iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data18SS, measure = "ROM")

#### 1 to 6 Effect Sizes ####

data_es1to6i<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1to6i, measure = "ROM")
data_es1to6iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                           sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1to6iS, measure = "ROM")
data_es1to6iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data1to6iS, measure = "ROM")

#### 3 to 6 Ambient Effect Sizes ####

data_es3to6iamb<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3to6iamb, measure = "ROM")
data_es3to6iambS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3to6iambS, measure = "ROM")
data_es3to6iambSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3to6iambS, measure = "ROM")

#### 3 to 6 All Treatments Effect Sizes ####

data_es3to6i<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data3to6i, measure = "ROM")
data_es3to6iS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                           sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3to6iS, measure = "ROM")
data_es3to6iSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data3to6iS, measure = "ROM")

#long-term pre mean with all sites
data_es1iamb <- data_es1i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es1iSamb <- data_es1iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es1iSSamb <- data_es1iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es2iamb <- data_es2i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es2iSamb <- data_es2iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es2iSSamb <- data_es2iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es3iamb <- data_es3i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es3iSamb <- data_es3iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es3iSSamb <- data_es3iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es4iamb <- data_es4i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es4iSamb <- data_es4iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es4iSSamb <- data_es4iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es5iamb <- data_es5i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es5iSamb <- data_es5iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es5iSSamb <- data_es5iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es6iamb <- data_es6i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es6iSamb <- data_es6iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es6iSSamb <- data_es6iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es7iamb <- data_es7i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es7iSamb <- data_es7iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es7iSSamb <- data_es7iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es8iamb <- data_es8i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es8iSamb <- data_es8iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es8iSSamb <- data_es8iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es9iamb <- data_es9i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es9iSamb <- data_es9iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es9iSSamb <- data_es9iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es10iamb <- data_es10i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es10iSamb <- data_es10iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es10iSSamb <- data_es10iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es11iamb <- data_es11i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es11iSamb <- data_es11iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es11iSSamb <- data_es11iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es12iamb <- data_es12i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es12iSamb <- data_es12iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es12iSSamb <- data_es12iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es13iamb <- data_es13i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es13iSamb <- data_es13iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es13iSSamb <- data_es13iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es14iamb <- data_es14i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es14iSamb <- data_es14iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es14iSSamb <- data_es14iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es15iamb <- data_es15i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es15iSamb <- data_es15iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es15iSSamb <- data_es15iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es16iamb <- data_es16i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es16iSamb <- data_es16iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es16iSSamb <- data_es16iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es17iamb <- data_es17i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es17iSamb <- data_es17iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es17iSSamb <- data_es17iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

data_es18iamb <- data_es18i %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#including only sites with pre-mean specific for the disturbance month
data_es18iSamb <- data_es18iS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")
#long-term pre mean for sites that also have subannual data
data_es18iSSamb <- data_es18iSS %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")

#### 1-14 months RESILIENCE####

## Calculations

#1to6

data_es1to6iamb<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data1to6iamb, measure = "ROM")
str(data_es1to6iamb)#86
forest(data_es1to6iamb$yi, data_es1to6iamb$vi)

data_es1to6iambS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                         sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1to6iambS, measure = "ROM")
str(data_es1to6iambS)#59
forest(data_es1to6iambS$yi, data_es1to6iambS$vi)

data_es1to6iambSS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                          sd1i = Post_SD, sd2i = Pre_SD, data = data1to6iambS, measure = "ROM")
str(data_es1to6iambSS)#59

##7to12

data_es7to12iamb <-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                          sd1i = Post_SD, sd2i = Pre_SD, data = data7to12iamb , measure = "ROM")
str(data_es7to12iamb)#74
data_es7to12iambS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                          sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data7to12iambS, measure = "ROM")
str(data_es7to12iambS)#57
data_es7to12iambSS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                           sd1i = Post_SD, sd2i = Pre_SD, data = data7to12iambS, measure = "ROM")
str(data_es7to12iambSS)#57


#13to18

data_es13to18iamb <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data13to18iamb , measure = "ROM")
str(data_es13to18iamb)#57
data_es13to18iambS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                           sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data13to18iambS, measure = "ROM")
str(data_es13to18iambS)#51
data_es13to18iambSS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data13to18iambS, measure = "ROM")
str(data_es13to18iamb )#57



data_es19to24iamb <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data19to24iamb , measure = "ROM")
str(data_es19to24iamb)#38
data_es19to24iambS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                           sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data19to24iambS, measure = "ROM")
str(data_es19to24iambS)#38
data_es19to24iambSS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                            sd1i = Post_SD, sd2i = Pre_SD, data = data19to24iambS, measure = "ROM")
str(data_es19to24iamb )#38


data_es1to14<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = res_metafor, measure = "ROM")
str(data_es1to14)#n = 248

data_es1to14S<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = res_metaforS, measure = "ROM")
str(data_es1to14S)
data_es1to14S$Effectsize_ID

data_es1to14SS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = res_metaforS, measure = "ROM")
str(data_es1to14SS)
data_es1to14SS$Effectsize_ID

#### 1-36 months RESILIENCE####

data_es1to36<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = res_temp, measure = "ROM")
str(data_es1to36)#n = 465

### Site-level resilience 
levels(data_es1to36$Site)

res_tempS<- res_temp %>% filter(Pre_Mean_MonthSpecific!="NA")
str(res_tempS)#n=381

data_es1to36S<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = res_tempS, measure = "ROM")
str(data_es1to36S)
data_es1to14S$Effectsize_ID

data_es1to36SS<-escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = res_tempS, measure = "ROM")
str(data_es1to36SS)
data_es1to14SS$Effectsize_ID


data_es1to4 <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data1to4, measure = "ROM")
data_es1to4S <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1to4S, measure = "ROM")
data_es1to12 <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1to12, measure = "ROM")

data_es5to10 <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5to10, measure = "ROM")
data_es11to14 <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data11to14, measure = "ROM")
data_es5to10S <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data5to10S, measure = "ROM")
data_es6iallS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data6allS, measure = "ROM")
data_es11to14S <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                         sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data11to14S, measure = "ROM")
data_es6iall <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6all, measure = "ROM")
data_es12iall <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data12all, measure = "ROM")

####Leaf fall Effect Sizes####

#long-term pre mean with all sites
data_es1ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data1lf, measure = "ROM")
#including only sites with pre-mean specific for the disturbance month
data_es1ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1lfS, measure = "ROM")
#long-term pre mean for sites that also have subannual data
data_es1ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data1lfSS, measure = "ROM")

data_es2ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data2lf, measure = "ROM")
data_es2ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data2lfS, measure = "ROM")
data_es2ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data2lfSS, measure = "ROM")

data_es3lfi <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data3lf, measure = "ROM")
data_es3ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3lfS, measure = "ROM")
data_es3ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data3lfSS, measure = "ROM")


data_es4lfi <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data4lf, measure = "ROM")
data_es4ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data4lfS, measure = "ROM")
data_es4ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i =Pre_SD, data = data4lfSS, measure = "ROM")

data_es5ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data5lf, measure = "ROM")
data_es5ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data5lfS, measure = "ROM")
data_es5ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data5lfSS, measure = "ROM")


data_es6ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data6lf, measure = "ROM")
data_es6ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data6lfS, measure = "ROM")
data_es6ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data6lfSS, measure = "ROM")


data_es7ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data7lf, measure = "ROM")
data_es7ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data7lfS, measure = "ROM")
data_es7ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data7lfSS, measure = "ROM")

data_es8ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data8lf, measure = "ROM")
data_es8ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data8lfS, measure = "ROM")
data_es8ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data8lfSS, measure = "ROM")

data_es9ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data9lf, measure = "ROM")
data_es9ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data9lfS, measure = "ROM")
data_es9ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data9lfSS, measure = "ROM")

data_es10ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data10lf, measure = "ROM")
data_es10ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data10lfS, measure = "ROM")
data_es10ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10lfSS, measure = "ROM")

data_es11ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data11lf, measure = "ROM")
data_es11ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data11lfS, measure = "ROM")
data_es11ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i =Pre_SD, data = data11lfSS, measure = "ROM")

data_es12ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data12lf, measure = "ROM")
data_es12ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data12lfS, measure = "ROM")
data_es12ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12lfSS, measure = "ROM")

data_es13ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data13lf, measure = "ROM")
data_es13ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data13lfS, measure = "ROM")
data_es13ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13lfSS, measure = "ROM")

data_es14ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data14lf, measure = "ROM")
data_es14ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data14lfS, measure = "ROM")
data_es14ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14lfSS, measure = "ROM")

data_es15ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data15lf, measure = "ROM")
data_es15ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data15lfS, measure = "ROM")
data_es15ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15lfSS, measure = "ROM")

data_es16ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data16lf, measure = "ROM")
data_es16ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data16lfS, measure = "ROM")
data_es16ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16lfSS, measure = "ROM")

data_es17ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data17lf, measure = "ROM")
data_es17ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data17lfS, measure = "ROM")
data_es17ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17lfSS, measure = "ROM")

data_es18ilf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data18lf, measure = "ROM")
data_es18ilfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data18lfS, measure = "ROM")
data_es18ilfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18lfSS, measure = "ROM")

##Wood fall Effect Sizes####

#long-term pre mean with all sites
data_es1iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data1wf, measure = "ROM")
#including only sites with pre-mean specific for the disturbance month
data_es1iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1wfS, measure = "ROM")
#long-term pre mean for sites that also have subannual data
data_es1iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data1wfSS, measure = "ROM")

data_es2iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data2wf, measure = "ROM")
data_es2iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data2wfS, measure = "ROM")
data_es2iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data2wfSS, measure = "ROM")

data_es3wfi <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data3wf, measure = "ROM")
data_es3iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3wfS, measure = "ROM")
data_es3iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data3wfSS, measure = "ROM")


data_es4iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data4wf, measure = "ROM")
data_es4iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data4wfS, measure = "ROM")
data_es4iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i =Pre_SD, data = data4wfSS, measure = "ROM")

data_es5iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data5wf, measure = "ROM")
data_es5iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data5wfS, measure = "ROM")
data_es5iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data5wfSS, measure = "ROM")

data_es6iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data6wf, measure = "ROM")
data_es6iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data6wfS, measure = "ROM")
data_es6iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data6wfSS, measure = "ROM")


data_es7iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data7wf, measure = "ROM")
data_es7iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data7wfS, measure = "ROM")
data_es7iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data7wfSS, measure = "ROM")

data_es8iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data8wf, measure = "ROM")
data_es8iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data8wfS, measure = "ROM")
data_es8iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data8wfSS, measure = "ROM")

data_es9iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                    sd1i = Post_SD, sd2i = Pre_SD, data = data9wf, measure = "ROM")
data_es9iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                     sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data9wfS, measure = "ROM")
data_es9iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data9wfSS, measure = "ROM")

data_es10iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data10wf, measure = "ROM")
data_es10iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data10wfS, measure = "ROM")
data_es10iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10wfSS, measure = "ROM")

data_es11iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data11wf, measure = "ROM")
data_es11iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data11wfS, measure = "ROM")
data_es11iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i =Pre_SD, data = data11wfSS, measure = "ROM")

data_es12iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data12wf, measure = "ROM")
data_es12iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data12wfS, measure = "ROM")
data_es12iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12wfSS, measure = "ROM")

data_es13iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data13wf, measure = "ROM")
data_es13iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data13wfS, measure = "ROM")
data_es13iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13wfSS, measure = "ROM")

data_es14iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data14wf, measure = "ROM")
data_es14iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data14wfS, measure = "ROM")
data_es14iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14wfSS, measure = "ROM")

data_es15iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data15wf, measure = "ROM")
data_es15iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data15wfS, measure = "ROM")
data_es15iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15wfSS, measure = "ROM")

data_es16iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data16wf, measure = "ROM")
data_es16iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data16wfS, measure = "ROM")
data_es16iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16wfSS, measure = "ROM")

data_es17iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data17wf, measure = "ROM")
data_es17iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data17wfS, measure = "ROM")
data_es17iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17wfSS, measure = "ROM")

data_es18iwf <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data18wf, measure = "ROM")
data_es18iwfS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                      sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data18wfS, measure = "ROM")
data_es18iwfSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18wfSS, measure = "ROM")

##FFS fall Effect Sizes ####

data_es1iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data1ff, measure = "ROM")
#including only sites with pre-mean specific for the disturbance month
data_es1iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data1ffS, measure = "ROM")
#long-term pre mean for sites that also have subannual data
data_es1iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data1ffSS, measure = "ROM")

data_es2iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data2ff, measure = "ROM")
data_es2iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data2ffS, measure = "ROM")
data_es2iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data2ffSS, measure = "ROM")

data_es3ffi <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data3ff, measure = "ROM")
data_es3iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data3ffS, measure = "ROM")
data_es3iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data3ffSS, measure = "ROM")

data_es4iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data4ff, measure = "ROM")
data_es4iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data4ffS, measure = "ROM")
data_es4iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i =Pre_SD, data = data4ffSS, measure = "ROM")

data_es5iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data5ff, measure = "ROM")
data_es5iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data5ffS, measure = "ROM")
data_es5iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data5ffSS, measure = "ROM")

data_es6iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data6ff, measure = "ROM")
data_es6iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data6ffS, measure = "ROM")
data_es6iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data6ffSS, measure = "ROM")

data_es7iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data7ff, measure = "ROM")
data_es7iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data7ffS, measure = "ROM")
data_es7iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data7ffSS, measure = "ROM")

data_es8iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data8ff, measure = "ROM")
data_es8iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data8ffS, measure = "ROM")
data_es8iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data8ffSS, measure = "ROM")

data_es9iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data9ff, measure = "ROM")
data_es9iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                       sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data9ffS, measure = "ROM")
data_es9iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data9ffSS, measure = "ROM")

data_es10iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10ff, measure = "ROM")
data_es10iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data10ffS, measure = "ROM")
data_es10iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data10ffSS, measure = "ROM")

data_es11iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11ff, measure = "ROM")
data_es11iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i =Pre_SD_MonthSpecific, data = data11ffS, measure = "ROM")
data_es11iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i =Pre_SD, data = data11wfSS, measure = "ROM")

data_es12iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12ff, measure = "ROM")
data_es12iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data12ffS, measure = "ROM")
data_es12iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data12ffSS, measure = "ROM")

data_es13iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13ff, measure = "ROM")
data_es13iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data13ffS, measure = "ROM")
data_es13iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data13ffSS, measure = "ROM")

data_es14iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14ff, measure = "ROM")
data_es14iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data14ffS, measure = "ROM")
data_es14iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data14ffSS, measure = "ROM")

data_es15iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15ff, measure = "ROM")
data_es15iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data15ffS, measure = "ROM")
data_es15iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data15ffSS, measure = "ROM")

data_es16iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16ff, measure = "ROM")
data_es16iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data16ffS, measure = "ROM")
data_es16iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data16ffSS, measure = "ROM")

data_es17iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17ff, measure = "ROM")
data_es17iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data17ffS, measure = "ROM")
data_es17iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data17wfSS, measure = "ROM")

data_es18iff <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18ff, measure = "ROM")
data_es18iffS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean_MonthSpecific, 
                        sd1i = Post_SD, sd2i = Pre_SD_MonthSpecific, data = data18ffS, measure = "ROM")
data_es18iffSS <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data18ffSS, measure = "ROM")

##Nutrient Effect Sizes####

##P flux####

##Total P flux####

data_es1itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                      sd1i = Post_SD, sd2i = Pre_SD, data = data1tpf, measure = "ROM")
data_es2itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2tpf, measure = "ROM")
data_es3itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3tpf, measure = "ROM")
data_es4itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4tpf, measure = "ROM")
data_es5itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5tpf, measure = "ROM")
data_es6itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6tpf, measure = "ROM")
data_es7itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7tpf, measure = "ROM")
data_es8itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8tpf, measure = "ROM")
data_es9itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9tpf, measure = "ROM")
data_es10itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10tpf, measure = "ROM")
data_es11itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11tpf, measure = "ROM")
data_es12itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12tpf, measure = "ROM")
data_es13itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13tpf, measure = "ROM")
data_es14itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14tpf, measure = "ROM")
data_es15itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15tpf, measure = "ROM")
data_es16itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16tpf, measure = "ROM")
data_es17itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17tpf, measure = "ROM")
data_es18itpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data19tpf, measure = "ROM")

##Leaf P flux####

data_es1ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1lpf, measure = "ROM")
data_es2ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2lpf, measure = "ROM")
data_es3ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3lpf, measure = "ROM")
data_es4ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4lpf, measure = "ROM")
data_es5ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5lpf, measure = "ROM")
data_es6ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6lpf, measure = "ROM")
data_es7ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7lpf, measure = "ROM")
data_es8ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8lpf, measure = "ROM")
data_es9ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9lpf, measure = "ROM")
data_es10ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10lpf, measure = "ROM")
data_es11ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11lpf, measure = "ROM")
data_es12ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12lpf, measure = "ROM")
data_es13ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13lpf, measure = "ROM")
data_es14ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14lpf, measure = "ROM")
data_es15ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15lpf, measure = "ROM")
data_es16ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16lpf, measure = "ROM")
data_es17ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17lpf, measure = "ROM")
data_es18ilpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18lpf, measure = "ROM")

##Wood P flux####

data_es1iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1wpf, measure = "ROM")
data_es2iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2wpf, measure = "ROM")
data_es3iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3wpf, measure = "ROM")
data_es4iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4wpf, measure = "ROM")
data_es5iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5wpf, measure = "ROM")
data_es6iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6wpf, measure = "ROM")
data_es7iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7wpf, measure = "ROM")
data_es8iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8wpf, measure = "ROM")
data_es9iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9wpf, measure = "ROM")
data_es10iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10wpf, measure = "ROM")
data_es11iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11wpf, measure = "ROM")
data_es12iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12wpf, measure = "ROM")
data_es13iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13wpf, measure = "ROM")
data_es14iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14wpf, measure = "ROM")
data_es15iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15wpf, measure = "ROM")
data_es16iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16wpf, measure = "ROM")
data_es17iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17wpf, measure = "ROM")
data_es18iwpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18wpf, measure = "ROM")

##FFS P flux####

data_es1iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1ffpf, measure = "ROM")
data_es2iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data2ffpf, measure = "ROM")
data_es3iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data3ffpf, measure = "ROM")
data_es4iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean,
                        sd1i = Post_SD, sd2i = Pre_SD, data = data4ffpf, measure = "ROM")
data_es5iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data5ffpf, measure = "ROM")
data_es6iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data6ffpf, measure = "ROM")
data_es7iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data7ffpf, measure = "ROM")
data_es8iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data8ffpf, measure = "ROM")
data_es9iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data9ffpf, measure = "ROM")
data_es10iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data10ffpf, measure = "ROM")
data_es11iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data11ffpf, measure = "ROM")
data_es12iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data12ffpf, measure = "ROM")
data_es13iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data13ffpf, measure = "ROM")
data_es14iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data14ffpf, measure = "ROM")
data_es15iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data15ffpf, measure = "ROM")
data_es16iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data16ffpf, measure = "ROM")
data_es17iffpf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data17ffpf, measure = "ROM")

##Total N flux####

data_es1itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1tnf, measure = "ROM")
data_es2itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2tnf, measure = "ROM")
data_es3itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3tnf, measure = "ROM")
data_es4itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4tnf, measure = "ROM")
data_es5itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5tnf, measure = "ROM")
data_es6itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6tnf, measure = "ROM")
data_es7itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7tnf, measure = "ROM")
data_es8itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8tnf, measure = "ROM")
data_es9itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9tnf, measure = "ROM")
data_es10itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10tnf, measure = "ROM")
data_es11itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11tnf, measure = "ROM")
data_es12itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12tnf, measure = "ROM")
data_es13itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13tnf, measure = "ROM")
data_es14itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14tnf, measure = "ROM")
data_es15itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15tnf, measure = "ROM")
data_es16itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16tnf, measure = "ROM")
data_es17itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17tnf, measure = "ROM")
data_es18itnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18tnf, measure = "ROM")

##Leaf N flux####

data_es1ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1lnf, measure = "ROM")
data_es2ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2lnf, measure = "ROM")
data_es3ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3lnf, measure = "ROM")
data_es4ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4lnf, measure = "ROM")
data_es5ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5lnf, measure = "ROM")
data_es6ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6lnf, measure = "ROM")
data_es7ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7lnf, measure = "ROM")
data_es8ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8lnf, measure = "ROM")
data_es9ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9lnf, measure = "ROM")
data_es10ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10lnf, measure = "ROM")
data_es11ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11lnf, measure = "ROM")
data_es12ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12lnf, measure = "ROM")
data_es13ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13lnf, measure = "ROM")
data_es14ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14lnf, measure = "ROM")
data_es15ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15lnf, measure = "ROM")
data_es16ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16lnf, measure = "ROM")
data_es17ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17lnf, measure = "ROM")
data_es18ilnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18lnf, measure = "ROM")

##Wood N flux####

data_es1iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1wnf, measure = "ROM")
data_es2iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data2wnf, measure = "ROM")
data_es3iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data3wnf, measure = "ROM")
data_es4iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data4wnf, measure = "ROM")
data_es5iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data5wnf, measure = "ROM")
data_es6iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data6wnf, measure = "ROM")
data_es7iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data7wnf, measure = "ROM")
data_es8iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data8wnf, measure = "ROM")
data_es9iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data9wnf, measure = "ROM")
data_es10iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data10wnf, measure = "ROM")
data_es11iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data11wnf, measure = "ROM")
data_es12iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data12wnf, measure = "ROM")
data_es13iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data13wnf, measure = "ROM")
data_es14iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data14wnf, measure = "ROM")
data_es15iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data15wnf, measure = "ROM")
data_es16iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data16wnf, measure = "ROM")
data_es17iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data17wnf, measure = "ROM")
data_es18iwnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data18wnf, measure = "ROM")

##FFS N flux####

data_es1iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                       sd1i = Post_SD, sd2i = Pre_SD, data = data1ffnf, measure = "ROM")
data_es2iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data2ffnf, measure = "ROM")
data_es3iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data3ffnf, measure = "ROM")
data_es4iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data4ffnf, measure = "ROM")
data_es5iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data5ffnf, measure = "ROM")
data_es6iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data6ffnf, measure = "ROM")
data_es7iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data7ffnf, measure = "ROM")
data_es8iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data8ffnf, measure = "ROM")
data_es9iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data9ffnf, measure = "ROM")
data_es10iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data10ffnf, measure = "ROM")
data_es11iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data11ffnf, measure = "ROM")
data_es12iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data12ffnf, measure = "ROM")
data_es13iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data13ffnf, measure = "ROM")
data_es14iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data14ffnf, measure = "ROM")
data_es15iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data15ffnf, measure = "ROM")
data_es16iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                        sd1i = Post_SD, sd2i = Pre_SD, data = data16ffnf, measure = "ROM")
data_es17iffnf <- escalc(n1i = Post_n, n2i = Pre_n, m1i = Post_Mean, m2i = Pre_Mean, 
                         sd1i = Post_SD, sd2i = Pre_SD, data = data17ffnf, measure = "ROM")


########STEP 3 #### Overall Effect Sizes ########

##Pantropical resilience first 36 months####

#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

#Transforming the numerical predictors

z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}
data_esall$soilP<-z.trans(data_esall$Other_soil_P)
data_esall$windsp<-z.trans(data_esall$WMO_wind_kts)
data_esall$d2track<-z.trans(data_esall$Distance_to_Disturb_km)
data_esall$tsd<-z.trans(data_esall$TSD_months)

##Total Litterfall####

tot_lit_all<-data_esall %>% filter(Fraction=="TotLitfall")
str(tot_lit_all)#436
levels(tot_lit_all$DisturbanceName)
tot_lit_all$TSD_months

#Ploting distribution of Treatments and Cyclones over time

df_TSD_tot <- tot_lit_all %>%
  group_by(yi,Site,Treatment,DisturbanceName, TSD_months)  %>%
  dplyr::summarise(counts = dplyr::n())
df_TSD_tot
df_TSD_tot$TSD_months=as.numeric(df_TSD_tot$TSD_months)

df_TSD_tot %>% ggplot(aes(x = TSD_months, fill=Treatment)) +geom_histogram(binwidth = 0.5)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Months since disturbance",y="Number of observations")+ annotate("text", x = 10, y = 25, label = "3-year resilience of total litterfall",size=6,colour="black")

df_TSD_tot %>% ggplot(aes(x = TSD_months, fill=DisturbanceName)) +geom_histogram(binwidth = 0.5)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Months since disturbance",y="Number of observations")+ annotate("text", x = 10, y = 25, label = "3-year resilience of total litterfall",size=6,colour="black")

df_TSD_tot %>% ggplot(aes(x = yi, fill=Treatment)) +geom_histogram(binwidth = 0.05)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Resilience effect sizes",y="Number of observations")+ annotate("text", x = -2, y =20, label = "3-year resilience of total litterfall",size=6,colour="black")



df_TSD_totS <- tot_lit_allS %>%
  group_by(Site,Treatment,DisturbanceName, TSD_months)  %>%
  dplyr::summarise(counts = dplyr::n())
df_TSD_totS

df_TSD_totS %>% ggplot(aes(x = TSD_months, fill=DisturbanceName)) +geom_histogram(binwidth = 0.5)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Months since disturbance",y="Number of observations")+ annotate("text", x = 15, y = 25, label = "3-year resilience of total litterfall - reduced dataset",size=6,colour="black")



#Intercept only - old
res_all_tot_old <- rma.mv(yi,vi,random = ~ 1 | Site/Case_ID,
                      tdist = TRUE,
                      data = tot_lit_all,struct = "AR",method = "REML", mods=~TSD_months)
summary(res_all_tot_old)
-(1-exp(res_all_tot_old$b))*100
((exp(res_all_tot_old$se))-1)*100

res_all_tot_old2 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                          tdist = TRUE,
                          data = tot_lit_all,struct = "AR",method = "REML")
summary(res_all_tot_old2)
-(1-exp(res_all_tot_old2$b))*100
((exp(res_all_tot_old2$se))-1)*100

#Calculating correlation of 'true effects' within the grouping level, which is case study ID
round(res_all_tot_old2$sigma2[1] / sum(res_all_tot_old2$sigma2), 3)# it is 0.42

#Found correlation of 0.95, so we need to account for caseID nested within Study

par(mfrow=c(2,1))
profile(res_all_tot_old2, sigma2=1)#for between-case study heterogeneity
profile(res_all_tot_old2, sigma2=2)#for between-effect size-within-case study heterogeneity

##2 yr resilience total litterfall####

tot_lit_all_2y<- tot_lit_all %>% filter(TSD_months<24)
str(tot_lit_all_2y)#364

#Ploting distribution of Treatments and Cyclones over time

df_TSD_tot_2y <- tot_lit_all_2y %>%
  group_by(yi,Site,Treatment,DisturbanceName, soilP,TSD_months)  %>%
  dplyr::summarise(counts = dplyr::n())
df_TSD_tot_2y
df_TSD_tot$TSD_months=as.numeric(df_TSD_tot$TSD_months)

df_TSD_tot_2y %>% ggplot(aes(x = TSD_months, fill=Treatment)) +geom_histogram(binwidth = 0.5)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Months since disturbance",y="Number of observations")+ annotate("text", x = 10, y = 25, label = "2-year resilience of total litterfall",size=6,colour="black")

df_TSD_tot_2y %>% ggplot(aes(x = yi, fill=Treatment)) +geom_histogram(binwidth = 0.05)+theme_pubr()+
  theme(strip.background = element_rect(color="white", fill="white",linetype="solid"),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=18),axis.text=element_text(size=16),axis.title=element_text(size=20),
        legend.position="right",legend.text =  element_text(size=16,angle=0),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"))+
  scale_fill_brewer(palette="Paired")+labs(x="Resilience effect sizes",y="Number of observations")+ annotate("text", x = -2, y =16, label = "2-year resilience of total litterfall",size=6,colour="black")


res_all_tot_old_2y <- rma.mv(yi,vi,random = ~ 1 | Treatment/Effectsize_ID,
                           tdist = TRUE,
                           data = tot_lit_all_2y,struct = "AR",method = "REML")
summary(res_all_tot_old_2y)
-(1-exp(res_all_tot_old_2y$b))*100
((exp(res_all_tot_old_2y$se))-1)*100

##2-yr Final Random-effects model####

res_all_tot_2y <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                      tdist = TRUE,
                      data = tot_lit_all,struct = "AR",method = "REML")
summary(res_all_tot_2y)

#Calculating correlation of 'true effects' within the grouping level, which is case study ID
round(res_all_tot_2y$sigma2[1] / sum(res_all_tot_2y$sigma2), 3)# it is 0.42

#Found correlation of 0.95, so we need to account for caseID nested within Study

par(mfrow=c(2,1))
profile(res_all_tot_2y, sigma2=1)#for between-case study heterogeneity
profile(res_all_tot_2y, sigma2=2)#for between-effect size-within-case study heterogeneity

##3-yr Total Litterfall Final intercept (random-effects)####

str(tot_lit_all)
tot_lit_all$Effectsize_ID=as.factor(tot_lit_all$Effectsize_ID)
tot_lit_all$Study_ID=as.factor(tot_lit_all$Study_ID)
tot_lit_all$Case_ID=as.factor(tot_lit_all$Case_ID)

res_all_tot <- rma.mv(yi,vi,random = ~ 1 |Treatment/Effectsize_ID,
                      tdist = TRUE,
                      data = tot_lit_all,struct = "AR",method = "REML")
summary(res_all_tot)
-(1-exp(res_all_tot$b))*100
((exp(res_all_tot$se))-1)*100

#Adding soil P to same model structure, which is now a Mixed Effects Model

 res_all_tot_reg0 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                        tdist = TRUE,
                        data = tot_lit_all,struct = "AR",method = "REML",
                        mods = ~ soilP)#Here calculate estimates for each month
 summary(res_all_tot_reg0)#soil P is significant
 
 res_all_tot_old_2y_reg0 <- rma.mv(yi,vi,random = ~1|Case_ID/Effectsize_ID,
                              tdist = TRUE,
                              data = tot_lit_all_2y,struct = "AR",method = "REML",
                              mods=~soilP)
 summary(res_all_tot_old_2y_reg0)
 
 res_all_tot_old_2y_reg0.1 <- rma.mv(yi,vi,random = ~1|Case_ID/Effectsize_ID,
                                   tdist = TRUE,
                                   data = tot_lit_all_2y,struct = "AR",method = "REML",
                                   mods=~soilP+tsd)
 summary(res_all_tot_old_2y_reg0.1)
 
 #making TSD as fixed affect interacting with soil P
 
 res_all_tot_reg1 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                      tdist = TRUE,
                      data = tot_lit_all,struct = "AR",method = "REML",
                      mods = ~ soilP+tsd)#Here calculate estimates for each month
summary(res_all_tot_reg1)
predict.rma(res_all_tot2)
res_all_tot2$b
res_all_tot2$se

res_all_tot_reg1.1 <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                           tdist = TRUE,
                           data = tot_lit_all,struct = "AR",method = "REML",
                           mods = ~ soilP*tsd)#Here calculate estimates for each month
summary(res_all_tot_reg1.1)


tot_lit_all <- within(tot_lit_all, {
  Treatment.ch1 <- C(Treatment, helmert, 7)
  print(attributes(Treatment.ch1))
})

res_all_tot4 <- rma.mv(yi,vi,random = list(~ 1 | Site,~1|DisturbanceName),
                       tdist = TRUE,
                       data = tot_lit_all,struct = "AR",method = "REML",
                       mods = ~ soilP*tsd*Treatment.ch1)#Here calculate estimates for each month
summary(res_all_tot4)

##Same for Subannual data

data_esallS$soilP<-z.trans(data_esallS$Other_soil_P)
data_esallS$windsp<-z.trans(data_esallS$WMO_wind_kts)
data_esallS$d2track<-z.trans(data_esallS$Distance_to_Disturb_km)
data_esallS$tsd<-z.trans(data_esallS$TSD_months)

tot_lit_allS<-data_esallS %>% filter(Fraction=="TotLitfall")
str(tot_lit_allS)#377
levels(tot_lit_allS$Site)
tot_lit_allS$DisturbanceName

res_all_totS_old <- rma.mv(yi,vi,random = ~ 1 | Treatment/Effectsize_ID,#~1|Treatment,~1|DisturbanceName),
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = tot_lit_allS,struct = "AR",method = "REML")
summary(res_all_totS_old)
-(1-exp(res_all_totS_old$b))*100
((exp(res_all_totS_old$se))-1)*100

##3y Subannual (red.) total litterfall####

res_all_totS <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                      tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                      data = tot_lit_allS,struct = "AR",method = "REML")
summary(res_all_totS)
-(1-exp(res_all_totS$b))*100
((exp(res_all_totS$se))-1)*100

##2-yr Subannual (red.) total litterfall####

tot_lit_allS_2y<- tot_lit_allS %>% filter(TSD_months<25)
str(tot_lit_allS_2y)#315

res_all_totS_2y_old <- rma.mv(yi,vi,random = ~ 1 | Treatment/Effectsize_ID,#~1|Treatment,~1|DisturbanceName),
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_allS_2y,struct = "AR",method = "REML")
summary(res_all_totS_2y_old)
-(1-exp(res_all_totS_2y_old$b))*100
((exp(res_all_totS_2y_old$se))-1)*100

#Adding soil P to same model structure, which is now a Mixed Effects Model

str( tot_lit_allS)

res_all_tot_regS0_2y <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                           tdist = TRUE,
                           data = tot_lit_allS_2y,struct = "AR",method = "REML",
                           mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_regS0_2y)#soil P is significant

res_all_tot_regS0 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                            tdist = TRUE,
                            data = tot_lit_allS,struct = "AR",method = "REML",
                            mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_regS0)

res_all_tot_regS0.1 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                            tdist = TRUE,
                            data = tot_lit_allS,struct = "AR",method = "REML",
                            mods = ~ soilP*tsd)#Here calculate estimates for each month
summary(res_all_tot_regS0.1)#soil P is significant

res_all_totS2 <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName),
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = tot_lit_allS,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_totS2)

##Annual (red.)

data_esallSS$soilP<-z.trans(data_esallSS$Other_soil_P)
data_esallSS$windsp<-z.trans(data_esallSS$WMO_wind_kts)
data_esallSS$d2track<-z.trans(data_esallSS$Distance_to_Disturb_km)
data_esallSS$tsd<-z.trans(data_esallSS$TSD_months)

tot_lit_allSS<-data_esallSS %>% filter(Fraction=="TotLitfall")
str(tot_lit_allSS)#377

res_all_totSS_old <- rma.mv(yi,vi,random = list(~ 1 | Site/Case_ID,~1|Case_ID/TSD_months),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|DisturbanceName),
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_allSS,struct = "AR",method = "REML")
summary(res_all_totSS_old)
-(1-exp(res_all_totSS_old$b))*100
((exp(res_all_totSS_old$se))-1)*100

##3y Annual (red.) total litterfall####
res_all_totSS <- rma.mv(yi,vi,random = ~ 1 | Treatment/Effectsize_ID,
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = tot_lit_allSS,struct = "CAR",method = "REML")
summary(res_all_totSS)
-(1-exp(res_all_totSS$b))*100
((exp(res_all_totSS$se))-1)*100

##2-yr Annual (red.) total litterfall####

tot_lit_allSS_2y<- tot_lit_allSS %>% filter(TSD_months<25)
str(tot_lit_allSS_2y)#315

res_all_tot_oldSS_2y <- rma.mv(yi,vi,random =~ 1 | Treatment/Effectsize_ID,
                             tdist = TRUE,
                             data = tot_lit_allSS_2y,struct = "AR",method = "REML")
summary(res_all_tot_oldSS_2y)
-(1-exp(res_all_tot_oldSS_2y$b))*100
((exp(res_all_tot_oldSS_2y$se))-1)*100

#Adding soil P to same model structure, which is now a Mixed Effects Model

str( tot_lit_allS)

res_all_tot_regSS0 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                            tdist = TRUE,
                            data = tot_lit_allSS,struct = "AR",method = "REML",
                            mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_regSS0)#soil P is NOT significant

res_all_tot_regSS0_2y <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                             tdist = TRUE,
                             data = tot_lit_allSS_2y,struct = "AR",method = "REML",
                             mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_regSS0_2y)#soil P is NOT significant

res_all_tot_regSS0.1 <- rma.mv(yi,vi,random = ~ 1 |Case_ID/Effectsize_ID,
                             tdist = TRUE,
                             data = tot_lit_allSS,struct = "AR",method = "REML",
                             mods = ~ soilP*tsd)#Here calculate estimates for each month
summary(res_all_tot_regSS0.1)#soil P is NOT significant

-41.2-(-33.7)

res_all_totSS2 <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName),
                        tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                        data = tot_lit_allSS,struct = "CAR",method = "REML",mods=~factor(TSD_months))
summary(res_all_totSS2)

####Total Litterfall Meta-Regressions####

names(tot_lit_all)
levels(tot_lit_all$Treatment)

res_all_tot_reg <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Site/Treatment),
                       tdist = TRUE,
                       data = tot_lit_all,struct = "AR",method = "REML",
                       mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_reg)

res_all_tot_reg.1 <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),#thesea are random intercepts
                          tdist = TRUE,
                          data = tot_lit_all,struct = "CAR",method = "REML",
                          mods = ~ soilP)#Here calculate estimates for each month
summary(res_all_tot_reg.1)

res_all_tot_reg_a <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE,
                          data = tot_lit_all,struct = "AR",method = "REML",
                          mods = ~ TSD_months+Other_soil_P)#Here calculate estimates for each month
summary(res_all_tot_reg_a)

res_all_tot_regS <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE,
                          data = tot_lit_allS,struct = "AR",method = "REML",
                          mods = ~ factor(TSD_months)+Other_soil_P)#Here calculate estimates for each month
summary(res_all_tot_regS)

data_esall

res_all_tot_reg0 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_all,struct = "AR",method = "REML",
                           mods = ~Other_soil_P)
summary(res_all_tot_reg0)
res_all_reg$b

tot_lit_all$soilP<-z.trans(tot_lit_all$Other_soil_P)
tot_lit_all$tsd<-z.trans(tot_lit_all$TSD_months)

res_all_tot_reg1 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_all,struct = "AR",method = "REML",
                           mods = ~TSD_months*Other_soil_P)
summary(res_all_tot_reg1)

res_all_tot_reg1.1 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~soilP)
summary(res_all_tot_reg1.1)

res_all_tot_reg1.0 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_all,struct = "AR",method = "REML",
                           mods = ~tsd+soilP+tsd*soilP)
summary(res_all_tot_reg1.0)

res_all_tot_reg1.2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd+soilP+soilP*Treatment_ID)
summary(res_all_tot_reg1.2)

res_all_tot_reg1.3 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd+soilP+soilP*Treatment_ID+tsd*soilP*Treatment_ID)
summary(res_all_tot_reg1.3)

res_all_tot_reg1.3a <- rma.mv(yi,vi,random = ~ 1 | Site_ID/tsd,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd+soilP+soilP*Treatment+tsd*soilP*Treatment)
summary(res_all_tot_reg1.3a)

##FINAL META-REGRESSION MODEL TOTAL LITTERFALL####

res_all_tot_reg1.4 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/DisturbanceName,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd+soilP+Par_Mat+Treatment+tsd*soilP+tsd*Treatment)
summary(res_all_tot_reg1.4)

res_all_tot_reg1.4a <- rma.mv(yi,vi,random = ~ 1 | Site_ID/DisturbanceName,
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd*soilP)
summary(res_all_tot_reg1.4a)

res_all_tot_reg1.4b <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                              tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                              data = tot_lit_all,struct = "AR",method = "REML",
                              mods = ~tsd*soilP)
summary(res_all_tot_reg1.4b)

res_all_tot_reg1.4c <- rma.mv(yi,vi,random = ~ 1 | Site_ID/DisturbanceName,
                              tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                              data = tot_lit_all,struct = "AR",method = "REML",
                              mods = ~tsd*soilP)
summary(res_all_tot_reg1.4c)

res_all_tot_reg1.4d <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                              tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                              data = tot_lit_all,struct = "AR",method = "REML",
                              mods = ~tsd*soilP+Treatment*soilP)
summary(res_all_tot_reg1.4d)

res_all_tot_reg1.5 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd*soilP+Treatment*soilP+Par_Mat)
summary(res_all_tot_reg1.5)

tot_lit_all <- within(tot_lit_all, {
  Treatment.ch <- C(Treatment, helmert)
  print(attributes(Treatment.ch))
})

res_all_tot_reg2 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd*soilP+Treatment.ch*soilP+Par_Mat)
summary(res_all_tot_reg2)

levels(tot_lit_all$Treatment)
tot_lit_all <- within(tot_lit_all, {
  Treatment.ch1 <- C(Treatment, helmert, 7)
  print(attributes(Treatment.ch1))
})

res_all_tot_reg2.1 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = tot_lit_all,struct = "AR",method = "REML",
                           mods = ~tsd*soilP+Treatment.ch1*soilP+Par_Mat)
summary(res_all_tot_reg2.1)

tot_lit_all <- within(tot_lit_all, {
  Par_mat.ch <- C(Par_Mat, helmert)
  print(attributes(Par_mat.ch))
})

tot_lit_all <- within(tot_lit_all, {
  Par_mat.ch1 <- C(Par_Mat, helmert, 13)
  print(attributes(Par_mat.ch1))
})

res_all_tot_reg2.2 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd*soilP+Treatment.ch1*soilP+Par_mat.ch1)
summary(res_all_tot_reg2.2)

(a <- contrasts(tot_lit_all$Treatment))

contrasts(tot_lit_all$Treatment) <-contr.helmert(8, contrasts = TRUE, sparse=FALSE)
contrasts(tot_lit_all$Treatment)

contrasts(tot_lit_all$Par_Mat) <-contr.helmert(14, contrasts = TRUE, sparse=FALSE)
contrasts(tot_lit_all$Par_Mat)

contrasts(tot_lit_all$Treatment) <-contr.treatment(8, contrasts = TRUE, sparse=FALSE)
contrasts(tot_lit_all$Treatment)

#I(Treatment == 2) + I(Treatment == 3) + I(Treatment == 4)+ I(Treatment == 5)

##FINAL META-REGRESSION RESILIENCE TOTAL LITTERFALL MASS FLUX####

res_all_tot_reg2.3 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~tsd*soilP+tsd*Treatment*soilP+Par_Mat)
summary(res_all_tot_reg2.3)

tot_lit_all$Treatment
res_all_tot_reg2.4 <- rma.mv(yi,vi,random = list(~ 1 | Site_ID/DisturbanceName,~ 1 | TSD_months),
                             tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                             data = tot_lit_all,struct = "AR",method = "REML",
                             mods = ~soilP*tsd+soilP*I(Treatment == "P+")*tsd)
summary(res_all_tot_reg2.4)


##Multimodel Inference####

res_results_tot<-multimodel.inference(TE = "yi", 
                              seTE = "vi",
                              data = tot_lit_all,
                              predictors = c("soilP", "tsd", "Treatment","Par_Mat"),
                              interaction = TRUE,method="REML",test = "knha",eval.criterion='BIC')

summary(res_results_tot)
res_results_tot$predictor.importance.plot
plot(res_results_tot)


##Leaf fraction####

levels(data_esall$Site)

leaf_all<-data_esall %>% filter(Fraction=="Leaf fall")
str(leaf_all)#368
leaf_allS$Treatment

#Intercept only
res_all_leaf_old <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                      tdist = TRUE,
                      data = leaf_all,struct = "AR",method = "REML")
summary(res_all_leaf_old)
-(1-exp(res_all_leaf_old$b))*100
((exp(res_all_leaf_old$se))-1)*100

res_all_leaf<- rma.mv(yi,vi,random = ~ 1 | Case_ID/TSD_months,
                           tdist = TRUE,
                           data = leaf_all,struct = "AR",method = "REML")
summary(res_all_leaf)
-(1-exp(res_all_leaf$b))*100
((exp(res_all_leaf$se))-1)*100

#TSD as factor
res_all_leaf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = leaf_all,struct = "AR",method = "REML",
                       mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_leaf2)
predict.rma(res_all_tot2)
res_all_tot2$b
res_all_tot2$se


##Same for Subannual data

leaf_allS<-data_esallS %>% filter(Fraction=="Leaf fall")
str(leaf_allS)#325

res_all_leafS_old <- rma.mv(yi,vi,random =~ 1 | Effectsize_ID,#~1|DisturbanceName,~1|Treatment),
                           tdist = TRUE,data = leaf_allS,struct = "AR",method = "REML")
summary(res_all_leafS_old)
-(1-exp(res_all_leafS_old$b))*100
((exp(res_all_leafS_old$se))-1)*100

#Intercept only
res_all_leafS <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                       tdist = TRUE,
                       data = leaf_allS,struct = "AR",method = "REML")
summary(res_all_leafS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_leafS$b))*100
((exp(res_all_leafS$se))-1)*100

#TSD as factor
res_all_leafS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                        tdist = TRUE,
                        data = leaf_allS,struct = "AR",method = "REML",
                        mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_leafS2)

leaf_allSS<-data_esallSS %>% filter(Fraction=="Leaf fall")
str(leaf_allSS)#325
levels(leaf_allSS$Site)

res_all_leafSS_old <- rma.mv(yi,vi,random =list(~ 1 | Site/TSD_months,~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|DisturbanceName,~1|Treatment),
                            tdist = TRUE,data = leaf_allSS,struct = "AR",method = "REML")
summary(res_all_leafSS_old)

#Intercept only
res_all_leafSS <- rma.mv(yi,vi,random = ~ 1 |Effectsize_ID,
                        tdist = TRUE,
                        data = leaf_allSS,struct = "AR",method = "REML")
summary(res_all_leafSS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_leafSS$b))*100
((exp(res_all_leafSS$se))-1)*100
44.4-37.2
42.4-7.2

#TSD as factor
res_all_leafSS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                         tdist = TRUE,
                         data = leaf_allSS,struct = "AR",method = "REML",
                         mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_leafSS2)


##Meta regressions Leaf fall####

#z-transforming the continuous variables
leaf_all$soilP=z.trans(leaf_all$Other_soil_P)
leaf_all$windsp=z.trans(leaf_all$WMO_wind_kts)
leaf_all$tsd=z.trans(leaf_all$TSD_months)
leaf_all$timesincestorm=z.trans(leaf_all$YearsSinceLastStorm)

##Multimodel Inference Leaf fall ####

res_results_leaf<-multimodel.inference(TE = "yi", 
                                      seTE = "vi",
                                      data = leaf_all,
                                      predictors = c("soilP", "tsd", "Treatment_ID","Par_Mat_ID"),
                                      interaction = TRUE,method="REML",test = "knha",eval.criterion='BIC')

summary(res_results_leaf)

leaf_all_reg<- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = leaf_all,struct = "AR",method = "REML",
                      mods = ~ soilP)#Here calculate estimates for each month
summary(leaf_all_reg)

leaf_all_reg1<- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = leaf_all,struct = "AR",method = "REML",
                      mods = ~ tsd+soilP+Par_Mat_ID+Treatment_ID+Par_Mat_ID*soilP+soilP*Treatment_ID+tsd*Treatment_ID)#Here calculate estimates for each month
summary(leaf_all_reg1)
names(leaf_all)

##FINAL Meta_Regression Leaf fall####

str(leaf_all)

res_all_leaf_reg_final <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE,
                           data = leaf_all,struct = "AR",method = "REML",
                           mods = ~ Other_soil_P+TSD_months*Treatment+Distance_to_Disturb_km)#Here calculate estimates for each month
summary(res_all_leaf_reg_final)

res_all_leaf_reg1 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                            tdist = TRUE,
                            data = leaf_all,struct = "AR",method = "REML",
                            mods = ~ factor(TSD_months)+Other_soil_P+Treatment+YearsSinceLastStorm+Distance_to_Disturb_km+Disturb_Rainfall_mm)#Here calculate estimates for each month
summary(res_all_leaf_reg1)

res_all_leaf_reg2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                            tdist = TRUE,
                            data = leaf_all,struct = "AR",method = "REML",
                            mods = ~ factor(TSD_months)+Other_soil_P+Elevation_m+Treatment+YearsSinceLastStorm+Distance_to_Disturb_km+Disturb_Rainfall_mm)#Here calculate estimates for each month
summary(res_all_leaf_reg2)

res_all_leaf_reg3 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                            tdist = TRUE,
                            data = leaf_all,struct = "AR",method = "REML",
                            mods = ~ factor(TSD_months)+Other_soil_P*Treatment)#Here calculate estimates for each month
summary(res_all_leaf_reg3)
chart.Correlation(leaf_all[,c(81,52)])
names(leaf_all)

##Wood fraction####

wood_all<-data_esall %>% filter(Fraction=="Wood fall")
summary(wood_all)#277
wood_allS$Site

res_all_wood_old <- rma.mv(yi,vi,random =list(~ 1 | Site/TSD_months,~1|DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|DisturbanceName,~1|Treatment),
                             tdist = TRUE,data = wood_all,struct = "AR",method = "REML")
summary(res_all_wood_old)
-(1-exp(res_all_wood_old$b))*100
((exp(res_all_wood_old$se))-1)*100

#Intercept only
res_all_wood <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                       tdist = TRUE,data = wood_all,struct = "AR",method = "REML")
summary(res_all_wood)#Months 1 to 36 for all case studies reporting wood mass 
-(1-exp(res_all_wood$b))*100
((exp(res_all_wood$se))-1)*100

#TSD as factor
res_all_wood2 <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                        tdist = TRUE,
                        data = wood_all,struct = "AR",method = "REML",
                        mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_wood2)
predict.rma(res_all_tot2)
res_all_tot2$b
res_all_tot2$se

##Same for Subannual data

wood_allS<-data_esallS %>% filter(Fraction=="Wood fall")
str(wood_allS)#235

res_all_woodS_old <- rma.mv(yi,vi,random =list(~ 1 | Site/TSD_months,~1|DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|DisturbanceName,~1|Treatment),
                           tdist = TRUE,data = wood_allS,struct = "AR",method = "REML")
summary(res_all_woodS_old)
-(1-exp(res_all_woodS_old$b))*100
((exp(res_all_woodS_old$se))-1)*100

#Intercept only
res_all_woodS <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                        tdist = TRUE,
                        data = wood_allS,struct = "AR",method = "REML")
summary(res_all_woodS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_woodS$b))*100
((exp(res_all_woodS$se))-1)*100

#TSD as factor
res_all_woodS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                         tdist = TRUE,
                         data = wood_allS,struct = "AR",method = "REML",
                         mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_woodS2)

wood_allSS<-data_esallSS %>% filter(Fraction=="Wood fall")
str(wood_allSS)#235

res_all_woodSS_old <- rma.mv(yi,vi,random =list(~ 1 | Site/TSD_months,~1|DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|DisturbanceName,~1|Treatment),
                            tdist = TRUE,data = wood_allSS,struct = "AR",method = "REML")
summary(res_all_woodSS_old)

-(1-exp(res_all_woodSS_old$b))*100
((exp(res_all_woodSS_old$se))-1)*100

#Intercept only
res_all_woodSS <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                         tdist = TRUE,data = wood_allSS,struct = "AR",method = "REML")
summary(res_all_woodSS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_woodSS$b))*100
((exp(res_all_woodSS$se))-1)*100

#TSD as factor
res_all_woodSS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE,
                          data = wood_allSS,struct = "AR",method = "REML",
                          mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_woodSS2)

##FFS fraction####

ffs_all<-data_esall %>% filter(Fraction=="FFS fall")
str(ffs_all)#209
ffs_all$DisturbanceName

res_all_ffs_old <- rma.mv(yi,vi,random =list(~ 1 | Site/TSD_months,~1|DisturbanceName),#/TSD_months,~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|Treatment,~1|Site/DisturbanceName),#~1|DisturbanceName,~1|Treatment),
                             tdist = TRUE,data = ffs_all,struct = "AR",method = "REML")
summary(res_all_ffs_old)
-(1-exp(res_all_ffs_old$b))*100
((exp(res_all_ffs_old$se))-1)*100

#Intercept only
res_all_ffs <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                       tdist = TRUE,
                       data = ffs_all,struct = "AR",method = "REML")
summary(res_all_ffs)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_ffs$b))*100
((exp(res_all_ffs$se))-1)*100

#TSD as factor
res_all_ffs2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                        tdist = TRUE,
                        data = ffs_all,struct = "AR",method = "REML",
                        mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_ffs2)
predict.rma(res_all_ffs2)
res_all_tot2$b
res_all_tot2$se

##Same for Subannual data

ffs_allS<-data_esallS %>% filter(Fraction=="FFS fall")
levels(ffs_allS$Site)#174

res_all_ffsS_old <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months,
                       tdist = TRUE,
                       data = ffs_allS,struct = "AR",method = "REML")
summary(res_all_ffsS_old)
-(1-exp(res_all_ffsS_old$b))*100
((exp(res_all_ffsS_old$se))-1)*100

#Intercept only
res_all_ffsS <- rma.mv(yi,vi,random = list( ~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                        tdist = TRUE,
                        data = ffs_allS,struct = "AR",method = "REML")
summary(res_all_ffsS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_ffsS$b))*100
((exp(res_all_ffsS$se))-1)*100

#TSD as factor
res_all_ffsS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                         tdist = TRUE,
                         data = ffs_allS,struct = "AR",method = "REML",
                         mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_ffsS2)

ffs_allSS<-data_esallSS %>% filter(Fraction=="FFS fall")
str(ffs_allSS)#174

res_all_ffsSS_old <- rma.mv(yi,vi,random =  ~ 1 | Site/TSD_months,
                        tdist = TRUE,
                        data = ffs_allSS,struct = "AR",method = "REML")
summary(res_all_ffsSS_old)
-(1-exp(res_all_ffsSS_old$b))*100
((exp(res_all_ffsSS_old$se))-1)*100

#Intercept only
res_all_ffsSS <- rma.mv(yi,vi,random = list(~ 1 | Site/TSD_months,~1|DisturbanceName,~1|Treatment),
                         tdist = TRUE,
                         data = ffs_allSS,struct = "AR",method = "REML")
summary(res_all_ffsSS)#Months 1 to 36 for all case studies reporting total litterfall mass 
-(1-exp(res_all_ffsSS$b))*100
((exp(res_all_ffsSS$se))-1)*100
67.9-59

#TSD as factor
res_all_ffsSS2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE,
                          data = ffs_allSS,struct = "AR",method = "REML",
                          mods = ~ factor(TSD_months))#Here calculate estimates for each month
summary(res_all_ffsSS2)

## Nutrients Overall Effect Sizes####

#Total P flux####
tpf_all<-data_es_pf_all %>% filter(Fraction=="TotLitfall")#Resilience first 2 years
summary(tpf_all)#97
data_es_pf_all$Fraction

#Intercept only
res_all_tpf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = tpf_all,struct = "AR",method = "REML")
summary(res_all_tpf)#Months 1 to 24for all case studies reporting all P flux all fractions
-(1-exp(res_all_tot$b))*100
((exp(res_all_tot$se))-1)*100

res_all_tpf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                     tdist = TRUE,
                     data = tpf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_tpf2)

#Leaf P flux####

lpf_all<-data_es_pf_all %>% filter(Fraction=="Leaf fall")#Resilience first 2 years
str(lpf_all)#102

#Intercept only
res_all_lpf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = lpf_all,struct = "AR",method = "REML")
summary(res_all_lpf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_lpf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = lpf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_lpf2)

#Wood P flux####

wpf_all<-data_es_pf_all %>% filter(Fraction=="Wood fall")#Resilience first 2 years
str(wpf_all)#89

#Intercept only
res_all_wpf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = wpf_all,struct = "AR",method = "REML")
summary(res_all_wpf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_wpf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = wpf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_wpf2)

#FFS P flux####

ffspf_all<-data_es_pf_all %>% filter(Fraction=="FFS fall")#Resilience first 2 years
str(ffspf_all)#59

#Intercept only
res_all_ffspf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months,
                      tdist = TRUE,
                      data = ffspf_all,struct = "AR",method = "REML")
summary(res_all_ffspf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_ffspf2 <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                       tdist = TRUE,
                       data = ffspf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_ffspf2)

##N flux####

tnf_all<-data_es_nf_all %>% filter(Fraction=="TotLitfall")#Resilience first 2 years
str(tnf_all)#97
data_es_nf_all$Fraction

#Intercept only
res_all_tnf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = tnf_all,struct = "AR",method = "REML")
summary(res_all_tnf)#Months 1 to 24for all case studies reporting all P flux all fractions

#TSD as factor

res_all_tnf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = tnf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_tnf2)

#Leaf N flux####

lnf_all<-data_es_nf_all %>% filter(Fraction=="Leaf fall")#Resilience first 2 years
str(lnf_all)#101

#Intercept only
res_all_lnf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = lnf_all,struct = "AR",method = "REML")
summary(res_all_lnf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_lnf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = lnf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_lnf2)

#Wood N flux####

wnf_all<-data_es_nf_all %>% filter(Fraction=="Wood fall")#Resilience first 2 years
str(wnf_all)#89

#Intercept only
res_all_wnf <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE,
                      data = wnf_all,struct = "AR",method = "REML")
summary(res_all_wnf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_wnf2 <- rma.mv(yi,vi,random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE,
                       data = wnf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_wnf2)

#FFS N flux####

ffsnf_all<-data_es_nf_all %>% filter(Fraction=="FFS fall")#Resilience first 2 years
str(ffsnf_all)#59

#Intercept only
res_all_ffsnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months,
                        tdist = TRUE,
                        data = ffsnf_all,struct = "AR",method = "REML")
summary(res_all_ffsnf)#Months 1 to 36 for all case studies reporting all P flux all fractions

#TSD as factor

res_all_ffsnf2 <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                         tdist = TRUE,
                         data = ffsnf_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_ffsnf2)

##P concentration####

lpc_all<-data_es_pc_all %>% filter(Fraction=="Leaf fall")%>% filter(TSD_months<25)#Resilience first 2 years
str(lpc_all)#60

#Intercept only
res_all_lpc <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months,
                        tdist = TRUE,
                        data = lpc_all,struct = "AR",method = "REML")
summary(res_all_lpc)

res_all_lpc2 <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months,
                      tdist = TRUE,
                      data = lpc_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_lpc2)

wpc_all<-data_es_pc_all %>% filter(Fraction=="Wood fall")%>% filter(TSD_months<24)#Resilience first 2 years
str(wpc_all)#15
wpc_all$TSD_months

#Intercept only
res_all_wpc <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                      tdist = TRUE,
                      data = wpc_all,struct = "AR",method = "REML")
summary(res_all_wpc)

res_all_wpc2 <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                       tdist = TRUE,
                       data = wpc_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_wpc2)

##N concentration####

lnc_all<-data_es_nc_all %>% filter(Fraction=="Leaf fall")%>% filter(TSD_months<25)#Resilience first 2 years
str(lnc_all)#58

#Intercept only
res_all_lnc <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                      tdist = TRUE,
                      data = lnc_all,struct = "AR",method = "REML")
summary(res_all_lnc)

res_all_lnc2 <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                       tdist = TRUE,
                       data = lnc_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_lnc2)

wnc_all<-data_es_nc_all %>% filter(Fraction=="Wood fall")%>% filter(TSD_months<25)#Resilience first 2 years
str(wnc_all)#15
wnc_all$TSD_months

#Intercept only
res_all_wnc <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                      tdist = TRUE,
                      data = wnc_all,struct = "AR",method = "REML")
summary(res_all_wnc)

res_all_wnc2 <- rma.mv(yi,vi,random = ~ 1 | TSD_months,
                       tdist = TRUE,
                       data = wnc_all,struct = "AR",method = "REML",mods=~factor(TSD_months))
summary(res_all_wnc2)

#### Total litterfall mass Effect Sizes####

## Including Time since disturbance as random effect

##3to6 months - the low point of the curve
str(data_es3to6iamb)

res3to6_amb <- rma.mv(yi, 
                      vi, 
                      random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                      data = data_es3to6iamb,
                      struct = "CAR",
                      method = "REML")
summary(res3to6_amb)

res3to6_ambS <- rma.mv(yi, 
                      vi, 
                      random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                      data = data_es3to6iambS,
                      struct = "CAR",
                      method = "REML")
summary(res3to6_ambS)

res3to6_ambSS <- rma.mv(yi, 
                       vi, 
                       random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = data_es3to6iambSS,
                       struct = "CAR",
                       method = "REML")
summary(res3to6_ambSS)

data_es1to36_high<-data_es1to36 %>% filter(yi>1) %>% filter (TSD_months <4)
data_es1to36_high$Site

data_es1to36_new <-data_es1to36 %>% filter(Site!="Bisley_Verde")

res1to6_amb <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months,
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es1to6iamb,
               struct = "CAR",
               method = "REML")
summary(res1to6_amb)

data_es1to6iamb$logsoilP=log(data_es1to6iamb$Other_soil_P)
data_es1to6iambS$logsoilP=log(data_es1to6iambS$Other_soil_P)

res1to6_amb_reg <- rma.mv(yi, 
                      vi, 
                      random = ~ 1 | Site_ID/TSD_months,
                      tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                      data = data_es1to6iamb,
                      struct = "CAR",
                      method = "REML",
                      mods = ~Distance_to_Disturb_km+Other_soil_P+Longitude)
summary(res1to6_amb_reg)

res1to6_amb_regS <- rma.mv(yi, 
                          vi, 
                          random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                          data = data_es1to6iambS,
                          struct = "CAR",
                          method = "REML",
                          mods = ~Distance_to_Disturb_km+Other_soil_P+Longitude)
summary(res1to6_amb_regS)

names(data_meta_resS)

res1to6_amb_regSS <- rma.mv(yi, 
                           vi, 
                           random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = data_es1to6iambSS,
                           struct = "CAR",
                           method = "REML",
                           mods = ~Distance_to_Disturb_km+Other_soil_P+Longitude)
summary(res1to6_amb_regSS)

###Total Litterfall mass####

res1t <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es1i,
                 struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                 method = "REML")
summary(res1t)
-(1-exp(res1t$b))*100
((exp(res1t$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR",#here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es1iS,
                #adding term for a continuous time heteroscedastic autoregressive structure
                method = "REML")
summary(res1tS)
-(1-exp(res1tS$b))*100
((exp(res1tS$se))-1)*100

res1tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es1iSS,
                 method = "REML")
summary(res1tSS)

res2t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es2i,
               method = "REML")
summary(res2t)
res2$k

res2tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iS,
                method = "REML")
summary(res2tS)
res2S$k

res2tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es2iSS,
                 method = "REML")
summary(res2tSS)

res3t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es3i,
               method = "REML")
summary(res3t)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

res3tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iS,
                method = "REML")
summary(res3tS)
-(1-exp(res3tS$b))*100
((exp(res3tS$se))-1)*100

res3tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3iSS,
                 method = "REML")
summary(res3tSS)

res4t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es4i,
               method = "REML")
summary(res4t)

res4tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iS,
                method = "REML")
summary(res4tS)

res4tSS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es4iSS,
                 method = "REML")
summary(res4tSS)

res5t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es5i,
               method = "REML")
summary(res5t)

res5tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iS,
                method = "REML")
summary(res5tS)

res5tSS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es5iSS,
                 method = "REML")
summary(res5tSS)

res6t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es6i,
               method = "REML")
summary(res6t)

res6tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iS,
                method = "REML")
summary(res6tS)

res6tSS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es6iSS,
                 method = "REML")
summary(res6tSS)

res7t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es7i,
               method = "REML")
summary(res7t)
-(1-exp(res7t$b))*100
((exp(res7t$se))-1)*100

res7tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iS,
                method = "REML")
summary(res7tS)
-(1-exp(res7tS$b))*100
((exp(res7tS$se))-1)*100

res7tSS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es7iSS,
                 method = "REML")
summary(res7tSS)

res8t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", 
               data = data_es8i,
               method = "REML")
summary(res8t)
-(1-exp(res8t$b))*100
((exp(res8t$se))-1)*100

res8tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es8iS,
                method = "REML")
summary(res8tS)

res8tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es8iSS,
                 method = "REML")
summary(res8tSS)

res9t <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
               tdist = TRUE,
               struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es9i,
               method = "REML")
summary(res9t)

res9tS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iS,
                method = "REML")
summary(res9tS)

res9tSS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es9iSS,
                 method = "REML")
summary(res9tSS)

res10t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es10i,
                method = "REML")
summary(res10t)

res10tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10iS,
                 method = "REML")
summary(res10tS)

res10tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es10iSS,
                  method = "REML")
summary(res10tSS)

res11t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es11i,
                method = "REML")
summary(res11t)

res11tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iS,
                 method = "REML")
summary(res11tS)

res11tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es11iSS,
                  method = "REML")
summary(res11tSS)

res12t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es12i,
                method = "REML")
summary(res12t)

res12tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iS,
                 method = "REML")
summary(res12tS)

res12tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es12iSS,
                  method = "REML")
summary(res12tSS)

res13t <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es13i,
                method = "REML")
summary(res13t)

res13tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iS,
                 method = "REML")
summary(res13tS)

res13tSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es13iSS,
                  method = "REML")
summary(res13tSS)

res14t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es14i,
                method = "REML")
summary(res14t)

res14tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iS,
                 method = "REML")
summary(res14tS)

res14tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es14iSS,
                  method = "REML")
summary(res14tSS)

res15t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es15i,
                method = "REML")
summary(res15t)

res15tS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iS,
                 method = "REML")
summary(res15tS)

res15tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es15iSS,
                  method = "REML")
summary(res15tSS)

res16t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es16i,
                method = "REML")
summary(res16t)

res16tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iS,
                 method = "REML")
summary(res16tS)

res16tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es16iSS,
                  method = "REML")
summary(res16tSS)

res17t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es17i,
                method = "REML")
summary(res17t)

res17tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iS,
                 method = "REML")
summary(res17tS)

res17tSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es17iSS,
                  method = "REML")
summary(res17tSS)

res18t <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es18i,
                method = "REML")
summary(res18t)

res18tS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iS,
                 method = "REML")
summary(res18tS)

res18tSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es18iSS,
                  method = "REML")
summary(res18tSS)

##Leaf fall Overall Effect Sizes####

res1lf <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1ilf,
                  method = "REML")
summary(res1lf)
-(1-exp(res1t$b))*100
((exp(res1t$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR",#here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es1ilfS,
                 #adding term for a continuous time heteroscedastic autoregressive structure
                 method = "REML")
summary(res1lfS)
-(1-exp(res1tS$b))*100
((exp(res1tS$se))-1)*100

res1lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1ilfSS,
                  method = "REML")
summary(res1lfSS)

res2lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2ilf,
                method = "REML")
summary(res2lf)
res2$k

res2lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es2ilfS,
                 method = "REML")
summary(res2lfS)
res2S$k

res2lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es2ilfSS,
                  method = "REML")
summary(res2lfSS)

data_es3ilf$Site
res3lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3ilf,
                method = "REML")
summary(res3lf)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

res3lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3ilfS,
                 method = "REML")
summary(res3lfS)
-(1-exp(res3tS$b))*100
((exp(res3tS$se))-1)*100

res3lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es3ilfSS,
                  method = "REML")
summary(res3lfSS)

res4lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4ilf,
                method = "REML")
summary(res4lf)

res4lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es4ilfS,
                 method = "REML")
summary(res4lfS)

res4lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es4ilfSS,
                  method = "REML")
summary(res4lfSS)

res5lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5ilf,
                method = "REML")
summary(res5lf)

res5lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es5ilfS,
                 method = "REML")
summary(res5lfS)

res5lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es5ilfSS,
                  method = "REML")
summary(res5lfSS)

res6lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6ilf,
                method = "REML")
summary(res6lf)

res6lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es6ilfS,
                 method = "REML")
summary(res6lfS)

res6lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es6ilfSS,
                  method = "REML")
summary(res6lfSS)

res7lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7ilf,
                method = "REML")
summary(res7lf)
-(1-exp(res7t$b))*100
((exp(res7t$se))-1)*100

res7lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es7ilfS,
                 method = "REML")
summary(res7lfS)
-(1-exp(res7tS$b))*100
((exp(res7tS$se))-1)*100

res7lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es7ilfSS,
                  method = "REML")
summary(res7lfSS)

res8lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", 
                data = data_es8ilf,
                method = "REML")
summary(res8lf)
-(1-exp(res8t$b))*100
((exp(res8t$se))-1)*100

res8lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es8ilfS,
                 method = "REML")
summary(res8lfS)

res8lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es8ilfSS,
                  method = "REML")
summary(res8lfSS)

res9lf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9ilf,
                method = "REML")
summary(res9lf)

res9lfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es9ilfS,
                 method = "REML")
summary(res9lfS)

res9lfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es9ilfSS,
                  method = "REML")
summary(res9lfSS)

res10lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10ilf,
                 method = "REML")
summary(res10lf)

res10lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es10ilfS,
                  method = "REML")
summary(res10lfS)

res10lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es10ilfSS,
                   method = "REML")
summary(res10lfSS)

res11lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11ilf,
                 method = "REML")
summary(res11lf)

res11lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es11ilfS,
                  method = "REML")
summary(res11lfS)

res11lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es11ilfSS,
                   method = "REML")
summary(res11lfSS)

res12lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12ilf,
                 method = "REML")
summary(res12lf)

res12lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es12ilfS,
                  method = "REML")
summary(res12lfS)

res12lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es12ilfSS,
                   method = "REML")
summary(res12lfSS)

res13lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13ilf,
                 method = "REML")
summary(res13lf)

res13lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es13ilfS,
                  method = "REML")
summary(res13lfS)

res13lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es13ilfSS,
                   method = "REML")
summary(res13lfSS)

res14lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14ilf,
                 method = "REML")
summary(res14lf)

res14lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es14ilfS,
                  method = "REML")
summary(res14lfS)

res14lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es14ilfSS,
                   method = "REML")
summary(res14lfSS)

res15lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15ilf,
                 method = "REML")
summary(res15lf)

res15lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es15ilfS,
                  method = "REML")
summary(res15lfS)

res15lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es15ilfSS,
                   method = "REML")
summary(res15lfSS)

res16lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16ilf,
                 method = "REML")
summary(res16lf)

res16lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es16ilfS,
                  method = "REML")
summary(res16lfS)

res16lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es16ilfSS,
                   method = "REML")
summary(res16lfSS)

res17lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17ilf,
                 method = "REML")
summary(res17lf)

res17lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es17ilfS,
                  method = "REML")
summary(res17lfS)

res17lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es17ilfSS,
                   method = "REML")
summary(res17lfSS)

res18lf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18ilf,
                 method = "REML")
summary(res18lf)

res18lfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es18ilfS,
                  method = "REML")
summary(res18lfS)

res18lfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es18ilfSS,
                   method = "REML")
summary(res18lfSS)

##Wood fall Overall Effect Sizes####

res1wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es1iwf,
                struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                method = "REML")
summary(res1wf)
-(1-exp(res1t$b))*100
((exp(res1t$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR",#here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es1iwfS,
                 #adding term for a continuous time heteroscedastic autoregressive structure
                 method = "REML")
summary(res1wfS)
-(1-exp(res1tS$b))*100
((exp(res1tS$se))-1)*100

res1wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1iwfSS,
                  method = "REML")
summary(res1wfSS)

res2wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iwf,
                method = "REML")
summary(res2wf)
res2$k

res2wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es2iwfS,
                 method = "REML")
summary(res2wfS)
res2S$k

res2wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es2iwfSS,
                  method = "REML")
summary(res2wfSS)

res3wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iwf,
                method = "REML")
summary(res3wf)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

res3wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3iwfS,
                 method = "REML")
summary(res3wfS)
-(1-exp(res3tS$b))*100
((exp(res3tS$se))-1)*100

res3wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es3iwfSS,
                  method = "REML")
summary(res3wfSS)

res4wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iwf,
                method = "REML")
summary(res4wf)

res4wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es4iwfS,
                 method = "REML")
summary(res4wfS)

res4wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es4iwfSS,
                  method = "REML")
summary(res4wfSS)

res5wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iwf,
                method = "REML")
summary(res5wf)

res5wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es5iwfS,
                 method = "REML")
summary(res5wfS)

res5wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es5iwfSS,
                  method = "REML")
summary(res5wfSS)

res6wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iwf,
                method = "REML")
summary(res6wf)

res6wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es6iwfS,
                 method = "REML")
summary(res6wfS)

res6wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es6iwfSS,
                  method = "REML")
summary(res6wfSS)

res7wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iwf,
                method = "REML")
summary(res7wf)
-(1-exp(res7t$b))*100
((exp(res7t$se))-1)*100

res7wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es7iwfS,
                 method = "REML")
summary(res7wfS)
-(1-exp(res7tS$b))*100
((exp(res7tS$se))-1)*100

res7wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es7iwfSS,
                  method = "REML")
summary(res7wfSS)

res8wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", 
                data = data_es8iwf,
                method = "REML")
summary(res8wf)
-(1-exp(res8t$b))*100
((exp(res8t$se))-1)*100

res8wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es8iwfS,
                 method = "REML")
summary(res8wfS)

res8wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es8iwfSS,
                  method = "REML")
summary(res8wfSS)

res9wf <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iwf,
                method = "REML")
summary(res9wf)

res9wfS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es9iwfS,
                 method = "REML")
summary(res9wfS)

res9wfSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es9iwfSS,
                  method = "REML")
summary(res9wfSS)

res10wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10iwf,
                 method = "REML")
summary(res10wf)

res10wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es10iwfS,
                  method = "REML")
summary(res10wfS)

res10wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es10iwfSS,
                   method = "REML")
summary(res10wfSS)

res11wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iwf,
                 method = "REML")
summary(res11wf)

res11wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es11iwfS,
                  method = "REML")
summary(res11wfS)

res11wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es11iwfSS,
                   method = "REML")
summary(res11wfSS)

res12wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iwf,
                 method = "REML")
summary(res12wf)

res12wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es12iwfS,
                  method = "REML")
summary(res12wfS)

res12wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es12iwfSS,
                   method = "REML")
summary(res12wfSS)

res13wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iwf,
                 method = "REML")
summary(res13wf)

res13wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es13iwfS,
                  method = "REML")
summary(res13wfS)

res13wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es13iwfSS,
                   method = "REML")
summary(res13wfSS)

res14wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iwf,
                 method = "REML")
summary(res14wf)

res14wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es14iwfS,
                  method = "REML")
summary(res14wfS)

res14wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es14iwfSS,
                   method = "REML")
summary(res14wfSS)

res15wf<- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iwf,
                 method = "REML")
summary(res15wf)

res15wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es15iwfS,
                  method = "REML")
summary(res15wfS)

res15wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es15iwfSS,
                   method = "REML")
summary(res15tSS)

res16wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iwf,
                 method = "REML")
summary(res16wf)

res16wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es16iwfS,
                  method = "REML")
summary(res16wfS)

res16wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es16iwfSS,
                   method = "REML")
summary(res16wfSS)

res17wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iwf,
                 method = "REML")
summary(res17wf)

res17wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es17iwfS,
                  method = "REML")
summary(res17wfS)

res17wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es17iwfSS,
                   method = "REML")
summary(res17wfSS)

res18wf <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iwf,
                 method = "REML")
summary(res18wf)

res18wfS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es18iwfS,
                  method = "REML")
summary(res18wfS)

res18wfSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es18iwfSS,
                   method = "REML")
summary(res18wfSS)

## FFS fall Overall Effect Sizes ####

res1ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es1iff,
                struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                method = "REML")
summary(res1ff)
-(1-exp(res1t$b))*100
((exp(res1t$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR",
                 data = data_es1iffS,
                 #adding term for a continuous time heteroscedastic autoregressive structure
                 method = "REML")
summary(res1ffS)
-(1-exp(res1tS$b))*100
((exp(res1tS$se))-1)*100

res1ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1iffSS,
                  method = "REML")
summary(res1ffSS)

res2ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iff,
                method = "REML")
summary(res2ff)
res2$k

res2ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es2iffS,
                 method = "REML")
summary(res2ffS)
res2S$k

res2ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es2iffSS,
                  method = "REML")
summary(res2ffSS)

res3ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iff,
                method = "REML")
summary(res3ff)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

res3ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3iffS,
                 method = "REML")
summary(res3ffS)
-(1-exp(res3tS$b))*100
((exp(res3tS$se))-1)*100

res3ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es3iffSS,
                  method = "REML")
summary(res3ffSS)

res4ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iff,
                method = "REML")
summary(res4ff)

res4ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es4iffS,
                 method = "REML")
summary(res4ffS)

res4ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es4iffSS,
                  method = "REML")
summary(res4ffSS)

res5ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iff,
                method = "REML")
summary(res5ff)

res5ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es5iffS,
                 method = "REML")
summary(res5ffS)

res5ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es5iffSS,
                  method = "REML")
summary(res5ffSS)

res6ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iff,
                method = "REML")
summary(res6ff)

res6ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es6iffS,
                 method = "REML")
summary(res6ffS)

res6ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es6iffSS,
                  method = "REML")
summary(res6ffSS)

res7ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iff,
                method = "REML")
summary(res7ff)
-(1-exp(res7t$b))*100
((exp(res7t$se))-1)*100

res7ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es7iffS,
                 method = "REML")
summary(res7ffS)
-(1-exp(res7tS$b))*100
((exp(res7tS$se))-1)*100

res7ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es7iffSS,
                  method = "REML")
summary(res7ffSS)

res8ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", 
                data = data_es8iff,
                method = "REML")
summary(res8ff)
-(1-exp(res8t$b))*100
((exp(res8t$se))-1)*100

res8ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es8iffS,
                 method = "REML")
summary(res8ffS)

res8ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es8iffSS,
                  method = "REML")
summary(res8ffSS)

res9ff <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iff,
                method = "REML")
summary(res9ff)

res9ffS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es9iffS,
                 method = "REML")
summary(res9ffS)

res9ffSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es9iffSS,
                  method = "REML")
summary(res9ffSS)

res10ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10iff,
                 method = "REML")
summary(res10ff)

res10ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es10iffS,
                  method = "REML")
summary(res10ffS)

res10ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es10iffSS,
                   method = "REML")
summary(res10ffSS)

res11ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iff,
                 method = "REML")
summary(res11ff)

res11ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es11iffS,
                  method = "REML")
summary(res11ffS)

res11ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es11iffSS,
                   method = "REML")
summary(res11ffSS)

res12ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iff,
                 method = "REML")
summary(res12ff)

res12ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es12iffS,
                  method = "REML")
summary(res12ffS)

res12ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es12iffSS,
                   method = "REML")
summary(res12ffSS)

res13ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iff,
                 method = "REML")
summary(res13ff)

res13ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es13iffS,
                  method = "REML")
summary(res13ffS)

res13ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es13iffSS,
                   method = "REML")
summary(res13ffSS)

res14ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iff,
                 method = "REML")
summary(res14ff)

res14ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es14iffS,
                  method = "REML")
summary(res14ffS)

res14ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es14iffSS,
                   method = "REML")
summary(res14ffSS)

res15ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iff,
                 method = "REML")
summary(res15ff)

res15ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es15iffS,
                  method = "REML")
summary(res15ffS)

res15ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es15iffSS,
                   method = "REML")
summary(res15ffSS)

res16ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iff,
                 method = "REML")
summary(res16ff)

res16ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es16iffS,
                  method = "REML")
summary(res16ffS)

res16ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es16iffSS,
                   method = "REML")
summary(res16ffSS)

res17ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iff,
                 method = "REML")
summary(res17ff)

res17ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es17iffS,
                  method = "REML")
summary(res17ffS)

res17ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es17iffSS,
                   method = "REML")
summary(res17ffSS)

res18ff <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iff,
                 method = "REML")
summary(res18ff)

res18ffS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es18iffS,
                  method = "REML")
summary(res18ffS)

res18ffSS <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es18iffSS,
                   method = "REML")
summary(res18ffSS)

##Nutrient Overal Effect Sizes####

##Total P flux Overall####
names(data_es1itpf)

res1tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es1itpf)
summary(res1tpf)

res2tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es2itpf)
summary(res2tpf)

res3tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es3itpf)
summary(res3tpf)

res4tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es4itpf)
summary(res4tpf)

res5tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es5itpf)
summary(res5tpf)

res6tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es6itpf)
summary(res6tpf)

res7tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es7itpf)
summary(res7tpf)

res8tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es8itpf)
summary(res8tpf)

res9tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es9itpf)
summary(res9tpf)

res10tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es10itpf)
summary(res10tpf)

res11tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es11itpf)
summary(res11tpf)

res12tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es12itpf)
summary(res12tpf)

res13tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es13itpf)
summary(res13tpf)

res14tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es14itpf)
summary(res14tpf)

res15tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es15itpf)
summary(res15tpf)

res16tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es16itpf)
summary(res16tpf)

res17tpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es17itpf)
summary(res17tpf)

res18tpf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR",method="REML",
                  data = data_es18itpf)
summary(res18tpf)

##Leaf P flux Overall####
names(data_es1ilpf)

res1lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es1ilpf)
summary(res1lpf)

res2lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es2ilpf)
summary(res2lpf)

res3lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es3ilpf)
summary(res3lpf)

res4lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es4ilpf)
summary(res4lpf)

res5lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es5ilpf)
summary(res5lpf)

res6lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es6ilpf)
summary(res6lpf)

res7lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es7ilpf)
summary(res7lpf)

res8lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es8ilpf)
summary(res8lpf)

res9lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es9ilpf)
summary(res9lpf)

res10lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es10ilpf)
summary(res10lpf)

res11lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es11ilpf)
summary(res11lpf)

res12lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es12ilpf)
summary(res12lpf)

res13lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es13ilpf)
summary(res13lpf)

res14lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es14ilpf)
summary(res14lpf)

res15lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es15ilpf)
summary(res15lpf)

res16lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es16ilpf)
summary(res16lpf)

res17lpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es17ilpf)
summary(res17lpf)

res18lpf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es18ilpf)
summary(res18lpf)

##Wood P flux Overall####

res1wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es1iwpf)
summary(res1wpf)

res2wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es2iwpf)
summary(res2wpf)

res3wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es3iwpf)
summary(res3wpf)

res4wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es4iwpf)
summary(res4wpf)

res5wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es5iwpf)
summary(res5wpf)

res6wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es6iwpf)
summary(res6wpf)

res7wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es7iwpf)
summary(res7wpf)

res8wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es8iwpf)
summary(res8wpf)

res9wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es9iwpf)
summary(res9wpf)

res10wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es10iwpf)
summary(res10wpf)

res11wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es11iwpf)
summary(res11wpf)

res12wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es12iwpf)
summary(res12wpf)

res13wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es12iwpf)
summary(res13wpf)

res14wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es13iwpf)
summary(res1wpf)

res1wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es14iwpf)
summary(res14wpf)

res15wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es15iwpf)
summary(res15wpf)

res16wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es16iwpf)
summary(res16wpf)

res17wpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es17iwpf)
summary(res17wpf)

res18wpf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es18iwpf)
summary(res18wpf)

##FFS P flux Overall####

res1ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",data = data_es1iffpf)
summary(res1ffpf)

res2ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es2iffpf)
summary(res2ffpf)

res3ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es3iffpf)
summary(res3ffpf)

res4ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es4iffpf)
summary(res4ffpf)

res5ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es5iffpf)
summary(res5ffpf)

res6ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es6iffpf)
summary(res6ffpf)

res7ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es7iffpf)
summary(res7ffpf)

res8ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es8iffpf)
summary(res8ffpf)

res9ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es9iffpf)
summary(res9ffpf)

res10ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es10iffpf)
summary(res10ffpf)

res11ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es11iffpf)
summary(res11ffpf)

res12ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es12iffpf)
summary(res12ffpf)

res13ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es13iffpf)
summary(res13ffpf)

res14ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es14iffpf)
summary(res14ffpf)

res15ffpf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es15iffpf)
summary(res15ffpf)

res16ffpf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",data = data_es16iffpf)
summary(res16ffpf)


##Total N flux Overall####
names(data_es1itnf)

res1tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es1itnf)
summary(res1tnf)

res2tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es2itnf)
summary(res2tnf)

res3tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es3itnf)
summary(res3tnf)

res4tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es4itnf)
summary(res4tnf)

res5tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es5itnf)
summary(res5tnf)

res6tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es6itnf)
summary(res6tnf)

res7tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es7itnf)
summary(res7tnf)

res8tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es8itnf)
summary(res8tnf)

res9tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es9itnf)
summary(res9tnf)

res10tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es10itnf)
summary(res10tnf)

res11tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es11itnf)
summary(res11tnf)

res12tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es12itnf)
summary(res12tnf)

res13tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es13itnf)
summary(res13tnf)

res14tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es14itnf)
summary(res14tnf)

res15tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es15itnf)
summary(res15tnf)

res16tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es16itnf)
summary(res16tnf)

res17tnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es17itnf)
summary(res17tnf)

res18tnf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es18itnf)
summary(res18tnf)

##Leaf N flux Overall####
names(data_es1itnf)

res1lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es1ilnf)
summary(res1lnf)

res2lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es2ilnf)
summary(res2lnf)

res3lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es3ilnf)
summary(res3lnf)

res4lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es4ilnf)
summary(res4lnf)

res5lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es5ilnf)
summary(res5lnf)

res6lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es6ilnf)
summary(res6lnf)

res7lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es7ilnf)
summary(res7lnf)

res8lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es8ilnf)
summary(res8lnf)

res9lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es9ilnf)
summary(res9lnf)

res10lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es10ilnf)
summary(res10lnf)

res11lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es11ilnf)
summary(res11lnf)

res12lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es12ilnf)
summary(res12lnf)

res13lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es13ilnf)
summary(res13lnf)

res14lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es14ilnf)
summary(res14lnf)

res15lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es1il5nf)
summary(res15lnf)

res16lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es16ilnf)
summary(res16lnf)

res17lnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es17ilnf)
summary(res17lnf)

res18lnf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es18ilnf)
summary(res18lnf)

## Wood N flux Overall####

res1wnf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es1iwnf)
summary(res1wnf)

res2wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es2iwnf)
summary(res2wnf)

res3wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es3iwnf)
summary(res3wnf)

res4wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es4iwnf)
summary(res4wnf)

res5wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es5iwnf)
summary(res5wnf)

res6wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es6iwnf)
summary(res6wnf)

res7wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es7iwnf)
summary(res7wnf)

res8wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es8iwnf)
summary(res8wnf)

res9wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es9iwnf)
summary(res9wnf)

res10wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es10iwnf)
summary(res10wnf)

res11wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es11iwnf)
summary(res11wnf)

res12wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es12iwnf)
summary(res12wnf)

res13wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es13iwnf)
summary(res13wnf)

res14wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es14iwnf)
summary(res14wnf)

res15wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es15iwnf)
summary(res15wnf)

res16wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es16iwnf)
summary(res16wnf)

res17wnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es17iwnf)
summary(res17wnf)

res18wnf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance nested within site
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es18iwnf)
summary(res18wnf)

## FFS N flux Overall####

res1ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                  tdist = TRUE,struct = "CAR",method="REML",
                  data = data_es1iffnf)
summary(res1ffnf)

res2ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es2iffnf)
summary(res2ffnf)

res3ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es3iffnf)
summary(res3ffnf)

res4ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es4iffnf)
summary(res4ffnf)

res5ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es5iffnf)
summary(res5ffnf)

res5ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es5iffnf)
summary(res5ffnf)

res6ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es6iffnf)
summary(res6ffnf)

res7ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es7iffnf)
summary(res7ffnf)

res8ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es8iffnf)
summary(res8ffnf)

res8ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es8iffnf)
summary(res8ffnf)

res9ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es9iffnf)
summary(res9ffnf)

res10ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es10iffnf)
summary(res10ffnf)

res10ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es10iffnf)
summary(res10ffnf)

res11ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es11iffnf)
summary(res11ffnf)

res12ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es12iffnf)
summary(res12ffnf)

res13ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es13iffnf)
summary(res13ffnf)

res14ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es14iffnf)
summary(res14ffnf)

res15ffnf <- rma.mv(yi,vi,random = ~ 1 | Site/TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es15iffnf)
summary(res15ffnf)

res16ffnf <- rma.mv(yi,vi,random = ~ 1 | TSD_months, #time since disturbance only because Site variance came out as zero
                   tdist = TRUE,struct = "CAR",method="REML",
                   data = data_es16iffnf)
summary(res16ffnf)


## Ambient + TrimDeb only

levels(res$Treatment)
#[1] "Ambient" "DebRem"  "Fert "   "N+"      "NP+"     "P+"      "Trim "   "TrimDeb"

res1t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es1iamb,
                struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                method = "REML")
summary(res1t_amb)
-(1-exp(res1t$b))*100
((exp(res1t$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR",#here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es1iSamb,
                 #adding term for a continuous time heteroscedastic autoregressive structure
                 method = "REML")
summary(res1tS_amb)
-(1-exp(res1tS$b))*100
((exp(res1tS$se))-1)*100

res1tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1iSSamb,
                  method = "REML")
summary(res1tSS_amb)

res2t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iamb,
                method = "REML")
summary(res2t_amb)
res2$k

res2tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es2iSamb,
                 method = "REML")
summary(res2tS_amb)

res2tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es2iSSamb,
                  method = "REML")
summary(res2tSS_amb)

res3t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iamb,
                method = "REML")
summary(res3t_amb)

res3tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3iSamb,
                 method = "REML")
summary(res3tS_amb)

res3tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es3iSSamb,
                  method = "REML")
summary(res3tSS_amb)

res4t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iamb,
                method = "REML")
summary(res4t_amb)

res4tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es4iSamb,
                 method = "REML")
summary(res4tS_amb)

data_es4iSS_amb<-data_es4iSS %>% filter(Treatment == "Ambient"|Treatment == "TrimDeb")

res4tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es4iSSamb,
                  method = "REML")
summary(res4tSS_amb)

res5t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iamb,
                method = "REML")
summary(res5t_amb)

data_es5iS_amb<-data_es5iS %>% filter(Treatment == "Ambient"|Treatment == "TrimDeb")

res5tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es5iSamb,
                 method = "REML")
summary(res5tS_amb)

res5tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es5iSSamb,
                  method = "REML")
summary(res5tSS_amb)

res6t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iamb,
                method = "REML")
summary(res6t_amb)

res6tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es6iSamb,
                 method = "REML")
summary(res6tS_amb)

data_es6iSS_amb<-data_es6iSS %>% filter(Treatment == "Ambient"|Treatment == "TrimDeb")

res6tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es6iSSamb,
                  method = "REML")
summary(res6tSS_amb)

res7t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iamb,
                method = "REML")
summary(res7t_amb)
-(1-exp(res7t$b))*100
((exp(res7t$se))-1)*100

res7tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es7iSamb,
                 method = "REML")
summary(res7tS_amb)
-(1-exp(res7tS$b))*100
((exp(res7tS$se))-1)*100

res7tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es7iSSamb,
                  method = "REML")
summary(res7tSS_amb)

res8t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", 
                data = data_es8iamb,
                method = "REML")
summary(res8t_amb)
-(1-exp(res8t$b))*100
((exp(res8t$se))-1)*100

res8tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es8iSamb,
                 method = "REML")
summary(res8tS_amb)

res8tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es8iSSamb,
                  method = "REML")
summary(res8tSS_amb)

res9t_amb <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iamb,
                method = "REML")
summary(res9t_amb)

res9tS_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es9iSamb,
                 method = "REML")
summary(res9tS_amb)

res9tSS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es9iSSamb,
                  method = "REML")
summary(res9tSS_amb)

res10t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10iamb,
                 method = "REML")
summary(res10t_amb)

res10tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es10iSamb,
                  method = "REML")
summary(res10tS_amb)

res10tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es10iSSamb,
                   method = "REML")
summary(res10tSS_amb)

res11t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iamb,
                 method = "REML")
summary(res11t_amb)

res11tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es11iSamb,
                  method = "REML")
summary(res11tS_amb)

res11tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es11iSSamb,
                   method = "REML")
summary(res11tSS_amb)

res12t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iamb,
                 method = "REML")
summary(res12t_amb)

res12tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es12iSamb,
                  method = "REML")
summary(res12tS_amb)

res12tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es12iSSamb,
                   method = "REML")
summary(res12tSS_amb)

res13t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iamb,
                 method = "REML")
summary(res13t_amb)

res13tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es13iSamb,
                  method = "REML")
summary(res13tS_amb)

res13tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es13iSSamb,
                   method = "REML")
summary(res13tSS_amb)

res14t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iamb,
                 method = "REML")
summary(res14t_amb)

res14tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es14iSamb,
                  method = "REML")
summary(res14tS_amb)

res14tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es14iSSamb,
                   method = "REML")
summary(res14tSS_amb)

res15t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iamb,
                 method = "REML")
summary(res15t_amb)

res15tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es15iSamb,
                  method = "REML")
summary(res15tS_amb)

res15tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es15iSSamb,
                   method = "REML")
summary(res15tSS_amb)

res16t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iamb,
                 method = "REML")
summary(res16t_amb)

res16tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es16iSamb,
                  method = "REML")
summary(res16tS_amb)

res16tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es16iSSamb,
                   method = "REML")
summary(res16tSS_amb)

res17t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iamb,
                 method = "REML")
summary(res17t_amb)

res17tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es17iSamb,
                  method = "REML")
summary(res17tS_amb)

res17tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es17iSSamb,
                   method = "REML")
summary(res17tSS_amb)

res18t_amb <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iamb,
                 method = "REML")
summary(res18t_amb)

res18tS_amb <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es18iSamb,
                  method = "REML")
summary(res18tS_amb)

res18tSS_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es18iSSamb,
                   method = "REML")
summary(res18tSS_amb)

## Not accounting for Time since disturbance as random effect

res1S <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es1iS,
               method = "REML")
summary(res1S)
res1S$k#26

res1SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es1iSS,
                method = "REML")
summary(res1SS)

res2 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es2i,
               method = "REML")
summary(res2)
res2$k

res2S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iS,
                method = "REML")
summary(res2S)
res2S$k

res2SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es2iSS,
                method = "REML")
summary(res2SS)

res3 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es3i,
               method = "REML")
summary(res3)

res3S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iS,
                method = "REML")
summary(res3S)

res3SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iSS,
                method = "REML")
summary(res3SS)

res4 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es4i,
               method = "REML")
summary(res4)

res4S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iS,
                method = "REML")
summary(res4S)

res4SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es4iSS,
                method = "REML")
summary(res4SS)

res5 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es5i,
               method = "REML")
summary(res5)

res5S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iS,
                method = "REML")
summary(res5S)

res5SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es5iSS,
                method = "REML")
summary(res5SS)

res6 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es6i,
               method = "REML")
summary(res6)

res6S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iS,
                method = "REML")
summary(res6S)

res6SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es6iSS,
                method = "REML")
summary(res6SS)

res7 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es7i,
               method = "REML")
summary(res7)

res7S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iS,
                method = "REML")
summary(res7S)

res7SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es7iSS,
                method = "REML")
summary(res7SS)

res8 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es8i,
               method = "REML")
summary(res8)

res8S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es8iS,
                method = "REML")
summary(res8S)

res8SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es8iSS,
                method = "REML")
summary(res8SS)

res9 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es9i,
               method = "REML")
summary(res9)

res9S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iS,
                method = "REML")
summary(res9S)

res9SS <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es9iSS,
                method = "REML")
summary(res9SS)

res10 <- rma.mv(yi, 
               vi, 
               random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
               tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
               data = data_es10i,
               method = "REML")
summary(res10)

res10S <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es10iS,
                method = "REML")
summary(res10S)

res10SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es10iSS,
                 method = "REML")
summary(res10SS)

res11 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es11i,
                method = "REML")
summary(res11)

res11S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iS,
                 method = "REML")
summary(res11S)

res11SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es11iSS,
                 method = "REML")
summary(res11SS)

res12 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es12i,
                method = "REML")
summary(res12)

res12S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iS,
                 method = "REML")
summary(res12S)

res12SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es12iSS,
                 method = "REML")
summary(res12SS)

res13 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es13i,
                method = "REML")
summary(res13)

res13S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iS,
                 method = "REML")
summary(res13S)

res13SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es13iSS,
                 method = "REML")
summary(res13SS)

res14 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es14i,
                method = "REML")
summary(res14)

res14S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iS,
                 method = "REML")
summary(res14S)

res14SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es14iSS,
                 method = "REML")
summary(res14SS)

res15 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es15i,
                method = "REML")
summary(res15)

res15S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iS,
                 method = "REML")
summary(res15S)

res15SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es15iSS,
                 method = "REML")
summary(res15SS)

res16 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es16i,
                method = "REML")
summary(res16)

res16S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iS,
                 method = "REML")
summary(res16S)

res16SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es16iSS,
                 method = "REML")
summary(res16SS)

res17 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es17i,
                method = "REML")
summary(res17)

res17S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iS,
                 method = "REML")
summary(res17S)

res17SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es17iSS,
                 method = "REML")
summary(res17SS)

res18 <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es18i,
                method = "REML")
summary(res18)

res18S <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iS,
                 method = "REML")
summary(res18S)

res18SS <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                 tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es18iSS,
                 method = "REML")
summary(res18SS)

####RESILIENCE Meta-regressions####

##Lowest point in the curve 5 to 6 months

res3t_reg <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3i,
                method = "REML",
                mods = ~ logsoilP)
summary(res3t_reg)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

res3tS_reg <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                 data = data_es3iS,
                 method = "REML",
                 mods = ~Par_Mat)
summary(res3tS_reg)
summary(res3tS)
-(1-exp(res3tS$b))*100
((exp(res3tS$se))-1)*100

res3tSS <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                  tdist = TRUE,
                  struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es3iSS,
                  method = "REML")
summary(res3tSS)

data_es3iSamb$logsoilP=log(data_es3iSamb$Other_soil_P)

res3tS_amb_reg <- rma.mv(yi, 
                         vi, 
                         random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                         tdist = TRUE,
                         struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                         data = data_es3iSamb,
                         method = "REML",
                         mods = ~logsoilP)
summary(res3tS_amb_reg)

data_es3iSamb_noCTE <- data_es3iSamb %>% filter(Treatment!="TrimDeb")

res3tS_amb_reg2 <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                    tdist = TRUE,
                    struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                    data = data_es3iSamb_noCTE,
                    method = "REML",
                    mods = ~logsoilP)
summary(res3tS_amb_reg2)

data_es3iS$logsoilP=log(data_es3iS$Other_soil_P)
res3tS_reg <- rma.mv(yi, 
                vi, 
                random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                tdist = TRUE,
                struct = "CAR", #here we turn ON the Knapp-Hartung adjustment for CIs
                data = data_es3iS,
                method = "REML",
                mods = ~logsoilP)
summary(res3tS_reg)
-(1-exp(res3t$b))*100
((exp(res3t$se))-1)*100

##3to6 months

res3to6_amb_reg <- rma.mv(yi, 
                           vi, 
                           random = ~ 1 | Site_ID/TSD_months,
                           tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                           data = data_es3to6iamb,
                           struct = "CAR",
                           method = "REML",
                           mods = ~Other_soil_P+Distance_to_Disturb_km+Longitude)
summary(res3to6_amb_reg)

data_es3to6iamb$USDA_Soil_Order
names(data_es3to6iamb)
data_es3to6iamb$logsoilP=log(data_es3to6iamb$Other_soil_P)

multimodel.inference(TE = "yi", 
                     seTE = "vi",
                     data = data_es3to6iamb,
                     predictors = c("logsoilP", "WMO_wind_kts", "StormFrequencyNorm", "Distance_to_Disturb_km","RockType","Elevation_m","RockPClass"),
                     interaction = FALSE)

multimodel.inference(TE = "yi", 
                     seTE = "vi",
                     data = data_es3to6iamb,
                     predictors = c("logsoilP", "StormFrequencyNorm", "RockType","Elevation_m"),
                     interaction = FALSE)
names(data_es3to6iamb)
res3to6_amb_reg.1 <- rma.mv(yi, 
                          vi, 
                          random = ~ 1 | Site_ID/TSD_months,
                          tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                          data = data_es3to6iamb,
                          struct = "CAR",
                          method = "REML",
                          mods = Elevation_m)
summary(res3to6_amb_reg.1)
chart.Correlation(data_es3to6iamb[,c(23,79,19)])

res3to6_amb_reg.2 <- rma.mv(yi, 
                            vi, 
                            random = ~ 1 | Site_ID/TSD_months,
                            tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                            data = data_es3to6iamb,
                            struct = "CAR",
                            method = "REML",
                            mods = ~RockType+Elevation_m)
summary(res3to6_amb_reg.2)

##Subannual 3to6 months

res3to6_ambS_reg <- rma.mv(yi, 
                       vi, 
                       random = ~ 1 | Site_ID/TSD_months,
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = data_es3to6iambS,
                       struct = "CAR",
                       method = "REML",
                       mods = ~logsoilP+RockType)
summary(res3to6_ambS_reg)
names(data_es3to6iambS)
chart.Correlation(data_es3to6iambS[,c(79,48,18)])

data_es3to6iambS$logsoilP=log(data_es3to6iambS$Other_soil_P)

res3to6_ambS_reg.2 <- rma.mv(yi, 
                            vi, 
                            random = ~ 1 | Site_ID/TSD_months,
                            tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                            data = data_es3to6iambS,
                            struct = "CAR",
                            method = "REML",
                            mods = ~ Elevation_m+logsoilP)
summary(res3to6_ambS_reg.2)

##First 36 months

data_es1to36$logsoilP=log(data_es1to36$Other_soil_P)

resall.1reg <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months,
                   tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                   data = data_es1to36,
                   struct = "CAR",
                   mods = ~Other_soil_P,
                   method = "REML")
summary(resall.1reg)

data_es1to36S$logsoilP=log(data_es1to36S$Other_soil_P)

resall.1Sreg <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months,
                    tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                    data = data_es1to36S,
                    struct = "CAR",
                    mods = ~logsoilP,
                    method = "REML")
summary(resall.1Sreg)

data_es1to36SS$logsoilP=log(data_es1to36SS$Other_soil_P)

resall.1SSreg <- rma.mv(yi, 
                     vi, 
                     random = ~ 1 | Site_ID/TSD_months,
                     tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                     data = data_es1to36SS,
                     struct = "CAR",
                     mods = ~logsoilP,
                     method = "REML")
summary(resall.1SSreg)

data_es1to14$logsoilP=log(data_es1to14$Other_soil_P)
data_es1to14$logwind_speed=log(data_es1to14$WMO_wind_kts)
names(data_es1to14)

data_es1to14S$logsoilP=log(data_es1to14S$Other_soil_P)
data_es1to14S$logwind_speed=log(data_es1to14S$WMO_wind_kts)

##Overall resilience within the first 14 months

res1to14_all <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                    tdist = TRUE,
                    struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                    data = data_es1to14,
                    #mods = ~Par_Mat,
                    method = "REML")
summary(res1to14_all)
-(1-exp(res1to14_all$b))*100
((exp(res1to14_all$se))-1)*100
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

res1to14_allS <- rma.mv(yi, 
                       vi, 
                       random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                       tdist = TRUE,
                       struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                       data = data_es1to14S,
                       #mods = ~Par_Mat,
                       method = "REML")
summary(res1to14_allS)
-(1-exp(res1to14_allS$b))*100
((exp(res1to14_allS$se))-1)*100

res1to14_allSS <- rma.mv(yi, 
                        vi, 
                        random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                        tdist = TRUE,
                        struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                        data = data_es1to14SS,
                        #mods = ~Par_Mat,
                        method = "REML")
summary(res1to14_allSS)
-(1-exp(res1to14_allSS$b))*100
((exp(res1to14_allSS$se))-1)*100

res1to14 <- rma.mv(yi, 
                 vi, 
                 random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                 tdist = TRUE,
                 struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                 data = data_es1to14,
                 mods = ~logsoilP,
                 method = "REML")
summary(res1to14)

data_es1to14_amb<-data_es1to14 %>% filter(Treatment == "Ambient")

res1to14_amb <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                   data = data_es1to14_amb,
                   mods = ~logsoilP,
                   method = "REML")
summary(res1to14_amb)

res1to14S <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                   data = data_es1to14S,
                   mods = ~logsoilP,
                   method = "REML")
summary(res1to14S)

res1to14b <- rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                   tdist = TRUE,
                   struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                   data = data_es1to14,
                   mods = ~Par_Mat,
                   method = "REML")
summary(res1to14b)

res1to14bS <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                    tdist = TRUE,
                    struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                    data = data_es1to14S,
                    mods = ~Par_Mat,
                    method = "REML")
summary(res1to14bS)

res1to14c <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                    tdist = TRUE,
                    struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                    data = data_es1to14,
                    mods = ~WMO_wind_kts,
                    method = "REML")
summary(res1to14c)

res1to14cS <- rma.mv(yi, 
                    vi, 
                    random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                    tdist = TRUE,
                    struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                    data = data_es1to14S,
                    mods = ~WMO_wind_kts,
                    method = "REML")
summary(res1to14cS)

res1to14dS <- rma.mv(yi, 
                     vi, 
                     random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                     tdist = TRUE,
                     struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                     data = data_es1to14S,
                     mods = ~logsoilP,
                     method = "REML")
summary(res1to14dS)

res1to14eS <- rma.mv(yi, 
                     vi, 
                     random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                     tdist = TRUE,
                     struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                     data = data_es1to14S,
                     mods = ~Treatment,
                     method = "REML")
summary(res1to14eS)

res1to14fS <- rma.mv(yi, 
                     vi, 
                     random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                     tdist = TRUE,
                     struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                     data = data_es1to14S,
                     mods = ~Treatment+WMO_wind_kts,
                     method = "REML")
summary(res1to14fS)

res1to14fSS <- rma.mv(yi, 
                     vi, 
                     random = ~ 1 | Site_ID/TSD_months, #time since disturbance nested within site
                     tdist = TRUE,
                     struct = "CAR",#adding term for a continuous time heteroscedastic autoregressive structure
                     data = data_es1to14SS,
                     mods = ~Treatment+WMO_wind_kts,
                     method = "REML")
summary(res1to14fSS)


pred1to12<-predict.rma(metareg1to12a)

metareg1to12b<-rma.mv(yi, 
                      vi, 
                      random = ~ 1 | Site_ID/Effectsize_ID, 
                      tdist = TRUE, 
                      data = data_es1to12,
                      method = "REML",
                      mods = ~ Elevation_m)
summary(metareg1to12b)#Elevation is a significant moderator

metaregplot1to12<- cbind(data.frame(data_es1to12$yi, pred1to12$pred,data_es1to12$Elevation_m,data_es1to12$StormsPerYear,data_es1to12$WMO_press_mb))
metaregplot1to12

metaregplot<- cbind(data.frame(data_es0ia$yi, pred$pred,data_es0ia$Other_soil_P))
metaregplot

metaregplot2<- cbind(data.frame(data_es0ia$yi, lm2$fitted.values))
metaregplot2

lm1to12<-lm(yi~Elevation_m+WMO_press_mb+Region,data=data_es1to12)
summary(lm1to12)

lm1to12_b<-lm(yi~StormsPerYear+WMO_press_mb+Region,data=data_es1to12)
summary(lm1to12_b)

lm1to12_c<-lm(yi~WMO_press_mb+Region,data=data_es1to12)
summary(lm1to12_c)

lm1to12_d<-lm(yi~WMO_press_mb+Region+Distance_to_Disturb_km,data=data_es1to12)
summary(lm1to12_d)

AIC(lm1to12,lm1to12_b,lm1to12_c,lm1to12_d)

metaregplot1to12_b<- cbind(data.frame(data_es1to12$yi, lm1to12_d$fitted.values,data_es1to12$WMO_press_mb,data_es1to12$Distance_to_Disturb_km))
names(metaregplot1to12_b)

preg1to12<-ggplot(metaregplot1to12, aes(x=pred1to12.pred, y=data_es1to12.yi,color=data_es1to12.Elevation_m))+geom_point(size=3.5,alpha=0.6)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=18))+ labs(x="Predicted Effect Size", y="Observed Effect Size")
preg1to12+scale_color_gradient(low="blue", high="red")

#+ geom_label_repel(aes(label=data_es0ia$Basin,fill = factor(data_es0ia$Basin)), color = 'black', size = 5, alpha=0.8) +scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))


preg2<-ggplot(metaregplot, aes(x=lm.fitted.values, y=data_es0ia.yi))+geom_point()+geom_smooth(method = 'lm')+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=24),
        axis.text=element_text(size=22))+ labs(x="Predicted Effect Size Values", y="Observed Effect Size Values")
preg2
library("ggrepel")
preg2 + geom_label_repel(aes(label=data_es0ia$Region,
                              fill = factor(data_es0ia$Region)), color = 'black',
                          size = 4.5) +
  theme(legend.position = "bottom")

summary(lm1to12_d)

preg1to12_2<-ggplot(metaregplot1to12_b, aes(x=lm1to12_d.fitted.values, y=data_es1to12.yi))+geom_point(aes(color=data_es1to12$Region,size=3.5))+geom_point(size=1,alpha=0.7,fill="white",stroke=0.5,colour="white")+geom_smooth(method = 'lm',color="black",alpha=0.8)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=18))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .5)+
  labs(x="Predicted Resilience", y="Observed Resilience")#+scale_colour_discrete(solid=F)
preg1to12_2+theme(legend.title = element_text (size = 16), legend.text = element_text (size = 18),legend.position=c(0.78,0.15),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))
library("ggrepel")
preg1to12_2

### Resilience PREDICTIONS ####

names(data_es3iS)
lm_Res_5to6S<-glm(yi~logsoilP, data=data_es3iS)#+(1|Site)
summary(lm_Res_5to6S)
sjPlot::tab_model(lm_Res_5to6S,show.df = TRUE,digits.p = 2,p.threshold = 0.05)

data_es3i$logsoilP=log(data_es3i$Other_soil_P)
lm_Res_5to6<-glm(yi~logsoilP, data=data_es3i)#+(1|Site)
summary(lm_Res_5to6)
sjPlot::tab_model(lm_Res_5to6S,show.df = TRUE,digits.p = 2,p.threshold = 0.05)

#### Meta-regression RESILIENCE ####

names(data_es1to14)


modres1 <- rma.mv(yi, 
                       vi, 
                       random = ~ 1 | Site_ID/Effectsize_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                       tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                       data = data_es1i,
                       mods = ~Other_soil_P,
                       method = "REML")
summary(modres1, digits = 4) #soil P ns

modres1 <- rma.mv(yi, 
                  vi, 
                  random = ~ 1 | Site_ID/Effectsize_ID, #individual effect size nested within basin (Basin is level 3, effect size is level 2)
                  tdist = TRUE, #here we turn ON the Knapp-Hartung adjustment for CIs
                  data = data_es1i,
                  mods = ~Other_soil_P,
                  method = "REML")
summary(modres1, digits = 4)

#Three-level model is very useful

model.mods2<-rma.mv(yi, 
                   vi, 
                   random = ~ 1 | Site_ID/Effectsize_ID, 
                   tdist = TRUE, 
                   data = data_es0ia,
                   method = "REML",
                   mods = ~ Other_soil_P+USDA_Soil_Order)
summary(model.mods2)


#### STEP 4## METAFOREST ####

###1 to 36 months Annual####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36$long<-z.trans(data_meta_res_1to36$Longitude)

data_meta_res_1to36$elev<-z.trans(data_meta_res_1to36$Elevation_m)

data_meta_res_1to36$mat_map<-z.trans(data_meta_res_1to36$MAT_MAP_x100)

data_meta_res_1to36$soilP<-z.trans(data_meta_res_1to36$Other_soil_P)

data_meta_res_1to36$stormfreq<-z.trans(data_meta_res_1to36$StormFrequencyNorm)

data_meta_res_1to36$timesincestorm<-z.trans(data_meta_res_1to36$YearsSinceLastStorm)

data_meta_res_1to36$d2track<-z.trans(data_meta_res_1to36$Distance_to_Disturb_km)

data_meta_res_1to36$dist_rain<-z.trans(data_meta_res_1to36$Disturb_Rainfall_mm)

data_meta_res_1to36$wind_speed<-z.trans(data_meta_res_1to36$WMO_wind_kts)

data_meta_res_1to36$tsd<-z.trans(data_meta_res_1to36$TSD_months)

names(data_meta_res_1to36)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

names(tot_lit_all)

data_meta_1to36<-data_meta_res_1to36[,c(1,18:29,2,6:9,11)]
names(data_meta_1to36)

data_meta_res_1to36<-tot_lit_all[,c(3,15,18,19,22,23,25,27,29,32,34,43,44,49:51,53,78:79)]
str(data_meta_res_1to36)#436 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36 <- MetaForest(yi~.,
                              data = data_meta_1to36,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv1to36) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36 <- MetaForest(yi~.,
                          data = data_meta_1to36,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 10000)
mf_rep1to36

preselected1to36 <- preselect(mf_rep1to36,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected1to36)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to36 <- preselect_vars(preselected1to36, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to36 <- trainControl(method = "cv", 
                                index = groupKFold(data_meta_1to36$Effectsize_ID, k = 10))
grouped_boot1to36 <- trainControl(method = "cboot", 
                                  index = groupKFold(data_meta_1to36$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36  <- data_meta_1to36[, c("Effectsize_ID", "vi", retain_mods1to36)]

# Train the model

mf_cv1to36 <- train(y = data_meta_1to36$yi,
                    x = X1to36,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv1to36,
                    tuneGrid = tuning_grid1to36,
                    num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36<-mf_cv1to36$results[which.min(mf_cv1to36$results$RMSE),]
r2cv1to36

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final1to36 <- mf_cv1to36$finalModel
final1to36

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36 <- final1to36$forest$r.squared
r2_oob1to36 #predictive performance of 40%

#REsidual heterogeneity
Vimp1to36 <- data.frame(final1to36$forest$variable.importance)
Vimp1to36

VarImpPlot(final1to36)

predictor_names_res1to36<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Time since cyclone","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36
Vimpres1to36 <- cbind(data.frame(varimp_res=final1to36$forest$variable.importance,predictors_res=predictor_names_res1to36))
str(Vimpres1to36)

Vimpres1to36$predictors<- factor(Vimpres1to36$predictors, levels=Vimp1to36$predictors)

Fig_1to36 <- ggplot(Vimpres1to36, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36 <- Fig_1to36 + xlab("Total litterfall resilience moderators") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=17),
  axis.title=element_text(size=20),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.08, x = 1, fontface="bold",label = "a", size=8,colour="black")
Fig_1to36 

ggsave(filename = "Fig9a.png",
       plot = Fig_1to36 , width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

names(data_meta_res_1to36)
CPFig9b<-data_meta_res_1to36[,c(2,20:29,6:9,11)]
str(CPFig9b)## Final!
names(CPFig9b)[names(CPFig9b) == "Holdridge_ID"] <- "Holdridge zone"
names(CPFig9b)[names(CPFig9b) == "long"] <- "Longitude"
names(CPFig9b)[names(CPFig9b) == "elev"] <- "Elevation"
names(CPFig9b)[names(CPFig9b) == "mat_map"] <- "MAT/MAP"
names(CPFig9b)[names(CPFig9b) == "soilP"] <- "Soil P"
names(CPFig9b)[names(CPFig9b) == "stormfreq"] <- "Storm frequency"
names(CPFig9b)[names(CPFig9b) == "timesincestorm"] <- "Time since previous storm"
names(CPFig9b)[names(CPFig9b) == "d2track"] <- "Distance to cyclone"
names(CPFig9b)[names(CPFig9b) == "dist_rain"] <- "Cyclone rainfall"
names(CPFig9b)[names(CPFig9b) == "wind_speed"] <- "Wind speed"
names(CPFig9b)[names(CPFig9b) == "tsd"] <- "Time since cyclone"
names(CPFig9b)[names(CPFig9b) == "Rocktype_ID"] <- "Geological group"
names(CPFig9b)[names(CPFig9b) == "RockP_ID"] <- "Parent material P group"
names(CPFig9b)[names(CPFig9b) == "Par_Mat_ID"] <- "Parent material"
names(CPFig9b)[names(CPFig9b) == "Soil_ID"] <- "Soil order"
names(CPFig9b)[names(CPFig9b) == "Treatment_ID"] <- "Treatment"

corrf9b <- round(cor(CPFig9b,method="pearson"),2)

p.matf9b <- cor_pmat(CPFig9b)

Fig9b<-ggcorrplot(corrf9b, hc.order = TRUE, type = "lower",hc.method = "ward.D2",sig.level = 0.05,
                  outline.col = "white", p.mat = p.matf9b,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, 
                  legend.title="Pearson's r", lab=TRUE, lab_size=4, tl.cex=18,
                  colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=26))+font("legend.text",size=16)+font("legend.title", size=20)#+theme(axis.text.x = element_text(margin=margin(-2,0,0,0)),axis.text.y = element_text(margin=margin(0,-2,0,0)))
Fig9b

ggsave(filename = "Fig9b.png",
       plot = Fig9b, width = 15, height = 10, units = 'cm',
       scale = 2, dpi = 600)

###1 to 36 months Subannual (red.)####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36S$long<-z.trans(data_meta_res_1to36S$Longitude)

data_meta_res_1to36S$elev<-z.trans(data_meta_res_1to36S$Elevation_m)

data_meta_res_1to36S$mat_map<-z.trans(data_meta_res_1to36S$MAT_MAP_x100)

data_meta_res_1to36S$soilP<-z.trans(data_meta_res_1to36S$Other_soil_P)

data_meta_res_1to36S$stormfreq<-z.trans(data_meta_res_1to36S$StormFrequencyNorm)

data_meta_res_1to36S$timesincestorm<-z.trans(data_meta_res_1to36S$YearsSinceLastStorm)

data_meta_res_1to36S$d2track<-z.trans(data_meta_res_1to36S$Distance_to_Disturb_km)

data_meta_res_1to36S$dist_rain<-z.trans(data_meta_res_1to36S$Disturb_Rainfall_mm)

data_meta_res_1to36S$wind_speed<-z.trans(data_meta_res_1to36S$WMO_wind_kts)

names(data_meta_res_1to36S)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

shapiro.test(residuals(lm))

names(tot_lit_all)

data_meta_1to36S<-data_meta_res_1to36S[,c(1,17:27,2,6:9,11)]
names(data_meta_1to36S)

data_meta_res_1to36S<-tot_lit_allS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,77:78)]
str(data_meta_res_1to36S)#377 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36S <- MetaForest(yi~.,
                              data = data_meta_1to36S,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv1to36S) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36S <- MetaForest(yi~.,
                          data = data_meta_1to36S,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 5000)
mf_rep1to36S

preselected1to36S <- preselect(mf_rep1to36S,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected1to36S)#13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to36S <- preselect_vars(preselected1to36S, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to36S <- trainControl(method = "cv", 
                                index = groupKFold(data_meta_1to36S$Effectsize_ID, k = 10))
grouped_boot1to36S <- trainControl(method = "cboot", 
                                  index = groupKFold(data_meta_1to36S$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36S <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36S  <- data_meta_1to36S[, c("Effectsize_ID", "vi", retain_mods1to36S)]

# Train the model

mf_cv1to36S <- train(y = data_meta_1to36S$yi,
                    x = X1to36S,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv1to36S,
                    tuneGrid = tuning_grid1to36S,
                    num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36S<-mf_cv1to36S$results[which.min(mf_cv1to36S$results$RMSE),]
r2cv1to36S

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final1to36S <- mf_cv1to36S$finalModel
final1to36S

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36S <- final1to36S$forest$r.squared
r2_oob1to36S #predictive performance of 27%

#REsidual heterogeneity
Vimp1to36S <- data.frame(final1to36S$forest$variable.importance)
Vimp1to36S

VarImpPlot(final1to36S)

predictor_names_res1to36S<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36S
Vimpres1to36S <- cbind(data.frame(varimp_res=final1to36S$forest$variable.importance,predictors_res=predictor_names_res1to36S))
str(Vimpres1to36S)

Vimpres1to36S$predictors<- factor(Vimpres1to36S$predictors, levels=Vimp1to36S$predictors)

Fig_1to36S <- ggplot(Vimpres1to36S, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36S <- Fig_1to36S + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.04, x = 1, fontface="bold",label = "b Subannual (red.)", size=6,colour="black")
Fig_1to36S 

##Annual (red.) 1 to 36 months####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36SS$long<-z.trans(data_meta_res_1to36SS$Longitude)

data_meta_res_1to36SS$elev<-z.trans(data_meta_res_1to36SS$Elevation_m)

data_meta_res_1to36SS$mat_map<-z.trans(data_meta_res_1to36SS$MAT_MAP_x100)

data_meta_res_1to36SS$soilP<-z.trans(data_meta_res_1to36SS$Other_soil_P)

data_meta_res_1to36SS$stormfreq<-z.trans(data_meta_res_1to36SS$StormFrequencyNorm)

data_meta_res_1to36SS$timesincestorm<-z.trans(data_meta_res_1to36SS$YearsSinceLastStorm)

data_meta_res_1to36SS$d2track<-z.trans(data_meta_res_1to36SS$Distance_to_Disturb_km)

data_meta_res_1to36SS$dist_rain<-z.trans(data_meta_res_1to36SS$Disturb_Rainfall_mm)

data_meta_res_1to36SS$wind_speed<-z.trans(data_meta_res_1to36SS$WMO_wind_kts)

names(data_meta_res_1to36SS)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

names(tot_lit_allSS)

data_meta_1to36SS<-data_meta_res_1to36SS[,c(1,17:27,2,6:9,11)]
names(data_meta_1to36SS)

data_meta_res_1to36SS<-tot_lit_allSS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,77:78)]
str(data_meta_res_1to36SS)# obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36SS <- MetaForest(yi~.,
                                 data = data_meta_1to36SS,
                                 study = "Effectsize_ID",
                                 whichweights = "random",
                                 num.trees = 20000)

plot(check_conv1to36SS) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36SS <- MetaForest(yi~.,
                            data = data_meta_1to36SS,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 7500)
mf_rep1to36SS

preselected1to36SS <- preselect(mf_rep1to36SS,
                                replications = 100,
                                algorithm = "recursive")
plot(preselected1to36SS)#13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance in more than 50% of replications

retain_mods1to36SS <- preselect_vars(preselected1to36SS, cutoff = .5)

# Set up 10-fold grouped (=clustered) CV

grouped_cv1to36SS <- trainControl(method = "cv", 
                                  index = groupKFold(data_meta_1to36SS$Effectsize_ID, k = 10))
grouped_boot1to36SS <- trainControl(method = "cboot", 
                                    index = groupKFold(data_meta_1to36SS$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36SS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                  mtry = 2:6,
                                  min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36SS  <- data_meta_1to36SS[, c("Effectsize_ID", "vi", retain_mods1to36SS)]

# Train the model

mf_cv1to36SS <- train(y = data_meta_1to36SS$yi,
                      x = X1to36SS,
                      study = "Effectsize_ID", # Name of the clustering variable
                      method = ModelInfo_mf(), 
                      trControl = grouped_cv1to36SS,
                      tuneGrid = tuning_grid1to36SS,
                      num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36SS<-mf_cv1to36SS$results[which.min(mf_cv1to36SS$results$RMSE),]
r2cv1to36SS

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final1to36SS <- mf_cv1to36SS$finalModel
final1to36SS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36SS <- final1to36SS$forest$r.squared
r2_oob1to36SS #predictive performance of 42%

#REsidual heterogeneity
Vimp1to36SS <- data.frame(final1to36SS$forest$variable.importance)
Vimp1to36SS

VarImpPlot(final1to36SS)

predictor_names_res1to36SS<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36SS
Vimpres1to36SS <- cbind(data.frame(varimp_res=final1to36SS$forest$variable.importance,predictors_res=predictor_names_res1to36SS))
str(Vimpres1to36SS)

Vimpres1to36SS$predictors<- factor(Vimpres1to36SS$predictors, levels=Vimp1to36SS$predictors)

Fig_1to36SS <- ggplot(Vimpres1to36SS, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36SS <- Fig_1to36SS + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.04, x = 1, fontface="bold",label = "c Annual (red.)", size=6,colour="black")
Fig_1to36SS 

library(patchwork)
Meta1to36<-Fig_1to36 +Fig_1to36S +Fig_1to36SS + plot_layout(ncol=3)
Meta1to36

ggsave(filename = "Meta_TotalLit1to36.png",
       plot = Meta1to36, width = 26, height = 14, units = "cm",
       scale = 2, dpi = 600)

CPFig4b<-Data_es0ia2[,c(15,18,19,22,23,25,31,42,43,48,49,50)]
str(CPFig4b)## Final!

corrf4b <- round(cor(CPFig4b,method="spearman"),1)

p.matf4b <- cor_pmat(CPFig4b)
head(p.matf5[, 1:4])

Fig4b<-ggcorrplot(corrf4b, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                  outline.col = "white", p.mat = p.matf4b,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig4b
ggsave(filename = "Fig4b.png",
       plot = Fig4b, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

##Meta Leaf fall 1 to 36 months####

###1 to 36 months Annual####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36l$long<-z.trans(data_meta_res_1to36l$Longitude)

data_meta_res_1to36l$elev<-z.trans(data_meta_res_1to36l$Elevation_m)

data_meta_res_1to36l$mat_map<-z.trans(data_meta_res_1to36l$MAT_MAP_x100)

data_meta_res_1to36l$soilP<-z.trans(data_meta_res_1to36l$Other_soil_P)

data_meta_res_1to36l$stormfreq<-z.trans(data_meta_res_1to36l$StormFrequencyNorm)

data_meta_res_1to36l$timesincestorm<-z.trans(data_meta_res_1to36l$YearsSinceLastStorm)

data_meta_res_1to36l$d2track<-z.trans(data_meta_res_1to36l$Distance_to_Disturb_km)

data_meta_res_1to36l$dist_rain<-z.trans(data_meta_res_1to36l$Disturb_Rainfall_mm)

data_meta_res_1to36l$wind_speed<-z.trans(data_meta_res_1to36l$WMO_wind_kts)

data_meta_res_1to36l$tsd<-z.trans(data_meta_res_1to36l$TSD_months)

names(data_meta_res_1to36l)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

names(leaf_all)
names(metadat)

data_meta_1to36l<-data_meta_res_1to36l[,c(1,18:29,2,6:9,11)]
names(data_meta_1to36l)

data_meta_res_1to36l<-leaf_all[,c(3,15,18,19,22,23,25,27,29,32,34,43,44,49:51,53,78:79)]
names(data_meta_res_1to36l)#368 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36l <- MetaForest(yi~.,
                              data = data_meta_1to36l,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv1to36l) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36l <- MetaForest(yi~.,
                          data = data_meta_1to36l,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 7500)
mf_rep1to36l

preselected1to36l <- preselect(mf_rep1to36l,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected1to36l)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to36l <- preselect_vars(preselected1to36l, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to36l <- trainControl(method = "cv", 
                                index = groupKFold(data_meta_1to36l$Effectsize_ID, k = 10))
grouped_boot1to36l <- trainControl(method = "cboot", 
                                  index = groupKFold(data_meta_1to36l$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36l <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36l  <- data_meta_1to36l[, c("Effectsize_ID", "vi", retain_mods1to36l)]

# Train the model

mf_cv1to36l <- train(y = data_meta_1to36l$yi,
                    x = X1to36l,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv1to36l,
                    tuneGrid = tuning_grid1to36l,
                    num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36l<-mf_cv1to36l$results[which.min(mf_cv1to36l$results$RMSE),]
r2cv1to36l

#Based on the root mean squared error, the best combination of tuning parameters
#were unif weights

# For convenience, extract final model
final1to36l <- mf_cv1to36l$finalModel
final1to36l

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36l <- final1to36l$forest$r.squared
r2_oob1to36l #predictive performance of 54%

#REsidual heterogeneity
Vimp1to36l <- data.frame(final1to36l$forest$variable.importance)
Vimp1to36l

VarImpPlot(final1to36l)

predictor_names_res1to36l<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Time since cyclone","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36l
Vimpres1to36l <- cbind(data.frame(varimp_res=final1to36l$forest$variable.importance,predictors_res=predictor_names_res1to36l))
str(Vimpres1to36l)

Vimpres1to36l$predictors<- factor(Vimpres1to36l$predictors, levels=Vimp1to36l$predictors)

Fig_1to36l <- ggplot(Vimpres1to36l, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36l <- Fig_1to36l + xlab("Leaf fall resilience moderators") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=20),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")#+annotate("text", y = 0.04, x = 1, fontface="bold",label = "a Annual (all)", size=6,colour="black")
Fig_1to36l 

ggsave(filename = "Fig9c.png",
       plot = Fig_1to36l, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

names(data_meta_res_1to36l)
CPFig9d<-data_meta_res_1to36l[,c(2,20:29,6:9,11)]
names(CPFig9d)## Final!
names(CPFig9d)[names(CPFig9d) == "Holdridge_ID"] <- "Holdridge zone"
names(CPFig9d)[names(CPFig9d) == "long"] <- "Longitude"
names(CPFig9d)[names(CPFig9d) == "elev"] <- "Elevation"
names(CPFig9d)[names(CPFig9d) == "mat_map"] <- "MAT/MAP"
names(CPFig9d)[names(CPFig9d) == "soilP"] <- "Soil P"
names(CPFig9d)[names(CPFig9d) == "stormfreq"] <- "Storm frequency"
names(CPFig9d)[names(CPFig9d) == "timesincestorm"] <- "Time since previous storm"
names(CPFig9d)[names(CPFig9d) == "d2track"] <- "Distance to cyclone"
names(CPFig9d)[names(CPFig9d) == "dist_rain"] <- "Cyclone rainfall"
names(CPFig9d)[names(CPFig9d) == "wind_speed"] <- "Wind speed"
names(CPFig9d)[names(CPFig9d) == "tsd"] <- "Time since cyclone"
names(CPFig9d)[names(CPFig9d) == "Rocktype_ID"] <- "Geological group"
names(CPFig9d)[names(CPFig9d) == "RockP_ID"] <- "Parent material P group"
names(CPFig9d)[names(CPFig9d) == "Par_Mat_ID"] <- "Parent material"
names(CPFig9d)[names(CPFig9d) == "Soil_ID"] <- "Soil order"
names(CPFig9d)[names(CPFig9d) == "Treatment_ID"] <- "Treatment"

corrf9d <- round(cor(CPFig9d,method="pearson"),2)

p.matf9d <- cor_pmat(CPFig9d)

Fig9d<-ggcorrplot(corrf9d, hc.order = TRUE, type = "lower",hc.method = "ward.D2",sig.level = 0.05,
                  outline.col = "white", p.mat = p.matf9d,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, 
                  legend.title="Pearson's r", lab=TRUE, lab_size=4, tl.cex=18,
                  colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=26))+font("legend.text",size=16)+font("legend.title", size=20)#+theme(axis.text.x = element_text(margin=margin(-2,0,0,0)),axis.text.y = element_text(margin=margin(0,-2,0,0)))
Fig9d

ggsave(filename = "Fig9d.png",
       plot = Fig9d, width = 15, height = 10, units = 'cm',
       scale = 2, dpi = 600)

###Leaf fall 1 to 36 months Subannual (red.)####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36lS$long<-z.trans(data_meta_res_1to36lS$Longitude)

data_meta_res_1to36lS$elev<-z.trans(data_meta_res_1to36lS$Elevation_m)

data_meta_res_1to36lS$mat_map<-z.trans(data_meta_res_1to36lS$MAT_MAP_x100)

data_meta_res_1to36lS$soilP<-z.trans(data_meta_res_1to36lS$Other_soil_P)

data_meta_res_1to36lS$stormfreq<-z.trans(data_meta_res_1to36lS$StormFrequencyNorm)

data_meta_res_1to36lS$timesincestorm<-z.trans(data_meta_res_1to36lS$YearsSinceLastStorm)

data_meta_res_1to36lS$d2track<-z.trans(data_meta_res_1to36lS$Distance_to_Disturb_km)

data_meta_res_1to36lS$dist_rain<-z.trans(data_meta_res_1to36lS$Disturb_Rainfall_mm)

data_meta_res_1to36lS$wind_speed<-z.trans(data_meta_res_1to36lS$WMO_wind_kts)

names(data_meta_res_1to36lS)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

names(tot_lit_all)

data_meta_1to36lS<-data_meta_res_1to36lS[,c(1,17:27,2,6:9,11)]
names(data_meta_1to36lS)

data_meta_res_1to36lS<-leaf_allS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,77:78)]
str(data_meta_res_1to36lS)#325 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36lS <- MetaForest(yi~.,
                               data = data_meta_1to36lS,
                               study = "Effectsize_ID",
                               whichweights = "random",
                               num.trees = 20000)

plot(check_conv1to36lS) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36lS <- MetaForest(yi~.,
                           data = data_meta_1to36lS,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 7500)
mf_rep1to36lS

preselected1to36lS <- preselect(mf_rep1to36lS,
                               replications = 100,
                               algorithm = "recursive")
plot(preselected1to36lS)#13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to36lS <- preselect_vars(preselected1to36lS, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to36lS <- trainControl(method = "cv", 
                                 index = groupKFold(data_meta_1to36lS$Effectsize_ID, k = 10))
grouped_boot1to36lS <- trainControl(method = "cboot", 
                                   index = groupKFold(data_meta_1to36lS$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36lS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                 mtry = 2:6,
                                 min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36lS  <- data_meta_1to36lS[, c("Effectsize_ID", "vi", retain_mods1to36lS)]

# Train the model

mf_cv1to36lS <- train(y = data_meta_1to36lS$yi,
                     x = X1to36lS,
                     study = "Effectsize_ID", # Name of the clustering variable
                     method = ModelInfo_mf(), 
                     trControl = grouped_cv1to36lS,
                     tuneGrid = tuning_grid1to36lS,
                     num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36lS<-mf_cv1to36lS$results[which.min(mf_cv1to36lS$results$RMSE),]
r2cv1to36lS

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final1to36lS <- mf_cv1to36lS$finalModel
final1to36lS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36lS <- final1to36lS$forest$r.squared
r2_oob1to36lS #predictive performance of 14%

#REsidual heterogeneity
Vimp1to36lS <- data.frame(final1to36lS$forest$variable.importance)
Vimp1to36lS

VarImpPlot(final1to36lS)

predictor_names_res1to36lS<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36lS
Vimpres1to36lS <- cbind(data.frame(varimp_res=final1to36lS$forest$variable.importance,predictors_res=predictor_names_res1to36lS))
str(Vimpres1to36lS)

Vimpres1to36lS$predictors<- factor(Vimpres1to36lS$predictors, levels=Vimp1to36lS$predictors)

Fig_1to36lS <- ggplot(Vimpres1to36lS, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36lS <- Fig_1to36lS + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.04, x = 1, fontface="bold",label = "b Subannual (red.)", size=6,colour="black")
Fig_1to36lS 

###Leaf fall 1 to 36 months Annual (red.)####

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

data_meta_res_1to36lSS$long<-z.trans(data_meta_res_1to36lSS$Longitude)

data_meta_res_1to36lSS$elev<-z.trans(data_meta_res_1to36lSS$Elevation_m)

data_meta_res_1to36lSS$mat_map<-z.trans(data_meta_res_1to36lSS$MAT_MAP_x100)

data_meta_res_1to36lSS$soilP<-z.trans(data_meta_res_1to36lSS$Other_soil_P)

data_meta_res_1to36lSS$stormfreq<-z.trans(data_meta_res_1to36lSS$StormFrequencyNorm)

data_meta_res_1to36lSS$timesincestorm<-z.trans(data_meta_res_1to36lSS$YearsSinceLastStorm)

data_meta_res_1to36lSS$d2track<-z.trans(data_meta_res_1to36lSS$Distance_to_Disturb_km)

data_meta_res_1to36lSS$dist_rain<-z.trans(data_meta_res_1to36lSS$Disturb_Rainfall_mm)

data_meta_res_1to36lSS$wind_speed<-z.trans(data_meta_res_1to36lSS$WMO_wind_kts)

names(data_meta_res_1to36lSS)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

names(tot_lit_allSS)

data_meta_1to36lSS<-data_meta_res_1to36lSS[,c(1,17:27,2,6:9,11)]
names(data_meta_1to36lSS)

data_meta_res_1to36lSS<-leaf_allSS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,77:78)]
str(data_meta_res_1to36lSS)#325 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv1to36lSS <- MetaForest(yi~.,
                               data = data_meta_1to36lSS,
                               study = "Effectsize_ID",
                               whichweights = "random",
                               num.trees = 20000)

plot(check_conv1to36lSS) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to36lSS <- MetaForest(yi~.,
                           data = data_meta_1to36lSS,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 5000)
mf_rep1to36lSS

preselected1to36lSS <- preselect(mf_rep1to36lSS,
                               replications = 100,
                               algorithm = "recursive")
plot(preselected1to36lSS)#13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance in more than 50% of replications

retain_mods1to36lSS <- preselect_vars(preselected1to36lSS, cutoff = .5)

# Set up 10-fold grouped (=clustered) CV

grouped_cv1to36lSS <- trainControl(method = "cv", 
                                 index = groupKFold(data_meta_1to36lSS$Effectsize_ID, k = 10))
grouped_boot1to36lSS <- trainControl(method = "cboot", 
                                   index = groupKFold(data_meta_1to36lSS$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to36lSS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                 mtry = 2:6,
                                 min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to36lSS  <- data_meta_1to36lSS[, c("Effectsize_ID", "vi", retain_mods1to36lSS)]

# Train the model

mf_cv1to36lSS <- train(y = data_meta_1to36lSS$yi,
                     x = X1to36lSS,
                     study = "Effectsize_ID", # Name of the clustering variable
                     method = ModelInfo_mf(), 
                     trControl = grouped_cv1to36lSS,
                     tuneGrid = tuning_grid1to36lSS,
                     num.trees = 5000)

#Examine optimal tuning parameters

r2cv1to36lSS<-mf_cv1to36lSS$results[which.min(mf_cv1to36lSS$results$RMSE),]
r2cv1to36lSS

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final1to36lSS <- mf_cv1to36lSS$finalModel
final1to36lSS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to36lSS <- final1to36lSS$forest$r.squared
r2_oob1to36lSS #predictive performance of 23%

#REsidual heterogeneity
Vimp1to36lSS <- data.frame(final1to36lSS$forest$variable.importance)
Vimp1to36lSS

VarImpPlot(final1to36lSS)

predictor_names_res1to36lSS<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res1to36lSS
Vimpres1to36lSS <- cbind(data.frame(varimp_res=final1to36lSS$forest$variable.importance,predictors_res=predictor_names_res1to36lSS))
str(Vimpres1to36lSS)

Vimpres1to36lSS$predictors<- factor(Vimpres1to36lSS$predictors, levels=Vimp1to36lSS$predictors)

Fig_1to36lSS <- ggplot(Vimpres1to36lSS, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig_1to36lSS <- Fig_1to36lSS + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.04, x = 1, fontface="bold",label = "c Annual (red.)", size=6,colour="black")
Fig_1to36lSS 

library(patchwork)
Meta1to36l<-Fig_1to36l +Fig_1to36lS +Fig_1to36lSS + plot_layout(ncol=3)
Meta1to36l

ggsave(filename = "Meta_leaf_1to36.png",
       plot = Meta1to36l, width = 26, height = 13, units = "cm",
       scale = 2, dpi = 600)

####For the lowest point in the curve, 5to6 months####
names(data_es3iS)
names(data_es3iSS)
names(data_es3i)

##z transforming the numerical data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

datametaforest5to6S$long<-z.trans(datametaforest5to6S$Longitude)

datametaforest5to6S$elev<-z.trans(datametaforest5to6S$Elevation_m)

datametaforest5to6S$mat_map<-z.trans(datametaforest5to6S$MAT_MAP_x100)

datametaforest5to6S$soilP<-z.trans(datametaforest5to6S$Other_soil_P)

datametaforest5to6S$stormfreq<-z.trans(datametaforest5to6S$StormFrequencyNorm)

datametaforest5to6S$timesincestorm<-z.trans(datametaforest5to6S$YearsSinceLastStorm)

datametaforest5to6S$d2track<-z.trans(datametaforest5to6S$Distance_to_Disturb_km)

datametaforest5to6S$dist_rain<-z.trans(datametaforest5to6S$Disturb_Rainfall_mm)

datametaforest5to6S$wind_speed<-z.trans(datametaforest5to6S$WMO_wind_kts)

names(datametaforest5to6S)

##Final data frame to run Meta Forest for Resilience 5 to 6 months Subannual

data_meta_res5to6S<-datametaforest5to6S[,c(1,17:22,24:27,2,6:9,11)]
names(data_meta_res5to6S)

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3iS)

datametaforest5to6S<-data_es3iS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,77:78)]
names(datametaforest5to6S)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

## AMBIENT + TREATMENTS

check_conv5to6S <- MetaForest(yi~.,
                             data = data_meta_res5to6S,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv5to6S) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep5to6S <- MetaForest(yi~.,
                         data = data_meta_res5to6S,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7000)
mf_rep5to6S

preselected5to6S <- preselect(mf_rep5to6S,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected5to6S)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods5to6S <- preselect_vars(preselected5to6S, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv5to6S <- trainControl(method = "cv", 
                               index = groupKFold(data_meta_res5to6S$Effectsize_ID, k = 3))
grouped_boot5to6S <- trainControl(method = "cboot", 
                                 index = groupKFold(data_meta_res5to6S$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5to6S <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5to6S <- data_meta_res5to6S[, c("Effectsize_ID", "vi", retain_mods5to6S)]

# Train the model

mf_cv5to6S <- train(y = data_meta_res5to6S$yi,
                   x = X5to6S,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv5to6S,
                   tuneGrid = tuning_grid5to6S,
                   num.trees = 5000)

#Examine optimal tuning parameters

r2cv5to6S<-mf_cv5to6S$results[which.min(mf_cv5to6S$results$RMSE),]
r2cv5to6S

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

# For convenience, extract final model
final5to6S <- mf_cv5to6S$finalModel
final5to6S

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob5to6S <- final5to6S$forest$r.squared
r2_oob5to6S #predictive performance of 14%

#REsidual heterogeneity
Vimp5to6S <- data.frame(final5to6S$forest$variable.importance)
Vimp5to6S

VarImpPlot(final5to6S)

predictor_names_res5to6S<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res5to6S
Vimpres5to6S <- cbind(data.frame(varimp_res=final5to6S$forest$variable.importance,predictors_res=predictor_names_res5to6S))
str(Vimpres5to6S)

Vimpres5to6S$predictors<- factor(Vimpres5to6S$predictors, levels=Vimp5to6S$predictors)

## 3 to 6 months Annual under ambient conditions

Fig7amb_5to6S_b <- ggplot(Vimpres5to6S, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7amb_5to6S_b <- Fig7amb_5to6S_b + xlab("Pantropical resilience (5 - 6 months) predictors") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.08, x = 1, fontface="bold",label = "a Annual", size=6,colour="black")
Fig7amb_5to6S_b 

####3to6 months Ambient combined####

str(data_es3to6iamb)

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

names(datametaforest1to12a)
str(datametaforest1to12a)

datametaforest3to6amb$long<-z.trans(datametaforest3to6amb$Longitude)

datametaforest3to6amb$elev<-z.trans(datametaforest3to6amb$Elevation_m)

datametaforest3to6amb$mat_map<-z.trans(datametaforest3to6amb$MAT_MAP_x100)

datametaforest3to6amb$soilP<-z.trans(datametaforest3to6amb$Other_soil_P)

datametaforest3to6amb$stormfreq<-z.trans(datametaforest3to6amb$StormFrequencyNorm)

datametaforest3to6amb$timesincestorm<-z.trans(datametaforest3to6amb$YearsSinceLastStorm)

datametaforest3to6amb$d2track<-z.trans(datametaforest3to6amb$Distance_to_Disturb_km)

datametaforest3to6amb$dist_rain<-z.trans(datametaforest3to6amb$Disturb_Rainfall_mm)

datametaforest3to6amb$wind_speed<-z.trans(datametaforest3to6amb$WMO_wind_kts)

names(data_es1to6iamb)
names(datametaforest3to6amb)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6amb<-datametaforest3to6amb[,c(1,16:26,2,6:9)]
names(data_meta_res3to6amb)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)

datametaforest3to6amb<-data_es3to6iamb[,c(3,15,18,19,22,23,25,27,28, 31,42,43,48, 49,50,77:78)]
names(datametaforest3to6amb)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6 <- MetaForest(yi~.,
                               data = data_meta_res3to6amb,
                               study = "Effectsize_ID",
                               whichweights = "random",
                               num.trees = 20000)

plot(check_conv3to6) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6 <- MetaForest(yi~.,
                           data = data_meta_res3to6,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 15000)
mf_rep3to6

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected3to6 <- preselect(mf_rep3to6,
                               replications = 100,
                               algorithm = "recursive")
plot(preselected3to6)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6 <- preselect_vars(preselected3to6, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6 <- trainControl(method = "cv", 
                                 index = groupKFold(data_meta_res3to6$Effectsize_ID, k = 3))
grouped_boot3to6 <- trainControl(method = "cboot", 
                                   index = groupKFold(data_meta_res3to6$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                 mtry = 2:6,
                                 min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6 <- data_meta_res3to6[, c("Effectsize_ID", "vi", retain_mods3to6)]

# Train the model

mf_cv3to6 <- train(y = data_meta_res3to6$yi,
                     x = X3to6,
                     study = "Effectsize_ID", # Name of the clustering variable
                     method = ModelInfo_mf(), 
                     trControl = grouped_cv3to6,
                     tuneGrid = tuning_grid3to6,
                     num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6<-mf_cv3to6$results[which.min(mf_cv3to6$results$RMSE),]
r2cv3to6

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final3to6 <- mf_cv3to6$finalModel
final3to6

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6 <- final3to6$forest$r.squared
r2_oob3to6 #predictive performance of 14%

#REsidual heterogeneity
Vimp3to6 <- data.frame(final3to6$forest$variable.importance)
Vimp3to6

VarImpPlot(final3to6)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order")
predictor_names_res3to6
Vimpres3to6 <- cbind(data.frame(varimp_res=final3to6$forest$variable.importance,predictors_res=predictor_names_res3to6))
str(Vimpres3to6)

Vimpres3to6$predictors<- factor(Vimpres3to6$predictors, levels=Vimp3to6$predictors)

## 3 to 6 months Annual under ambient conditions

Fig7amb_3to6_a <- ggplot(Vimpres3to6, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7amb_3to6_a <- Fig7amb_3to6_a + xlab("Pantropical resilience predictors (3-6 months)") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.08, x = 1, fontface="bold",label = "a Annual", size=5,colour="black")
Fig7amb_3to6_a

ggsave(filename = "Fig7_VarImp_3to6amb.png",
       plot = Fig7amb, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

names(datametaforest3to6amb)
CPFig7amb_3to6<-datametaforest3to6amb[,c(2,6,7,9,16,18:26)]
str(CPFig7amb_3to6)## Final!

corrf7amb_3to6 <- round(cor(CPFig5), 1)
corrf5a <- round(cor(CPFig5a), 1)
corrf7amb_3to6 <- round(cor(CPFig7amb_3to6,method="spearman"),1)

p.matf7amb_3to6 <- cor_pmat(CPFig7amb_3to6)
head(p.matf5[, 1:4])

Fig7amb_3to6<-ggcorrplot(corrf7amb_3to6, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                  outline.col = "white", p.mat = p.matf7amb_3to6,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7amb_3to6

##Subannual 3to6 months Ambient####

str(data_es3to6iamb)

##z transforming the data
##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

names(datametaforest1to12a)
str(datametaforest1to12a)

datametaforest3to6ambS$long<-z.trans(datametaforest3to6ambS$Longitude)

datametaforest3to6ambS$elev<-z.trans(datametaforest3to6ambS$Elevation_m)

datametaforest3to6ambS$mat_map<-z.trans(datametaforest3to6ambS$MAT_MAP_x100)

datametaforest3to6ambS$soilP<-z.trans(datametaforest3to6ambS$Other_soil_P)

datametaforest3to6ambS$stormfreq<-z.trans(datametaforest3to6ambS$StormFrequencyNorm)

datametaforest3to6ambS$timesincestorm<-z.trans(datametaforest3to6ambS$YearsSinceLastStorm)

datametaforest3to6ambS$d2track<-z.trans(datametaforest3to6ambS$Distance_to_Disturb_km)

datametaforest3to6ambS$dist_rain<-z.trans(datametaforest3to6ambS$Disturb_Rainfall_mm)

datametaforest3to6ambS$wind_speed<-z.trans(datametaforest3to6ambS$WMO_wind_kts)

names(data_es1to6iambS)
names(datametaforest3to6amb)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6S<-datametaforest3to6ambS[,c(1,16:26,2,6:9)]
names(data_meta_res3to6S)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)
names(data_meta_res3to6S)

datametaforest3to6ambS<-data_es3to6iambS[,c(3,15,18,19,22,23,25,27,28, 31,42,43,48, 49,50,77:78)]
names(datametaforest3to6ambS)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6S <- MetaForest(yi~.,
                             data = data_meta_res3to6S,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv3to6S) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6S <- MetaForest(yi~.,
                         data = data_meta_res3to6S,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 8000)
mf_rep3to6S

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected3to6S <- preselect(mf_rep3to6S,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected3to6S)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6S <- preselect_vars(preselected3to6S, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6S <- trainControl(method = "cv", 
                               index = groupKFold(data_meta_res3to6S$Effectsize_ID, k = 3))
grouped_boot3to6S <- trainControl(method = "cboot", 
                                 index = groupKFold(data_meta_res3to6S$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6S <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6S <- data_meta_res3to6S[, c("Effectsize_ID", "vi", retain_mods3to6S)]

# Train the model

mf_cv3to6S <- train(y = data_meta_res3to6S$yi,
                   x = X3to6S,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv3to6S,
                   tuneGrid = tuning_grid3to6S,
                   num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6S<-mf_cv3to6S$results[which.min(mf_cv3to6S$results$RMSE),]
r2cv3to6S

# For convenience, extract final model
final3to6S <- mf_cv3to6S$finalModel
final3to6S

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6S <- final3to6S$forest$r.squared
r2_oob3to6S #predictive performance of 14%

#REsidual heterogeneity
Vimp3to6S <- data.frame(final3to6S$forest$variable.importance)
Vimp3to6S

VarImpPlot(final3to6S)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6S<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order")
predictor_names_res3to6S
Vimpres3to6S <- cbind(data.frame(varimp_res=final3to6S$forest$variable.importance,predictors_res=predictor_names_res3to6S))
str(Vimpres3to6S)

Vimpres3to6S$predictors<- factor(Vimpres3to6S$predictors, levels=Vimp3to6S$predictors)

## 3 to 6 months Annual under ambient conditions

Fig7amb_3to6S_b <- ggplot(Vimpres3to6S, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7amb_3to6S_b <- Fig7amb_3to6S_b + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.06, x = 1, fontface="bold",label = "b Subannual", size=5,colour="black")
Fig7amb_3to6S_b

ggsave(filename = "Fig7_VarImp_3to6amb.png",
       plot = Fig7amb, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

names(datametaforest3to6amb)
CPFig7amb_3to6S<-datametaforest3to6ambS[,c(2,6,7,9,16,18:26)]
str(CPFig7amb_3to6S)## Final!

corrf7amb_3to6S <- round(cor(CPFig7amb_3to6S,method="spearman"),1)

p.matf7amb_3to6S <- cor_pmat(CPFig7amb_3to6S)
head(p.matf5[, 1:4])

Fig7amb_3to6S<-ggcorrplot(corrf7amb_3to6S, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                         outline.col = "white", p.mat = p.matf7amb_3to6S,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7amb_3to6S

##Annual* 3to6 months Ambient ####

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

datametaforest3to6ambSS$long<-z.trans(datametaforest3to6ambSS$Longitude)

datametaforest3to6ambSS$elev<-z.trans(datametaforest3to6ambSS$Elevation_m)

datametaforest3to6ambSS$mat_map<-z.trans(datametaforest3to6ambSS$MAT_MAP_x100)

datametaforest3to6ambSS$soilP<-z.trans(datametaforest3to6ambSS$Other_soil_P)

datametaforest3to6ambSS$stormfreq<-z.trans(datametaforest3to6ambSS$StormFrequencyNorm)

datametaforest3to6ambSS$timesincestorm<-z.trans(datametaforest3to6ambSS$YearsSinceLastStorm)

datametaforest3to6ambSS$d2track<-z.trans(datametaforest3to6ambSS$Distance_to_Disturb_km)

datametaforest3to6ambSS$dist_rain<-z.trans(datametaforest3to6ambSS$Disturb_Rainfall_mm)

datametaforest3to6ambSS$wind_speed<-z.trans(datametaforest3to6ambSS$WMO_wind_kts)

names(data_es1to6iambSS)
names(datametaforest3to6ambSS)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6SS<-datametaforest3to6ambSS[,c(1,16:26,2,6:9)]
names(data_meta_res3to6SS)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)

datametaforest3to6ambSS<-data_es3to6iambSS[,c(3,15,18,19,22,23,25,27,28, 31,42,43,48, 49,50,77:78)]
str(datametaforest3to6amb)#58 obs
names(datametaforest3to6ambS)

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6SS <- MetaForest(yi~.,
                              data = data_meta_res3to6SS,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv3to6SS) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6SS <- MetaForest(yi~.,
                          data = data_meta_res3to6SS,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 7000)
mf_rep3to6SS

preselected3to6SS <- preselect(mf_rep3to6SS,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected3to6SS)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6SS <- preselect_vars(preselected3to6SS, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6SS <- trainControl(method = "cv", 
                                index = groupKFold(data_meta_res3to6SS$Effectsize_ID, k = 3))
grouped_boot3to6SS <- trainControl(method = "cboot", 
                                  index = groupKFold(data_meta_res3to6SS$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6SS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6SS <- data_meta_res3to6SS[, c("Effectsize_ID", "vi", retain_mods3to6SS)]

# Train the model

mf_cv3to6SS <- train(y = data_meta_res3to6SS$yi,
                    x = X3to6SS,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv3to6SS,
                    tuneGrid = tuning_grid3to6SS,
                    num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6SS<-mf_cv3to6SS$results[which.min(mf_cv3to6SS$results$RMSE),]
r2cv3to6SS

# For convenience, extract final model
final3to6SS <- mf_cv3to6SS$finalModel
final3to6SS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6SS <- final3to6SS$forest$r.squared
r2_oob3to6SS #predictive performance of 14%

#REsidual heterogeneity
Vimp3to6SS <- data.frame(final3to6SS$forest$variable.importance)
Vimp3to6SS

VarImpPlot(final3to6SS)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6SS<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order")
predictor_names_res3to6SS
Vimpres3to6SS <- cbind(data.frame(varimp_res=final3to6SS$forest$variable.importance,predictors_res=predictor_names_res3to6SS))
str(Vimpres3to6SS)

Vimpres3to6SS$predictors<- factor(Vimpres3to6SS$predictors, levels=Vimp3to6SS$predictors)

## 3 to 6 months Annual under ambient conditions

Fig7amb_3to6SS_c <- ggplot(Vimpres3to6SS, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7amb_3to6SS_c <- Fig7amb_3to6SS_c + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.08, x = 1, fontface="bold",label = "c Annual*", size=5,colour="black")
Fig7amb_3to6SS_c

Fig3to6amb<-Fig7amb_3to6_a+Fig7amb_3to6S_b+Fig7amb_3to6SS_c
Fig3to6amb

ggsave(filename = "Fig7_VarImp_3to6amb.png",
       plot = Fig3to6amb, width = 22, height = 12, units = 'cm',
       scale = 2, dpi = 600)

names(datametaforest3to6amb)
CPFig7amb_3to6SS<-datametaforest3to6ambSS[,c(2,6,7,9,16,18:26)]
str(CPFig7amb_3to6Ss)## Final!

corrf7amb_3to6SS <- round(cor(CPFig7amb_3to6SS,method="spearman"),1)

p.matf7amb_3to6SS <- cor_pmat(CPFig7amb_3to6SS)
head(p.matf5[, 1:4])

Fig7amb_3to6SS<-ggcorrplot(corrf7amb_3to6SS, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                          outline.col = "white", p.mat = p.matf7amb_3to6SS,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7amb_3to6SS

####3to6 months ALL TREATMENTS ####

str(data_es3to6iamb)

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

names(datametaforest1to12a)
str(datametaforest1to12a)

datametaforest3to6$long<-z.trans(datametaforest3to6$Longitude)

datametaforest3to6$elev<-z.trans(datametaforest3to6$Elevation_m)

datametaforest3to6$mat_map<-z.trans(datametaforest3to6$MAT_MAP_x100)

datametaforest3to6$soilP<-z.trans(datametaforest3to6$Other_soil_P)

datametaforest3to6$stormfreq<-z.trans(datametaforest3to6$StormFrequencyNorm)

datametaforest3to6$timesincestorm<-z.trans(datametaforest3to6$YearsSinceLastStorm)

datametaforest3to6$d2track<-z.trans(datametaforest3to6$Distance_to_Disturb_km)

datametaforest3to6$dist_rain<-z.trans(datametaforest3to6$Disturb_Rainfall_mm)

datametaforest3to6$wind_speed<-z.trans(datametaforest3to6$WMO_wind_kts)

names(data_es3to6i)
names(datametaforest3to6)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6all<-datametaforest3to6[,c(1,17:27,2,6:9,11)]
names(data_meta_res3to6all)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)

datametaforest3to6<-data_es3to6i[,c(3,15,18,19,22,23,25,27,28, 31,34,42,43,48, 49,50,77:78)]
names(datametaforest3to6)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6all <- MetaForest(yi~.,
                             data = data_meta_res3to6all,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv3to6all) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6all <- MetaForest(yi~.,
                         data = data_meta_res3to6all,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 10000)
mf_rep3to6all

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected3to6all <- preselect(mf_rep3to6all,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected3to6all)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6all <- preselect_vars(preselected3to6all, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6all <- trainControl(method = "cv", 
                               index = groupKFold(data_meta_res3to6all$Effectsize_ID, k = 3))
grouped_boot3to6all <- trainControl(method = "cboot", 
                                 index = groupKFold(data_meta_res3to6all$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6all <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6all <- data_meta_res3to6all[, c("Effectsize_ID", "vi", retain_mods3to6all)]

# Train the model

mf_cv3to6all <- train(y = data_meta_res3to6all$yi,
                   x = X3to6all,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv3to6all,
                   tuneGrid = tuning_grid3to6all,
                   num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6all<-mf_cv3to6all$results[which.min(mf_cv3to6all$results$RMSE),]
r2cv3to6all

#Based on the root mean squared error, the best combination of tuning parameters
#were unif weights

#The object returned by train already contains the final model, estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final3to6all <- mf_cv3to6all$finalModel
final3to6all

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6all <- final3to6all$forest$r.squared
r2_oob3to6all #predictive performance of 24%

#REsidual heterogeneity
Vimp3to6all <- data.frame(final3to6all$forest$variable.importance)
Vimp3to6all

VarImpPlot(final3to6all)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6all<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res3to6all
Vimpres3to6all <- cbind(data.frame(varimp_res=final3to6all$forest$variable.importance,predictors_res=predictor_names_res3to6all))
str(Vimpres3to6all)

Vimpres3to6all$predictors<- factor(Vimpres3to6all$predictors, levels=Vimp3to6all$predictors)

## 3 to 6 months Annual under ambient conditions

Fig7_3to6all_a <- ggplot(Vimpres3to6all, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7_3to6all_a <- Fig7_3to6all_a + xlab("Pantropical resilience predictors (3-6 months)") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.08, x = 1, fontface="bold",label = "a Annual", size=5,colour="black")
Fig7_3to6all_a

ggsave(filename = "Fig7_VarImp_3to6all.png",
       plot = Fig7amb, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)

names(datametaforest3to6)
levels(datametaforest3to6$Treatment)
CPFig7_3to6all<-datametaforest3to6[,c(17,2:7,9,12:16)]
str(CPFig7_3to6all)## Final!

corrf7_3to6 <- round(cor(CPFig7_3to6all,method="spearman"),1)

p.matf7_3to6 <- cor_pmat(CPFig7_3to6all)
head(p.matf5[, 1:4])

Fig7_3to6<-ggcorrplot(corrf7_3to6, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                         outline.col = "white", p.mat = p.matf7_3to6,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7_3to6

##Subannual 3to6 months ALL TREATMENTS ####

str(data_es3to6iamb)

##z transforming the data
##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

datametaforest3to6Sall$long<-z.trans(datametaforest3to6Sall$Longitude)

datametaforest3to6Sall$elev<-z.trans(datametaforest3to6Sall$Elevation_m)

datametaforest3to6Sall$mat_map<-z.trans(datametaforest3to6Sall$MAT_MAP_x100)

datametaforest3to6Sall$soilP<-z.trans(datametaforest3to6Sall$Other_soil_P)

datametaforest3to6Sall$stormfreq<-z.trans(datametaforest3to6Sall$StormFrequencyNorm)

datametaforest3to6Sall$timesincestorm<-z.trans(datametaforest3to6Sall$YearsSinceLastStorm)

datametaforest3to6Sall$d2track<-z.trans(datametaforest3to6Sall$Distance_to_Disturb_km)

datametaforest3to6Sall$dist_rain<-z.trans(datametaforest3to6Sall$Disturb_Rainfall_mm)

datametaforest3to6Sall$wind_speed<-z.trans(datametaforest3to6Sall$WMO_wind_kts)

names(data_es1to6iS)
names(datametaforest3to6Sall)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6Sall<-datametaforest3to6Sall[,c(1,17:27,2,6:9,11)]
names(data_meta_res3to6S)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)

datametaforest3to6Sall<-data_es3to6iS[,c(3,15,18,19,22,23,25,27,28, 31,34,42,43,48, 49,50,77:78)]
names(datametaforest3to6Sall)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6Sall <- MetaForest(yi~.,
                              data = data_meta_res3to6Sall,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv3to6Sall) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6Sall <- MetaForest(yi~.,
                          data = data_meta_res3to6S,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 11000)
mf_rep3to6Sall

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected3to6Sall <- preselect(mf_rep3to6Sall,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected3to6Sall)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6Sall <- preselect_vars(preselected3to6Sall, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6Sall <- trainControl(method = "cv", 
                                index = groupKFold(data_meta_res3to6Sall$Effectsize_ID, k = 3))
grouped_boot3to6Sall <- trainControl(method = "cboot", 
                                  index = groupKFold(data_meta_res3to6Sall$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6Sall <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6Sall <- data_meta_res3to6Sall[, c("Effectsize_ID", "vi", retain_mods3to6Sall)]

# Train the model

mf_cv3to6Sall <- train(y = data_meta_res3to6Sall$yi,
                    x = X3to6Sall,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv3to6Sall,
                    tuneGrid = tuning_grid3to6Sall,
                    num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6Sall<-mf_cv3to6Sall$results[which.min(mf_cv3to6Sall$results$RMSE),]
r2cv3to6Sall

# For convenience, extract final model
final3to6Sall <- mf_cv3to6Sall$finalModel
final3to6Sall

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6Sall <- final3to6Sall$forest$r.squared
r2_oob3to6Sall #predictive performance of 56%

#REsidual heterogeneity
Vimp3to6Sall <- data.frame(final3to6Sall$forest$variable.importance)
Vimp3to6Sall

VarImpPlot(final3to6Sall)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6Sall<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order")
predictor_names_res3to6Sall
Vimpres3to6Sall <- cbind(data.frame(varimp_res=final3to6Sall$forest$variable.importance,predictors_res=predictor_names_res3to6Sall))
str(Vimpres3to6Sall)

Vimpres3to6Sall$predictors<- factor(Vimpres3to6Sall$predictors, levels=Vimp3to6Sall$predictors)

## 3 to 6 months Subannual All Treatments

Fig7_3to6Sall_b <- ggplot(Vimpres3to6Sall, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7_3to6Sall_b <- Fig7_3to6Sall_b + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.06, x = 1, fontface="bold",label = "b Subannual", size=5,colour="black")
Fig7_3to6Sall_b

CPFig7all_3to6S<-datametaforest3to6allS[,c(2,6,7,9,16,18:26)]
str(CPFig7all_3to6S)## Final!

corrf7amb_3to6S <- round(cor(CPFig7amb_3to6S,method="spearman"),1)

p.matf7all_3to6S <- cor_pmat(CPFig7all_3to6S)
head(p.matf5[, 1:4])

Fig7all_3to6S<-ggcorrplot(corrf7all_3to6S, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                          outline.col = "white", p.mat = p.matf7all_3to6S,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7all_3to6S

##Annual* 3to6 months ALL TREATMENTS ####

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

datametaforest3to6SSall$long<-z.trans(datametaforest3to6SSall$Longitude)

datametaforest3to6SSall$elev<-z.trans(datametaforest3to6SSall$Elevation_m)

datametaforest3to6SSall$mat_map<-z.trans(datametaforest3to6SSall$MAT_MAP_x100)

datametaforest3to6SSall$soilP<-z.trans(datametaforest3to6SSall$Other_soil_P)

datametaforest3to6SSall$stormfreq<-z.trans(datametaforest3to6SSall$StormFrequencyNorm)

datametaforest3to6SSall$timesincestorm<-z.trans(datametaforest3to6SSall$YearsSinceLastStorm)

datametaforest3to6SSall$d2track<-z.trans(datametaforest3to6SSall$Distance_to_Disturb_km)

datametaforest3to6SSall$dist_rain<-z.trans(datametaforest3to6SSall$Disturb_Rainfall_mm)

datametaforest3to6SSall$wind_speed<-z.trans(datametaforest3to6SSall$WMO_wind_kts)

names(datametaforest3to6SSall)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

data_meta_res3to6SSall<-datametaforest3to6SSall[,c(1,17:27,2,6:9,11)]
names(data_meta_res3to6SSall)
str(data_meta_res)#86

Data_es1to12a<- data_es6iall
names(Data_es1to12a)#73 observations
levels(data_es1ib$Disturbanceme)
names(data_es1to14)

names(data_es3to6iamb)

datametaforest3to6SSall<-data_es3to6iSS[,c(3,15,18,19,22,23,25,27,28, 31,34,42,43,48, 49,50,77:78)]
names(datametaforest3to6SSall)#58 obs

# Run model with many trees to check convergence - Resilience Meta Forest for Ambient + TrDeb between 1 and 6 months 

check_conv3to6SSall <- MetaForest(yi~.,
                                 data = data_meta_res3to6SSall,
                                 study = "Effectsize_ID",
                                 whichweights = "random",
                                 num.trees = 20000)

plot(check_conv3to6SSall) #model converged at about 15000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3to6SSall <- MetaForest(yi~.,
                             data = data_meta_res3to6SSall,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 11000)
mf_rep3to6SSall

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected3to6SSall <- preselect(mf_rep3to6SSall,
                                 replications = 100,
                                 algorithm = "recursive")
plot(preselected3to6SSall)# 13 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods3to6SSall <- preselect_vars(preselected3to6SSall, cutoff = .5)

# Set up 3-fold grouped (=clustered) CV

grouped_cv3to6SSall <- trainControl(method = "cv", 
                                   index = groupKFold(data_meta_res3to6SSall$Effectsize_ID, k = 3))
grouped_boot3to6SSall <- trainControl(method = "cboot", 
                                     index = groupKFold(data_meta_res3to6SSall$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3to6SSall <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                   mtry = 2:6,
                                   min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3to6SSall <- data_meta_res3to6SSall[, c("Effectsize_ID", "vi", retain_mods3to6SSall)]

# Train the model

mf_cv3to6SSall <- train(y = data_meta_res3to6SSall$yi,
                       x = X3to6SSall,
                       study = "Effectsize_ID", # Name of the clustering variable
                       method = ModelInfo_mf(), 
                       trControl = grouped_cv3to6SSall,
                       tuneGrid = tuning_grid3to6SSall,
                       num.trees = 5000)

#Examine optimal tuning parameters

r2cv3to6SSall<-mf_cv3to6SSall$results[which.min(mf_cv3to6SSall$results$RMSE),]
r2cv3to6SSall

# For convenience, extract final model
final3to6SSall <- mf_cv3to6SSall$finalModel
final3to6SSall

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3to6SSall <- final3to6SSall$forest$r.squared
r2_oob3to6SSall #predictive performance of 64%

#REsidual heterogeneity
Vimp3to6SSall <- data.frame(final3to6SSall$forest$variable.importance)
Vimp3to6SSall

VarImpPlot(final3to6SSall)

##Ploting Figure 7 Var Imp Resilience

predictor_names_res3to6SSall<-c("Longitude","Elevation","MAT/MAP","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed","Holdridge zone","Geological group","Parent material P group","Parent material","Soil order","Treatment")
predictor_names_res3to6SSall
Vimpres3to6SSall <- cbind(data.frame(varimp_res=final3to6SSall$forest$variable.importance,predictors_res=predictor_names_res3to6SSall))
str(Vimpres3to6SSall)

Vimpres3to6SSall$predictors<- factor(Vimpres3to6SSall$predictors, levels=Vimp3to6SSall$predictors)

## 3 to 6 months Annual* ALL TREATMENTS

Fig7_3to6SSall_c <- ggplot(Vimpres3to6SSall, aes(x=reorder(predictors_res,varimp_res), weight=varimp_res, fill=varimp_res))+ geom_bar()+coord_flip()+theme_pubr()

Fig7_3to6SSall_c <- Fig7_3to6SSall_c + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.06, x = 1, fontface="bold",label = "c Annual*", size=5,colour="black")
Fig7_3to6SSall_c

Fig3to6all<-Fig7_3to6all_a+Fig7_3to6Sall_b+Fig7_3to6SSall_c
Fig3to6all

ggsave(filename = "Fig7_VarImp_3to6all.png",
       plot = Fig3to6all, width = 22, height = 12, units = 'cm',
       scale = 2, dpi = 600)

names(datametaforest3to6amb)
CPFig7all_3to6S<-datametaforest3to6allS[,c(2,6,7,9,16,18:26)]
str(CPFig7all_3to6S)## Final!

corrf7amb_3to6S <- round(cor(CPFig7amb_3to6S,method="spearman"),1)

p.matf7all_3to6S <- cor_pmat(CPFig7all_3to6S)
head(p.matf5[, 1:4])

Fig7all_3to6S<-ggcorrplot(corrf7all_3to6S, hc.order = TRUE, type = "lower",hc.method = "ward.D2",
                          outline.col = "white", p.mat = p.matf7all_3to6S,method="square",ggtheme=ggplot2::theme_bw(),show.legend=TRUE, legend.title="Spearman correlation", lab=TRUE, lab_size=5, tl.cex=14,colors = c("#003f5c", "white", "#ffa600",pch.cex=20,nbreaks = 8,legend.text.cex=20))+font("legend.text",size=14)+font("legend.title", size=16)
Fig7all_3to6S


##Subannual 1 to 6 months####

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

names(datametaforest1to12aS)

datametaforest1to12aS$long<-z.trans(datametaforest1to12aS$Longitude)

datametaforest1to12aS$elev<-z.trans(datametaforest1to12aS$Elevation_m)

datametaforest1to12aS$mat_map<-z.trans(datametaforest1to12aS$MAT_MAP_x100)

datametaforest1to12aS$soilP<-z.trans(datametaforest1to12aS$Other_soil_P)

datametaforest1to12aS$stormfreq<-z.trans(datametaforest1to12aS$StormFrequencyNorm)

datametaforest1to12aS$timesincestorm<-z.trans(datametaforest1to12aS$YearsSinceLastStorm)

datametaforest1to12aS$d2track<-z.trans(datametaforest1to12aS$Distance_to_Disturb_km)

datametaforest1to12aS$dist_rain<-z.trans(datametaforest1to12aS$Disturb_Rainfall_mm)

datametaforest1to12aS$wind_speed<-z.trans(datametaforest1to12aS$WMO_wind_kts)

datametaforest1to12aS$tsd<-z.trans(datametaforest1to12aS$TSD_months)

names(datametaforest1to12aS)
names(data_es1to6iambS)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

datametaforest1to12aS<-data_es1to6iambS[,c(3,15,18,19,22,23,25,27,28, 31,34,42,43,48, 49,50,52,77:78)]
names(datametaforest1to12aS)#248 obst

data_meta_resS<-datametaforest1to12aS[,c(1,18,19,2,6:9,20:28)]
names(data_meta_resS)

# Run model with many trees to check convergence

check_conv1to12aS <- MetaForest(yi~.,
                               data = data_meta_resS,
                               study = "Effectsize_ID",
                               whichweights = "random",
                               num.trees = 20000)

plot(check_conv1to12aS) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to12aS <- MetaForest(yi~.,
                           data = data_meta_resS,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 7000)
mf_rep1to12aS

#now apply recursive pre-selection using the preselect function. 
# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected1to12aS <- preselect(mf_rep1to12aS,
                               replications = 100,
                               algorithm = "recursive")
plot(preselected1to12aS)# 21 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to12aS <- preselect_vars(preselected1to12aS, cutoff = .5)

plot(retain_mods1to12S)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to12aS <- trainControl(method = "cv", 
                                 index = groupKFold(data_meta_resS$Effectsize_ID, k = 3))
grouped_boot1to12aS <- trainControl(method = "cboot", 
                                   index = groupKFold(data_meta_resS$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to12aS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                 mtry = 2:6,
                                 min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to12aS <- data_meta_resS[, c("Effectsize_ID", "vi", retain_mods1to12aS)]

# Train the model

mf_cv1to12aS <- train(y = data_meta_resS$yi,
                     x = X1to12aS,
                     study = "Effectsize_ID", # Name of the clustering variable
                     method = ModelInfo_mf(), 
                     trControl = grouped_cv1to12aS,
                     tuneGrid = tuning_grid1to12aS,
                     num.trees = 5000)

#Examine optimal tuning parameters

r2cvS<-mf_cv1to12aS$results[which.min(mf_cv1to12aS$results$RMSE),]
r2cvS

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final1to12aS <- mf_cv1to12aS$finalModel
final1to12aS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to12aS <- final1to12aS$forest$r.squared
r2_oob1to12aS #predictive performance of 

#REsidual heterogeneity
Vimp1to12aS <- data.frame(final1to12aS$forest$variable.importance)
Vimp1to12aS

VarImpPlot(final1to12aS)

##Ploting Figure 7b Var Imp Resilience

predictor_names_resS<-c("Holdridge zone","Longitude","Elevation","MAT/MAP","Geological group","Parent material P group","Parent material","Soil order","Treatment","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed")
predictor_names_resS
Vimp3resS <- cbind(data.frame(varimp_resS=final1to12aS$forest$variable.importance,predictors_resS=predictor_names_resS))
str(Vimp3resS)

Vimp3resS$predictors<- factor(Vimp3resS$predictors, levels=Vimp3S$predictors)

Fig7b <- ggplot(Vimp3resS, aes(x=reorder(predictors_resS,varimp_resS), weight=varimp_resS, fill=varimp_resS))+ geom_bar()+coord_flip()+theme_pubr()

Fig7b <- Fig7b + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.1, x = 1, fontface="bold",label = "b Subannual", size=6,colour="black")
Fig7b

ggsave(filename = "Fig7b_VarImpS.png",
       plot = Fig7b, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)
Fig7a+Fig7b

##Annual*S 1to6 months combined####

##z transforming the data
z.trans<-function(x) {(x - mean(x, na.rm=T))/(2*sd(x, na.rm=T))}

names(datametaforest1to12aS)
str(datametaforest1to12aS)

datametaforest1to12aSS$long<-z.trans(datametaforest1to12aSS$Longitude)
datametaforest1to12aSS$long

datametaforest1to12aSS$elev<-z.trans(datametaforest1to12aSS$Elevation_m)

datametaforest1to12aSS$mat_map<-z.trans(datametaforest1to12aSS$MAT_MAP_x100)
datametaforest1to12a$mat_map

datametaforest1to12aSS$soilP<-z.trans(datametaforest1to12aSS$Other_soil_P)

datametaforest1to12aSS$stormfreq<-z.trans(datametaforest1to12aSS$StormFrequencyNorm)
datametaforest1to12a$stormfreq

datametaforest1to12aSS$timesincestorm<-z.trans(datametaforest1to12aSS$YearsSinceLastStorm)

datametaforest1to12aSS$d2track<-z.trans(datametaforest1to12aSS$Distance_to_Disturb_km)

datametaforest1to12aSS$dist_rain<-z.trans(datametaforest1to12aSS$Disturb_Rainfall_mm)

datametaforest1to12aSS$wind_speed<-z.trans(datametaforest1to12aSS$WMO_wind_kts)

datametaforest1to12aSS$tsd<-z.trans(datametaforest1to12aSS$TSD_months)

names(datametaforest1to12aSS)

##Final data frame to run Meta Forest for Resilience 1 to 14 months

datametaforest1to12aSS<-data_es1to6iambS[,c(3,15,18,19,22,23,25,27,28,31,34,42,43,48, 49,50,52,77:78)]
str(datametaforest1to12aSS)#248 obst

data_meta_resSS<-datametaforest1to12aSS[,c(1,2,20,21,22,6:9,11,23:28,18,19)]
names(data_meta_resSS)

# Run model with many trees to check convergence

check_conv1to12aSS <- MetaForest(yi~.,
                                data = data_meta_resSS,
                                study = "Effectsize_ID",
                                whichweights = "random",
                                num.trees = 20000)

plot(check_conv1to12aSS) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to12aSS <- MetaForest(yi~.,
                            data = data_meta_resSS,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 7000)
mf_rep1to12aSS

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected1to12aSS <- preselect(mf_rep1to12aSS,
                                replications = 100,
                                algorithm = "recursive")
plot(preselected1to12aSS)# 21 variables

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to12aSS <- preselect_vars(preselected1to12aSS, cutoff = .5)
retain_mods1to12aSS

plot(retain_mods1to12SS)#18 variables are retained

# Set up 5-fold grouped (=clustered) CV

grouped_cv1to12aSS <- trainControl(method = "cv", 
                                  index = groupKFold(data_meta_resSS$Effectsize_ID, k = 5))
grouped_boot1to12aSS <- trainControl(method = "cboot", 
                                    index = groupKFold(data_meta_resSS$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to12aSS <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                  mtry = 2:6,
                                  min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to12aSS <- data_meta_resSS[, c("Effectsize_ID", "vi", retain_mods1to12aSS)]

# Train the model

mf_cv1to12aSS <- train(y = data_meta_resSS$yi,
                      x = X1to12aSS,
                      study = "Effectsize_ID", # Name of the clustering variable
                      method = ModelInfo_mf(), 
                      trControl = grouped_cv1to12aSS,
                      tuneGrid = tuning_grid1to12aSS,
                      num.trees = 5000)

#Examine optimal tuning parameters

r2cvSS<-mf_cv1to12aSS$results[which.min(mf_cv1to12aSS$results$RMSE),]
r2cvSS

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final1to12aSS <- mf_cv1to12aSS$finalModel
final1to12aSS

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to12aSS <- final1to12aSS$forest$r.squared
r2_oob1to12aSS #predictive performance of 

#REsidual heterogeneity
Vimp1to12aSS <- data.frame(final1to12aSS$forest$variable.importance)
Vimp1to12aSS

VarImpPlot(final1to12aSS)

##Ploting Figure 7b Var Imp Resilience

predictor_names_resSS<-c("Holdridge zone","Longitude","Elevation","MAT/MAP","Geological group","Parent material P group","Parent material","Soil order","Treatment","Soil P","Storm frequency","Time since previous storm","Distance to cyclone","Cyclone rainfall","Wind speed")
predictor_names_resSS

Vimp3resSS <- cbind(data.frame(varimp_resSS=final1to12aSS$forest$variable.importance,predictors_resSS=predictor_names_resSS))
str(Vimp3resSS)

Vimp3resSS$predictors<- factor(Vimp3resSS$predictors, levels=Vimp3SS$predictors)

Fig7c <- ggplot(Vimp3resSS, aes(x=reorder(predictors_resSS,varimp_resSS), weight=varimp_resSS, fill=varimp_resSS))+ geom_bar()+coord_flip()+theme_pubr()

Fig7c <- Fig7c + xlab("") + ylab("Variable Importance")+ theme(
  axis.text.y=element_text(size=17),
  axis.text.x=element_text(size=14),
  axis.title=element_text(size=17),
  legend.title=element_blank(),
  legend.text=element_blank(),
  legend.key = element_blank(),legend.position="none")+annotate("text", y = 0.09, x = 1, fontface="bold",label = "c Annual*", size=6,colour="black")
Fig7c

ggsave(filename = "Fig7b_VarImpSS.png",
       plot = Fig7c, width = 12, height = 10, units = 'cm',
       scale = 2, dpi = 600)
FinalFig7<-Fig7a+Fig7b+Fig7c
FinalFig7

ggsave(filename = "Fig7a-c_VarImp.png",
       plot = FinalFig7, width = 28, height = 14, units = 'cm',
       scale = 2, dpi = 600)

##Testing 1 to 12 months combined####

Data_es1to12<- data_es1to12
str(Data_es1to12)#157 observations
levels(data_es1ib$Disturbanceme)

datametaforest1to12<-Data_es1to12[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest1to12)#24 variables

# Run model with many trees to check convergence

check_conv1to12 <- MetaForest(yi~.,
                          data = datametaforest1to12,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv1to12) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to12 <- MetaForest(yi~.,
                      data = datametaforest1to12,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 10000)
mf_rep1to12

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected1to12 <- preselect(mf_rep1to12,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected1to12)# 21 variables

preselected1a <- preselect(mf_rep1,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected1a)

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to12 <- preselect_vars(preselected1to12, cutoff = .5)
retain_mods1to12

plot(retain_mods1to12)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to12 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest1to12$Effectsize_ID, k = 5))
grouped_boot1to12 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest1to12$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to12 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to12 <- datametaforest1to12[, c("Effectsize_ID", "vi", retain_mods1to12)]

# Train the model

mf_cv1to12 <- train(y = datametaforest1to12$yi,
                x = X1to12,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv1to12,
                tuneGrid = tuning_grid1to12,
                num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1to12$results[which.min(mf_cv1to12$results$RMSE), ]

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final1to12 <- mf_cv1to12$finalModel
final1to12

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to12 <- final1to12$forest$r.squared
r2_oob1to12 #predictive performance of 

#REsidual heterogeneity
Vimp1to12 <- data.frame(final1to12$forest$variable.importance)
Vimp1to12

VarImpPlot(final1to12)

#Testing meta forest for each group 
#1 and 2 months post-disturbance first

Data_es1<- data_es1ib %>% filter(Disturbanceme!="CTE")
str(Data_es1)#30 observations
levels(data_es1ib$Disturbanceme)

datametaforest1<-Data_es1[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest1)#24 variables

# Run model with many trees to check convergence

check_conv1 <- MetaForest(yi~.,
                         data = datametaforest1,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 20000)

plot(check_conv1) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1 <- MetaForest(yi~.,
                     data = datametaforest1,
                     study = "Effectsize_ID",
                     whichweights = "random",
                     num.trees = 4000)
mf_rep1

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected1 <- preselect(mf_rep1,
                         replications = 100,
                         algorithm = "recursive")
plot(preselected1)# 21 variables

preselected1a <- preselect(mf_rep1,
                          replications = 100,
                          algorithm = "replicate")
plot(preselected1a)

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1 <- preselect_vars(preselected1, cutoff = .5)
retain_mods1

plot(retain_mods1)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1 <- trainControl(method = "cv", 
                           index = groupKFold(datametaforest1$Effectsize_ID, k = 3))
grouped_boot1 <- trainControl(method = "cboot", 
                             index = groupKFold(datametaforest1$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                           mtry = 2:6,
                           min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1 <- datametaforest1[, c("Effectsize_ID", "vi", retain_mods1)]

# Train the model

mf_cv1 <- train(y = datametaforest1$yi,
               x = X1,
               study = "Effectsize_ID", # Name of the clustering variable
               method = ModelInfo_mf(), 
               trControl = grouped_cv1,
               tuneGrid = tuning_grid1,
               num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1$results[which.min(mf_cv1$results$RMSE), ]

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final1 <- mf_cv1$finalModel
final1

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1 <- final1$forest$r.squared
r2_oob1 #predictive performance of 

#REsidual heterogeneity
Vimp1 <- data.frame(final1$forest$variable.importance)
Vimp1

VarImpPlot(final1)

# Plot convergence
plot(final1)

## 1 and 2 months including CTE

Data_es1b<- data_es1ib
str(Data_es1b)
datametaforest1b<-Data_es1b[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest1)#24 variables

check_conv1b <- MetaForest(yi~.,
                          data = datametaforest1b,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv1b) #model converged at about 4000 trees, which will be used in the next step

mf_rep1b <- MetaForest(yi~.,
                      data = datametaforest1b,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7500)
mf_rep1b

preselected1b <- preselect(mf_rep1b,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected1b)# 21 variables

preselected1b2 <- preselect(mf_rep1b,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected1b2)

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1b <- preselect_vars(preselected1b, cutoff = .5)
retain_mods1b

plot(retain_mods1b)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1b <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest1b$Effectsize_ID, k = 3))
grouped_boot1b <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest1b$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1b <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1b <- datametaforest1b[, c("Effectsize_ID", "vi", retain_mods1b)]

# Train the model

mf_cv1b <- train(y = datametaforest1b$yi,
                x = X1b,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv1b,
                tuneGrid = tuning_grid1b,
                num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1b$results[which.min(mf_cv1b$results$RMSE), ]

# For convenience, extract final model
final1b <- mf_cv1b$finalModel
final1b
r2_oob1b <- final1b$forest$r.squared
r2_oob1b #predictive performance of 78%

#REsidual heterogeneity
Vimp1b <- data.frame(final1b$forest$variable.importance)
Vimp1b

VarImpPlot(final1b)

# Plot convergence
plot(final1b)

##Resilience 1 and 2 months fewer data with seasonality

Data_es1s<- data_es1iS %>% filter(Disturbanceme!="CTE")
str(Data_es1s)

datametaforest1s<-Data_es1s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest1s)#24 variables

check_conv1s <- MetaForest(yi~.,
                          data = datametaforest1s,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv1s) #model converged at about 4000 trees, which will be used in the next step

mf_rep1s <- MetaForest(yi~.,
                      data = datametaforest1s,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7500)
mf_rep1s

preselected1s <- preselect(mf_rep1s,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected1s)# 21 variables

retain_mods1s <- preselect_vars(preselected1s, cutoff = .5)
grouped_cv1s <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest1s$Effectsize_ID, k = 3))
grouped_boot1s <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest1s$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1s <- datametaforest1s[, c("Effectsize_ID", "vi", retain_mods1s)]

# Train the model

mf_cv1s <- train(y = datametaforest1s$yi,
                x = X1s,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv1s,
                tuneGrid = tuning_grid1s,
                num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1s$results[which.min(mf_cv1s$results$RMSE), ]

# For convenience, extract final model
final1s <- mf_cv1s$finalModel
final1s

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1s <- final1s$forest$r.squared
r2_oob1s #predictive performance of 51%

#REsidual heterogeneity
Vimp1s <- data.frame(final1s$forest$variable.importance)
Vimp1s

VarImpPlot(final1s)

## 1 and 2 months no seasonality including CTE

Data_es1A<- data_es1i
str(Data_es1A)

datametaforest1A<-Data_es1A[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]

check_conv1A <- MetaForest(yi~.,
                           data = datametaforest1A,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 20000)

plot(check_conv1A) #model converged at about 4000 trees, which will be used in the next step

mf_rep1A <- MetaForest(yi~.,
                       data = datametaforest1A,
                       study = "Effectsize_ID",
                       whichweights = "random",
                       num.trees = 10000)
mf_rep1A

preselected1A <- preselect(mf_rep1A,
                           replications = 100,
                           algorithm = "recursive")
plot(preselected1A)# 21 variables

retain_mods1A <- preselect_vars(preselected1A, cutoff = .5)
retain_mods1A

plot(retain_mods1A)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1A <- trainControl(method = "cv", 
                             index = groupKFold(datametaforest1A$Effectsize_ID, k = 3))
grouped_boot1A <- trainControl(method = "cboot", 
                               index = groupKFold(datametaforest1A$Effectsize_ID, k = 3))

tuning_grid1A <- expand.grid(whichweights = c("random", "fixed", "unif"),
                             mtry = 2:6,
                             min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1A <- datametaforest1A[, c("Effectsize_ID", "vi", retain_mods1A)]

# Train the model

mf_cv1A <- train(y = datametaforest1A$yi,
                 x = X1A,
                 study = "Effectsize_ID", # Name of the clustering variable
                 method = ModelInfo_mf(), 
                 trControl = grouped_cv1A,
                 tuneGrid = tuning_grid1A,
                 num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1A$results[which.min(mf_cv1A$results$RMSE), ]

# For convenience, extract final model
final1A <- mf_cv1A$finalModel
final1A

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1A <- final1A$forest$r.squared
r2_oob1A #predictive performance of 41%

#REsidual heterogeneity
Vimp1A <- data.frame(final1A$forest$variable.importance)
Vimp1A

VarImpPlot(final1A)

## 1 and 2 months with seasonality including CTE

Data_es1sA<- data_es1iS
str(Data_es1sA)

datametaforest1sA<-Data_es1sA[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]

check_conv1sA <- MetaForest(yi~.,
                            data = datametaforest1sA,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 20000)

plot(check_conv1sA) #model converged at about 4000 trees, which will be used in the next step

mf_rep1sA <- MetaForest(yi~.,
                        data = datametaforest1sA,
                        study = "Effectsize_ID",
                        whichweights = "random",
                        num.trees = 7500)
mf_rep1sA

preselected1sA <- preselect(mf_rep1sA,
                            replications = 100,
                            algorithm = "recursive")
plot(preselected1sA)# 21 variables

retain_mods1sA <- preselect_vars(preselected1sA, cutoff = .5)
grouped_cv1sA <- trainControl(method = "cv", 
                              index = groupKFold(datametaforest1sA$Effectsize_ID, k = 3))
grouped_boot1sA <- trainControl(method = "cboot", 
                                index = groupKFold(datametaforest1sA$Effectsize_ID, k = 3))

tuning_grid1sA <- expand.grid(whichweights = c("random", "fixed", "unif"),
                              mtry = 2:6,
                              min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1sA <- datametaforest1sA[, c("Effectsize_ID", "vi", retain_mods1sA)]

# Train the model

mf_cv1sA <- train(y = datametaforest1sA$yi,
                  x = X1sA,
                  study = "Effectsize_ID", # Name of the clustering variable
                  method = ModelInfo_mf(), 
                  trControl = grouped_cv1sA,
                  tuneGrid = tuning_grid1sA,
                  num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1sA$results[which.min(mf_cv1sA$results$RMSE), ]

# For convenience, extract final model
final1sA <- mf_cv1sA$finalModel
final1sA

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1sA <- final1sA$forest$r.squared
r2_oob1sA #predictive performance of 53%

#REsidual heterogeneity
Vimp1sA <- data.frame(final1sA$forest$variable.importance)
Vimp1sA

VarImpPlot(final1sA)

##Testing Resilience 3 and 4 months

Data_es2<- data_es2ib %>% filter(Disturbanceme!="CTE")
str(Data_es2)
levels(data_es2ib$Disturbanceme)

datametaforest2<-Data_es2[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest2)#24 variables

# Run model with many trees to check convergence

check_conv2 <- MetaForest(yi~.,
                          data = datametaforest2,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv2) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep2 <- MetaForest(yi~.,
                      data = datametaforest2,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 8000)
mf_rep2

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected2 <- preselect(mf_rep2,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected2)# 21 variables

preselected2a <- preselect(mf_rep2,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected2a)

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods2 <- preselect_vars(preselected2, cutoff = .5)
retain_mods2

plot(retain_mods2)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv2 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest2$Effectsize_ID, k = 3))
grouped_boot2 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest2$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid2 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X2 <- datametaforest2[, c("Effectsize_ID", "vi", retain_mods2)]

# Train the model

mf_cv2 <- train(y = datametaforest2$yi,
                x = X2,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv2,
                tuneGrid = tuning_grid2,
                num.trees = 8000)

#Examine optimal tuning parameters

mf_cv2$results[which.min(mf_cv2$results$RMSE), ]

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final2 <- mf_cv2$finalModel
final2

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob2 <- final2$forest$r.squared
r2_oob2 #predictive performance of 78%

#REsidual heterogeneity
Vimp2 <- data.frame(final2$forest$variable.importance)
Vimp2

VarImpPlot(final2)

# Plot convergence
plot(final2)

## 3 and 4 months fewer observations no season

Data_es2ns<- data_es2i
str(Data_es2ns)

datametaforest2ns<-Data_es2ns[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest2ns)#24 variables

# Run model with many trees to check convergence

check_conv2ns <- MetaForest(yi~.,
                          data = datametaforest2ns,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv2ns) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep2ns <- MetaForest(yi~.,
                      data = datametaforest2ns,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 12000)
mf_rep2ns

preselected2ns <- preselect(mf_rep2ns,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected2ns)# 21 variables

retain_mods2ns <- preselect_vars(preselected2ns, cutoff = .5)
retain_mods2ns

grouped_cv2ns <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest2ns$Effectsize_ID, k = 3))
grouped_boot2ns <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest2ns$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid2ns <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X2ns <- datametaforest2ns[, c("Effectsize_ID", "vi", retain_mods2ns)]

# Train the model

mf_cv2ns <- train(y = datametaforest2ns$yi,
                x = X2ns,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv2ns,
                tuneGrid = tuning_grid2ns,
                num.trees = 10000)

#Examine optimal tuning parameters

mf_cv2ns$results[which.min(mf_cv2ns$results$RMSE), ]

# For convenience, extract final model
final2ns <- mf_cv2ns$finalModel
final2ns

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob2ns <- final2ns$forest$r.squared
r2_oob2ns #predictive performance of 59%

#REsidual heterogeneity
Vimp2ns <- data.frame(final2ns$forest$variable.importance)
Vimp2ns

VarImpPlot(final2ns)

## Testing 3 and 4 months with seasonality and CTE

##Testing Resilience 3 and 4 months

Data_es2s<- data_es2iS
str(Data_es2s)

datametaforest2s<-Data_es2s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]

check_conv2s <- MetaForest(yi~.,
                          data = datametaforest2s,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv2s) #model converged at about 4000 trees, which will be used in the next step

mf_rep2s <- MetaForest(yi~.,
                      data = datametaforest2s,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7500)
mf_rep2s

preselected2s <- preselect(mf_rep2s,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected2s)# 21 variables

retain_mods2s <- preselect_vars(preselected2s, cutoff = .5)
grouped_cv2s <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest2s$Effectsize_ID, k = 3))
grouped_boot2s <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest2s$Effectsize_ID, k = 3))
tuning_grid2s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X2s <- datametaforest2s[, c("Effectsize_ID", "vi", retain_mods2s)]

# Train the model

mf_cv2s <- train(y = datametaforest2s$yi,
                x = X2s,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv2s,
                tuneGrid = tuning_grid2s,
                num.trees = 8000)

mf_cv2s$results[which.min(mf_cv2s$results$RMSE), ]

# For convenience, extract final model
final2s <- mf_cv2s$finalModel
final2s

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob2s <- final2s$forest$r.squared
r2_oob2s #predictive performance of 44%

#REsidual heterogeneity
Vimp2s <- data.frame(final2s$forest$variable.importance)
Vimp2s

VarImpPlot(final2s)

##Testing Resilience 5 and 6 months

Data_es3<- data_es3ib %>% filter(Disturbanceme!="CTE")
str(Data_es3)
levels(data_es3ib$Disturbanceme)

datametaforest3<-Data_es3[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest3)#24 variables

# Run model with many trees to check convergence

check_conv3 <- MetaForest(yi~.,
                          data = datametaforest3,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv3) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3 <- MetaForest(yi~.,
                      data = datametaforest3,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 8000)
mf_rep3

preselected3 <- preselect(mf_rep3,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected3)# 21 variables

preselected3a <- preselect(mf_rep3,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected3a)

retain_mods3 <- preselect_vars(preselected3, cutoff = .5)
retain_mods3

plot(retain_mods3)#20 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv3 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest3$Effectsize_ID, k = 3))
grouped_boot3 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest3$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid3 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3 <- datametaforest3[, c("Effectsize_ID", "vi", retain_mods3)]

# Train the model

mf_cv3 <- train(y = datametaforest3$yi,
                x = X3,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv3,
                tuneGrid = tuning_grid3,
                num.trees = 8000)

#Examine optimal tuning parameters

mf_cv3$results[which.min(mf_cv3$results$RMSE), ]


# For convenience, extract final model
final3 <- mf_cv3$finalModel
final3

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob3 <- final3$forest$r.squared
r2_oob3 #predictive performance of 25%

#REsidual heterogeneity
Vimp3 <- data.frame(final3$forest$variable.importance)
Vimp3

VarImpPlot(final3)

# Plot convergence
plot(final3)

##Fewer sites no seasonlity

Data_es3ns<- data_es3i
str(Data_es3ns)

datametaforest3ns<-Data_es3ns[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest3ns)#24 variables

check_conv3ns <- MetaForest(yi~.,
                           data = datametaforest3ns,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 20000)

plot(check_conv3ns) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3ns <- MetaForest(yi~.,
                       data = datametaforest3ns,
                       study = "Effectsize_ID",
                       whichweights = "random",
                       num.trees = 10000)
mf_rep3ns

preselected3ns <- preselect(mf_rep3ns,
                           replications = 100,
                           algorithm = "recursive")
plot(preselected3ns)# 21 variables

retain_mods3ns <- preselect_vars(preselected3ns, cutoff = .5)
retain_mods3ns

grouped_cv3ns <- trainControl(method = "cv", 
                             index = groupKFold(datametaforest3ns$Effectsize_ID, k = 3))
grouped_boot3ns <- trainControl(method = "cboot", 
                               index = groupKFold(datametaforest3ns$Effectsize_ID, k = 3))
tuning_grid3ns <- expand.grid(whichweights = c("random", "fixed", "unif"),
                             mtry = 2:6,
                             min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3ns <- datametaforest3ns[, c("Effectsize_ID", "vi", retain_mods3ns)]

# Train the model

mf_cv3ns <- train(y = datametaforest3ns$yi,
                 x = X3ns,
                 study = "Effectsize_ID", # Name of the clustering variable
                 method = ModelInfo_mf(), 
                 trControl = grouped_cv3ns,
                 tuneGrid = tuning_grid3ns,
                 num.trees = 8000)
mf_cv3ns$results[which.min(mf_cv3ns$results$RMSE), ]

final3ns <- mf_cv3ns$finalModel
final3ns

r2_oob3ns <- final3ns$forest$r.squared
r2_oob3ns #predictive performance of 36%

#REsidual heterogeneity
Vimp3ns <- data.frame(final3ns$forest$variable.importance)
Vimp3ns

VarImpPlot(final3ns)

##Testing Resilience 5 and 6 months with seasonality and CTE

Data_es3s<- data_es3iS
str(Data_es3s)

datametaforest3s<-Data_es3s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest3)#24 variables

check_conv3s <- MetaForest(yi~.,
                          data = datametaforest3s,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv3s) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep3s <- MetaForest(yi~.,
                      data = datametaforest3s,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7000)
mf_rep3s

preselected3s <- preselect(mf_rep3s,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected3s)# 21 variables

retain_mods3s <- preselect_vars(preselected3s, cutoff = .5)
retain_mods3s

grouped_cv3s <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest3s$Effectsize_ID, k = 3))
grouped_boot3s <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest3s$Effectsize_ID, k = 3))
tuning_grid3s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X3s <- datametaforest3s[, c("Effectsize_ID", "vi", retain_mods3s)]

# Train the model

mf_cv3s <- train(y = datametaforest3s$yi,
                x = X3s,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv3s,
                tuneGrid = tuning_grid3s,
                num.trees = 8000)
mf_cv3s$results[which.min(mf_cv3s$results$RMSE), ]

final3s <- mf_cv3s$finalModel
final3s

r2_oob3s <- final3s$forest$r.squared
r2_oob3s #predictive performance of 39%

#REsidual heterogeneity
Vimp3s <- data.frame(final3s$forest$variable.importance)
Vimp3s

VarImpPlot(final3s)

# Plot convergence
plot(final3)

##Testing Resilience 7 and 8 months

Data_es4<- data_es4ib %>% filter(Disturbanceme!="CTE")
str(Data_es4)
levels(data_es4ib$Disturbanceme)

datametaforest4<-Data_es4[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest4)#24 variables

check_conv4 <- MetaForest(yi~.,
                          data = datametaforest4,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv4) #model converged at about 4000 trees, which will be used in the next step

mf_rep4 <- MetaForest(yi~.,
                      data = datametaforest4,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 5000)
mf_rep4

preselected4 <- preselect(mf_rep4,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected4)# 21 variables

preselected4a <- preselect(mf_rep4,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected4a)

retain_mods4 <- preselect_vars(preselected4, cutoff = .5)
retain_mods4

plot(retain_mods4)#20 variables are retained

grouped_cv4 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest4$Effectsize_ID, k = 3))
grouped_boot4 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest4$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid4 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X4 <- datametaforest4[, c("Effectsize_ID", "vi", retain_mods4)]

# Train the model

mf_cv4 <- train(y = datametaforest4$yi,
                x = X4,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv4,
                tuneGrid = tuning_grid4,
                num.trees = 8000)

mf_cv4$results[which.min(mf_cv4$results$RMSE), ]

# For convenience, extract final model
final4 <- mf_cv4$finalModel
final4

r2_oob4 <- final4$forest$r.squared
r2_oob4 #predictive performance of 33%

#REsidual heterogeneity
Vimp4 <- data.frame(final4$forest$variable.importance)
Vimp4

VarImpPlot(final4)

# Plot convergence
plot(final4)

### 7 and 8 months fewer sites no season

Data_es4ns<- data_es4i
str(Data_es4ns)#n = 32

datametaforest4ns<-Data_es4ns[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest4ns)#24 variables

check_conv4ns <- MetaForest(yi~.,
                          data = datametaforest4ns,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv4ns) #model converged at about 4000 trees, which will be used in the next step

mf_rep4ns <- MetaForest(yi~.,
                      data = datametaforest4ns,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 10000)
mf_rep4ns

preselected4ns <- preselect(mf_rep4ns,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected4ns)# 21 variables

retain_mods4ns <- preselect_vars(preselected4ns, cutoff = .5)
retain_mods4ns
grouped_cv4ns <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest4ns$Effectsize_ID, k = 3))
grouped_boot4ns <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest4ns$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid4ns <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X4ns <- datametaforest4ns[, c("Effectsize_ID", "vi", retain_mods4ns)]

# Train the model

mf_cv4ns <- train(y = datametaforest4ns$yi,
                x = X4ns,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv4ns,
                tuneGrid = tuning_grid4ns,
                num.trees = 8000)

mf_cv4ns$results[which.min(mf_cv4ns$results$RMSE), ]

# For convenience, extract final model
final4ns <- mf_cv4ns$finalModel
final4ns

r2_oob4ns <- final4ns$forest$r.squared
r2_oob4ns #predictive performance of 78%

#REsidual heterogeneity
Vimp4ns <- data.frame(final4ns$forest$variable.importance)
Vimp4ns

VarImpPlot(final4ns)

## Resilience 7 and 8 months with seasonality

Data_es4s<- data_es4iS
str(Data_es4s)#n = 32

datametaforest4s<-Data_es4s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest4s)#24 variables

check_conv4s <- MetaForest(yi~.,
                            data = datametaforest4s,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 20000)

plot(check_conv4s) #model converged at about 4000 trees, which will be used in the next step

mf_rep4s <- MetaForest(yi~.,
                        data = datametaforest4s,
                        study = "Effectsize_ID",
                        whichweights = "random",
                        num.trees = 10000)
mf_rep4s

preselected4s <- preselect(mf_rep4s,
                            replications = 100,
                            algorithm = "recursive")
plot(preselected4s)# 21 variables

retain_mods4s <- preselect_vars(preselected4s, cutoff = .5)
retain_mods4s
grouped_cv4s <- trainControl(method = "cv", 
                              index = groupKFold(datametaforest4s$Effectsize_ID, k = 3))
grouped_boot4s <- trainControl(method = "cboot", 
                                index = groupKFold(datametaforest4s$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid4s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                              mtry = 2:6,
                              min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X4s <- datametaforest4s[, c("Effectsize_ID", "vi", retain_mods4s)]

# Train the model

mf_cv4s <- train(y = datametaforest4s$yi,
                  x = X4s,
                  study = "Effectsize_ID", # Name of the clustering variable
                  method = ModelInfo_mf(), 
                  trControl = grouped_cv4s,
                  tuneGrid = tuning_grid4s,
                  num.trees = 8000)

mf_cv4s$results[which.min(mf_cv4s$results$RMSE), ]

# For convenience, extract final model
final4s <- mf_cv4s$finalModel
final4s

r2_oob4s <- final4s$forest$r.squared
r2_oob4s #predictive performance of 78%

#REsidual heterogeneity
Vimp4s <- data.frame(final4s$forest$variable.importance)
Vimp4s

VarImpPlot(final4s)

##Testing Resilience 9 and 10 months

Data_es5<- data_es5ib %>% filter(Disturbanceme!="CTE")
str(Data_es5)
levels(data_es5ib$Disturbanceme)

datametaforest5<-Data_es5[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest5)#24 variables

check_conv5 <- MetaForest(yi~.,
                          data = datametaforest5,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv5) #model converged at about 4000 trees, which will be used in the next step

mf_rep5 <- MetaForest(yi~.,
                      data = datametaforest5,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 5000)
mf_rep5

preselected5 <- preselect(mf_rep5,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected5)# 21 variables

preselected5a <- preselect(mf_rep5,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected5a)

retain_mods5 <- preselect_vars(preselected5, cutoff = .5)
retain_mods5

plot(retain_mods5)#20 variables are retained

grouped_cv5 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest5$Effectsize_ID, k = 3))
grouped_boot5 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest5$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5 <- datametaforest5[, c("Effectsize_ID", "vi", retain_mods5)]

# Train the model

mf_cv5 <- train(y = datametaforest5$yi,
                x = X5,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv5,
                tuneGrid = tuning_grid5,
                num.trees = 8000)

mf_cv5$results[which.min(mf_cv5$results$RMSE), ]

# For convenience, extract final model
final5 <- mf_cv5$finalModel
final5

r2_oob5 <- final5$forest$r.squared
r2_oob5 #predictive performance of 78%

#REsidual heterogeneity
Vimp5 <- data.frame(final5$forest$variable.importance)
Vimp5

VarImpPlot(final5)

# Plot convergence
plot(final5)

## Testing 9 and 10 months fewer sites no season

Data_es5ns<- data_es5i
str(Data_es5ns) #n=23
levels(data_es5ib$Disturbanceme)

datametaforest5ns<-Data_es5ns[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest5ns)#24 variables

check_conv5ns <- MetaForest(yi~.,
                          data = datametaforest5ns,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv5ns) #model converged at about 4000 trees, which will be used in the next step

mf_rep5ns <- MetaForest(yi~.,
                      data = datametaforest5ns,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7500)
mf_rep5ns

preselected5ns <- preselect(mf_rep5ns,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected5ns)# 21 variables

retain_mods5ns <- preselect_vars(preselected5ns, cutoff = .5)
grouped_cv5ns <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest5ns$Effectsize_ID, k = 3))
grouped_boot5ns <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest5ns$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5ns <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5ns <- datametaforest5ns[, c("Effectsize_ID", "vi", retain_mods5ns)]

# Train the model

mf_cv5ns <- train(y = datametaforest5ns$yi,
                x = X5ns,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv5ns,
                tuneGrid = tuning_grid5ns,
                num.trees = 8000)

mf_cv5ns$results[which.min(mf_cv5ns$results$RMSE), ]

# For convenience, extract final model
final5ns <- mf_cv5ns$finalModel
final5ns

r2_oob5ns <- final5ns$forest$r.squared
r2_oob5ns #predictive performance of 66%

#REsidual heterogeneity
Vimp5ns <- data.frame(final5ns$forest$variable.importance)
Vimp5ns

VarImpPlot(final5ns)

## Testing 9 and 10 months fewer sites season

Data_es5s<- data_es5iS
str(Data_es5s) #n=23

datametaforest5s<-Data_es5s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest5s)#24 variables

check_conv5s <- MetaForest(yi~.,
                            data = datametaforest5s,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 20000)

plot(check_conv5s) #model converged at about 4000 trees, which will be used in the next step

mf_rep5s <- MetaForest(yi~.,
                        data = datametaforest5s,
                        study = "Effectsize_ID",
                        whichweights = "random",
                        num.trees = 7500)
mf_rep5s

preselected5s <- preselect(mf_rep5s,
                            replications = 100,
                            algorithm = "recursive")
plot(preselected5s)# 21 variables

retain_mods5s <- preselect_vars(preselected5s, cutoff = .5)
grouped_cv5s <- trainControl(method = "cv", 
                              index = groupKFold(datametaforest5s$Effectsize_ID, k = 3))
grouped_boot5s <- trainControl(method = "cboot", 
                                index = groupKFold(datametaforest5s$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                              mtry = 2:6,
                              min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5s <- datametaforest5s[, c("Effectsize_ID", "vi", retain_mods5s)]

# Train the model

mf_cv5s <- train(y = datametaforest5s$yi,
                  x = X5s,
                  study = "Effectsize_ID", # Name of the clustering variable
                  method = ModelInfo_mf(), 
                  trControl = grouped_cv5s,
                  tuneGrid = tuning_grid5s,
                  num.trees = 8000)

mf_cv5s$results[which.min(mf_cv5s$results$RMSE), ]

# For convenience, extract final model
final5s <- mf_cv5s$finalModel
final5s

r2_oob5s <- final5s$forest$r.squared
r2_oob5s #predictive performance of 78%

#REsidual heterogeneity
Vimp5s <- data.frame(final5s$forest$variable.importance)
Vimp5s

VarImpPlot(final5s)

##Testing Resilience 11 and 12 months

Data_es6<- data_es6ib %>% filter(Disturbanceme!="CTE")
str(Data_es6)#n = 28

datametaforest6<-Data_es6[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest6)#24 variables

check_conv6 <- MetaForest(yi~.,
                          data = datametaforest6,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv6) #model converged at about 4000 trees, which will be used in the next step

mf_rep6 <- MetaForest(yi~.,
                      data = datametaforest6,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 5000)
mf_rep6

preselected6 <- preselect(mf_rep6,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected6)# 21 variables

preselected6a <- preselect(mf_rep6,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected6a)

retain_mods6 <- preselect_vars(preselected6, cutoff = .5)
retain_mods6

plot(retain_mods6)#20 variables are retained

grouped_cv6 <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest6$Effectsize_ID, k = 3))
grouped_boot6 <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest6$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid6 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X6 <- datametaforest6[, c("Effectsize_ID", "vi", retain_mods6)]

# Train the model

mf_cv6 <- train(y = datametaforest6$yi,
                x = X6,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv6,
                tuneGrid = tuning_grid6,
                num.trees = 5000)

mf_cv6$results[which.min(mf_cv6$results$RMSE), ]

# For convenience, extract final model
final6 <- mf_cv6$finalModel
final6

r2_oob6 <- final6$forest$r.squared
r2_oob6 #predictive performance of 45%

#REsidual heterogeneity
Vimp6 <- data.frame(final6$forest$variable.importance)
Vimp6

VarImpPlot(final6)
plot(final6)

# 11 and 12 months fewer sites no seasonality

Data_es6ns<- data_es6i
str(Data_es6ns)#n = 25

datametaforest6ns<-Data_es6ns[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest6ns)#24 variables

check_conv6ns <- MetaForest(yi~.,
                          data = datametaforest6ns,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv6ns) #model converged at about 4000 trees, which will be used in the next step

mf_rep6ns <- MetaForest(yi~.,
                      data = datametaforest6ns,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 5000)
mf_rep6ns

preselected6ns <- preselect(mf_rep6ns,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected6ns)# 21 variables

retain_mods6ns <- preselect_vars(preselected6ns, cutoff = .5)

grouped_cv6ns <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest6ns$Effectsize_ID, k = 3))
grouped_boot6ns <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest6ns$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid6ns <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X6ns <- datametaforest6ns[, c("Effectsize_ID", "vi", retain_mods6ns)]

# Train the model

mf_cv6ns <- train(y = datametaforest6ns$yi,
                x = X6ns,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv6ns,
                tuneGrid = tuning_grid6ns,
                num.trees = 5000)

mf_cv6ns$results[which.min(mf_cv6ns$results$RMSE), ]

# For convenience, extract final model
final6ns <- mf_cv6ns$finalModel
final6ns

r2_oob6ns <- final6ns$forest$r.squared
r2_oob6ns #predictive performance of 46%

#REsidual heterogeneity
Vimp6ns <- data.frame(final6ns$forest$variable.importance)
Vimp6ns

VarImpPlot(final6ns)
plot(final6ns)

#11 and 12 months fewer obs with seasonality

Data_es6s<- data_es6iS
str(Data_es6s)#n = 25

datametaforest6s<-Data_es6s[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest6s)#24 variables

check_conv6s <- MetaForest(yi~.,
                            data = datametaforest6s,
                            study = "Effectsize_ID",
                            whichweights = "random",
                            num.trees = 20000)

plot(check_conv6s) #model converged at about 4000 trees, which will be used in the next step

mf_rep6s <- MetaForest(yi~.,
                        data = datametaforest6s,
                        study = "Effectsize_ID",
                        whichweights = "random",
                        num.trees = 5000)
mf_rep6s

preselected6s <- preselect(mf_rep6s,
                            replications = 100,
                            algorithm = "recursive")
plot(preselected6s)# 21 variables

retain_mods6s <- preselect_vars(preselected6s, cutoff = .5)

grouped_cv6s <- trainControl(method = "cv", 
                              index = groupKFold(datametaforest6s$Effectsize_ID, k = 3))
grouped_boot6s <- trainControl(method = "cboot", 
                                index = groupKFold(datametaforest6s$Effectsize_ID, k = 3))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid6s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                              mtry = 2:6,
                              min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X6s <- datametaforest6s[, c("Effectsize_ID", "vi", retain_mods6s)]

# Train the model

mf_cv6s <- train(y = datametaforest6s$yi,
                  x = X6s,
                  study = "Effectsize_ID", # Name of the clustering variable
                  method = ModelInfo_mf(), 
                  trControl = grouped_cv6s,
                  tuneGrid = tuning_grid6s,
                  num.trees = 5000)

mf_cv6s$results[which.min(mf_cv6s$results$RMSE), ]

# For convenience, extract final model
final6s <- mf_cv6s$finalModel
final6s

r2_oob6s <- final6s$forest$r.squared
r2_oob6s #predictive performance of -41%

#REsidual heterogeneity
Vimp6s <- data.frame(final6s$forest$variable.importance)
Vimp6s

VarImpPlot(final6s)
plot(final6s)

##Testing combining 1 to 4 months

Data_es1to4<- data_es1to4
str(Data_es1to4)

datametaforest1to4<-Data_es1to4[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]
names(datametaforest1to4)
P1to4 <- datametaforest1to4[,c(2:4,6:13,15:19)]

corr <- round(cor(P1to4), 1)
head(corr[, 1:6])
p.mat <- cor_pmat(P1to4)
head(p.mat[, 1:4])
ggcorrplot(corr)
ggcorrplot(corr, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

check_conv1to4 <- MetaForest(yi~.,
                             data = datametaforest1to4,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv1to4) #model converged at about 4000 trees, which will be used in the next step

mf_rep1to4 <- MetaForest(yi~.,
                         data = datametaforest1to4,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7500)
mf_rep1to4

preselected1to4 <- preselect(mf_rep1to4,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected1to4)# 21 variables

retain_mods1to4 <- preselect_vars(preselected1to4, cutoff = .5)
retain_mods1to4
grouped_cv1to4 <- trainControl(method = "cv", 
                               index = groupKFold(datametaforest1to4$Effectsize_ID, k = 5))
grouped_boot1to4 <- trainControl(method = "cboot", 
                                 index = groupKFold(datametaforest1to4$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to4 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to4 <- datametaforest1to4[, c("Effectsize_ID", "vi", retain_mods1to4)]

# Train the model

mf_cv1to4 <- train(y = datametaforest1to4$yi,
                   x = X1to4,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv1to4,
                   tuneGrid = tuning_grid1to4,
                   num.trees = 5000)

mf_cv1to4$results[which.min(mf_cv1to4$results$RMSE), ]

# For convenience, extract final model
final1to4 <- mf_cv1to4$finalModel
final1to4

r2_oob1to4 <- final1to4$forest$r.squared
r2_oob1to4 #predictive performance of 42%

#REsidual heterogeneity
Vimp1to4 <- data.frame(final1to4$forest$variable.importance)
Vimp1to4

VarImpPlot(final1to4)
plot(final1to4)

### Same 1 to 4 months but with Seasonality

Data_es1to4s<- data_es1to4S
str(Data_es1to4s)

datametaforest1to4s<-Data_es1to4s[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]
names(datametaforest1to4)
P1to4s <- datametaforest1to4[,c(2:4,6:13,15:19)]

corrs <- round(cor(P1to4s), 1)
head(corrs[, 1:6])
p.mats <- cor_pmat(P1to4s)
head(p.mats[, 1:4])
ggcorrplot(corrs)
ggcorrplot(corrs, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mats)

check_conv1to4s <- MetaForest(yi~.,
                             data = datametaforest1to4s,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv1to4s) #model converged at about 4000 trees, which will be used in the next step

mf_rep1to4s <- MetaForest(yi~.,
                         data = datametaforest1to4s,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7500)
mf_rep1to4s

preselected1to4s <- preselect(mf_rep1to4s,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected1to4s)# 21 variables

retain_mods1to4s <- preselect_vars(preselected1to4s, cutoff = .5)
grouped_cv1to4s <- trainControl(method = "cv", 
                               index = groupKFold(datametaforest1to4s$Effectsize_ID, k = 5))
grouped_boot1to4s <- trainControl(method = "cboot", 
                                 index = groupKFold(datametaforest1to4s$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to4s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to4s <- datametaforest1to4s[, c("Effectsize_ID", "vi", retain_mods1to4s)]

# Train the model

mf_cv1to4s <- train(y = datametaforest1to4s$yi,
                   x = X1to4s,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv1to4s,
                   tuneGrid = tuning_grid1to4s,
                   num.trees = 8000)

mf_cv1to4s$results[which.min(mf_cv1to4s$results$RMSE),]

# For convenience, extract final model
final1to4s <- mf_cv1to4s$finalModel
final1to4s

r2_oob1to4s <- final1to4s$forest$r.squared
r2_oob1to4s #predictive performance of 42%

#REsidual heterogeneity
Vimp1to4s <- data.frame(final1to4s$forest$variable.importance)
Vimp1to4s

VarImpPlot(final1to4s)
plot(final1to4s)

## 5 to 10 months

Data_es5to10<- data_es5to10
str(Data_es5to10)

datametaforest5to10<-Data_es5to10[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]
names(datametaforest5to10)
P5to10 <- datametaforest5to10[,c(2:4,6:13,15:19)]

corr_b <- round(cor(P5to10), 1)
head(corr_b[, 1:6])
p.mat_b <- cor_pmat(P5to10)
head(p.mat_b[, 1:4])
ggcorrplot(corr_b)
ggcorrplot(corr_b, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

check_conv5to10 <- MetaForest(yi~.,
                             data = datametaforest5to10,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv5to10) #model converged at about 4000 trees, which will be used in the next step

mf_rep5to10 <- MetaForest(yi~.,
                         data = datametaforest5to10,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7500)
mf_rep5to10

preselected5to10 <- preselect(mf_rep5to10,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected5to10)# 21 variables

retain_mods5to10 <- preselect_vars(preselected5to10, cutoff = .5)
retain_mods5to10
grouped_cv5to10 <- trainControl(method = "cv", 
                               index = groupKFold(datametaforest5to10$Effectsize_ID, k = 5))
grouped_boot5to10 <- trainControl(method = "cboot", 
                                 index = groupKFold(datametaforest5to10$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5to10 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5to10 <- datametaforest5to10[, c("Effectsize_ID", "vi", retain_mods5to10)]

# Train the model

mf_cv5to10 <- train(y = datametaforest5to10$yi,
                   x = X5to10,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv5to10,
                   tuneGrid = tuning_grid5to10,
                   num.trees = 5000)

mf_cv5to10$results[which.min(mf_cv5to10$results$RMSE), ]

# For convenience, extract final model
final5to10 <- mf_cv5to10$finalModel
final5to10

r2_oob5to10 <- final5to10$forest$r.squared
r2_oob5to10 #predictive performance of 42%

#REsidual heterogeneity
Vimp5to10 <- data.frame(final5to10$forest$variable.importance)
Vimp5to10

VarImpPlot(final5to10)
plot(final5to10)

## 5 to 10 months seasonality

Data_es5to10s<- data_es5to10S
str(Data_es5to10s)

datametaforest5to10s<-Data_es5to10s[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]
str(datametaforest5to10s)
P5to10s <- datametaforest5to10s[,c(2:4,6:13,15:19)]

corr_bs <- round(cor(P5to10s), 1)
head(corr_bs[, 1:6])
p.mat_bs <- cor_pmat(P5to10s)
head(p.mat_bs[, 1:4])
ggcorrplot(corr_bs)
ggcorrplot(corr_bs, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

check_conv5to10s <- MetaForest(yi~.,
                              data = datametaforest5to10s,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv5to10s) #model converged at about 4000 trees, which will be used in the next step

mf_rep5to10s <- MetaForest(yi~.,
                          data = datametaforest5to10s,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 7500)
mf_rep5to10s

preselected5to10s <- preselect(mf_rep5to10s,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected5to10s)# 21 variables

retain_mods5to10s <- preselect_vars(preselected5to10s, cutoff = .5)

grouped_cv5to10s <- trainControl(method = "cv", 
                                index = groupKFold(datametaforest5to10s$Effectsize_ID, k = 5))
grouped_boot5to10s <- trainControl(method = "cboot", 
                                  index = groupKFold(datametaforest5to10s$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid5to10s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X5to10s <- datametaforest5to10s[, c("Effectsize_ID", "vi", retain_mods5to10s)]

# Train the model

mf_cv5to10s <- train(y = datametaforest5to10s$yi,
                    x = X5to10s,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv5to10s,
                    tuneGrid = tuning_grid5to10s,
                    num.trees = 5000)

mf_cv5to10s$results[which.min(mf_cv5to10s$results$RMSE),]

# For convenience, extract final model
final5to10s <- mf_cv5to10s$finalModel
final5to10s

r2_oob5to10s <- final5to10s$forest$r.squared
r2_oob5to10s #predictive performance of 42%

#REsidual heterogeneity
Vimp5to10s <- data.frame(final5to10s$forest$variable.importance)
Vimp5to10s

VarImpPlot(final5to10s)
plot(final5to10s)

## 11 to 14 months

Data_es11to14<- data_es11to14
str(Data_es11to14)

datametaforest11to14<-Data_es11to14[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]
names(datametaforest11to14)
P11to14 <- datametaforest11to14[,c(2:4,6:13,15:19)]

corr_11 <- round(cor(P11to14), 1)
head(corr_11[, 1:6])
p.mat_11 <- cor_pmat(P11to14)
head(p.mat_11[, 1:4])
ggcorrplot(corr_11, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

check_conv11to14 <- MetaForest(yi~.,
                              data = datametaforest11to14,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv11to14) #model converged at about 4000 trees, which will be used in the next step

mf_rep11to14 <- MetaForest(yi~.,
                          data = datametaforest11to14,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 5000)
mf_rep11to14

preselected11to14 <- preselect(mf_rep11to14,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected11to14)# 21 variables

retain_mods11to14 <- preselect_vars(preselected11to14, cutoff = .5)
retain_mods11to14
grouped_cv11to14 <- trainControl(method = "cv", 
                                index = groupKFold(datametaforest11to14$Effectsize_ID, k = 5))
grouped_boot11to14 <- trainControl(method = "cboot", 
                                  index = groupKFold(datametaforest11to14$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid11to14 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X11to14 <- datametaforest11to14[, c("Effectsize_ID", "vi", retain_mods11to14)]

# Train the model

mf_cv11to14 <- train(y = datametaforest11to14$yi,
                    x = X11to14,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv11to14,
                    tuneGrid = tuning_grid11to14,
                    num.trees = 5000)

mf_cv11to14$results[which.min(mf_cv11to14$results$RMSE), ]

# For convenience, extract final model
final11to14 <- mf_cv11to14$finalModel
final11to14

r2_oob11to14 <- final11to14$forest$r.squared
r2_oob11to14 #predictive performance of 42%

#REsidual heterogeneity
Vimp11to14 <- data.frame(final11to14$forest$variable.importance)
Vimp11to14

VarImpPlot(final11to14)
plot(final11to14)

## 11 to 14 months seasonality

Data_es11to14s<- data_es11to14S
str(Data_es11to14s)

datametaforest11to14s<-Data_es11to14s[,c(2,5,7,11,13,14,16:18,21,23,26,29,32,38,45:46,48, 50,90:91)]

P11to14s <- datametaforest11to14s[,c(2:4,6:13,15:19)]

corr_11s <- round(cor(P11to14s), 1)
head(corr_11s[, 1:6])
p.mat_11s <- cor_pmat(P11to14s)
head(p.mat_11s[, 1:4])
ggcorrplot(corr_11s, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

check_conv11to14s <- MetaForest(yi~.,
                               data = datametaforest11to14s,
                               study = "Effectsize_ID",
                               whichweights = "random",
                               num.trees = 20000)

plot(check_conv11to14s) #model converged at about 4000 trees, which will be used in the next step

mf_rep11to14s <- MetaForest(yi~.,
                           data = datametaforest11to14s,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 5000)
mf_rep11to14s

preselected11to14s <- preselect(mf_rep11to14s,
                               replications = 100,
                               algorithm = "recursive")
plot(preselected11to14s)# 21 variables

retain_mods11to14s <- preselect_vars(preselected11to14s, cutoff = .5)

grouped_cv11to14s <- trainControl(method = "cv", 
                                 index = groupKFold(datametaforest11to14s$Effectsize_ID, k = 5))
grouped_boot11to14s <- trainControl(method = "cboot", 
                                   index = groupKFold(datametaforest11to14s$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid11to14s <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                 mtry = 2:6,
                                 min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X11to14s <- datametaforest11to14s[, c("Effectsize_ID", "vi", retain_mods11to14s)]

# Train the model

mf_cv11to14s <- train(y = datametaforest11to14s$yi,
                     x = X11to14s,
                     study = "Effectsize_ID", # Name of the clustering variable
                     method = ModelInfo_mf(), 
                     trControl = grouped_cv11to14s,
                     tuneGrid = tuning_grid11to14s,
                     num.trees = 5000)

mf_cv11to14s$results[which.min(mf_cv11to14s$results$RMSE),]

# For convenience, extract final model
final11to14s <- mf_cv11to14s$finalModel
final11to14s

r2_oob11to14s <- final11to14s$forest$r.squared
r2_oob11to14s #predictive performance of 42%

#REsidual heterogeneity
Vimp11to14s <- data.frame(final11to14s$forest$variable.importance)
Vimp11to14s

VarImpPlot(final11to14s)
plot(final11to14s)

##Testing combining all data for TSD between 1 and 12 months

Data_es6all<- data_es6iall %>% filter(Disturbanceme!="CTE")
names(Data_es6all)
levels(Data_es6all$Site)

datametaforest6all<-Data_es6all[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest6all)#24 variables

check_conv6all <- MetaForest(yi~.,
                          data = datametaforest6all,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 20000)

plot(check_conv6all) #model converged at about 4000 trees, which will be used in the next step

mf_rep6all <- MetaForest(yi~.,
                      data = datametaforest6all,
                      study = "Effectsize_ID",
                      whichweights = "random",
                      num.trees = 7500)
mf_rep6all

preselected6all <- preselect(mf_rep6all,
                          replications = 100,
                          algorithm = "recursive")
plot(preselected6all)# 21 variables

retain_mods6all <- preselect_vars(preselected6all, cutoff = .5)
retain_mods6all

plot(retain_mods6all)#20 variables are retained

grouped_cv6all <- trainControl(method = "cv", 
                            index = groupKFold(datametaforest6all$Effectsize_ID, k = 5))
grouped_boot6all <- trainControl(method = "cboot", 
                              index = groupKFold(datametaforest6all$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid6all <- expand.grid(whichweights = c("random", "fixed", "unif"),
                            mtry = 2:6,
                            min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X6all <- datametaforest6all[, c("Effectsize_ID", "vi", retain_mods6all)]

# Train the model

mf_cv6all <- train(y = datametaforest6all$yi,
                x = X6all,
                study = "Effectsize_ID", # Name of the clustering variable
                method = ModelInfo_mf(), 
                trControl = grouped_cv6all,
                tuneGrid = tuning_grid6all,
                num.trees = 5000)

mf_cv6all$results[which.min(mf_cv6all$results$RMSE), ]

# For convenience, extract final model
final6all <- mf_cv6all$finalModel
final6all

r2_oob6all <- final6all$forest$r.squared
r2_oob6all #predictive performance of 78%

#REsidual heterogeneity
Vimp6all <- data.frame(final6all$forest$variable.importance)
Vimp6all

VarImpPlot(final6all)
plot(final6all)

## Testing also 1 to 12 months but deleting the Kokee fertilizations

Data_es6all2<- data_es6iall %>% filter(Disturbanceme!="CTE")%>% filter(Site!="Kokee N" & Site!="Kokee P"|Site!="Kokee NP")
names(Data_es6all2)
levels(Data_es6all2$Site)

datametaforest6all2<-Data_es6all2[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest6all2)#24 variables

check_conv6all2 <- MetaForest(yi~.,
                             data = datametaforest6all2,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv6all2) #model converged at about 4000 trees, which will be used in the next step

mf_rep6all2 <- MetaForest(yi~.,
                         data = datametaforest6all2,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7500)
mf_rep6all2

preselected6all2 <- preselect(mf_rep6all2,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected6all2)# 21 variables

retain_mods6all2 <- preselect_vars(preselected6all2, cutoff = .5)
retain_mods6all2

plot(retain_mods6all2)#20 variables are retained

grouped_cv6all2 <- trainControl(method = "cv", 
                               index = groupKFold(datametaforest6all2$Effectsize_ID, k = 5))
grouped_boot6all2 <- trainControl(method = "cboot", 
                                 index = groupKFold(datametaforest6all2$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid6all2 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X6all2 <- datametaforest6all2[, c("Effectsize_ID", "vi", retain_mods6all2)]

# Train the model

mf_cv6all2 <- train(y = datametaforest6all2$yi,
                   x = X6all2,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv6all2,
                   tuneGrid = tuning_grid6all2,
                   num.trees = 7500)

mf_cv6all2$results[which.min(mf_cv6all2$results$RMSE), ]

# For convenience, extract final model
final6all2 <- mf_cv6all2$finalModel
final6all2

r2_oob6all2 <- final6all2$forest$r.squared
r2_oob6all2 #predictive performance of 78%

#REsidual heterogeneity
Vimp6all2 <- data.frame(final6all2$forest$variable.importance)
Vimp6all2

VarImpPlot(final6all2)
plot(final6all2)

## Testing for TSD > 12 and < 25 months

Data_es12all<- data_es12iall %>% filter(Disturbanceme!="CTE")
names(Data_es12all)

datametaforest12all<-Data_es12all[,c(2,5,7,11,13,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest12all)#24 variables

check_conv12all <- MetaForest(yi~.,
                             data = datametaforest12all,
                             study = "Effectsize_ID",
                             whichweights = "random",
                             num.trees = 20000)

plot(check_conv12all) #model converged at about 4000 trees, which will be used in the next step

mf_rep12all <- MetaForest(yi~.,
                         data = datametaforest12all,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 7500)
mf_rep12all

preselected12all <- preselect(mf_rep12all,
                             replications = 100,
                             algorithm = "recursive")
plot(preselected12all)# 21 variables

retain_mods12all <- preselect_vars(preselected12all, cutoff = .5)
retain_mods12all

plot(retain_mods12all)#20 variables are retained

grouped_cv12all <- trainControl(method = "cv", 
                               index = groupKFold(datametaforest12all$Effectsize_ID, k = 5))
grouped_boot12all <- trainControl(method = "cboot", 
                                 index = groupKFold(datametaforest12all$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid12all <- expand.grid(whichweights = c("random", "fixed", "unif"),
                               mtry = 2:6,
                               min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X12all <- datametaforest12all[, c("Effectsize_ID", "vi", retain_mods12all)]

# Train the model

mf_cv12all <- train(y = datametaforest12all$yi,
                   x = X12all,
                   study = "Effectsize_ID", # Name of the clustering variable
                   method = ModelInfo_mf(), 
                   trControl = grouped_cv12all,
                   tuneGrid = tuning_grid12all,
                   num.trees = 5000)

mf_cv12all$results[which.min(mf_cv12all$results$RMSE), ]

# For convenience, extract final model
final12all <- mf_cv12all$finalModel
final12all

r2_oob12all <- final12all$forest$r.squared
r2_oob12all #predictive performance of 78%

#REsidual heterogeneity
Vimp12all <- data.frame(final12all$forest$variable.importance)
Vimp12all

VarImpPlot(final12all)
plot(final12all)

####MetaForest Leaf fall####

names(data_es0ilf)
names(data_es0ia)
datametaforestlf<-data_es0ilf[,c(1:2,5,7,11,13,14,16:18,21,27:28, 30, 32,44:47, 67:68)]
names(datametaforest)
names(datametaforestlf)
str(datametaforestlf)

# Run model with many trees to check convergence
check_convlf <- MetaForest(yi~.,
                         data = datametaforestlf,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 20000)

plot(check_convlf) #m odel converged at about 2500 trees, which will be used in the next step

#Model with 2500 trees for replication

mf_replf <- MetaForest(yi~.,
                     data = datametaforestlf,
                     study = "Effectsize_ID",
                     whichweights = "random",
                     num.trees = 2500)

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'

preselectedlf <- preselect(mf_replf,
                         replications = 100,
                         algorithm = "recursive")

plot(preselectedlf)#17 variables
preselectedlf
preselected

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications
retain_modslf <- preselect_vars(preselectedlf, cutoff = .5)
retain_modslf

plot(retain_modslf)#18 variables are retained

# Set up 10-fold grouped (=clustered) CV

grouped_cvlf <- trainControl(method = "cv", 
                           index = groupKFold(datametaforestlf$Effectsize_ID, k = 10))
grouped_bootlf <- trainControl(method = "cboot", 
                             index = groupKFold(datametaforestlf$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest
tuning_gridlf <- expand.grid(whichweights = c("random", "fixed", "unif"),
                           mtry = 2:6,
                           min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
Xlf <- datametaforestlf[, c("Effectsize_ID", "vi", retain_modslf)]

# Train the model
mf_cvlf <- train(y = datametaforestlf$yi,
               x = Xlf,
               study = "Effectsize_ID", # Name of the clustering variable
               method = ModelInfo_mf(), 
               trControl = grouped_cvlf,
               tuneGrid = tuning_gridlf,
               num.trees = 10000)

#Examine optimal tuning parameters

mf_cvlf$results[which.min(mf_cvlf$results$RMSE), ]

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
finallf <- mf_cvlf$finalModel
finallf$obsLevels

# Extract R^2_{oob} from the final model
r2_ooblf <- finallf$forest$r.squared
r2_ooblf

# Plot convergence
plot(finallf)

# Plot variable importance
VarImpPlot(finallf)

# Sort the variable names by importance, so that the
# partial dependence plots will be ranked by importance

ordered_varslf <- names(finallf$forest$variable.importance)[
  order(finallf$forest$variable.importance, decreasing = TRUE)]

# Plot partial dependence
PartialDependence(finallf, vars = ordered_vars,
                  rawdata = TRUE, pi = .95)

####MetaForest Wood Fall####

names(data_es0iwf)
names(data_es0ia)
datametaforestwf<-data_es0iwf[,c(1:2,5,7,11,13,14,16:18,21,27:28, 30, 32,44:47, 67:68)]
names(datametaforestwf)


# Run model with many trees to check convergence
check_convwf <- MetaForest(yi~.,
                           data = datametaforestwf,
                           study = "Effectsize_ID",
                           whichweights = "random",
                           num.trees = 20000)

plot(check_convwf) #m odel converged at about 4000 trees, which will be used in the next step

#Model with 2500 trees for replication

mf_repwf <- MetaForest(yi~.,
                       data = datametaforestwf,
                       study = "Effectsize_ID",
                       whichweights = "random",
                       num.trees = 4000)

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'

preselectedwf <- preselect(mf_repwf,
                           replications = 100,
                           algorithm = "recursive")

plot(preselectedwf)#17 variables


#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications
retain_modswf <- preselect_vars(preselectedwf, cutoff = .5)
retain_modswf

plot(retain_modswf)#18 variables are retained

# Set up 10-fold grouped (=clustered) CV

grouped_cvwf <- trainControl(method = "cv", 
                             index = groupKFold(datametaforestwf$Effectsize_ID, k = 10))
grouped_bootwf <- trainControl(method = "cboot", 
                               index = groupKFold(datametaforestwf$Effectsize_ID, k = 10))

# Set up a tuning grid for the three tuning parameters of MetaForest
tuning_gridwf <- expand.grid(whichweights = c("random", "fixed", "unif"),
                             mtry = 2:6,
                             min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
Xwf <- datametaforestwf[, c("Effectsize_ID", "vi", retain_modswf)]

# Train the model
mf_cvwf <- train(y = datametaforestwf$yi,
                 x = Xwf,
                 study = "Effectsize_ID", # Name of the clustering variable
                 method = ModelInfo_mf(), 
                 trControl = grouped_cvwf,
                 tuneGrid = tuning_gridwf,
                 num.trees = 10000)

#Examine optimal tuning parameters

mf_cvwf$results[which.min(mf_cvwf$results$RMSE), ]

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
finalwf <- mf_cvwf$finalModel
finalwf$obsLevels

# Extract R^2_{oob} from the final model
r2_oobwf <- finalwf$forest$r.squared
r2_oobwf

# Plot convergence
plot(finalwf)

# Plot variable importance
VarImpPlot(finalwf)

# Sort the variable names by importance, so that the
# partial dependence plots will be ranked by importance

ordered_varswf <- names(finalwf$forest$variable.importance)[
  order(finalwf$forest$variable.importance, decreasing = TRUE)]

# Plot partial dependence
PartialDependence(finalwf, vars = ordered_varswf,
                  rawdata = TRUE, pi = .95)

####Recovery MetaForest####

####First year Recovery####

##Testing 1 to 12 months combined####

Data_es1to14<- data_es1to14ia
str(Data_es1to14)#996 observations
Data_es1to14$Cat_TSD_months

names(Data_es1to14)
datametaforest1to14<-Data_es1to14[,c(2,7,14,16:18,21,22,23,25,27,29, 32,38,42,45:46,48, 50,90:91)]
str(datametaforest1to14)#21 variables

P1to14 <- datametaforest1to14[,c(2:7,9,12,14,16:19)]

corr <- round(cor(P1to14), 1)
head(corr[, 1:6])
p.mat <- cor_pmat(P1to14)
head(p.mat[, 1:4])
ggcorrplot(corr)
ggcorrplot(corr, hc.order = TRUE, type = "lower",
           outline.col = "white", p.mat = p.mat)

# Run model with many trees to check convergence

check_conv1to14 <- MetaForest(yi~.,
                              data = datametaforest1to14,
                              study = "Effectsize_ID",
                              whichweights = "random",
                              num.trees = 20000)

plot(check_conv1to14) #model converged at about 4000 trees, which will be used in the next step

#Model with 4000 trees for replication

mf_rep1to14 <- MetaForest(yi~.,
                          data = datametaforest1to14,
                          study = "Effectsize_ID",
                          whichweights = "random",
                          num.trees = 8000)
mf_rep1to14

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'
#There are three possible algorithms for variable selection : replicate, recursive, and bootstrap (but latter does not work with this data)
#Both generated similar results

preselected1to14 <- preselect(mf_rep1to14,
                              replications = 100,
                              algorithm = "recursive")
plot(preselected1to14)# 21 variables

preselected1a <- preselect(mf_rep1,
                           replications = 100,
                           algorithm = "replicate")
plot(preselected1a)

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications

retain_mods1to14 <- preselect_vars(preselected1to14, cutoff = .5)
retain_mods1to14

plot(retain_mods1to14)#18 variables are retained

# Set up 3-fold grouped (=clustered) CV

grouped_cv1to14 <- trainControl(method = "cv", 
                                index = groupKFold(datametaforest1to14$Effectsize_ID, k = 5))
grouped_boot1to14 <- trainControl(method = "cboot", 
                                  index = groupKFold(datametaforest1to14$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest

tuning_grid1to14 <- expand.grid(whichweights = c("random", "fixed", "unif"),
                                mtry = 2:6,
                                min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X1to14 <- datametaforest1to14[, c("Effectsize_ID", "vi", retain_mods1to14)]

# Train the model

mf_cv1to14 <- train(y = datametaforest1to14$yi,
                    x = X1to14,
                    study = "Effectsize_ID", # Name of the clustering variable
                    method = ModelInfo_mf(), 
                    trControl = grouped_cv1to14,
                    tuneGrid = tuning_grid1to14,
                    num.trees = 8000)

#Examine optimal tuning parameters

mf_cv1to14$results[which.min(mf_cv1to14$results$RMSE), ]

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final1to14 <- mf_cv1to14$finalModel
final1to14

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob1to14 <- final1to14$forest$r.squared
r2_oob1to14 #predictive performance of 

#REsidual heterogeneity
Vimp1to14 <- data.frame(final1to14$forest$variable.importance)
Vimp1to14

VarImpPlot(final1to14)

####Recovery Rate Total Litterfall####

data_rec1<-metadat %>% filter(Cat_TSD_months!="0-0.5") %>% filter(Fraction=="TotLitfall")
str(data_rec1)#385 rows

data_rec <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                   sd1i = Post_SD, sd2i = Pre_SD, data = recmeta, measure = "ROM") # ROM =  log transformed ratio of means (Hedges et al., 1999; Lajeunesse, 2011).
str(data_rec)
#Including only the first 36 months and sites with more than 2 data points 
data_rec36<-data_rec %>% filter (TSD_months > "1"|TSD_months<="36")
str(data_rec36)
names(data_rec36)
levels(data_rec36$Disturbance)

prec<-ggplot(data_rec, aes(x=TSD_months, y=yi, color = Region))+geom_point()+geom_smooth(method = 'lm')+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=24),
        axis.text=element_text(size=24))+ labs(x="Months since disturbance", y="Effect size (ln RR)")
prec

prec_sub36<-ggplot(data_rec36, aes(x=TSD_months, y=yi, color = Site, shape = Region))+geom_point(size = 3, alpha = .7)+geom_smooth(method = 'lm',se=FALSE)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=24),
        axis.text=element_text(size=24))+ labs(x="Months since disturbance", y="Effect size (ln RR)")+
  guides(legend.key.width=22)+
  theme(legend.title = element_text (size = 22), legend.text = element_text (size = 22),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(0,6,12,18,24,30,36))

prec_sub36

prec_sub36a<-ggplot(data_rec36, aes(x=TSD_months, y=yi, color = Region, shape = Region))+geom_point(size = 3, alpha = .7)+geom_smooth(method = 'lm',se=FALSE)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=24),
        axis.text=element_text(size=24))+ labs(x="Months since disturbance", y="Effect size (ln RR)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .5)+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26),legend.position = c(.99, .99),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(0,6,12,18,24,30,36))

prec_sub36a

prec_sub36b<-ggplot(data_rec36, aes(x=TSD_months, y=yi, color = Disturbance, shape = Region))+geom_point(size = 3, alpha = .7)+geom_smooth(method = 'lm',se=FALSE)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=16),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Effect size (ln RR)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .5)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(0,6,12,18,24,30,36))

prec_sub36b + facet_wrap(~Site)+theme(strip.text.x = element_text(size=12))

prec_sub36b2<-ggplot(data_rec36, aes(x=TSD_months, y=yi, color = Disturbanceme))+geom_point(size = 3, alpha = .7)+geom_smooth(method = 'glm',se=FALSE)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=16),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Effect size (ln RR)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .5)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(0,6,12))

prec_sub36b2 + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

prec_sub36c<-ggplot(data_rec36, aes(x=TSD_months, y=yi, color = Disturbanceme))+geom_point(size = 3, alpha = .7)+geom_smooth(method = 'lm',se=FALSE)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=16),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Effect size (ln RR)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .5)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.justification = c("right", "top"))+xlim(0,12)#+scale_x_continuous(breaks=c(0,6,12))

prec_sub36c + facet_wrap(~Site+Region)+theme(strip.text.x = element_text(size=12))
#facet_wrap(~Site+Region, scales="free_y")

####Recovery analysis by site with temporal autocorrelation####


prec2<-ggplot(data_rec1, aes(x=Other_soil_P, y=Recovery_k, color = Region))+geom_point()+geom_smooth(method = 'lm')+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=24),
        axis.text=element_text(size=24))+ labs(x="Months since disturbance", y="Recovery_k")
prec2

levels(metadat$Site)

####Recovery Analysis####

data_rec<-metadat %>% filter(Treatment=="Ambient"|Treatment=="TrimDeb")%>% filter(Fraction=="TotLitfall")%>% filter(Cat_TSD_months!="0-0.5")
str(data_rec)#385
data_rec$TSD_months

data_rec1 <- escalc(n1i = S_size, n2i = S_size, m1i = Post_Mean, m2i = Pre_Mean, 
                     sd1i = Post_SD, sd2i = Pre_SD, data = data_rec, measure = "ROM") # ROM =  log transformed ratio of means (Hedges et al., 1999; Lajeunesse, 2011).
data_rec1$yi

df_rec <- data_rec1 %>%
  group_by(Study_ID,Site,Basin,Region,TSD_months,Disturbance,yi) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(percent = (counts/sum(counts))*100) #%>%arrange(desc(TSD_months))
df_rec

#Testing for autocorrelation site by site

####Birthday Creek, Australia and Charlie Disturbance####

bcc<-df_rec %>% filter(Site == "Birthday Creek")%>% filter(Disturbance == "Charlie")
bcc

bcc_lm<-lm(yi~TSD_months,data = bcc)
summary(bcc_lm)#TSD not significant
plot(residuals(bcc_lm))
plot(bcc_lm, which = 1:4)
plot(residuals(bcc_lm),type="b")
plot(rstandard(bcc_lm)~bcc$TSD_months)
lines(rstandard(bcc_lm)~bcc$TSD_months)
abline(h=0,lty=3)

#autocorrelation plot
#acf() function that calculates the degree of correlation associated 
#with increasing lags
acf(residuals(bcc_lm), lag=40)

#Accounting for autocorrelation using Generalized Least Squares
bcc_lm_ac <- gls(yi ~TSD_months, data=bcc, 
              correlation = corAR1(form=~TSD_months),
              na.action=na.omit)
summary(bcc_lm_ac)
anova(bcc_lm_ac, type = "marginal")

#The estimated autocorrelation coefficient "Phi" is 0.99.
acf(residuals(bcc_lm_ac))
acf(residuals(bcc_lm_ac,type="p"))
plot(resid(bcc_lm_ac, type = "normalized") ~
       bcc$TSD_months)
lines(resid(bcc_lm_ac, type = "normalized") ~
            bcc$TSD_months)

#Comparing coefficients
coef(bcc_lm)
coef(bcc_lm_ac)

#Comparing models

library(MuMIn) #multi-model inference
model.sel(bcc_lm, bcc_lm_ac)
anova(bcc_lm, bcc_lm_ac)

library(orcutt) #to account for temporal autocorrelation
cochrane.orcutt(bcc_lm)

#first order autocorrelation is 0.53 in model that does not account for autocorrelation


###Birthday Creek, Charlie, The best model is the one WITHOUT autocorrelation##

####Birthday Creek, Aivu####

bca<-df_rec %>% filter(Site == "Birthday Creek")%>% filter(Disturbance == "Aivu")
bca

bca_lm<-lm(yi~TSD_months,data = bca)
summary(bca_lm)#TSD is significant
plot(residuals(bca_lm))
plot(residuals(bca_lm),type="b")
abline(h=0,lty=3)
#autocorrelation plot
acf(residuals(bca_lm))

#Accounting for autocorrelation
bca_lm_ac <- gls(yi ~TSD_months, data=bca, 
                 correlation = corAR1(form=~TSD_months),
                 na.action=na.omit)
summary(bca_lm_ac)
acf(residuals(bca_lm_ac))
acf(residuals(bca_lm_ac,type="p"))

#Comparing coefficients
coef(bca_lm)
coef(bca_lm_ac)

#Comparing models

library(MuMIn) #multi-model inference
model.sel(bca_lm, bca_lm_ac)

##Birthday Creek, Aivu, There is temporal autocorrelation

#Bisley, Caribbean and Hugo Disturbance

bh<-df_rec %>% filter(Site == "Bisley")%>% filter(Disturbance == "Hugo")%>% filter(Study_ID == "17")
bh

bh_lm<-lm(yi~TSD_months,data = bh)
summary(bh_lm)#TSD significant
plot(residuals(bh_lm))
plot(residuals(bh_lm),type="b")
abline(h=0,lty=3)
#autocorrelation plot
acf(residuals(bh_lm))

#Accounting for autocorrelation
bh_lm_ac <- gls(yi ~TSD_months, data=bh, 
                 correlation = corAR1(form=~TSD_months),
                 na.action=na.omit)
summary(bcc_lm_ac)
acf(residuals(bcc_lm_ac))
acf(residuals(bcc_lm_ac,type="p"))

#Comparing coefficients
coef(bcc_lm)
coef(bcc_lm_ac)

#Comparing models

library(MuMIn) #multi-model inference
model.sel(bcc_lm, bcc_lm_ac)

#The best model is the one WITHOUT autocorrelation

#testing study 25 

bh2<-df_rec %>% filter(Site == "Bisley")%>% filter(Disturbance == "Hugo")%>% filter(Study_ID == "25")
bh2$TSD_months

bh_lm2<-lm(yi~TSD_months,data = bh2)
summary(bh_lm2)#TSD is significant

#Accounting for autocorrelation
bh_lm_ac2 <- gls(yi ~TSD_months, data=bh2, 
                correlation = corAR1(form=~TSD_months),
                na.action=na.omit)
summary(bcc_lm_ac2)

str(metadat$Dist_Date)
names(data_rec)

datametarec<-data_rec[,c(1,2,5,7,11,13,14,16:18,21,22,27:28, 30, 32,40,42,44:47, 49,56,69:70)]
names(datametarec)#26 variables
head(datametarec)
str(datametarec)#388 variables

head(datametarec)


# Run model with many trees to check convergence
check_conv_rec <- MetaForest(yi~.,
                         data = datametarec,
                         study = "Effectsize_ID",
                         whichweights = "random",
                         num.trees = 20000)

plot(check_conv_rec) #m odel converged at about 7500 trees, which will be used in the next step

#Model with 8000 trees for replication

mf_rep <- MetaForest(yi~.,
                     data = datametaforest,
                     study = "Effectsize_ID",
                     whichweights = "random",
                     num.trees = 7500)
mf_rep$call

#now apply recursive pre-selection using the preselect function. 

# Run recursive preselection, store results in object 'preselect'

preselected <- preselect(mf_rep,
                         replications = 100,
                         algorithm = "recursive")

plot(preselected)#18 variables

preselected$selected

#Using preselect_vars, we retain only those moderators for which a 50% percentile interval 
#of the variable importance metrics does not include zero

#Retain only moderators with positive variable importance
#in more than 50% of replications
retain_mods <- preselect_vars(preselected, cutoff = .5)
retain_mods

plot(retain_mods)#18 variables are retained

# Set up 10-fold grouped (=clustered) CV

grouped_cv <- trainControl(method = "cv", 
                           index = groupKFold(datametaforest$Effectsize_ID, k = 5))
grouped_boot <- trainControl(method = "cboot", 
                             index = groupKFold(datametaforest$Effectsize_ID, k = 5))

# Set up a tuning grid for the three tuning parameters of MetaForest
tuning_grid <- expand.grid(whichweights = c("random", "fixed", "unif"),
                           mtry = 2:6,
                           min.node.size = 2:6)

# X should contain only retained moderators, clustering variable, and vi
X <- datametaforest[, c("Effectsize_ID", "vi", retain_mods)]

# Train the model
mf_cv <- train(y = datametaforest$yi,
               x = X,
               study = "Effectsize_ID", # Name of the clustering variable
               method = ModelInfo_mf(), 
               trControl = grouped_cv,
               tuneGrid = tuning_grid,
               num.trees = 7500)

#Examine optimal tuning parameters

mf_cv$results[which.min(mf_cv$results$RMSE), ]

#Based on the root mean squared error, the best combination of tuning parameters
#were RANDOM weights

#The object returned by train already contains the final model, 
#estimated with the best combination of tuning parameters

#Inspecting the results

# For convenience, extract final model
final <- mf_cv$finalModel
final

# Extract the estimate of predictive performance R^2_{oob} from the final model
#This is an estimate of how much variance the model would explain in a new data set 
r2_oob <- final$forest$r.squared
r2_oob #predictive performance of 81%

#REsidual heterogeneity
Vimp <- data.frame(final$forest$variable.importance)
Vimp

# Plot convergence
plot(final)

#We can conclude that the model has converged, and has a positive estimate of explained variance in new data. Now, we proceed to interpreting the model findings. 
#We will plot the variable importance, and partial dependence plots.

# Plot variable importance
#MetaForests variable importance metrics reflect each moderators contribution 
#to the predictive power of the final model across all linear-, non-linear-, and interaction effects
VarImpPlot(final)

# Sort the variable names by importance, so that the
# partial dependence plots will be ranked by importance

ordered_vars <- names(final$forest$variable.importance)[
  order(final$forest$variable.importance, decreasing = TRUE)]
ordered_vars

# Plot partial dependence
PartialDependence(final, vars = ordered_vars,
                  rawdata = TRUE, pi = .95)


####STEP 5 Datasets for Figures ####


Cari<-data_es0ia %>% filter(Region == "Caribbean")
Cari$vi
CariS<-data_es0iaS %>% filter(Region == "Caribbean")
str(CariS)
CariSS<-data_es0iaSS %>% filter(Region == "Caribbean")
str(CariSS)
Tai<-data_es0ia %>% filter(Region == "Taiwan")
str(Tai)
TaiS<-data_es0iaS %>% filter(Region == "Taiwan")
str(TaiS)
TaiSS<-data_es0iaSS %>% filter(Region == "Taiwan")
str(TaiSS)
Haw<-data_es0ia %>% filter(Region == "Hawaii")
str(Haw)
HawS<-data_es0iaS %>% filter(Region == "Hawaii")
str(HawS)
HawSS<-data_es0iaSS %>% filter(Region == "Hawaii")
str(HawSS)
Mex<-data_es0ia %>% filter(Region == "Mexico")
str(Mex)
MexS<-data_es0iaS %>% filter(Region == "Mexico")
str(MexS)
MexSS<-data_es0iaSS %>% filter(Region == "Mexico")
str(MexSS)
Aus<-data_es0ia %>% filter(Region == "Australia")
str(Aus)
AusS<-data_es0iaS %>% filter(Region == "Australia")
str(AusS)
AusSS<-data_es0iaSS %>% filter(Region == "Australia")
str(AusSS)

data_region <- rbind(data.frame(group="Caribbean", variable="All NoSeason",estimate=Cari$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Hawaii", variable="All NoSeason",estimate=Haw$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Mexico", variable="All NoSeason",estimate=Mex$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Australia", variable="All NoSeason",estimate=Aus$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Taiwan", variable="All NoSeason",estimate=Tai$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Caribbean", variable="Few NoSeason",estimate=CariS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Hawaii", variable="Few NoSeason",estimate=HawS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Mexico", variable="Few NoSeason",estimate=MexS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Australia", variable="Few NoSeason",estimate=AusS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Taiwan", variable="Few NoSeason",estimate=TaiS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Caribbean", variable="Few Season",estimate=CariSS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Hawaii", variable="Few Season",estimate=HawSS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Mexico", variable="Few Season",estimate=MexSS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Australia", variable="Few Season",estimate=AusSS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="Taiwan", variable="Few Season",estimate=TaiSS$yi,
                               row.names=FALSE, stringsAsFactors=TRUE))
data_region

data1<-data_es0ia %>% mutate(season = "All NoSeason")
data1S<-data_es0iaS %>% mutate(season = "Few Season")
data1SS<-data_es0iaSS %>% mutate(season = "Few NoSeason")

data_region2<-rbind(data1,data1S,data1SS)
str(data_region2)
data_region2$season=as.factor(data_region2$season)

tlf_eff_imp <- rbind(data.frame(group="All sites", estimate=data_es0ia$yi, 
                                       ci_low=data_es0ia$sei, ci_up=data_es0ia$sei,
                                       row.names=FALSE, stringsAsFactors=TRUE))
                            #data.frame(group="Wood", estimate=(exp(random0wf$b)-1)*100, 
                                       #ci_low=(exp(random0wf$ci.lb)-1)*100, ci_up=(exp(random0wf$ci.ub)-1)*100,
                                       #row.names=FALSE, stringsAsFactors=TRUE),
                           # data.frame(group="Leaf", estimate=(exp(random0lf$b)-1)*100, 
                                      # ci_low=(exp(random0lf$ci.lb)-1)*100, ci_up=(exp(random0lf$ci.ub)-1)*100,
                                   #    row.names=FALSE, stringsAsFactors=TRUE),
                           # data.frame(group="Misc.", estimate=(exp(random0mf$b)-1)*100, 
                                      # ci_low=(exp(random0mf$ci.lb)-1)*100, ci_up=(exp(random0mf$ci.ub)-1)*100,
                                      # row.names=FALSE, stringsAsFactors=TRUE),
                           # data.frame(group="FFS", estimate=-((1-exp(random0ff$b))*100), 
                                      # ci_low=-((1-exp(random0ff$ci.lb))*100), ci_up=(exp(random0ff$ci.ub)-1)*100,
                                      # row.names=FALSE, stringsAsFactors=TRUE))
tlf_eff_imp

region0a<-data_es0ia$Region
cat0a<-data_es0ia$SSHWS_Cat
year0a<-data_es0ia$Year_measurement
forest(random0a, order = "obs",
         +        ilab = paste(disturbance.names0a, year0a, cat0a, sep=" | "),
         +        slab = paste(site.names0a,region0a, sep=" | "),
         +        ilab.xpos = -6.5,
         +        ilab.pos=4,
         +        cex=1.4,
         +        digits=1,
         +        ylim=c(-1,30),
         +        xlim=c(-16,14),
         +        steps=5,
         +        lineheight="auto",
         +        refline = 3.8, mlab="Summary effect", col = c("red", "black"),border = "black",alpha=0.5,
         +        xlab = "Log response ratio",cex.lab=1.8, cex.axis = 1.8, pch=5)

####Resilience plots####

str(allres)
names(data_es1to4)

levels(data_es1to4$Treatment)=c("Ambient","DebRem","Fert","+N","+N+P","+P","Trim","TrimDeb")
library(dplyr)
data_es1to4 <- data_es1to4 %>% rename(Wind_speed_kt=Wind_speed)

pres1to12<-ggplot(data_es1to12, aes(x=reorder(Site,-yi), y=yi))+geom_point(alpha=0.7,aes(color=StormsPerYear,size=Elevation_m))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=17,angle=0, hjust=1),axis.text.y=element_text(size=17, hjust=1))+ labs(x="Tropical site", y="Resilience [ln(post-/pre-cyclone)]")+theme(legend.title = element_text (size = 16), legend.text = element_text (size = 14),legend.position="right",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")+scale_size(range = c(2, 8))
pres1to12

pres1to12<-ggplot(data_es1to12, aes(x=reorder(Site,-yi), y=yi))+geom_boxplot(alpha=0.7)+geom_point(alpha=0.5,aes(color=StormsPerYear,size=Elevation_m))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=17,angle=0, hjust=1),axis.text.y=element_text(size=17, hjust=1))+ labs(x="Tropical site", y="Resilience [ln(post-/pre-cyclone)]")+theme(legend.title = element_text (size = 15), legend.text = element_text (size = 14),legend.position=c(0.82,0.72),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")+scale_size(range = c(2, 8))
pres1to12

names(Data_es1to12a)

#Resilience linear model
lm_res<-lm(yi~Other_soil_P,data=Data_es1to12a)
summary(lm_res)
shapiro.test(residuals(lm_res))

Soil_P_mgkg<-Data_es1to12a$Other_soil_P
plot_reg_res<- cbind(data.frame(Data_es1to12a$yi, lm_res$fitted.values,Soil_P_mgkg))
plot_reg_res

p_res1to14<-ggplot(Data_es1to12a, aes(x=reorder(Region,-yi), y=yi))+geom_violin(alpha=0.6)+geom_point(alpha=0.5,aes(size=StormsPerYear,color=Soil_P_mgkg))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+geom_hline(aes(yintercept=-0.47), lty=2, color = "darkblue", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=17,angle=0, hjust=1),axis.text.y=element_text(size=17, hjust=1))+ labs(x="Region", y="Resilience [ln(Litterfall tx/t0)]")+theme(legend.title = element_text (size = 19), legend.text = element_text (size = 18),legend.position="right",legend.background = element_blank(),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")+scale_size(range = c(1, 8))
p_res1to14

p_reg_res<-ggplot(plot_reg_res, aes(x=lm_res.fitted.values, y=Data_es1to12a.yi,color=Soil_P_mgkg))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_minimal()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=18,hjust=0.9,vjust = 1))+ labs(x="Predicted resilience", y="Observed resilience")
p_reg_res +scale_color_gradient(low="blue", high="orange")+theme(legend.title = element_text (size = 15), legend.text = element_text (size = 14),legend.position=c(0.82,0.2),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "darkgray"))

+ geom_label_repel(aes(label=data_es0ia$Basin,fill = factor(data_es0ia$Basin)), color = 'black', size = 5, alpha=0.8) +scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))


pres1to4<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = Treatment))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+ geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=35, hjust=1))+ labs(x="Treatment", y="Resilience (ln post/pre)")
pres1to4

pres1to4_b<-ggplot(data_es1to4, aes(x=reorder(Treatments, -yi), y=yi, color = Treatment))+geom_boxplot()+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=35, hjust=1))+ labs(x="WMO wind speed (kts)", y="Resilience (ln post/pre)")
pres1to4_b+scale_color_brewer(palette="Dark2")

pres1to4_c<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = Wind_speed_kt))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=18,angle=0, hjust=1),axis.text.y=element_text(size=18, hjust=1))+ labs(x="Treatment", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 16), legend.text = element_text (size = 14),legend.position=c(0.15,.28),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_c

pres1to4_c2<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = Storm_frequency))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=18,angle=0, hjust=1),axis.text.y=element_text(size=18, hjust=1))+ labs(x="Treatment", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 16), legend.text = element_text (size = 14),legend.position=c(0.17,.28),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_c2

pres1to4_c2a<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = SoilP_mgkg))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),axis.text.x=element_text(size=18,angle=0, hjust=1),axis.text.y=element_text(size=18, hjust=1))+ labs(x="Treatment", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 16), legend.text = element_text (size = 14),legend.position=c(0.15,.28),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_c2a

pres1to4_c / pres1to4_c2 / pres1to4_c2a+
  plot_layout(guides = 'keep')

amb<-data_es1to4 %>% filter(Treatment == "Ambient")

pres1to4_c3<-ggplot(amb, aes(x=reorder(Region, -yi), y=yi, color = Other_soil_P))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text.x=element_text(size=20,angle=0, hjust=1),axis.text.y=element_text(size=20, hjust=1))+ labs(x="Region", y="Overall resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.15,.2),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_c3

pres1to4_c4<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = Other_soil_P, shape=Region))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+coord_flip()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text.x=element_text(size=20,angle=0, hjust=1),axis.text.y=element_text(size=20, hjust=1))+ labs(x="Region", y="Overall resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.15,.2),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_c4

pres1to4_d<-ggplot(data_es1to4, aes(x=reorder(Treatment, -yi), y=yi, color = StormsPerYear))+geom_boxplot()+ geom_jitter(position=position_jitter(0.2))+
  theme_bw()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=1))+ labs(x="Treatment", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.2,.2),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
scale_color_gradient(low="blue", high="orange")
pres1to4_d


pres1to4_c + pres1to4_d

resamb1to4<- data_es1to4 %>% filter (Treatment =="Ambient")

pres1to4_cA<-ggplot(resamb1to4, aes(x=Other_soil_P, y=yi, color = WMO_wind_kts))+ geom_jitter(position=position_jitter(0.2))+geom_smooth(method="glm",se=T, color="black",alpha=0.5)+
  theme_bw()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=0.8))+ labs(x="Total soil P (mg/kg)", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.2,.15),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_cA

pres1to4_dA<-ggplot(resamb1to4, aes(x=Other_soil_P, y=yi, color = StormsPerYear))+ geom_jitter(position=position_jitter(0.2))+geom_smooth(method="glm",se=T, color="black",alpha=0.5)+
  theme_bw()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=0.8))+ labs(x="Total soil P (mg/kg)", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.2,.15),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_dA

pres1to4_cA + pres1to4_dA

pres1to4_cB<-ggplot(data_es1to4, aes(x=Other_soil_P, y=yi, color = WMO_wind_kts))+ geom_jitter(position=position_jitter(0.2))+geom_smooth(method="glm",se=T, color="black",alpha=0.5)+
  theme_bw()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=0.8))+ labs(x="Total soil P (mg/kg)", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.2,.15),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_cB

pres1to4_dB<-ggplot(data_es1to4, aes(x=Other_soil_P, y=yi, color = StormsPerYear))+ geom_jitter(position=position_jitter(0.2))+geom_smooth(method="glm",se=T, color="black",alpha=0.5)+
  theme_bw()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=0.8))+ labs(x="Total soil P (mg/kg)", y="Resilience (ln post/pre)")+theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position=c(0.2,.15),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  scale_color_gradient(low="blue", high="orange")
pres1to4_dB

pres1to4_cB + pres1to4_dB

names(data_es1to4)

Res_amb<- data_es1to4 %>% filter (Treatment == "Ambient")
str(Res_amb)#n=146

lmP<-lm(yi~SoilP_mgkg, data=data_es1to4)
summary(lmP)#R2adj = 0.26
shapiro.test(residuals(lmP))

lmP_amb<-lm(yi~SoilP_mgkg, data=Res_amb)
summary(lmP_amb)#R2adj = 0.16 and significant
shapiro.test(residuals(lmP))

lmP2<-lm(yi~SoilP_mgkg+Storm_frequency, data=data_es1to4)
summary(lmP2)#R2adj = 0.32
shapiro.test(residuals(lmP2))

lmP3<-lm(yi~SoilP_mgkg+Storm_frequency+Treatment, data=data_es1to4)
summary(lmP3)#R2adj = 0.42
shapiro.test(residuals(lmP2))

lmP3_amb<-lm(yi~SoilP_mgkg+Storm_frequency, data=Res_amb)
summary(lmP3_amb)#R2adj = 0.18 and significant
shapiro.test(residuals(lmP2))

lmP4<-lm(yi~SoilP_mgkg+Storm_frequency+Treatment+Wind_speed_kt, data=data_es1to4)
summary(lmP4)#R2adj = 0.44
shapiro.test(residuals(lmP4))

lmP4_amb<-lm(yi~SoilP_mgkg+Storm_frequency+Wind_speed_kt, data=Res_amb)
summary(lmP4_amb)#R2adj = 0.21
shapiro.test(residuals(lmP4_amb))

lmP5<-lm(yi~Storm_frequency+Treatment+Wind_speed_kt, data=data_es1to4)
summary(lmP5)#R2adj = 0.44
shapiro.test(residuals(lmP5))

lmP6_amb<-lm(yi~Basin+Storm_frequency+Wind_speed_kt, data=Res_amb)
summary(lmP6_amb)#R2adj = 0.26
shapiro.test(residuals(lmP6_amb))

lmP6<-lm(yi~Storm_frequency+Wind_speed_kt, data=data_es1to4)
summary(lmP6)#R2adj = 0.28
shapiro.test(residuals(lmP5))

lmP7_amb<-lm(yi~Storm_frequency+Wind_speed_kt, data=Res_amb)
summary(lmP7_amb)#R2adj = 0.26
shapiro.test(residuals(lmP7_amb))

AIC(lmP,lmP2,lmP3,lmP4,lmP5,lmP6)
AIC(lmP_amb,lmP3_amb,lmP4_amb,lmP6_amb,lmP7_amb)

#### Regression model for resilience ####

metareg_res<- cbind(data.frame(data_es1to4$yi, lmP5$fitted.values))
metareg_res

pRes_reg<-ggplot(metareg_res, aes(x=lmP5.fitted.values, y=data_es1to4.yi,color=data_es1to4$Storm_frequency))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Effect Size", y="Observed Effect Size")
pRes_reg

pRes_reg2<-ggplot(metareg_res, aes(x=lmP5.fitted.values, y=data_es1to4.yi,color=data_es1to4$Treatment))+geom_point(size=3, alpha=0.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Effect Size", y="Observed Effect Size")
pRes_reg2+scale_color_brewer(palette="Dark2")

pRes_reg + geom_label_repel(aes(label=data_es1to4$Basin,fill = factor(data_es1to4$Basin)), color = 'black', size = 5, alpha=0.8) +scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

metareg_res_amb<- cbind(data.frame(Res_amb$yi, lmP6_amb$fitted.values))
metareg_res_amb

pRes_reg_amb<-ggplot(metareg_res_amb, aes(x=lmP6_amb.fitted.values, y=Res_amb.yi,color=Res_amb$Storm_frequency))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Effect Size", y="Observed Effect Size")
pRes_reg_amb +guides(fill = guide_legend(title = "Storms per year"),legend.key.width=22)+scale_color_gradient(low="blue", high="red")+theme(legend.position=c(0.8,.18),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.text=element_text(size=16),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))

#+ geom_label_repel(aes(label=Res_amb$Basin,fill = factor(Res_amb$Basin)), color = 'black', size = 5, alpha=0.8) +scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  #theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

####Recovery plot and Regression model####

names(datametaforest1to14)
names(Data_es1to14)
p_rec_1to14<-ggplot(Data_es1to14, aes(x=reorder(Region, -yi), y=yi, color = Other_soil_P, alpha=1, size=TSD_months))+geom_boxplot(alpha=0.5)+ geom_jitter(position=position_jitter(0.2))+
  theme_minimal()+coord_flip()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),axis.text=element_text(size=20,angle=0, hjust=1))+ labs(x="Region", y="Recovery (ln post/cyclone)")+theme(legend.title = element_text (size = 18),legend.key.size = unit(1.2, "lines"), legend.text = element_text (size = 16),legend.position=c(0.2,.5),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "darkgray"))+
  scale_color_gradient(low="blue", high="orange")+ guides(alpha = FALSE)#+guides(color=guide_legend(title="Soil P (mg/kg)")) 
p_rec_1to14

p_rec_1to14b<-ggplot(Data_es1to14, aes(x=pred.pred, y=data_es0ia.yi,color=data_es0ia.Other_soil_P))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Effect Size", y="Observed Effect Size")

SoilP_mgkg<-Data_es1to14$Other_soil_P
recplot<- cbind(data.frame(Data_es1to14$yi, lm_rec$fitted.values),Data_es1to14$Other_soil_P)
recplot
recplot<- cbind(data.frame(Data_es1to14$yi, lm_rec$fitted.values),SoilP_mgkg)
recplot

lm_rec<-lm(yi~Other_soil_P,data=Data_es1to14)
summary(lm_rec)
shapiro.test(residuals(lm_rec))

p_lm_rec<-ggplot(recplot, aes(x=lm_rec.fitted.values, y=Data_es1to14.yi,color=SoilP_mgkg))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_pubclean()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=18))+ labs(x="Predicted recovery", y="Observed recovery")

p_lm_rec +scale_color_gradient(low="blue", high="orange")+#scale_color_gradientn(colours = rainbow(5))+#
  theme(legend.title = element_text (size = 14), legend.text = element_text (size = 16),legend.position = c(0.98,0.38),legend.justification = c("right", "top"),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "darkgray"))
#+ geom_label_repel(aes(label=data_es0ia$Basin,fill = factor(data_es0ia$Basin)), color = 'black', size = 5, alpha=0.8) 

p_lm_rec2<-ggplot(recplot, aes(x=lm_rec.fitted.values, y=Data_es1to14.yi,color=SoilP_mgkg))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_pubclean()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Recovery", y="Observed Recovery")

p_lm_rec2 +scale_color_gradient(low="blue", high="orange")+#scale_color_gradientn(colours = rainbow(5))+#
  theme(legend.title = element_text (size = 14), legend.text = element_text (size = 16),legend.position = c(0.98,0.38),legend.justification = c("right", "top"),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "darkgray"))


summary(random1)
random1$k
estimate=1-(exp(random1$b))*100
estimate

#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100


#### RESILIENCE data prep for Pantropical resilience index ####

summary(res11)
#ci_low=(full.model3ff$b-(1.96*full.model3ff$se)),ci_up=(full.model3ff$b+(1.96*full.model3ff$se))

##P flux ####

##P flux total, leaf, wood, ffs

summary(res1tpf)

data_res_t_p_n_flux <- rbind(data.frame(fraction="Total",group="2", estimate=res1tpf$b, n=res1tpf$k,
                             ci_low=(res1tpf$b-(1.96*res1tpf$se)),ci_up=(res1tpf$b+(1.96*res1tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="4", estimate=res2tpf$b, n=res2tpf$k,
                                  ci_low=(res2tpf$b-(1.96*res2tpf$se)),ci_up=(res2tpf$b+(1.96*res2tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="6", estimate=res3tpf$b, n=res3tpf$k,
                                  ci_low=(res3tpf$b-(1.96*res3tpf$se)),ci_up=(res3tpf$b+(1.96*res3tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="8", estimate=res4tpf$b, n=res4tpf$k,
                                  ci_low=(res4tpf$b-(1.96*res4tpf$se)),ci_up=(res4tpf$b+(1.96*res4tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="10", estimate=res5tpf$b,n=res5tpf$k, 
                                  ci_low=(res5tpf$b-(1.96*res5tpf$se)),ci_up=(res5tpf$b+(1.96*res5tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="12", estimate=res6tpf$b, n=res6tpf$k,
                                  ci_low=(res6tpf$b-(1.96*res6tpf$se)),ci_up=(res6tpf$b+(1.96*res6tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="14", estimate=res7tpf$b, n=res7tpf$k,
                                  ci_low=(res7tpf$b-(1.96*res7tpf$se)),ci_up=(res7tpf$b+(1.96*res7tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="16", estimate=res8tpf$b, n=res8tpf$k, 
                                  ci_low=(res8tpf$b-(1.96*res8tpf$se)),ci_up=(res8tpf$b+(1.96*res8tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="18", estimate=res9tpf$b, n=res9tpf$k,
                                  ci_low=(res9tpf$b-(1.96*res9tpf$se)),ci_up=(res9tpf$b+(1.96*res9tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="20", estimate=res10tpf$b, n=res10tpf$k,
                                  ci_low=(res10tpf$b-(1.96*res10tpf$se)),ci_up=(res10tpf$b+(1.96*res10tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="22", estimate=res11tpf$b, n=res11tpf$k,
                                  ci_low=(res11tpf$b-(1.96*res11tpf$se)),ci_up=(res11tpf$b+(1.96*res11tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="24", estimate=res12tpf$b, n=res12tpf$k,
                                  ci_low=(res12tpf$b-(1.96*res12tpf$se)),ci_up=(res12tpf$b+(1.96*res12tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="26", estimate=res13tpf$b, n=res13tpf$k,
                                  ci_low=(res13tpf$b-(1.96*res13tpf$se)),ci_up=(res13tpf$b+(1.96*res13tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="28", estimate=res14tpf$b, n=res14tpf$k,
                                  ci_low=(res14tpf$b-(1.96*res14tpf$se)),ci_up=(res14tpf$b+(1.96*res14tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="30", estimate=res15tpf$b, n=res15tpf$k,
                                  ci_low=(res15tpf$b-(1.96*res15tpf$se)),ci_up=(res15tpf$b+(1.96*res15tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="32", estimate=res16tpf$b, n=res16tpf$k,
                                  ci_low=(res16tpf$b-(1.96*res16tpf$se)),ci_up=(res16tpf$b+(1.96*res16tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="34",estimate=res17tpf$b, n=res17tpf$k,
                                  ci_low=(res17tpf$b-(1.96*res17tpf$se)),ci_up=(res17tpf$b+(1.96*res17tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Total",group="36", estimate=res18tpf$b, n=res18tpf$k, 
                                  ci_low=(res18tpf$b-(1.96*res18tpf$se)),ci_up=(res18tpf$b+(1.96*res18tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))
#add N flux here


data_res_lpn_flux <- rbind(data.frame(fraction="Leaf",group="2", estimate=res1lpf$b, n=res1lpf$k,
                                  ci_low=(res1lpf$b-(1.96*res1lpf$se)),ci_up=(res1lpf$b+(1.96*res1lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="4", estimate=res2lpf$b, n=res2lpf$k, 
                                  ci_low=(res2lpf$b-(1.96*res2lpf$se)),ci_up=(res2lpf$b+(1.96*res2lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="6", estimate=res3lpf$b, n=res3lpf$k, 
                                  ci_low=(res3lpf$b-(1.96*res3lpf$se)),ci_up=(res3lpf$b+(1.96*res3lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="8", estimate=res4lpf$b, n=res4lpf$k, 
                                  ci_low=(res4lpf$b-(1.96*res4lpf$se)),ci_up=(res4lpf$b+(1.96*res4lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="10", estimate=res5lpf$b, n=res5lpf$k, 
                                  ci_low=(res5lpf$b-(1.96*res5lpf$se)),ci_up=(res5lpf$b+(1.96*res5lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="12", estimate=res6lpf$b, n=res6lpf$k, 
                                  ci_low=(res6lpf$b-(1.96*res6lpf$se)),ci_up=(res6lpf$b+(1.96*res6lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="14", estimate=res7lpf$b, n=res7lpf$k, 
                                  ci_low=(res7lpf$b-(1.96*res7lpf$se)),ci_up=(res7lpf$b+(1.96*res7lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="16", estimate=res8lpf$b, n=res8lpf$k, 
                                  ci_low=(res8lpf$b-(1.96*res8lpf$se)),ci_up=(res8lpf$b+(1.96*res8lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="18", estimate=res9lpf$b, n=res9lpf$k, 
                                  ci_low=(res9lpf$b-(1.96*res9lpf$se)),ci_up=(res9lpf$b+(1.96*res9lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="20", estimate=res10lpf$b, n=res10lpf$k, 
                                  ci_low=(res10lpf$b-(1.96*res10lpf$se)),ci_up=(res10lpf$b+(1.96*res10lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="22", estimate=res11lpf$b, n=res11lpf$k, 
                                  ci_low=(res11lpf$b-(1.96*res11lpf$se)),ci_up=(res11lpf$b+(1.96*res11lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="24", estimate=res12lpf$b, n=res12lpf$k, 
                                  ci_low=(res12lpf$b-(1.96*res12lpf$se)),ci_up=(res12lpf$b+(1.96*res12lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="26", estimate=res13lpf$b, n=res13lpf$k, 
                                  ci_low=(res13lpf$b-(1.96*res13lpf$se)),ci_up=(res13lpf$b+(1.96*res13lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="28", estimate=res14lpf$b, n=res14lpf$k, 
                                  ci_low=(res14lpf$b-(1.96*res14lpf$se)),ci_up=(res14lpf$b+(1.96*res14lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="30", estimate=res15lpf$b, n=res15lpf$k, 
                                  ci_low=(res15lpf$b-(1.96*res15lpf$se)),ci_up=(res15lpf$b+(1.96*res15lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="32", estimate=res16lpf$b, n=res16lpf$k, 
                                  ci_low=(res16lpf$b-(1.96*res16lpf$se)),ci_up=(res16lpf$b+(1.96*res16lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="34", estimate=res17lpf$b, n=res17lpf$k,
                                  ci_low=(res17lpf$b-(1.96*res17lpf$se)),ci_up=(res17lpf$b+(1.96*res17lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Leaf",group="36", estimate=res18lpf$b, n=res18lpf$k, 
                                  ci_low=(res18lpf$b-(1.96*res18lpf$se)),ci_up=(res18lpf$b+(1.96*res18lpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))

data_res_wpn_flux <- rbind (data.frame(fraction="Wood",group="2", estimate=res1wpf$b, n=res1wpf$k,
                                  ci_low=(res1wpf$b-(1.96*res1wpf$se)),ci_up=(res1wpf$b+(1.96*res1wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="4", estimate=res2wpf$b, n=res2wpf$k, 
                                  ci_low=(res2wpf$b-(1.96*res2wpf$se)),ci_up=(res2wtpf$b+(1.96*res2wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="6", estimate=res3wpf$b, n=res3wpf$k, 
                                  ci_low=(res3wpf$b-(1.96*res3wpf$se)),ci_up=(res3wpf$b+(1.96*res3wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="8", estimate=res4wpf$b, n=res4wpf$k, 
                                  ci_low=(res4wpf$b-(1.96*res4wpf$se)),ci_up=(res4wpf$b+(1.96*res4wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="10", estimate=res5wpf$b, n=res5wpf$k, 
                                  ci_low=(res5wpf$b-(1.96*res5wpf$se)),ci_up=(res5wpf$b+(1.96*reswpf5$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="12", estimate=res6wpf$b, n=res6wpf$k, 
                                  ci_low=(res6wpf$b-(1.96*res6wpf$se)),ci_up=(res6wpf$b+(1.96*res6wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="14", estimate=res7wpf$b, n=res7wpf$k, 
                                  ci_low=(res7wpf$b-(1.96*res7wpf$se)),ci_up=(res7wpf$b+(1.96*res7wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="16", estimate=res8wpf$b, n=res8wpf$k, 
                                  ci_low=(res8wpf$b-(1.96*res8wpf$se)),ci_up=(res8wpf$b+(1.96*res8wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="18", estimate=res9wpf$b, n=res9wpf$k, 
                                  ci_low=(res9wpf$b-(1.96*res9wpf$se)),ci_up=(res9wpf$b+(1.96*res9wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="20", estimate=res10wpf$b, n=res10wpf$k, 
                                  ci_low=(res10wpf$b-(1.96*res10wpf$se)),ci_up=(res10wpf$b+(1.96*res10wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="22", estimate=res11wpf$b, n=res11wpf$k, 
                                  ci_low=(res11wpf$b-(1.96*res11wpf$se)),ci_up=(res11wpf$b+(1.96*res11wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="24", estimate=res12wpf$b, n=res12wpf$k, 
                                  ci_low=(res12wpf$b-(1.96*res12wpf$se)),ci_up=(res12wpf$b+(1.96*res12wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="26", estimate=res13wpf$b, n=res13wpf$k, 
                                  ci_low=(res13wpf$b-(1.96*res13wpf$se)),ci_up=(res13wpf$b+(1.96*res13wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="28", estimate=res14wpf$b, n=res14wpf$k, 
                                  ci_low=(res14wpf$b-(1.96*res14wpf$se)),ci_up=(res14wpf$b+(1.96*res14wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="30", estimate=res15wpf$b, n=res15wpf$k, 
                                  ci_low=(res15wpf$b-(1.96*res15wpf$se)),ci_up=(res15wpf$b+(1.96*res15wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="32", estimate=res16wpf$b, n=res16wpf$k, 
                                  ci_low=(res16wpf$b-(1.96*res16wpf$se)),ci_up=(res16wpf$b+(1.96*res16wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="34", estimate=res17wpf$b, n=res17wpf$k, 
                                  ci_low=(res17wpf$b-(1.96*res17wpf$se)),ci_up=(res17wpf$b+(1.96*res17wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="Wood",group="36", estimate=res18wpf$b, n=res18wpf$k, 
                                  ci_low=(res18wpf$b-(1.96*res18wpf$se)),ci_up=(res18wpf$b+(1.96*res18wpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))
                       #ADD N HERE

data_res_ffpn_flux <- rbind (data.frame(fraction="FFS",group="2", estimate=-(1-exp(res1tpf$b))*100, n=res1tpf$k,
                                  ci_low=(res1tpf$b-(1.96*res1tpf$se)),ci_up=(res1tpf$b+(1.96*res1tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="4", estimate=-(1-exp(res2tpf$b))*100, 
                                  ci_low=(res2tpf$b-(1.96*res1tpf$se)),ci_up=(res1tpf$b+(1.96*res2tpf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="6", estimate=-(1-exp(res3$b))*100, 
                                  ci_low=(res3$b-(1.96*res3$se)),ci_up=(res3$b+(1.96*res3$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="8", estimate=-(1-exp(res4$b))*100, 
                                  ci_low=(res4$b-(1.96*res4$se)),ci_up=(res4$b+(1.96*res4$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="10", estimate=-(1-exp(res5$b))*100, 
                                  ci_low=(res5$b-(1.96*res5$se)),ci_up=(res5$b+(1.96*res5$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="12", estimate=-(1-exp(res6$b))*100, 
                                  ci_low=(res6$b-(1.96*res6$se)),ci_up=(res6$b+(1.96*res6$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="14", estimate=-(1-exp(res7$b))*100, 
                                  ci_low=-(1-exp(res7$ci.lb))*100, ci_up=(exp(res7$ci.ub)-1)*100,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="16", estimate=-(1-exp(res8$b))*100, 
                                  ci_low=(res8$b-(1.96*res8$se)),ci_up=(res8$b+(1.96*res8$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="18", estimate=-(1-exp(res9$b))*100, 
                                  ci_low=(res9$b-(1.96*res9$se)),ci_up=(res9$b+(1.96*res9$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="20", estimate=-(1-exp(res10$b))*100, 
                                  ci_low=(res10$b-(1.96*res10$se)),ci_up=(res10$b+(1.96*res10$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="22", estimate=-(1-exp(res11$b))*100, 
                                  ci_low=(res11$b-(1.96*res11$se)),ci_up=(res11$b+(1.96*res11$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="24", estimate=-(1-exp(res12$b))*100, 
                                  ci_low=(res12$b-(1.96*res12$se)),ci_up=(res12$b+(1.96*res12$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="26", estimate=-(1-exp(res13$b))*100, 
                                  ci_low=(res13$b-(1.96*res13$se)),ci_up=(res13$b+(1.96*res13$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="28", estimate=-(1-exp(res14$b))*100, 
                                  ci_low=(res14$b-(1.96*res14$se)),ci_up=(res14$b+(1.96*res14$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="30", estimate=-(1-exp(res15$b))*100, 
                                  ci_low=(res15$b-(1.96*res15$se)),ci_up=(res15$b+(1.96*res15$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="32", estimate=-(1-exp(res16$b))*100, 
                                  ci_low=(res16$b-(1.96*res16$se)),ci_up=(res16$b+(1.96*res16$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="34", estimate=-(1-exp(res17$b))*100, 
                                  ci_low=(res17$b-(1.96*res17$se)),ci_up=(res17$b+(1.96*res17$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(fraction="FFS",group="36", estimate=-(1-exp(res18$b))*100, 
                                  ci_low=(res18$b-(1.96*res18$se)),ci_up=(res18$b+(1.96*res18$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))

#ADD N HERE

data_res_pflux

#to add more data points

data_res2 <- rbind(data.frame(group="2", estimate=res1$b, 
                             ci_low=res1$ci.lb, ci_up=res1$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="4", estimate=res2$b, 
                             ci_low=res2$ci.lb, ci_up=res2$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="6", estimate=res3$b, 
                             ci_low=res3$ci.lb, ci_up=res3$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="8", estimate=res4$b, 
                             ci_low=res4$ci.lb, ci_up=res4$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="10", estimate=res5$b,
                             ci_low=res5$ci.lb, ci_up=res5$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="12", estimate=res6$b, 
                             ci_low=res6$ci.lb, ci_up=res6$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="14", estimate=res7$b, 
                             ci_low=res7$ci.lb, ci_up=res7$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="16", estimate=res8$b,
                             ci_low=res8$ci.lb,ci_up=res8$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="18", estimate=res9$b, 
                             ci_low=res9$ci.lb, ci_up=res9$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="20", estimate=res10$b,
                             ci_low=res10$ci.lb,  ci_up=res10$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="22", estimate=res11$b, 
                             ci_low=res11$ci.lb, ci_up=res11$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="24", estimate=res12$b, 
                             ci_low=res12$ci.lb, ci_up=res12$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="26", estimate=res13$b, 
                             ci_low=res13$ci.lb, ci_up=res13$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="28", estimate=res14$b, 
                             ci_low=res14$ci.lb,ci_up=res14$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="30", estimate=res15$b,
                             ci_low=res15$ci.lb, ci_up=res15$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="32", estimate=res16$b, 
                             ci_low=res16$ci.lb, ci_up= res16$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="34", estimate=res17$b,
                             ci_low=res17$ci.lb, ci_up=res17$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="36", estimate=res18$b, 
                             ci_low=res18$ci.lb, ci_up=res18$ci.ub,
                             row.names=FALSE, stringsAsFactors=TRUE))
data_res2

data_res2a <- rbind(data.frame(group="2", estimate=res1$b, 
                              ci_low=res1$ci.lb, ci_up=res1$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="4", estimate=res2$b, 
                              ci_low=res2$ci.lb, ci_up=res2$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="6", estimate=res3$b, 
                              ci_low=res3$ci.lb, ci_up=res3$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="8", estimate=res4$b, 
                              ci_low=res4$ci.lb, ci_up=res4$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="10", estimate=res5$b,
                              ci_low=res5$ci.lb, ci_up=res5$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="12", estimate=res6$b, 
                              ci_low=res6$ci.lb, ci_up=res6$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE))
data_res2a

summary(res11S)

data_resS <- rbind(data.frame(group="2", estimate=-(1-exp(res1S$b))*100, 
                             ci_low=-(1-exp(res1S$ci.lb))*100, ci_up=(exp(res1S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="4", estimate=-(1-exp(res2S$b))*100, 
                             ci_low=-(1-exp(res2S$ci.lb))*100, ci_up=(exp(res2S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="6", estimate=-(1-exp(res3S$b))*100, 
                             ci_low=-(1-exp(res3S$ci.lb))*100, ci_up=-(1-exp(res3S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="8", estimate=-(1-exp(res4S$b))*100, 
                             ci_low=-(1-exp(res4S$ci.lb))*100, ci_up=-(1-exp(res4S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="10", estimate=-(1-exp(res5S$b))*100, 
                             ci_low=-(1-exp(res5S$ci.lb))*100, ci_up=-(1-exp(res5S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="12", estimate=-(1-exp(res6S$b))*100, 
                             ci_low=-(1-exp(res6S$ci.lb))*100, ci_up=-(1-exp(res6S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="14", estimate=-(1-exp(res7S$b))*100, 
                             ci_low=-(1-exp(res7S$ci.lb))*100, ci_up=(exp(res7S$ci.ub)-1)*100,#HERE
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="16", estimate=-(1-exp(res8S$b))*100, 
                             ci_low=-(1-exp(res8S$ci.lb))*100, ci_up=(exp(res8S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="18", estimate=-(1-exp(res9S$b))*100, 
                             ci_low=-(1-exp(res9S$ci.lb))*100, ci_up=(exp(res9S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="20", estimate=-(1-exp(res10S$b))*100, 
                             ci_low=-(1-exp(res10S$ci.lb))*100, ci_up=(exp(res10S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="22", estimate=-(1-exp(res11S$b))*100, 
                             ci_low=-(1-exp(res11S$ci.lb))*100, ci_up=-(1-exp(res11S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="24", estimate=-(1-exp(res12S$b))*100, 
                             ci_low=-(1-exp(res12S$ci.lb))*100, ci_up=(exp(res12S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="26", estimate=-(1-exp(res13S$b))*100, 
                             ci_low=-(1-exp(res13S$ci.lb))*100, ci_up=(exp(res13S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="28", estimate=-(1-exp(res14S$b))*100, 
                             ci_low=-(1-exp(res14S$ci.lb))*100, ci_up=(exp(res14S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="30", estimate=-(1-exp(res15S$b))*100, 
                             ci_low=-(1-exp(res15S$ci.lb))*100, ci_up=(exp(res15S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="32", estimate=-(1-exp(res16S$b))*100, 
                             ci_low=-(1-exp(res16S$ci.lb))*100, ci_up=(exp(res16S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="34", estimate=-(1-exp(res17S$b))*100, 
                             ci_low=-(1-exp(res17S$ci.lb))*100, ci_up=-(1-exp(res17S$ci.ub))*100,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="36", estimate=-(1-exp(res18S$b))*100, 
                             ci_low=-(1-exp(res18S$ci.lb))*100, ci_up=(exp(res18S$ci.ub)-1)*100,
                             row.names=FALSE, stringsAsFactors=TRUE))
data_resS

data_res2S <- rbind(data.frame(group="2", estimate=res1S$b, 
                              ci_low=res1S$ci.lb, ci_up=res1S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="4", estimate=res2S$b, 
                              ci_low=res2S$ci.lb, ci_up=res2S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="6", estimate=res3S$b, 
                              ci_low=res3S$ci.lb, ci_up=res3S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="8", estimate=res4S$b, 
                              ci_low=res4S$ci.lb, ci_up=res4S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="10", estimate=res5S$b,
                              ci_low=res5S$ci.lb, ci_up=res5S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="12", estimate=res6S$b, 
                              ci_low=res6S$ci.lb, ci_up=res6S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="14", estimate=res7S$b, 
                              ci_low=res7S$ci.lb, ci_up=res7S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="16", estimate=res8S$b,
                              ci_low=res8S$ci.lb,ci_up=res8S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="18", estimate=res9S$b, 
                              ci_low=res9S$ci.lb, ci_up=res9S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="20", estimate=res10S$b,
                              ci_low=res10S$ci.lb,  ci_up=res10S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="22", estimate=res11S$b, 
                              ci_low=res11S$ci.lb, ci_up=res11S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="24", estimate=res12S$b, 
                              ci_low=res12S$ci.lb, ci_up=res12S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="26", estimate=res13S$b, 
                              ci_low=res13S$ci.lb, ci_up=res13S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="28", estimate=res14S$b, 
                              ci_low=res14S$ci.lb,ci_up=res14S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="30", estimate=res15S$b,
                              ci_low=res15S$ci.lb, ci_up=res15S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="32", estimate=res16S$b, 
                              ci_low=res16S$ci.lb, ci_up= res16S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="34", estimate=res17S$b,
                              ci_low=res17S$ci.lb, ci_up=res17S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="36", estimate=res18S$b, 
                              ci_low=res18S$ci.lb, ci_up=res18S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE))
data_res2S

data_res2aS <- rbind(data.frame(group="2", estimate=res1S$b, 
                                ci_low=res1S$ci.lb, ci_up=res1S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE),
                     data.frame(group="4", estimate=res2S$b, 
                                ci_low=res2S$ci.lb, ci_up=res2S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE),
                     data.frame(group="6", estimate=res3S$b, 
                                ci_low=res3S$ci.lb, ci_up=res3S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE),
                     data.frame(group="8", estimate=res4S$b, 
                                ci_low=res4S$ci.lb, ci_up=res4S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE),
                     data.frame(group="10", estimate=res5S$b,
                                ci_low=res5S$ci.lb, ci_up=res5S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE),
                     data.frame(group="12", estimate=res6S$b, 
                                ci_low=res6S$ci.lb, ci_up=res6S$ci.ub,
                                row.names=FALSE, stringsAsFactors=TRUE))
data_res2aS

####Figure 6 RESILIENCE data wrangling ####

####Total Litterfall####

##1 to 36 months####

summary(res_all_tot2)

months<-factor(tot_lit_all$TSD_months)
months

mypreds_tot<-predict(res_all_tot2,addx=TRUE)
tot_lit_all$pred<-mypreds_tot$pred
tot_lit_all$se<-mypreds_tot$se 

head(tot_lit_all)

Est_res <- cbind(data.frame(Estimate=mypreds_tot$pred,se=mypreds_tot$se,Months=factor(tot_lit_all$TSD_months)))
str(Est_res)
Est_res$Months<-factor(Est_res$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res$Months)

#Est_res <- cbind(data.frame(Estimate=res_all_tot2$b,se=res_all_tot2$se,ci_low=res_all_tot2$ci.lb,ci_hi=res_all_tot2$ci.ub,Months=levels(months)))
#Est_res$Months<-factor(Est_res$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                 #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual 1 to 36 months

Fig6_res <- ggplot(Est_res, aes(y=Estimate, x=Months))
Fig6_res_annual<-Fig6_res+geom_line(aes(group=1),alpha=0.8)+geom_ribbon(aes(ymin=Estimate-(1.96*se),ymax=Estimate+(1.96*se),group=1),fill="blue",alpha=0.1,linetype=2)
Fig6_res_annual

#Subannual 1 to 36 months

monthsS<-factor(tot_lit_allS$TSD_months)
monthsS

mypreds_totS<-predict(res_all_totS2,addx=TRUE)
tot_lit_allS$pred<-mypreds_totS$pred
tot_lit_allS$se<-mypreds_totS$se 

Est_resS <- cbind(data.frame(Estimate=mypreds_totS$pred,se=mypreds_totS$se,Months=factor(tot_lit_allS$TSD_months)))
str(Est_resS)
Est_resS$Months<-factor(Est_resS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_resS$Months)

#Est_resS <- cbind(data.frame(Estimate=res_all_totS2$b,se=res_all_totS2$se,ci_low=res_all_totS2$ci.lb,ci_hi=res_all_totS2$ci.ub,Months=levels(monthsS)))
#Est_resS$Months<-factor(Est_resS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual 1 to 36 months

Fig6_resS <- ggplot(Est_resS, aes(y=Estimate, x=Months))
Fig6_res_S<-Fig6_resS+geom_line(aes(group=1),alpha=0.8)+geom_ribbon(aes(ymin=Estimate-(1.96*se),ymax=Estimate+(1.96*se),group=1),fill="blue",alpha=0.1,linetype=2)
Fig6_res_S

Fig6_res_annual+Fig6_res_S+plot_layout(ncol=1)

#Annual red

monthsSS<-factor(tot_lit_allSS$TSD_months)
monthsSS

mypreds_totSS<-predict(res_all_totSS2,addx=TRUE)
tot_lit_allSS$pred<-mypreds_totSS$pred
tot_lit_allSS$se<-mypreds_totSS$se 

Est_resSS <- cbind(data.frame(Estimate=mypreds_totSS$pred,se=mypreds_totSS$se,Months=factor(tot_lit_allSS$TSD_months)))
str(Est_resS)
Est_resSS$Months<-factor(Est_resSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                    "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_resSS$Months)

#Est_resSS <- cbind(data.frame(Estimate=res_all_totSS2$b,se=res_all_totSS2$se,ci_low=res_all_totSS2$ci.lb,ci_hi=res_all_totSS2$ci.ub,Months=levels(monthsSS)))
#Est_resSS$Months<-factor(Est_resSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                    #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual, Subannual, Annual*

Res_all<-rbind(data.frame(Group="Annual (all)",ES=Est_res$Estimate,SE=Est_res$se,TSD=Est_res$Months),
                      data.frame(Group="Subannual (red.)",ES=Est_resS$Estimate,SE=Est_resS$se,TSD=Est_resS$Months),
                      data.frame(Group="Annual (red.)",ES=Est_resSS$Estimate,SE=Est_resSS$se,TSD=Est_resSS$Months))

str(Res_all)
levels(Res_all$TSD)

##Pantropical resilience only####

Est_res_tot <- rbind(data.frame(Group="Annual (all)",Estimate=res_all_tot$b,se=res_all_tot$se,ci_low=res_all_tot$ci.lb,ci_hi=res_all_tot$ci.ub),
                     data.frame(Group="Subannual (red.)",Estimate=res_all_totS$b,se=res_all_totS$se,ci_low=res_all_totS$ci.lb,ci_hi=res_all_totS$ci.ub),
                     data.frame(Group="Annual (red.)",Estimate=res_all_totSS$b,se=res_all_totSS$se,ci_low=res_all_totSS$ci.lb,ci_hi=res_all_totSS$ci.ub))
str(Est_res_tot)

Est_res_lf <- rbind(data.frame(Group="Annual (all)",Estimate=res_all_leaf$b,se=res_all_leaf$se,ci_low=res_all_leaf$ci.lb,ci_hi=res_all_leaf$ci.ub),
                     data.frame(Group="Subannual (red.)",Estimate=res_all_leafS$b,se=res_all_leafS$se,ci_low=res_all_leafS$ci.lb,ci_hi=res_all_leafS$ci.ub),
                     data.frame(Group="Annual (red.)",Estimate=res_all_leafSS$b,se=res_all_leafSS$se,ci_low=res_all_leafSS$ci.lb,ci_hi=res_all_leafSS$ci.ub))
str(Est_res_lf)

res_all_wood$b
Est_res_w <- rbind(data.frame(Group="Annual (all)",Estimate=res_all_wood$b,se=res_all_wood$se,ci_low=res_all_wood$ci.lb,ci_hi=res_all_wood$ci.ub),
                    data.frame(Group="Subannual (red.)",Estimate=res_all_woodS$b,se=res_all_woodS$se,ci_low=res_all_woodS$ci.lb,ci_hi=res_all_woodS$ci.ub),
                    data.frame(Group="Annual (red.)",Estimate=res_all_woodSS$b,se=res_all_woodSS$se,ci_low=res_all_woodSS$ci.lb,ci_hi=res_all_woodSS$ci.ub))
str(Est_res_w)

Est_res_ff <- rbind(data.frame(Group="Annual (all)",Estimate=res_all_ffs$b,se=res_all_ffs$se,ci_low=res_all_ffs$ci.lb,ci_hi=res_all_ffs$ci.ub),
                   data.frame(Group="Subannual (red.)",Estimate=res_all_ffsS$b,se=res_all_ffsS$se,ci_low=res_all_ffsS$ci.lb,ci_hi=res_all_ffsS$ci.ub),
                   data.frame(Group="Annual (red.)",Estimate=res_all_ffsSS$b,se=res_all_ffsSS$se,ci_low=res_all_ffsSS$ci.lb,ci_hi=res_all_ffsSS$ci.ub))
str(Est_res_ff)

##Mass New Figures Resilience####

names(tot_lit_all)

pobs_tot_lit_all<- tot_lit_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_tot_lit_all

pobs_tot_lit_allS<- tot_lit_allS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Subnnual-red")
pobs_tot_lit_allS

pobs_tot_lit_allSS<- tot_lit_allSS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-red")
pobs_tot_lit_allSS

Res_all_k<-rbind(data.frame(Group="Annual (all)", TSD=pobs_tot_lit_all$TSD_months,n=pobs_tot_lit_all$counts),
                 data.frame(Group="Subannual (red.)", TSD=pobs_tot_lit_allS$TSD_months,n=pobs_tot_lit_allS$counts),
                 data.frame(Group="Annual (red.)", TSD=pobs_tot_lit_allSS$TSD_months,n=pobs_tot_lit_allSS$counts))
str(Res_all_k)

New_Fig6a<-ggplot(Res_all_k, aes(x=factor(TSD), y=n, group=Group,color=Group,shape=Group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1.2)+labs(x = "", y = "Number of observations")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 5.5, y = 26, fontface="bold",label = "a Total litterfall mass", size=8,colour="black")

New_Fig6a

#Total litterfall pantropical resilience 36 months

#Predictions

summary(res_all_tot2)

ggplot(data=tot_lit_all,aes(x=TSD_months,y=pred,group=factor(TSD_months))) +
  geom_line()+geom_point()+
  theme_bw()

Fig6_res_full <- ggplot(Res_all, aes(y=ES, x=TSD,group=Group))
Fig6_res_full<-Fig6_res_full+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig6_res_full<-Fig6_res_full+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=3,size=0.2)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+ scale_fill_manual(values=c("#141212","#F9EBEB","#F9EBEB"))
Fig6_res_full<-Fig6_res_full+theme_pubr()+geom_segment(aes(x=1, y=0, xend=36, yend=0), lty=2, color = "magenta", cex=1.4)+
  geom_segment(aes(x=1, y=res_all_tot$b, xend=36, yend=res_all_tot$b), lty=2, color = "#141212", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_totS$b, xend=36, yend=res_all_totS$b), lty=2, color = "#5E3FBA", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_totSS$b, xend=36, yend=res_all_totSS$b), lty=2, color = "#A81C38", cex=0.3)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=22),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="top")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
 annotate("text", x = 5.8, y = 1, fontface="bold",label = "a Total mass flux", size=8,colour="black")+labs(x="")
Fig6_res_full

Fig_tot_res<-Fig6_res_full + annotation_custom(ggplotGrob(Fig_res_tot), xmin = 25.2, xmax = 36.2, 
                                               ymin = -0.45, ymax = -1.48)
Fig_tot_res

Fig_tot_resb<-Fig6_res_full + annotation_custom(grob = res_tot_grob, xmin = 31, xmax = 36.5, 
                                               ymin = -0.98, ymax = 0.02)
Fig_tot_resb

library(patchwork)

New_Fig6_final<-New_Fig6a+ Fig6_res_full + plot_layout(ncol=1,heights=c(0.5,0.8))
New_Fig6_final

ggsave(filename = "New_Fig6_totlit_final.png",
       plot = New_Fig6_final, width = 19, height = 14, units = 'cm',
       scale = 2, dpi = 600)

# Create a transparent theme object
transparent_theme <- theme(
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_blank(), 
  axis.text.y = element_blank(),
  axis.ticks = element_blank(),
  panel.grid = element_blank(),
  axis.line = element_blank(),
  panel.background = element_rect(fill = "transparent",colour = NA),
  plot.background = element_rect(fill = "transparent",colour = NA))

Fig_res_tot<-ggplot(Est_res_tot, aes(x=factor(Group),y=Estimate,ymax=Estimate+(1.96*se),ymin=Estimate-(1.96*se), col=Group))+scale_y_continuous(breaks=c(-1,-0.5,0))+
  geom_pointrange(mapping=aes(shape=Group),size=1, stroke=1.2,position=position_dodge(width=c(0.5,0.5,0.5)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+
  #theme_bw()+
  transparent_theme +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_text(size=14),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
  #annotate("text", x = 1.28, y = 0.02, fontface="bold",label = "a Total litterfall", size=6,colour="black")

Fig_res_tot
res_tot_grob = ggplotGrob(Fig_res_tot)


###Leaf, Wood, Reproductive fractions

mypreds_leaf<-predict(res_all_leaf2,addx=TRUE)
leaf_all$pred<-mypreds_leaf$pred
leaf_all$se<-mypreds_leaf$se 

Est_res_leaf <- cbind(data.frame(Estimate=mypreds_leaf$pred,se=mypreds_leaf$se,Months=factor(leaf_all$TSD_months)))
str(Est_res_leaf)
Est_res_leaf$Months<-factor(Est_res_leaf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_leaf$Months)

#Est_res_leaf <- cbind(data.frame(Estimate=res_all_leaf2$b,se=res_all_leaf2$se,ci_low=res_all_leaf2$ci.lb,ci_hi=res_all_leaf2$ci.ub,Months=levels(months_leaf)))
#Est_res_leaf$Months<-factor(Est_res_leaf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

mypreds_leafS<-predict(res_all_leafS2,addx=TRUE)
leaf_allS$pred<-mypreds_leafS$pred
leaf_allS$se<-mypreds_leafS$se

Est_res_leafS <- cbind(data.frame(Estimate=mypreds_leafS$pred,se=mypreds_leafS$se,Months=factor(leaf_allS$TSD_months)))
str(Est_res_leafS)
Est_res_leafS$Months<-factor(Est_res_leafS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_leafS$Months)

#Est_res_leafS <- cbind(data.frame(Estimate=res_all_leafS2$b,se=res_all_leafS2$se,ci_low=res_all_leafS2$ci.lb,ci_hi=res_all_leafS2$ci.ub,Months=levels(monthsS_leaf)))
#Est_res_leafS$Months<-factor(Est_res_leafS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

mypreds_leafSS<-predict(res_all_leafSS2,addx=TRUE)
leaf_allSS$pred<-mypreds_leafSS$pred
leaf_allSS$se<-mypreds_leafSS$se

Est_res_leafSS <- cbind(data.frame(Estimate=mypreds_leafSS$pred,se=mypreds_leafSS$se,Months=factor(leaf_allSS$TSD_months)))
str(Est_res_leafSS)
Est_res_leafSS$Months<-factor(Est_res_leafSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                              "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_leafSS$Months)

#Est_res_leafSS <- cbind(data.frame(Estimate=res_all_leafSS2$b,se=res_all_leafSS2$se,ci_low=res_all_leafSS2$ci.lb,ci_hi=res_all_leafSS2$ci.ub,Months=levels(monthsSS_leaf)))
#Est_res_leafSS$Months<-factor(Est_res_leafSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                      #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual, Subannual, Annual*

Res_all_leaf<-rbind(data.frame(Group="Annual (all)",ES=Est_res_leaf$Estimate,SE=Est_res_leaf$se,TSD=Est_res_leaf$Months),
               data.frame(Group="Subannual (red.)",ES=Est_res_leafS$Estimate,SE=Est_res_leafS$se,TSD=Est_res_leafS$Months),
               data.frame(Group="Annual (red.)",ES=Est_res_leafSS$Estimate,SE=Est_res_leafSS$se,TSD=Est_res_leafSS$Months))

#Observations
pobs_leaf_all<- leaf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_leaf_all

pobs_leaf_allS<- leaf_allS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Subnnual-red")
pobs_leaf_allS

pobs_leaf_allSS<- leaf_allSS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-red")
pobs_leaf_allSS

Res_leaf_k<-rbind(data.frame(Group="Annual (all)", TSD=pobs_leaf_all$TSD_months,n=pobs_leaf_all$counts),
                 data.frame(Group="Subannual (red.)", TSD=pobs_leaf_allS$TSD_months,n=pobs_leaf_allS$counts),
                 data.frame(Group="Annual (red.)", TSD=pobs_leaf_allSS$TSD_months,n=pobs_leaf_allSS$counts))
str(Res_leaf_k)

New_Fig6_leaf_mass<-ggplot(Res_leaf_k, aes(x=factor(TSD), y=n, color=Group, group=Group, shape=Group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "", y = "Number of observations")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+scale_y_continuous(breaks=c(0,5,10,15,20))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 4.5, y = 17, fontface="bold",label = "b Leaf fall mass", size=8,colour="black")

New_Fig6_leaf_mass

Fig6d_res_leaf <- ggplot(Res_all_leaf, aes(y=ES, x=TSD,group=Group))
Fig6d_res_leaf <-Fig6d_res_leaf+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)+scale_y_continuous(breaks=c(-2,-1.5,-1,-0.5,0,0.5,1,1.5,2))
Fig6d_res_leaf <-Fig6d_res_leaf+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=3,size=0.2)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+ scale_fill_manual(values=c("#141212","#F9EBEB","#F9EBEB"))
Fig6d_res_leaf <-Fig6d_res_leaf+theme_pubr()+geom_segment(aes(x=1, y=0, xend=36, yend=0), lty=2, color = "magenta", cex=1.4)+
  geom_segment(aes(x=1, y=res_all_leaf$b, xend=36, yend=res_all_leaf$b), lty=2, color = "#141212", cex=0.3,alpha=0.1)+
  geom_segment(aes(x=1, y=res_all_leafS$b, xend=36, yend=res_all_leafS$b), lty=2, color = "#5E3FBA", cex=0.3,alpha=0.1)+
  geom_segment(aes(x=1, y=res_all_leafSS$b, xend=36, yend=res_all_leafSS$b), lty=2, color = "#A81C38", cex=0.3,alpha=0.1)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 5.2, y = 1, fontface="bold",label = "b Leaf mass flux", size=8,colour="black")+labs(x = "")
Fig6d_res_leaf 

New_Fig6_leaf_final<-New_Fig6c+ Fig6d_res_leaf  + plot_layout(ncol=1,heights=c(0.5,0.8))
New_Fig6_leaf_final

Fig_leaf_resb<-Fig6d_res_leaf + annotation_custom(ggplotGrob(Fig_res_leaf), xmin = 31, xmax = 36.5, 
                                                ymin = -1.08, ymax = 0.06)
Fig_leaf_resb

ggsave(filename = "New_Fig6_leaf_final.png",
       plot = New_Fig6_leaf_final, width = 19, height = 14, units = 'cm',
       scale = 2, dpi = 600)

Fig_res_leaf<-ggplot(Est_res_lf, aes(x=factor(Group),y=Estimate,ymax=Estimate+(1.96*se),ymin=Estimate-(1.96*se), col=Group))+scale_y_continuous(breaks=c(-1,-0.5,0))+
  geom_pointrange(mapping=aes(shape=Group),size=1.2, stroke=1,position=position_dodge(width=c(0.5,0.5,0.5)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.02, fontface="bold",label = "a Total litterfall", size=6,colour="black")

Fig_res_leaf

##Wood####

mypreds_wood<-predict(res_all_wood2,addx=TRUE)
wood_all$pred<-mypreds_wood$pred
wood_all$se<-mypreds_wood$se 

Est_res_wood <- cbind(data.frame(Estimate=mypreds_wood$pred,se=mypreds_wood$se,Months=factor(wood_all$TSD_months)))
str(Est_res_wood)
Est_res_wood$Months<-factor(Est_res_wood$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_wood$Months)

#Est_res_wood <- cbind(data.frame(Estimate=res_all_wood2$b,se=res_all_wood2$se,ci_low=res_all_wood2$ci.lb,ci_hi=res_all_wood2$ci.ub,Months=levels(months_wood)))
#Est_res_wood$Months<-factor(Est_res_wood$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                  #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Subannual 1 to 36 months

mypreds_woodS<-predict(res_all_woodS2,addx=TRUE)
wood_allS$pred<-mypreds_woodS$pred
wood_allS$se<-mypreds_woodS$se 

Est_res_woodS <- cbind(data.frame(Estimate=mypreds_woodS$pred,se=mypreds_woodS$se,Months=factor(wood_allS$TSD_months)))
str(Est_res_woodS)
Est_res_woodS$Months<-factor(Est_res_woodS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_woodS$Months)

#Est_res_woodS <- cbind(data.frame(Estimate=res_all_woodS2$b,se=res_all_woodS2$se,ci_low=res_all_woodS2$ci.lb,ci_hi=res_all_woodS2$ci.ub,Months=levels(monthsS_wood)))
#Est_res_woodS$Months<-factor(Est_res_woodS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                    #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual red

mypreds_woodSS<-predict(res_all_woodSS2,addx=TRUE)
wood_allSS$pred<-mypreds_woodSS$pred
wood_allSS$se<-mypreds_woodSS$se 

Est_res_woodSS <- cbind(data.frame(Estimate=mypreds_woodSS$pred,se=mypreds_woodSS$se,Months=factor(wood_allSS$TSD_months)))
str(Est_res_woodSS)
Est_res_woodSS$Months<-factor(Est_res_woodSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                              "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_woodSS$Months)

#Est_res_woodSS <- cbind(data.frame(Estimate=res_all_woodSS2$b,se=res_all_woodSS2$se,ci_low=res_all_woodSS2$ci.lb,ci_hi=res_all_woodSS2$ci.ub,Months=levels(monthsSS_wood)))
#Est_res_woodSS$Months<-factor(Est_res_woodSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                      #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual, Subannual, Annual*

Res_wood<-rbind(data.frame(Group="Annual (all)",ES=Est_res_wood$Estimate,SE=Est_res_wood$se,TSD=Est_res_wood$Months),
               data.frame(Group="Subannual (red.)",ES=Est_res_woodS$Estimate,SE=Est_res_woodS$se,TSD=Est_res_woodS$Months),
               data.frame(Group="Annual (red.)",ES=Est_res_woodSS$Estimate,SE=Est_res_woodSS$se,TSD=Est_res_woodSS$Months))

Res_wood
str(Res_wood)
levels(Res_wood$TSD)

##03/01 wood Resilience####

names(wood_all)

pobs_wood_all<- wood_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_wood_all

pobs_wood_allS<- wood_allS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Subnnual-red")
pobs_wood_allS

pobs_wood_allSS<- wood_allSS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-red")
pobs_wood_allSS

Res_wood_k<-rbind(data.frame(Group="Annual (all)", TSD=pobs_wood_all$TSD_months,n=pobs_wood_all$counts),
                 data.frame(Group="Subannual (red.)", TSD=pobs_wood_allS$TSD_months,n=pobs_wood_allS$counts),
                 data.frame(Group="Annual (red.)", TSD=pobs_wood_allSS$TSD_months,n=pobs_wood_allSS$counts))
str(Res_wood_k)

New_Fig6_wood_mass<-ggplot(Res_wood_k, aes(x=factor(TSD), y=n, group=Group,color=Group,shape=Group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "", y = "Number of observations")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 4.6, y = 14, fontface="bold",label = "c Wood fall mass", size=8,colour="black")

New_Fig6_wood_mass

#total litterfall pantropical resilience 36 months
res_all_wood$b
Res_wood

Fig6_res_wood <- ggplot(Res_wood, aes(y=ES, x=TSD,group=Group))
Fig6_res_wood<-Fig6_res_wood+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)+scale_y_continuous(breaks=c(-2.5,-2,-1.5,-1,-0.5,0,0.5,1,1.5,2))
Fig6_res_wood<-Fig6_res_wood+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=3,size=0.2)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+ scale_fill_manual(values=c("#141212","#F9EBEB","#F9EBEB"))
Fig6_res_wood<-Fig6_res_wood+theme_pubr()+geom_segment(aes(x=1, y=0, xend=36, yend=0), lty=2, color = "magenta", cex=1.4)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  geom_segment(aes(x=1, y=res_all_wood$b, xend=36, yend=res_all_wood$b), lty=2, color = "#141212", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_woodS$b, xend=36, yend=res_all_woodS$b), lty=2, color = "#5E3FBA", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_woodSS$b, xend=36, yend=res_all_woodSS$b), lty=2, color = "#A81C38", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 5.8, y = 1.7, fontface="bold",label = "c Wood mass flux", size=8,colour="black")+labs(x = "")
Fig6_res_wood

library(patchwork)
New_Fig6wood_final<-New_Fig6_wood+ Fig6_res_wood + plot_layout(ncol=1,heights=c(0.5,0.8))
New_Fig6wood_final

Fig_wood_resb<-Fig6_res_wood + annotation_custom(ggplotGrob(Fig_res_w), xmin = 31, xmax = 36.5, 
                                                  ymin = -1.7, ymax = 0.15)
Fig_wood_resb

ggsave(filename = "New_Fig6_wood_final.png",
       plot = New_Fig6wood_final, width = 19, height = 14, units = 'cm',
       scale = 2, dpi = 600)

Fig_res_w<-ggplot(Est_res_w, aes(x=factor(Group),y=Estimate,ymax=Estimate+(1.96*se),ymin=Estimate-(1.96*se), col=Group))+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0))+
  geom_pointrange(mapping=aes(shape=Group),size=1, stroke=1.2,position=position_dodge(width=c(0.5,0.5,0.5)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.02, fontface="bold",label = "a Total litterfall", size=6,colour="black")

Fig_res_w

##FFS fall####

mypreds_ffs<-predict(res_all_ffs2,addx=TRUE)
ffs_all$pred<-mypreds_ffs$pred
ffs_all$se<-mypreds_ffs$se 

Est_res_ffs <- cbind(data.frame(Estimate=mypreds_ffs$pred,se=mypreds_ffs$se,Months=factor(ffs_all$TSD_months)))
str(Est_res_ffs)
Est_res_ffs$Months<-factor(Est_res_ffs$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_ffs$Months)

#Est_res_ffs <- cbind(data.frame(Estimate=res_all_ffs2$b,se=res_all_ffs2$se,ci_low=res_all_ffs2$ci.lb,ci_hi=res_all_ffs2$ci.ub,Months=levels(months_ffs)))
#Est_res_ffs$Months<-factor(Est_res_ffs$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Subannual 1 to 36 months

mypreds_ffsS<-predict(res_all_ffsS2,addx=TRUE)
ffs_allS$pred<-mypreds_ffsS$pred
ffs_allS$se<-mypreds_ffsS$se 

Est_res_ffsS <- cbind(data.frame(Estimate=mypreds_ffsS$pred,se=mypreds_ffsS$se,Months=factor(ffs_allS$TSD_months)))
str(Est_res_ffsS)
Est_res_ffsS$Months<-factor(Est_res_ffsS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_ffsS$Months)

#Est_res_ffsS <- cbind(data.frame(Estimate=res_all_ffsS2$b,se=res_all_ffsS2$se,ci_low=res_all_ffsS2$ci.lb,ci_hi=res_all_ffsS2$ci.ub,Months=levels(monthsS_ffs)))

#Est_res_ffsS$Months<-factor(Est_res_ffsS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                              #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual red

mypreds_ffsSS<-predict(res_all_ffsSS2,addx=TRUE)
ffs_allSS$pred<-mypreds_ffsSS$pred
ffs_allSS$se<-mypreds_ffsSS$se 

Est_res_ffsSS <- cbind(data.frame(Estimate=mypreds_ffsSS$pred,se=mypreds_ffsSS$se,Months=factor(ffs_allSS$TSD_months)))
str(Est_res_ffsSS)
Est_res_ffsSS$Months<-factor(Est_res_ffsSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                            "18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))
levels(Est_res_ffsSS$Months)

#Est_res_ffsSS <- cbind(data.frame(Estimate=res_all_ffsSS2$b,se=res_all_ffsSS2$se,ci_low=res_all_ffsSS2$ci.lb,ci_hi=res_all_ffsSS2$ci.ub,Months=levels(monthsSS_ffs)))
#str(Est_res_ffsSS)
#Est_res_ffsSS$Months<-factor(Est_res_ffsSS$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                                #"18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"))

#Annual, Subannual, Annual*

Res_ffs<-rbind(data.frame(Group="Annual (all)",ES=Est_res_ffs$Estimate,SE=Est_res_ffs$se,TSD=Est_res_ffs$Months),
                data.frame(Group="Subannual (red.)",ES=Est_res_ffsS$Estimate,SE=Est_res_ffsS$se,TSD=Est_res_ffsS$Months),
                data.frame(Group="Annual (red.)",ES=Est_res_ffsSS$Estimate,SE=Est_res_ffsSS$se,TSD=Est_res_ffsSS$Months))

Res_ffs
str(Res_ffs)
levels(Res_ffs$TSD)

names(ffs_all)

pobs_ffs_all<- ffs_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_ffs_all

pobs_ffs_allS<- ffs_allS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Subnnual-red")
pobs_ffs_allS

pobs_ffs_allSS<- ffs_allSS %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-red")
pobs_ffs_allSS

Res_ffs_k<-rbind(data.frame(Group="Annual (all)", TSD=pobs_ffs_all$TSD_months,n=pobs_ffs_all$counts),
                  data.frame(Group="Subannual (red.)", TSD=pobs_ffs_allS$TSD_months,n=pobs_ffs_allS$counts),
                  data.frame(Group="Annual (red.)", TSD=pobs_ffs_allSS$TSD_months,n=pobs_ffs_allSS$counts))
str(Res_ffs_k)

New_Fig6_ffs_mass<-ggplot(Res_ffs_k, aes(x=factor(TSD), y=n, group=Group,color=Group,shape=Group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "Time since disturbance (months)", y = "Number of observations")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 4.5, y = 10, fontface="bold",label = "d FFS fall mass", size=8,colour="black")

New_Fig6_ffs_mass

##Fig Sup Observations Fractions mass

SupFig_fractions_mass<-New_Fig6a+New_Fig6_leaf_mass+ New_Fig6_wood_mass + New_Fig6_ffs_mass+plot_layout(ncol=1,heights=c(1,1,1,1))
SupFig_fractions_mass

## Fig Sup Mass Flux Observations####

ggsave(filename = "Sup_Fig_Resil_Mass_Fractions.png",
       plot = SupFig_fractions_mass, width = 17, height = 24, units = 'cm',
       scale = 2, dpi = 600)

#total litterfall pantropical resilience 36 months
res_all_ffs$b

Fig6_res_ffs <- ggplot(Res_ffs, aes(y=ES, x=TSD,group=Group))
Fig6_res_ffs<-Fig6_res_ffs+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)+scale_y_continuous(breaks=c(-2.5,-2,-1.5,-1,-0.5,0,0.5,1,1.5,2))
Fig6_res_ffs<-Fig6_res_ffs+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=3,size=0.2)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+ scale_fill_manual(values=c("#141212","#F9EBEB","#F9EBEB"))
Fig6_res_ffs<-Fig6_res_ffs+theme_pubr()+geom_segment(aes(x=1, y=0, xend=36, yend=0), lty=2, color = "magenta", cex=1.4)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  geom_segment(aes(x=1, y=res_all_ffs$b, xend=36, yend=res_all_ffs$b), lty=2, color = "#141212", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_ffsS$b, xend=36, yend=res_all_ffsS$b), lty=2, color = "#5E3FBA", cex=0.3)+
  geom_segment(aes(x=1, y=res_all_ffsSS$b, xend=36, yend=res_all_ffsSS$b), lty=2, color = "#A81C38", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 5.8, y = 1.6, fontface="bold",label = "d FFS mass flux", size=8,colour="black")+labs(x = "Time since disturbance (months)")
Fig6_res_ffs

Fig_ffs_res<-Fig6_res_ffs + annotation_custom(ggplotGrob(Fig_res_ff), xmin = 25.2, xmax = 36.2, 
                                                ymin = -0.7, ymax = -2.6)
Fig_ffs_res

Fig_ffs_resb<-Fig6_res_ffs + annotation_custom(ggplotGrob(Fig_res_ff), xmin = 31, xmax = 36.5, 
                                                 ymin = -1.9, ymax = 0.1)
Fig_ffs_resb

library(patchwork)
New_Fig6ffs_final<-New_Fig6_ffs+ Fig6_res_ffs + plot_layout(ncol=1,heights=c(0.5,0.8))
New_Fig6ffs_final

ggsave(filename = "New_Fig6_ffs_final.png",
       plot = New_Fig6ffs_final, width = 19, height = 14, units = 'cm',
       scale = 2, dpi = 600)

Fig_res_ff<-ggplot(Est_res_ff, aes(x=factor(Group),y=Estimate,ymax=Estimate+(1.96*se),ymin=Estimate-(1.96*se), col=Group))+scale_y_continuous(breaks=c(-1.5,-1.0,-0.5,0))+
  geom_pointrange(mapping=aes(shape=Group),size=1, stroke=1.2,position=position_dodge(width=c(0.5,0.5,0.5)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#141212","#5E3FBA","#A81C38"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.02, fontface="bold",label = "a Total litterfall", size=6,colour="black")

Fig_res_ff

##New Figure6 All Fractions Mass Flux ####

#Res_Mass_Fractions_Grob<-Fig_tot_res+Fig_leaf_res+Fig_wood_res+Fig_ffs_res+ plot_layout(ncol=1,heights=c(1,1,1,1))
#Res_Mass_Fractions_Grob

Res_Mass_Fractions_Grob_b<-Fig_tot_resb+Fig_leaf_resb+Fig_wood_resb+Fig_ffs_resb+ plot_layout(ncol=1,heights=c(1,1,1,1))
Res_Mass_Fractions_Grob_b

ggsave(filename = "Res_Mass_Fractions_New_2.png",
       plot = Res_Mass_Fractions_Grob_b, width = 17, height = 26, units = 'cm',
       scale = 2, dpi = 600)

## P and N fluxes ####

##P flux####

#Annual 1 to 24 months

mypreds_lpf<-predict(res_all_lpf2,addx=TRUE)
lpf_all$pred<-mypreds_lpf$pred
lpf_all$se<-mypreds_lpf$se 

Est_res_lpf <- cbind(data.frame(Estimate=mypreds_lpf$pred,se=mypreds_lpf$se,Months=factor(lpf_all$TSD_months)))
str(Est_res_lpf)
Est_res_lpf$Months<-factor(Est_res_lpf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_lpf$Months)

mypreds_wpf<-predict(res_all_wpf2,addx=TRUE)
wpf_all$pred<-mypreds_wpf$pred
wpf_all$se<-mypreds_wpf$se 

Est_res_wpf <- cbind(data.frame(Estimate=mypreds_wpf$pred,se=mypreds_wpf$se,Months=factor(wpf_all$TSD_months)))
str(Est_res_wpf)
Est_res_wpf$Months<-factor(Est_res_wpf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_wpf$Months)

mypreds_ffspf<-predict(res_all_ffspf2,addx=TRUE)
ffspf_all$pred<-mypreds_ffspf$pred
ffspf_all$se<-mypreds_ffspf$se 

Est_res_ffspf <- cbind(data.frame(Estimate=mypreds_ffspf$pred,se=mypreds_ffspf$se,Months=factor(ffspf_all$TSD_months)))
str(Est_res_ffspf)
Est_res_ffspf$Months<-factor(Est_res_ffspf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_ffspf$Months)


Res_pf<-rbind(data.frame(Group="Total",ES=Est_res_tpf$Estimate,SE=Est_res_tpf$se,TSD=Est_res_tpf$Months),
              data.frame(Group="Leaf",ES=Est_res_lpf$Estimate,SE=Est_res_lpf$se,TSD=Est_res_lpf$Months),
              data.frame(Group="Wood",ES=Est_res_wpf$Estimate,SE=Est_res_wpf$se,TSD=Est_res_wpf$Months),
              data.frame(Group="FFS",ES=Est_res_ffspf$Estimate,SE=Est_res_ffspf$se,TSD=Est_res_ffspf$Months))
Res_pf

names(ffs_all)

pobs_tpf_all<- tpf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_tpf_all

pobs_lpf_all<- lpf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_lpf_all

pobs_wpf_all<- wpf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_wpf_all

pobs_ffspf_all<- ffspf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_ffspf_all

Res_pf_k<-rbind(data.frame(group="Total", TSD=pobs_tpf_all$TSD_months,n=pobs_tpf_all$counts),
                 data.frame(group="Leaf", TSD=pobs_lpf_all$TSD_months,n=pobs_lpf_all$counts),
                 data.frame(group="Wood", TSD=pobs_wpf_all$TSD_months,n=pobs_wpf_all$counts),
                data.frame(group="FFS", TSD=pobs_ffspf_all$TSD_months,n=pobs_ffspf_all$counts))
str(Res_pf_k)

SupFig_obs_pflux<-ggplot(Res_pf_k, aes(x=factor(TSD), y=n, col=group,shape=group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1.5)+labs(x = "", y = "Number of observations")+
  scale_shape_discrete(solid=F)+theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#167923","#167923","#167923","#167923"))+scale_y_continuous(breaks=c(0,5,10))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 2, y = 10, fontface="bold",label = "a P flux", size=8,colour="black")

SupFig_obs_pflux

#P flux all Fractions

Fig_res_pflux <- ggplot(Res_pf, aes(y=ES, x=TSD,group=Group))
Fig_res_pflux<-Fig_res_pflux+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_pflux<-Fig_res_pflux+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=3)+ scale_color_manual(values=c("#261703","#167923","#1C39A8","#EE8B06"))+ scale_fill_manual(values=c("#261703","#167923","#1C39A8","#EE8B06"))
Fig_res_pflux<-Fig_res_pflux+theme_pubr()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  geom_hline(aes(yintercept=res_all_tpf$b), lty=2, color = "#261703", cex=1.2)+
  geom_hline(aes(yintercept=res_all_lpf$b), lty=2, color = "#167923", cex=1.2)+
  geom_hline(aes(yintercept=res_all_wpf$b), lty=2, color = "#1C39A8", cex=1.2)+
  geom_hline(aes(yintercept=res_all_ffspf$b), lty=2, color = "#EE8B06", cex=1.2)+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="top")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 3.5, y = 3.5, fontface="bold",label = "a Litterfall P flux", size=8,colour="black")+labs(x = "Time since disturbance (months)", y = "")
Fig_res_pflux

###Nutrient flux by fraction####

Res_pf<-rbind(data.frame(Group="Total",ES=Est_res_tpf$Estimate,SE=Est_res_tpf$se,TSD=Est_res_tpf$Months),
              data.frame(Group="Leaf",ES=Est_res_lpf$Estimate,SE=Est_res_lpf$se,TSD=Est_res_lpf$Months),
              data.frame(Group="Wood",ES=Est_res_wpf$Estimate,SE=Est_res_wpf$se,TSD=Est_res_wpf$Months),
              data.frame(Group="FFS",ES=Est_res_ffspf$Estimate,SE=Est_res_ffspf$se,TSD=Est_res_ffspf$Months))
Res_pf

Res_total<-rbind(data.frame(Group="P flux",ES=Est_res_tpf$Estimate,SE=Est_res_tpf$se,TSD=Est_res_tpf$Months),
                 data.frame(Group="N flux",ES=Est_res_tnf$Estimate,SE=Est_res_tnf$se,TSD=Est_res_tnf$Months))
Res_total              
Res_leaf<-rbind(data.frame(Group="P flux",ES=Est_res_lpf$Estimate,SE=Est_res_lpf$se,TSD=Est_res_lpf$Months),
                data.frame(Group="N flux",ES=Est_res_lnf$Estimate,SE=Est_res_lnf$se,TSD=Est_res_lnf$Months))
Res_leaf
Res_woodf<-rbind(data.frame(Group="P flux",ES=Est_res_wpf$Estimate,SE=Est_res_wpf$se,TSD=Est_res_wpf$Months),
                data.frame(Group="N flux",ES=Est_res_wnf$Estimate,SE=Est_res_wnf$se,TSD=Est_res_wnf$Months))

Res_ffsf<-rbind(data.frame(Group="P flux",ES=Est_res_ffspf$Estimate,SE=Est_res_ffspf$se,TSD=Est_res_ffspf$Months),
               data.frame(Group="N flux",ES=Est_res_ffsnf$Estimate,SE=Est_res_ffsnf$se,TSD=Est_res_ffsnf$Months))
Res_ffsf

##N flux####

mypreds_tnf<-predict(res_all_tnf2,addx=TRUE)
tnf_all$pred<-mypreds_tnf$pred
tnf_all$se<-mypreds_tnf$se 

#Annual 1 to 24 months

Est_res_tnf <- cbind(data.frame(Estimate=mypreds_tnf$pred,se=mypreds_tnf$se,Months=factor(tnf_all$TSD_months)))
str(Est_res_tnf)
Est_res_tnf$Months<-factor(Est_res_tnf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_lnf$Months)

mypreds_lnf<-predict(res_all_lnf2,addx=TRUE)
lnf_all$pred<-mypreds_lnf$pred
lnf_all$se<-mypreds_lnf$se
Est_res_lnf <- cbind(data.frame(Estimate=mypreds_lnf$pred,se=mypreds_lnf$se,Months=factor(lnf_all$TSD_months)))
str(Est_res_lnf)
Est_res_lnf$Months<-factor(Est_res_lnf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_lpf$Months)

mypreds_wnf<-predict(res_all_wnf2,addx=TRUE)
wnf_all$pred<-mypreds_wnf$pred
wnf_all$se<-mypreds_wnf$se
Est_res_wnf <- cbind(data.frame(Estimate=mypreds_wnf$pred,se=mypreds_wnf$se,Months=factor(wnf_all$TSD_months)))
str(Est_res_wnf)
Est_res_wnf$Months<-factor(Est_res_wnf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_wnf$Months)

mypreds_ffsnf<-predict(res_all_ffsnf2,addx=TRUE)
ffsnf_all$pred<-mypreds_ffsnf$pred
ffsnf_all$se<-mypreds_ffsnf$se
Est_res_ffsnf <- cbind(data.frame(Estimate=mypreds_ffsnf$pred,se=mypreds_ffsnf$se,Months=factor(ffsnf_all$TSD_months)))
str(Est_res_ffsnf)
Est_res_ffsnf$Months<-factor(Est_res_ffsnf$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                              "18","19","20","21","22","23","24"))
levels(Est_res_ffsnf$Months)


Res_nf<-rbind(data.frame(Group="Total",ES=Est_res_tnf$Estimate,SE=Est_res_tnf$se,TSD=Est_res_tnf$Months),
              data.frame(Group="Leaf",ES=Est_res_lnf$Estimate,SE=Est_res_lnf$se,TSD=Est_res_lnf$Months),
              data.frame(Group="Wood",ES=Est_res_wnf$Estimate,SE=Est_res_wnf$se,TSD=Est_res_wnf$Months),
              data.frame(Group="FFS",ES=Est_res_ffsnf$Estimate,SE=Est_res_ffsnf$se,TSD=Est_res_ffsnf$Months))
Res_nf

##Fig Sup Observations N Flux Fractions

pobs_tnf_all<- tnf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_tnf_all

pobs_lnf_all<- lnf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_lnf_all

pobs_wnf_all<- wnf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_wnf_all

pobs_ffsnf_all<- ffsnf_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_ffsnf_all

Res_nf_k<-rbind(data.frame(group="Total", TSD=pobs_tnf_all$TSD_months,n=pobs_tnf_all$counts),
                data.frame(group="Leaf", TSD=pobs_lnf_all$TSD_months,n=pobs_lnf_all$counts),
                data.frame(group="Wood", TSD=pobs_wnf_all$TSD_months,n=pobs_wnf_all$counts),
                data.frame(group="FFS", TSD=pobs_ffsnf_all$TSD_months,n=pobs_ffsnf_all$counts))
str(Res_nf_k)

SupFig_obs_nflux<-ggplot(Res_nf_k, aes(x=factor(TSD), y=n, col=group,shape=group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1.5)+labs(x = "", y = "Number of observations")+
  scale_shape_discrete(solid=F)+theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#1C39A8","#1C39A8","#1C39A8","#1C39A8"))+scale_y_continuous(breaks=c(0,5,10))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 2, y = 10, fontface="bold",label = "b N flux", size=8,colour="black")

SupFig_obs_nflux

SupFig_fractions_nutrients<-SupFig_obs_pflux+SupFig_obs_nflux+plot_layout(ncol=1,heights=c(1,1))
SupFig_fractions_nutrients

ggsave(filename = "Sup_Fig_Resilience_Nutrient_Fractions.png",
       plot = SupFig_fractions_nutrients, width = 17, height = 20, units = 'cm',
       scale = 2, dpi = 600)

#N flux all Fractions

Fig_res_nflux <- ggplot(Res_nf, aes(y=ES, x=TSD,group=Group))
Fig_res_nflux<-Fig_res_nflux+geom_line(aes(group=Group,col=Group),alpha=0.9,size=2)
Fig_res_nflux<-Fig_res_nflux+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2)+ scale_color_manual(values=c("#261703","#167923","#1C39A8","#EE8B06"))+ scale_fill_manual(values=c("#261703","#167923","#1C39A8","#EE8B06"))
Fig_res_nflux<-Fig_res_nflux+theme_pubr()+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  geom_hline(aes(yintercept=res_all_tnf$b), lty=2, color = "#261703", cex=1.2)+
  geom_hline(aes(yintercept=res_all_lnf$b), lty=2, color = "#167923", cex=1.2)+
  geom_hline(aes(yintercept=res_all_wnf$b), lty=2, color = "#1C39A8", cex=1.2)+
  geom_hline(aes(yintercept=res_all_ffsnf$b), lty=2, color = "#EE8B06", cex=1.2)+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="top")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 3.5, y = 4, fontface="bold",label = "b Litterfall N flux", size=8,colour="black")+labs(x = "Time since disturbance (months)", y = "")
Fig_res_nflux

Nut_flux<-Fig_res_pflux+Fig_res_nflux+plot_layout(ncol=1,heights=c(1,1))
Nut_flux

library(patchwork)
New_Fig6ffs_final<-New_Fig6_ffs+ Fig6_res_ffs + plot_layout(ncol=1,heights=c(0.5,0.8))
New_Fig6ffs_final

ggsave(filename = "New_Fig6_ffs_final.png",
       plot = New_Fig6ffs_final, width = 19, height = 14, units = 'cm',
       scale = 2, dpi = 600)

New_Res_Fractions<-Fig6d_res_leaf+Fig6_res_wood+Fig6_res_ffs+ plot_layout(ncol=1,heights=c(1,1,1))
New_Res_Fractions

ggsave(filename = "New_Fig7_mass_fractions.png",
       plot = New_Res_Fractions, width = 17, height = 20, units = 'cm',
       scale = 2, dpi = 600)

##Nutrient concentrations####

##P concentration####

mypreds_lpc<-predict(res_all_lpc2,addx=TRUE)
lpc_all$pred<-mypreds_lpc$pred
lpc_all$se<-mypreds_lpc$se 

#Annual 1 to 24 months

Est_res_lpc <- cbind(data.frame(Estimate=mypreds_lpc$pred,se=mypreds_lpc$se,Months=factor(lpc_all$TSD_months)))
str(Est_res_lpc)
Est_res_lpc$Months<-factor(Est_res_lpc$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_lpc$Months)

mypreds_wpc<-predict(res_all_wpc,addx=TRUE)
wpc_all$pred<-mypreds_wpc$pred
wpc_all$se<-mypreds_wpc$se 

Est_res_wpc<-cbind(data.frame(Estimate=mypreds_wpc$pred,se=mypreds_wpc$se))
str(Est_res_wpc)

##N concentration####

mypreds_lnc<-predict(res_all_lnc2,addx=TRUE)
lnc_all$pred<-mypreds_lnc$pred
lnc_all$se<-mypreds_lnc$se

#Annual 1 to 24 months

Est_res_lnc <- cbind(data.frame(Estimate=mypreds_lnc$pred,se=mypreds_lnc$se,Months=factor(lnc_all$TSD_months)))
str(Est_res_lnc)
Est_res_lnc
Est_res_lnc$Months<-factor(Est_res_lnc$Months, levels = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17",
                                                          "18","19","20","21","22","23","24"))
levels(Est_res_lnc$Months)

mypreds_wnc<-predict(res_all_wnc,addx=TRUE)
wnc_all$pred<-mypreds_wnc$pred
wnc_all$se<-mypreds_wnc$se

Est_res_wnc <- data.frame(Estimate=mypreds_wnc$pred,se=mypreds_wnc$se)
str(Est_res_wnc)

Res_leafc<-rbind(data.frame(Group="P conc.",ES=Est_res_lpc$Estimate,SE=Est_res_lpc$se,CI_low=Est_res_lpc$ci_low,CI_high=Est_res_lpc$ci_hi,TSD=Est_res_lpc$Months),
                data.frame(Group="N conc.",ES=Est_res_lnc$Estimate,SE=Est_res_lnc$se,CI_low=Est_res_lnc$ci_low,CI_high=Est_res_lnc$ci_hi,TSD=Est_res_lnc$Months))
Res_leafc

data_impact_fracPN$var
Res_wlc<-rbind(data.frame(var="P conc.",Fraction="Wood",ES=res_all_wpc$b,SE=res_all_wpc$se,row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(var="N conc.",Fraction="Wood",ES=res_all_wnc$b,SE=res_all_wnc$se,row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,row.names=FALSE, stringsAsFactors=TRUE))
Res_wlc

Res_wc<-rbind(data.frame(var="P conc.",Fraction="Wood",ES=res_all_wpc$b,SE=res_all_wpc$se,row.names=FALSE, stringsAsFactors=TRUE),
               data.frame(var="N conc.",Fraction="Wood",ES=res_all_wnc$b,SE=res_all_wnc$se,row.names=FALSE, stringsAsFactors=TRUE))
               #data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
               #data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_wc

Res_lc<-rbind(data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,row.names=FALSE, stringsAsFactors=TRUE),
              data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,row.names=FALSE, stringsAsFactors=TRUE))
#data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_lc

##Fig Sup Observations N Concentration Fractions####

pobs_lnc_all<- lnc_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_lnc_all

pobs_lpc_all<- lpc_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_lpc_all

pobs_wnc_all<- wnc_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_wnc_all

pobs_wpc_all<- wpc_all %>% group_by(TSD_months) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop,Group="Annual-full")
pobs_wpc_all

Res_wlc_k<-rbind(data.frame(group="Leaf", var="P",TSD=pobs_lpc_all$TSD_months,n=pobs_lpc_all$counts),
                data.frame(group="Leaf", var="N",TSD=pobs_lnc_all$TSD_months,n=pobs_lnc_all$counts),
                data.frame(group="Wood", var="P",TSD=pobs_wpc_all$TSD_months,n=pobs_wpc_all$counts),
                data.frame(group="Wood", var="N",TSD=pobs_wnc_all$TSD_months,n=pobs_wnc_all$counts))
str(Res_wlc_k)

SupFig_obs_wlc<-ggplot(Res_wlc_k, aes(x=factor(TSD), y=n, color=var,group=var,shape=group)) +
  geom_linerange(aes(x = factor(TSD), ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1.5)+labs(x = "Time since disturbance (months)", y = "Number of observations")+
  scale_shape_discrete(solid=F)+theme_pubr()+theme(axis.title=element_text(size=22),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#167923","#1C39A8","#167923","#1C39A8"))+scale_y_continuous(breaks=c(0,2,4,6,8))+ #scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 4.3, y = 7, fontface="bold",label = "c N and P concentration", size=8,colour="black")

SupFig_obs_wlc

SupFig_fractions_nut_final<-SupFig_obs_pflux+SupFig_obs_nflux+SupFig_obs_wlc+plot_layout(ncol=1,heights=c(1,1,1))
SupFig_fractions_nut_final

ggsave(filename = "Nut_Res_Obs_Fractions_final.png",
       plot = SupFig_fractions_nut_final, width = 16, height = 22, units = 'cm',
       scale = 2, dpi = 600)

#Figure 7 Nutrient Flux by Fraction####

#Res_total, Res_leaf,Res_wood,Res_ffs

Est_res_tot_pnf <- rbind(data.frame(Group="Annual (all)",Estimate=res_all_tot$b,se=res_all_tot$se,ci_low=res_all_tot$ci.lb,ci_hi=res_all_tot$ci.ub),
                     data.frame(Group="Subannual (red.)",Estimate=res_all_totS$b,se=res_all_totS$se,ci_low=res_all_totS$ci.lb,ci_hi=res_all_totS$ci.ub),
                     data.frame(Group="Annual (red.)",Estimate=res_all_totSS$b,se=res_all_totSS$se,ci_low=res_all_totSS$ci.lb,ci_hi=res_all_totSS$ci.ub))
str(Est_res_tot)

Res_tot_pnf<-rbind(data.frame(var="P flux",Fraction="Total",ES=res_all_tpf$b,SE=res_all_tpf$se,row.names=FALSE, stringsAsFactors=TRUE),
              data.frame(var="N flux",Fraction="Total",ES=res_all_tnf$b,SE=res_all_tnf$se,row.names=FALSE, stringsAsFactors=TRUE))
#data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_tot_pnf

summary(res_all_lpf)
Res_leaf_pnf<-rbind(data.frame(var="P flux",Fraction="Leaf",ES=res_all_lpf$b,SE=res_all_lpf$se,row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(var="N flux",Fraction="Leaf",ES=res_all_lnf$b,SE=res_all_lnf$se,row.names=FALSE, stringsAsFactors=TRUE))
#data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_leaf_pnf

Res_wood_pnf<-rbind(data.frame(var="P flux",Fraction="Wood",ES=res_all_wpf$b,SE=res_all_wpf$se,row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(var="N flux",Fraction="Wood",ES=res_all_wnf$b,SE=res_all_wnf$se,row.names=FALSE, stringsAsFactors=TRUE))
#data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_wood_pnf

Res_ffs_pnf<-rbind(data.frame(var="P flux",Fraction="FFS",ES=res_all_ffspf$b,SE=res_all_ffspf$se,row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(var="N flux",Fraction="FFS",ES=res_all_ffsnf$b,SE=res_all_ffsnf$se,row.names=FALSE, stringsAsFactors=TRUE))
#data.frame(var="P conc.",Fraction="Leaf",ES=res_all_lpc$b,SE=res_all_lpc$se,CI_low=res_all_lpc$ci.lb,CI_high=res_all_lpc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(var="N conc.",Fraction="Leaf",ES=res_all_lnc$b,SE=res_all_lnc$se,CI_low=res_all_lnc$ci.lb,CI_high=res_all_lnc$ci.ub,row.names=FALSE, stringsAsFactors=TRUE))
Res_ffs_pnf

#Total P and N flux

Res_total

Fig_res_total <- ggplot(Res_total, aes(y=ES, x=TSD,group=Group))
Fig_res_total<-Fig_res_total+geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_total<-Fig_res_total+geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2, cex=0.2)+ scale_color_manual(values=c("#167923","#1C39A8"))+ scale_fill_manual(values=c("#167923","#1C39A8"))
Fig_res_total<-Fig_res_total+theme_pubr()+geom_segment(aes(x=1, y=0, xend=24, yend=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0,0.5,1))+
  geom_segment(aes(x = 1, y = res_all_tpf$b, xend = 24, yend = res_all_tpf$b), lty=2, color = "#167923", cex=0.3)+
  geom_segment(aes(x=1,y=res_all_tnf$b,xend=24,yend=res_all_tnf$b), lty=2, color = "#1C39A8", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="top")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 3.5, y = 1, fontface="bold",label = "a Total litterfall", size=8,colour="black")+labs(x = "")
Fig_res_total

Fig_res_totalb<-Fig_res_total + annotation_custom(ggplotGrob(Fig_res_pnf), xmin = 19, xmax =24.5, 
                                               ymin = -1.2, ymax = -0.02)
Fig_res_totalb

#mini plot with intercept-only pantropical resilience for Total P and N fluxes

Fig_res_pnf<-ggplot(Res_tot_pnf, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
  #annotate("text", x = 1.28, y = 0.18, fontface="bold",label = "b Wood fall", size=6,colour="black")
Fig_res_pnf

#Leaf P and N flux

Res_leaf
Fig_res_leaf <- ggplot(Res_leaf, aes(y=ES, x=TSD,group=Group))
Fig_res_leaf <-Fig_res_leaf +geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_leaf <-Fig_res_leaf +geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2,cex=0.2)+ scale_color_manual(values=c("#167923","#1C39A8"))+ scale_fill_manual(values=c("#167923","#1C39A8"))
Fig_res_leaf <-Fig_res_leaf +theme_pubr()+geom_segment(aes(x=1, y=0, xend=24, yend=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0,0.5,1,1.5))+
  geom_segment(aes(x = 1, y = res_all_lpf$b, xend = 24, yend = res_all_lpf$b), lty=2, color = "#167923", cex=0.3)+
  geom_segment(aes(x=1,y=res_all_lnf$b,xend=24,yend=res_all_lnf$b), lty=2, color = "#1C39A8", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 2.5, y = 1.5, fontface="bold",label = "b Leaf fall", size=8,colour="black")+labs(x = "")
Fig_res_leaf 

Fig_res_leafb<-Fig_res_leaf + annotation_custom(ggplotGrob(Fig_res_leaf_pnf), xmin = 19, xmax =24.5, 
                                                  ymin = -1.17, ymax = 1.055)
Fig_res_leafb

#mini plot with intercept-only pantropical resilience for Total P and N fluxes

Fig_res_leaf_pnf<-ggplot(Res_leaf_pnf, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.18, fontface="bold",label = "b Wood fall", size=6,colour="black")
Fig_res_leaf_pnf

Res_wood
Fig_res_wood <- ggplot(Res_woodf, aes(y=ES, x=TSD,group=Group))
Fig_res_wood <-Fig_res_wood  +geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_wood <-Fig_res_wood  +geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2,cex=0.2)+ scale_color_manual(values=c("#167923","#1C39A8"))+ scale_fill_manual(values=c("#167923","#1C39A8"))
Fig_res_wood <-Fig_res_wood  +theme_pubr()+geom_segment(aes(x=1, y=0, xend=24, yend=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  geom_segment(aes(x = 1, y = res_all_wpf$b, xend = 24, yend = res_all_wpf$b), lty=2, color = "#167923", cex=0.3)+
  geom_segment(aes(x=1,y=res_all_wnf$b,xend=24,yend=res_all_wnf$b), lty=2, color = "#1C39A8", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+scale_y_continuous(breaks=c(-3,-2.5,-2,-1.5,-1,-0.5,0,0.5,1,1.5))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 3, y = 1.5, fontface="bold",label = "c Wood fall", size=8,colour="black")+labs(x = "")
Fig_res_wood 

Fig_res_woodb<-Fig_res_wood + annotation_custom(ggplotGrob(Fig_res_wood_pnf), xmin = 19, xmax =24.5, 
                                                ymin = -1.86, ymax = -0.05)
Fig_res_woodb

#mini plot with intercept-only pantropical resilience for Total P and N fluxes

Fig_res_wood_pnf<-ggplot(Res_wood_pnf, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.18, fontface="bold",label = "b Wood fall", size=6,colour="black")
Fig_res_wood_pnf

Res_Nut_Fractions<-Fig_res_total+Fig_res_leaf + Fig_res_wood +plot_layout(ncol=1,heights=c(1,1,1))
Res_Nut_Fractions

Res_ffsf
Fig_res_ffs <- ggplot(Res_ffsf, aes(y=ES, x=TSD,group=Group))
Fig_res_ffs <-Fig_res_ffs  +geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_ffs<-Fig_res_ffs  +geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2,cex=0.2)+ scale_color_manual(values=c("#167923","#1C39A8"))+ scale_fill_manual(values=c("#167923","#1C39A8"))
Fig_res_ffs <-Fig_res_ffs  +theme_pubr()+geom_segment(aes(x=1, y=0, xend=24, yend=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24, 27, 30, 33,36))+
  #geom_hline(aes(yintercept=res_all_ffspf$b), lty=2, color = "#167923", cex=1.2)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+scale_y_continuous(breaks=c(-5,-4.5,-4,-3.5,-3,-2.5,-2,-1.5,-1,-0.5,0,0.5,1))+
  geom_segment(aes(x = 1, y = res_all_ffspf$b, xend = 24, yend = res_all_ffspf$b), lty=2, color = "#167923", cex=0.3)+
  geom_segment(aes(x=1,y=res_all_ffsnf$b,xend=24,yend=res_all_ffsnf$b), lty=2, color = "#1C39A8", cex=0.3)+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=18),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 2.5, y = 1, fontface="bold",label = "d FFS fall", size=8,colour="black")+labs(x = "")
Fig_res_ffs 

Fig_res_ffsb <-Fig_res_ffs + annotation_custom(ggplotGrob(Fig_res_ffs_pnf), xmin = 19, xmax =24.5, 
                                                ymin = -3.1, ymax = 0.3)
Fig_res_ffsb

#mini plot with intercept-only pantropical resilience for Total P and N fluxes

Fig_res_ffs_pnf<-ggplot(Res_ffs_pnf, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.18, fontface="bold",label = "b Wood fall", size=6,colour="black")
Fig_res_ffs_pnf

Res_Nut_Fractionsb<-Fig_res_totalb+Fig_res_leafb + Fig_res_woodb +Fig_res_ffsb+plot_layout(ncol=1,heights=c(1,1,1,1))
Res_Nut_Fractionsb

ggsave(filename = "Res_Nut_Flux_Fractions.png",
       plot = Res_Nut_Fractionsb, width = 16, height = 24, units = 'cm',
       scale = 2, dpi = 600)

#N and P concentrations

Fig_res_leafc <- ggplot(Res_leafc, aes(y=ES, x=TSD,group=Group))
Fig_res_leafc <-Fig_res_leafc +geom_line(aes(group=Group,col=Group),alpha=0.9,size=1)
Fig_res_leafc <-Fig_res_leafc +geom_ribbon(aes(ymin=ES-(1.96*SE),ymax=ES+(1.96*SE),col=Group,fill=Group),alpha=0.1,linetype=2,cex=0.3)+ scale_color_manual(values=c("#167923","#1C39A8"))+ scale_fill_manual(values=c("#167923","#1C39A8"))
Fig_res_leafc <-Fig_res_leafc +theme_pubr()+geom_segment(aes(x=1, y=0, xend=24, yend=0), lty=2, color = "magenta", cex=1.2)+
  scale_x_discrete(breaks = c(1, 3, 6, 9,12, 15, 18,21, 24))+
  geom_segment(aes(x = 1, y = res_all_lpc$b, xend = 24, yend = res_all_lpc$b), lty=2, color = "#167923", cex=0.3)+scale_y_continuous(breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0))+
  geom_segment(aes(x=1,y=res_all_lnc$b,xend=24,yend=res_all_lnc$b), lty=2, color = "#1C39A8", cex=0.3)+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[0]^-1)))+
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1,size=22),
        axis.text=element_text(size=20),legend.text =  element_text(size=24),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  annotate("text", x = 4, y = 0.8, fontface="bold",label = "e Leaf concentration", size=8,colour="black")+labs(x = "Time since disturbance (months)")
Fig_res_leafc 

Fig_leaf_npc<-Fig_res_leafc + annotation_custom(ggplotGrob(Fig_res_leaf_npc), xmin = 21, xmax = 24.5, 
                    ymin = -0.02, ymax = 0.58)
Fig_NP_conc<-Fig_leaf_npc+ annotation_custom(ggplotGrob(Fig_res_wc), xmin = 0.5, xmax = 12, 
                                ymin = -1.3, ymax = -0.2)
Fig_NP_conc

Resl_Nut_Fractions_final<-Fig_res_totalb+Fig_res_leafb + Fig_res_woodb +Fig_res_ffsb+Fig_NP_conc+plot_layout(ncol=1,heights=c(1,1,1,1,1))
Resl_Nut_Fractions_final

ggsave(filename = "Resl_Nut_Fractions.png",
       plot = Resl_Nut_Fractions_final, width = 18, height = 28, units = 'cm',
       scale = 2, dpi = 600)

#mini plot with intercept-only pantropical resilience for Total P and N fluxes

Fig_res_leaf_npc<-ggplot(Res_lc, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  #geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_transparent() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_blank(),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))
#annotate("text", x = 1.28, y = 0.18, fontface="bold",label = "f Wood fall", size=6,colour="black")
Fig_res_leaf_npc

##Wood N and P concentration

Fig_res_wc<-ggplot(Res_wc, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.3,-0.1,0,0.1,0.3))+
  geom_pointrange(mapping=aes(shape=var),size=1, stroke=1.2,position=position_dodge(width=c(0.4,0.4)))+
  geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_bw() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_blank(),axis.text.x =element_blank(),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_text(size=18),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),
        legend.position = "none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(panel.background = element_rect(fill = "transparent", colour = NA),  plot.background = element_rect(fill = "transparent", colour = NA))+
  annotate("text", x = 1.28, y = 0.1, fontface="bold",label = "f Wood concentration", size=7,colour="black")


Fig_res_wc

Fig_res_NP_conc.<-Fig_res_leafc+Fig_res_wc+plot_layout(ncol=2)
Fig_res_NP_conc.

Fig_res_wlc<-ggplot(Res_wlc, aes(x=factor(Fraction),y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), shape =var,col=var))+scale_y_continuous(breaks=c(-0.5,-0.25,0,0.25,0.5))+
  geom_pointrange(mapping=aes(shape=var),size=1.2, stroke=1.2,position=position_dodge(width=c(0.6,0.6)))+
  geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience (2 years)", x="Litterfall fraction") +scale_shape_discrete(solid=F)+ scale_color_manual(values=c("#167923","#1C39A8"))+
  theme_pubr() +# ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = 0.5),axis.text.x =element_text(vjust = 0.3),
        axis.title.y =element_text(vjust = 0.5,size=22),
        axis.text=element_text(size=20),legend.box="horizontal",legend.text =  element_text(size=22),legend.title = element_blank(),legend.position = "top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)))+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())


Fig_res_wlc

## Including only Ambient and TrimDeb

data_res_fig6amb <- rbind(data.frame(group="2",  season="Annual", estimate=res1t_amb$b, n=res1t_amb$k,
                                  ci_low=(res1t_amb$b-(1.96*res1t_amb$se)),ci_up=(res1t_amb$b+(1.96*res1t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual",estimate=res2t_amb$b, n=res2t_amb$k,
                                  ci_low=(res2t_amb$b-(1.96*res2t_amb$se)),ci_up=(res2t_amb$b+(1.96*res2t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual",estimate=res3t_amb$b, n=res3t_amb$k,
                                  ci_low=(res3t_amb$b-(1.96*res3t_amb$se)),ci_up=(res3t_amb$b+(1.96*res3t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual",estimate=res4t_amb$b, n=res4t_amb$k,
                                  ci_low=(res4t_amb$b-(1.96*res4t_amb$se)),ci_up=(res4t_amb$b+(1.96*res4t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual",estimate=res5t_amb$b,n=res5t_amb$k,
                                  ci_low=(res5t_amb$b-(1.96*res5t_amb$se)),ci_up=(res5t_amb$b+(1.96*res5t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual",estimate=res6t_amb$b, n=res6t_amb$k,
                                  ci_low=(res6t_amb$b-(1.96*res6t_amb$se)),ci_up=(res6t_amb$b+(1.96*res6t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual",estimate=res7t_amb$b, n=res7t_amb$k,
                                  ci_low=(res7t_amb$b-(1.96*res7t_amb$se)),ci_up=(res7t_amb$b+(1.96*res7t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual",estimate=res8t_amb$b,n=res8t_amb$k,
                                  ci_low=(res8t_amb$b-(1.96*res8t_amb$se)),ci_up=(res8t_amb$b+(1.96*res8t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual",estimate=res9t_amb$b, n=res9t_amb$k,
                                  ci_low=(res9t_amb$b-(1.96*res9t_amb$se)),ci_up=(res9t_amb$b+(1.96*res9t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual",estimate=res10t_amb$b,n=res10t_amb$k,
                                  ci_low=(res10t_amb$b-(1.96*res10t_amb$se)),ci_up=(res10t_amb$b+(1.96*res10t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual",estimate=res11t_amb$b, n=res11t_amb$k,
                                  ci_low=(res11t_amb$b-(1.96*res11t_amb$se)),ci_up=(res11t_amb$b+(1.96*res11t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual",estimate=res12t_amb$b, n=res12t_amb$k,
                                  ci_low=(res12t_amb$b-(1.96*res12t_amb$se)),ci_up=(res12t_amb$b+(1.96*res12t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual",estimate=res13t_amb$b, n=res13t_amb$k,
                                  ci_low=(res13t_amb$b-(1.96*res13t_amb$se)),ci_up=(res13t_amb$b+(1.96*res13t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual",estimate=res14t_amb$b, n=res14t_amb$k,
                                  ci_low=(res14t_amb$b-(1.96*res14t_amb$se)),ci_up=(res14t_amb$b+(1.96*res14t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual",estimate=res15t_amb$b,n=res15t_amb$k,
                                  ci_low=(res15t_amb$b-(1.96*res15t_amb$se)),ci_up=(res15t_amb$b+(1.96*res15t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual",estimate=res16t_amb$b, n=res16t_amb$k,
                                  ci_low=(res16t_amb$b-(1.96*res16t_amb$se)),ci_up=(res16t_amb$b+(1.96*res16t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual",estimate=res17t_amb$b,n=res17t_amb$k,
                                  ci_low=(res17t_amb$b-(1.96*res17t_amb$se)),ci_up=(res17t_amb$b+(1.96*res17t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual",estimate=res18t_amb$b, n=res18t_amb$k,
                                  ci_low=(res18t_amb$b-(1.96*res18t_amb$se)),ci_up=(res18t_amb$b+(1.96*res18t_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2", season="Subannual", estimate=res1tS_amb$b,n=res1tS_amb$k, 
                                  ci_low=(res1tS_amb$b-(1.96*res1tS_amb$se)),ci_up=(res1tS_amb$b+(1.96*res1tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Subannual",estimate=res2tS_amb$b, n=res2tS_amb$k,
                                  ci_low=(res2tS_amb$b-(1.96*res2tS_amb$se)),ci_up=(res2tS_amb$b+(1.96*res2tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Subannual",estimate=res3tS_amb$b, n=res3tS_amb$k,
                                  ci_low=(res3tS_amb$b-(1.96*res3tS_amb$se)),ci_up=(res3tS_amb$b+(1.96*res3tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Subannual",estimate=res4tS_amb$b, n=res4tS_amb$k,
                                  ci_low=(res4tS_amb$b-(1.96*res4tS_amb$se)),ci_up=(res4tS_amb$b+(1.96*res4tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Subannual",estimate=res5tS_amb$b,n=res5tS_amb$k,
                                  ci_low=(res5tS_amb$b-(1.96*res5tS_amb$se)),ci_up=(res5tS_amb$b+(1.96*res5tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Subannual",estimate=res6tS_amb$b, n=res6tS_amb$k,
                                  ci_low=(res6tS_amb$b-(1.96*res6tS_amb$se)),ci_up=(res6tS_amb$b+(1.96*res6tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Subannual",estimate=res7tS_amb$b, n=res7tS_amb$k,
                                  ci_low=(res7tS_amb$b-(1.96*res7tS_amb$se)),ci_up=(res7tS_amb$b+(1.96*res7tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Subannual",estimate=res8tS_amb$b,n=res8tS_amb$k,
                                  ci_low=(res8tS_amb$b-(1.96*res8tS_amb$se)),ci_up=(res8tS_amb$b+(1.96*res8tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Subannual",estimate=res9tS_amb$b, n=res9tS_amb$k,
                                  ci_low=(res9tS_amb$b-(1.96*res9tS_amb$se)),ci_up=(res9tS_amb$b+(1.96*res9tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Subannual",estimate=res10tS_amb$b,n=res10tS_amb$k,
                                  ci_low=(res10tS_amb$b-(1.96*res10tS_amb$se)),ci_up=(res10tS_amb$b+(1.96*res10tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Subannual",estimate=res11tS_amb$b, n=res11tS_amb$k,
                                  ci_low=(res11tS_amb$b-(1.96*res11tS_amb$se)),ci_up=(res11tS_amb$b+(1.96*res11tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Subannual",estimate=res12tS_amb$b, n=res12tS_amb$k,
                                  ci_low=(res12tS_amb$b-(1.96*res12tS_amb$se)),ci_up=(res12tS_amb$b+(1.96*res12tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Subannual",estimate=res13tS_amb$b, n=res13tS_amb$k,
                                  ci_low=(res13tS_amb$b-(1.96*res13tS_amb$se)),ci_up=(res13tS_amb$b+(1.96*res13tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Subannual",estimate=res14tS_amb$b, n=res14tS_amb$k,
                                  ci_low=(res14tS_amb$b-(1.96*res14tS_amb$se)),ci_up=(res14tS_amb$b+(1.96*res14tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Subannual",estimate=res15tS_amb$b,n=res15tS_amb$k,
                                  ci_low=(res15tS_amb$b-(1.96*res15tS_amb$se)),ci_up=(res15tS_amb$b+(1.96*res15tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Subannual",estimate=res16tS_amb$b, n=res16tS_amb$k,
                                  ci_low=(res16tS_amb$b-(1.96*res16tS_amb$se)),ci_up=(res16tS_amb$b+(1.96*res16tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Subannual",estimate=res17tS_amb$b,n=res17tS_amb$k,
                                  ci_low=(res17tS_amb$b-(1.96*res17tS_amb$se)),ci_up=(res17tS_amb$b+(1.96*res17tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Subannual",estimate=res18tS_amb$b, n=res18tS_amb$k,
                                  ci_low=(res18tS_amb$b-(1.96*res18tS_amb$se)),ci_up=(res18tS_amb$b+(1.96*res18tS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2",  season="Annual*", estimate=res1tSS_amb$b, n=res1tSS_amb$k,
                                  ci_low=(res1tSS_amb$b-(1.96*res1tSS_amb$se)),ci_up=(res1tSS_amb$b+(1.96*res1tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual*",estimate=res2tSS_amb$b, n=res2tSS_amb$k,
                                  ci_low=(res2tSS_amb$b-(1.96*res2tSS_amb$se)),ci_up=(res2tSS_amb$b+(1.96*res2tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual*",estimate=res3tSS_amb$b, n=res3tSS_amb$k,
                                  ci_low=(res3tSS_amb$b-(1.96*res3tSS_amb$se)),ci_up=(res3tSS_amb$b+(1.96*res3tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual*",estimate=res4tSS_amb$b, n=res4tSS_amb$k,
                                  ci_low=(res4tSS_amb$b-(1.96*res4tSS_amb$se)),ci_up=(res4tSS_amb$b+(1.96*res4tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual*",estimate=res5tSS_amb$b,n=res5tSS_amb$k,
                                  ci_low=(res5tSS_amb$b-(1.96*res5tSS_amb$se)),ci_up=(res5tSS_amb$b+(1.96*res5tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual*",estimate=res6tSS_amb$b, n=res6tSS_amb$k,
                                  ci_low=(res6tSS_amb$b-(1.96*res6tSS_amb$se)),ci_up=(res6tSS_amb$b+(1.96*res6tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual*",estimate=res7tSS_amb$b, n=res7tSS_amb$k,
                                  ci_low=(res7tSS_amb$b-(1.96*res7tSS_amb$se)),ci_up=(res7tSS_amb$b+(1.96*res7tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual*",estimate=res8tSS_amb$b,n=res8tSS_amb$k,
                                  ci_low=(res8tSS_amb$b-(1.96*res8tSS_amb$se)),ci_up=(res8tSS_amb$b+(1.96*res8tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual*",estimate=res9tSS_amb$b, n=res9tSS_amb$k,
                                  ci_low=res9tSS_amb$ci.lb, ci_up=res9tSS_amb$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual*",estimate=res10tSS_amb$b,n=res10tSS_amb$k,
                                  ci_low=(res10tSS_amb$b-(1.96*res10tSS_amb$se)),ci_up=(res10tSS_amb$b+(1.96*res10tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual*",estimate=res11tSS_amb$b, n=res11tSS_amb$k,
                                  ci_low=(res11tSS_amb$b-(1.96*res11tSS_amb$se)),ci_up=(res11tSS_amb$b+(1.96*res11tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual*",estimate=res12tSS_amb$b, n=res12tSS_amb$k,
                                  ci_low=(res12tSS_amb$b-(1.96*res12tSS_amb$se)),ci_up=(res12tSS_amb$b+(1.96*res12tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual*",estimate=res13tSS_amb$b, n=res13tSS_amb$k,
                                  ci_low=(res13tSS_amb$b-(1.96*res13tSS_amb$se)),ci_up=(res13tSS_amb$b+(1.96*res13tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual*",estimate=res14tSS_amb$b, n=res14tSS_amb$k,
                                  ci_low=(res14tSS_amb$b-(1.96*res14tSS_amb$se)),ci_up=(res14tSS_amb$b+(1.96*res14tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual*",estimate=res15tSS_amb$b,n=res15tSS_amb$k,
                                  ci_low=(res15tSS_amb$b-(1.96*res15tSS_amb$se)),ci_up=(res15tSS_amb$b+(1.96*res15tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual*",estimate=res16tSS_amb$b, n=res16tSS_amb$k,
                                  ci_low=(res16tSS_amb$b-(1.96*res16tSS_amb$se)),ci_up=(res16tSS_amb$b+(1.96*res16tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual*",estimate=res17tSS_amb$b,n=res17tSS_amb$k,
                                  ci_low=(res17tSS_amb$b-(1.96*res17tSS_amb$se)),ci_up=(res17tSS_amb$b+(1.96*res17tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual*",estimate=res18tSS_amb$b, n=res18tSS_amb$k,
                                  ci_low=(res18tSS_amb$b-(1.96*res18tSS_amb$se)),ci_up=(res18tSS_amb$b+(1.96*res18tSS_amb$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))
data_res_fig6amb

## Including all treatments

data_res_fig6 <- rbind(data.frame(group="2",  season="Annual", estimate=res1t$b, n=res1t$k,
                                 ci_low=(res1t$b-(1.96*res1t$se)),ci_up=(res1t$b+(1.96*res1t$se)),
                                 row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual",estimate=res2t$b, n=res2t$k,
                                  ci_low=(res2t$b-(1.96*res2t$se)),ci_up=(res2t$b+(1.96*res2t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual",estimate=res3t$b, n=res3t$k,
                                  ci_low=(res3t$b-(1.96*res3t$se)),ci_up=(res3t$b+(1.96*res3t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual",estimate=res4t$b, n=res4t$k,
                                  ci_low=(res4t$b-(1.96*res4t$se)),ci_up=(res4t$b+(1.96*res4t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual",estimate=res5t$b,n=res5t$k,
                                  ci_low=(res5t$b-(1.96*res5t$se)),ci_up=(res5t$b+(1.96*res5t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual",estimate=res6t$b, n=res6t$k,
                                  ci_low=(res6t$b-(1.96*res6t$se)),ci_up=(res6t$b+(1.96*res6t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual",estimate=res7t$b, n=res7t$k,
                                  ci_low=(res7t$b-(1.96*res7t$se)),ci_up=(res7t$b+(1.96*res7t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual",estimate=res8t$b,n=res8t$k,
                                  ci_low=(res8t$b-(1.96*res8t$se)),ci_up=(res8t$b+(1.96*res8t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual",estimate=res9t$b, n=res9t$k,
                                  ci_low=(res9t$b-(1.96*res9t$se)),ci_up=(res9t$b+(1.96*res9t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual",estimate=res10t$b,n=res10t$k,
                                  ci_low=(res10t$b-(1.96*res10t$se)),ci_up=(res10t$b+(1.96*res10t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual",estimate=res11t$b, n=res11t$k,
                                  ci_low=(res11t$b-(1.96*res11t$se)),ci_up=(res11t$b+(1.96*res11t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual",estimate=res12t$b, n=res12t$k,
                                  ci_low=(res12t$b-(1.96*res12t$se)),ci_up=(res12t$b+(1.96*res12t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual",estimate=res13t$b, n=res13t$k,
                                  ci_low=(res13t$b-(1.96*res13t$se)),ci_up=(res13t$b+(1.96*res13t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual",estimate=res14t$b, n=res14t$k,
                                  ci_low=(res14t$b-(1.96*res14t$se)),ci_up=(res14t$b+(1.96*res14t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual",estimate=res15t$b,n=res15t$k,
                                  ci_low=(res15t$b-(1.96*res15t$se)),ci_up=(res15t$b+(1.96*res15t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual",estimate=res16t$b, n=res16t$k,
                                  ci_low=(res16t$b-(1.96*res16t$se)),ci_up=(res16t$b+(1.96*res16t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual",estimate=res17t$b,n=res17t$k,
                                  ci_low=(res17t$b-(1.96*res17t$se)),ci_up=(res17t$b+(1.96*res17t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual",estimate=res18t$b, n=res18t$k,
                                  ci_low=(res18t$b-(1.96*res18t$se)),ci_up=(res18t$b+(1.96*res18t$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2", season="Subannual", estimate=res1tS$b,n=res1tS$k, 
                              ci_low=(res1tS$b-(1.96*res1tS$se)),ci_up=(res1tS$b+(1.96*res1tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="4", season="Subannual",estimate=res2tS$b, n=res2tS$k,
                               ci_low=(res2tS$b-(1.96*res2tS$se)),ci_up=(res2tS$b+(1.96*res2tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="6", season="Subannual",estimate=res3tS$b, n=res3tS$k,
                               ci_low=(res3tS$b-(1.96*res3tS$se)),ci_up=(res3tS$b+(1.96*res3tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="8", season="Subannual",estimate=res4tS$b, n=res4tS$k,
                               ci_low=(res4tS$b-(1.96*res4tS$se)),ci_up=(res4tS$b+(1.96*res4tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="10", season="Subannual",estimate=res5tS$b,n=res5tS$k,
                               ci_low=(res5tS$b-(1.96*res5tS$se)),ci_up=(res5tS$b+(1.96*res5tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="12", season="Subannual",estimate=res6tS$b, n=res6tS$k,
                               ci_low=(res6tS$b-(1.96*res6tS$se)),ci_up=(res6tS$b+(1.96*res6tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="14", season="Subannual",estimate=res7tS$b, n=res7tS$k,
                               ci_low=(res7tS$b-(1.96*res7tS$se)),ci_up=(res7tS$b+(1.96*res7tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="16", season="Subannual",estimate=res8tS$b,n=res8tS$k,
                               ci_low=(res8tS$b-(1.96*res8tS$se)),ci_up=(res8tS$b+(1.96*res8tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="18", season="Subannual",estimate=res9tS$b, n=res9tS$k,
                               ci_low=(res9tS$b-(1.96*res9tS$se)),ci_up=(res9tS$b+(1.96*res9tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="20", season="Subannual",estimate=res10tS$b,n=res10tS$k,
                               ci_low=(res10tS$b-(1.96*res10tS$se)),ci_up=(res10tS$b+(1.96*res10tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="22", season="Subannual",estimate=res11tS$b, n=res11tS$k,
                               ci_low=(res11tS$b-(1.96*res11tS$se)),ci_up=(res11tS$b+(1.96*res11tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="24", season="Subannual",estimate=res12tS$b, n=res12tS$k,
                               ci_low=(res12tS$b-(1.96*res12tS$se)),ci_up=(res12tS$b+(1.96*res12tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="26", season="Subannual",estimate=res13tS$b, n=res13tS$k,
                               ci_low=(res13tS$b-(1.96*res13tS$se)),ci_up=(res13tS$b+(1.96*res13tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="28", season="Subannual",estimate=res14tS$b, n=res14tS$k,
                               ci_low=(res14tS$b-(1.96*res14tS$se)),ci_up=(res14tS$b+(1.96*res14tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="30", season="Subannual",estimate=res15tS$b,n=res15tS$k,
                               ci_low=(res15tS$b-(1.96*res15tS$se)),ci_up=(res15tS$b+(1.96*res15tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="32", season="Subannual",estimate=res16tS$b, n=res16tS$k,
                               ci_low=(res16tS$b-(1.96*res16tS$se)),ci_up=(res16tS$b+(1.96*res16tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="34", season="Subannual",estimate=res17tS$b,n=res17tS$k,
                               ci_low=(res17tS$b-(1.96*res17tS$se)),ci_up=(res17tS$b+(1.96*res17tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
                    data.frame(group="36", season="Subannual",estimate=res18tS$b, n=res18tS$k,
                               ci_low=(res18tS$b-(1.96*res18tS$se)),ci_up=(res18tS$b+(1.96*res18tS$se)),
                               row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="2",  season="Annual*", estimate=res1tSS$b, n=res1tSS$k,
           ci_low=(res1tSS$b-(1.96*res1tSS$se)),ci_up=(res1tSS$b+(1.96*res1tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="4", season="Annual*",estimate=res2tSS$b, n=res2tSS$k,
           ci_low=(res2tSS$b-(1.96*res2tSS$se)),ci_up=(res2tSS$b+(1.96*res2tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="6", season="Annual*",estimate=res3tSS$b, n=res3tSS$k,
           ci_low=(res3tSS$b-(1.96*res3tSS$se)),ci_up=(res3tSS$b+(1.96*res3tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="8", season="Annual*",estimate=res4tSS$b, n=res4tSS$k,
           ci_low=(res4tSS$b-(1.96*res4tSS$se)),ci_up=(res4tSS$b+(1.96*res4tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="10", season="Annual*",estimate=res5tSS$b,n=res5tSS$k,
           ci_low=(res5tSS$b-(1.96*res5tSS$se)),ci_up=(res5tSS$b+(1.96*res5tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="12", season="Annual*",estimate=res6tSS$b, n=res6tSS$k,
           ci_low=(res6tSS$b-(1.96*res6tSS$se)),ci_up=(res6tSS$b+(1.96*res6tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="14", season="Annual*",estimate=res7tSS$b, n=res7tSS$k,
           ci_low=(res7tSS$b-(1.96*res7tSS$se)),ci_up=(res7tSS$b+(1.96*res7tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="16", season="Annual*",estimate=res8tSS$b,n=res8tSS$k,
           ci_low=(res8tSS$b-(1.96*res8tSS$se)),ci_up=(res8tSS$b+(1.96*res8tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="18", season="Annual*",estimate=res9tSS$b, n=res9tSS$k,
           ci_low=(res9tSS$b-(1.96*res9tSS$se)), ci_up=(res9tSS$b+(1.96*res9tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="20", season="Annual*",estimate=res10tSS$b,n=res10tSS$k,
           ci_low=(res10tSS$b-(1.96*res10tSS$se)),ci_up=(res10tSS$b+(1.96*res10tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="22", season="Annual*",estimate=res11tSS$b, n=res11tSS$k,
           ci_low=(res11tSS$b-(1.96*res11tSS$se)),ci_up=(res11tSS$b+(1.96*res11tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="24", season="Annual*",estimate=res12tSS$b, n=res12tSS$k,
           ci_low=(res12tSS$b-(1.96*res12tSS$se)),ci_up=(res12tSS$b+(1.96*res12tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="26", season="Annual*",estimate=res13tSS$b, n=res13tSS$k,
           ci_low=(res13tSS$b-(1.96*res13tSS$se)),ci_up=(res13tSS$b+(1.96*res13tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="28", season="Annual*",estimate=res14tSS$b, n=res14tSS$k,
           ci_low=(res14tSS$b-(1.96*res14tSS$se)),ci_up=(res14tSS$b+(1.96*res14tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="30", season="Annual*",estimate=res15tSS$b,n=res15tSS$k,
           ci_low=(res15tSS$b-(1.96*res15tSS$se)),ci_up=(res15tSS$b+(1.96*res15tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="32", season="Annual*",estimate=res16tSS$b, n=res16tSS$k,
           ci_low=(res16tSS$b-(1.96*res16tSS$se)),ci_up=(res16tSS$b+(1.96*res16tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="34", season="Annual*",estimate=res17tSS$b,n=res17tSS$k,
           ci_low=(res17tSS$b-(1.96*res17tSS$se)),ci_up=(res17tSS$b+(1.96*res17tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE),
data.frame(group="36", season="Annual*",estimate=res18tSS$b, n=res18tSS$k,
           ci_low=(res18tSS$b-(1.96*res18tSS$se)),ci_up=(res18tSS$b+(1.96*res18tSS$se)),
           row.names=FALSE, stringsAsFactors=TRUE))

data_res_fig6

###Leaf fall Overall effects data wrangling ####

data_res_figlf <- rbind(data.frame(group="2",  season="Annual", estimate=res1lf$b, n=res1lf$k,
                                  ci_low=(res1lf$b-(1.96*res1lf$se)),ci_up=(res1lf$b+(1.96*res1lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual",estimate=res2lf$b, n=res2lf$k,
                                  ci_low=(res2lf$b-(1.96*res2lf$se)),ci_up=(res2lf$b+(1.96*res2lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual",estimate=res3lf$b, n=res3lf$k,
                                  ci_low=(res3lf$b-(1.96*res3lf$se)),ci_up=(res3lf$b+(1.96*res3lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual",estimate=res4lf$b, n=res4lf$k,
                                  ci_low=(res4lf$b-(1.96*res4lf$se)),ci_up=(res4lf$b+(1.96*res4lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual",estimate=res5lf$b,n=res5lf$k,
                                  ci_low=(res5lf$b-(1.96*res5lf$se)),ci_up=(res5lf$b+(1.96*res5lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual",estimate=res6lf$b, n=res6lf$k,
                                  ci_low=(res6lf$b-(1.96*res6lf$se)),ci_up=(res6lf$b+(1.96*res6lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual",estimate=res7lf$b, n=res7lf$k,
                                  ci_low=(res7lf$b-(1.96*res7lf$se)),ci_up=(res7lf$b+(1.96*res7lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual",estimate=res8lf$b,n=res8lf$k,
                                  ci_low=(res8lf$b-(1.96*res8lf$se)),ci_up=(res8lf$b+(1.96*res8lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual",estimate=res9lf$b, n=res9lf$k,
                                  ci_low=(res9lf$b-(1.96*res9lf$se)),ci_up=(res9lf$b+(1.96*res9lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual",estimate=res10lf$b,n=res10lf$k,
                                  ci_low=(res10lf$b-(1.96*res10lf$se)),ci_up=(res10lf$b+(1.96*res10lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual",estimate=res11lf$b, n=res11lf$k,
                                  ci_low=(res11lf$b-(1.96*res11lf$se)),ci_up=(res11lf$b+(1.96*res11lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual",estimate=res12lf$b, n=res12lf$k,
                                  ci_low=(res12lf$b-(1.96*res12lf$se)),ci_up=(res12lf$b+(1.96*res12lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual",estimate=res13lf$b, n=res13lf$k,
                                  ci_low=(res13lf$b-(1.96*res13lf$se)),ci_up=(res13lf$b+(1.96*res13lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual",estimate=res14lf$b, n=res14lf$k,
                                  ci_low=(res14lf$b-(1.96*res14lf$se)),ci_up=(res14lf$b+(1.96*res14lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual",estimate=res15lf$b,n=res15lf$k,
                                  ci_low=(res15lf$b-(1.96*res15lf$se)),ci_up=(res15lf$b+(1.96*res15lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual",estimate=res16lf$b, n=res16lf$k,
                                  ci_low=(res16lf$b-(1.96*res16lf$se)),ci_up=(res16lf$b+(1.96*res16lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual",estimate=res17lf$b,n=res17lf$k,
                                  ci_low=(res17lf$b-(1.96*res17lf$se)),ci_up=(res17lf$b+(1.96*res17lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual",estimate=res18lf$b, n=res18lf$k,
                                  ci_low=(res18lf$b-(1.96*res18lf$se)),ci_up=(res18lf$b+(1.96*res18lf$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2", season="Subannual", estimate=res1lfS$b,n=res1lfS$k, 
                                  ci_low=(res1lfS$b-(1.96*res1lfS$se)),ci_up=(res1lfS$b+(1.96*res1lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Subannual",estimate=res2lfS$b, n=res2lfS$k,
                                  ci_low=(res2lfS$b-(1.96*res2lfS$se)),ci_up=(res2lfS$b+(1.96*res2lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Subannual",estimate=res3lfS$b, n=res3lfS$k,
                                  ci_low=(res3lfS$b-(1.96*res3lfS$se)),ci_up=(res3lfS$b+(1.96*res3lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Subannual",estimate=res4lfS$b, n=res4lfS$k,
                                  ci_low=(res4lfS$b-(1.96*res4lfS$se)),ci_up=(res4lfS$b+(1.96*res4lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Subannual",estimate=res5lfS$b,n=res5lfS$k,
                                  ci_low=(res5lfS$b-(1.96*res5lfS$se)),ci_up=(res5lfS$b+(1.96*res5lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Subannual",estimate=res6lfS$b, n=res6lfS$k,
                                  ci_low=(res6lfS$b-(1.96*res6lfS$se)),ci_up=(res6lfS$b+(1.96*res6lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Subannual",estimate=res7lfS$b, n=res7lfS$k,
                                  ci_low=(res7lfS$b-(1.96*res7lfS$se)),ci_up=(res7lfS$b+(1.96*res7lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Subannual",estimate=res8lfS$b,n=res8lfS$k,
                                  ci_low=(res8lfS$b-(1.96*res8lfS$se)),ci_up=(res8lfS$b+(1.96*res8lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Subannual",estimate=res9lfS$b, n=res9lfS$k,
                                  ci_low=(res9lfS$b-(1.96*res9lfS$se)),ci_up=(res9lfS$b+(1.96*res9lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Subannual",estimate=res10lfS$b,n=res10lfS$k,
                                  ci_low=(res10lfS$b-(1.96*res10lfS$se)),ci_up=(res10lfS$b+(1.96*res10lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Subannual",estimate=res11lfS$b, n=res11lfS$k,
                                  ci_low=(res11lfS$b-(1.96*res11lfS$se)),ci_up=(res11lfS$b+(1.96*res11lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Subannual",estimate=res12lfS$b, n=res12lfS$k,
                                  ci_low=(res12lfS$b-(1.96*res12lfS$se)),ci_up=(res12lfS$b+(1.96*res12lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Subannual",estimate=res13lfS$b, n=res13lfS$k,
                                  ci_low=(res13lfS$b-(1.96*res13lfS$se)),ci_up=(res13lfS$b+(1.96*res13lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Subannual",estimate=res14lfS$b, n=res14lfS$k,
                                  ci_low=(res14lfS$b-(1.96*res14lfS$se)),ci_up=(res14lfS$b+(1.96*res14lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Subannual",estimate=res15lfS$b,n=res15lfS$k,
                                  ci_low=(res15lfS$b-(1.96*res15lfS$se)),ci_up=(res15lfS$b+(1.96*res15lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Subannual",estimate=res16lfS$b, n=res16lfS$k,
                                  ci_low=(res16lfS$b-(1.96*res16lfS$se)),ci_up=(res16lfS$b+(1.96*res16lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Subannual",estimate=res17lfS$b,n=res17lfS$k,
                                  ci_low=(res17lfS$b-(1.96*res17lfS$se)),ci_up=(res17lfS$b+(1.96*res17lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Subannual",estimate=res18lfS$b, n=res18lfS$k,
                                  ci_low=(res18lfS$b-(1.96*res18lfS$se)),ci_up=(res18lfS$b+(1.96*res18lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2",  season="Annual*", estimate=res1lfSS$b, n=res1lfSS$k,
                                  ci_low=(res1lfSS$b-(1.96*res1lfSS$se)),ci_up=(res1lfSS$b+(1.96*res1lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual*",estimate=res2lfSS$b, n=res2lfSS$k,
                                  ci_low=(res2lfSS$b-(1.96*res2lfSS$se)),ci_up=(res2lfSS$b+(1.96*res2lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual*",estimate=res3lfSS$b, n=res3lfSS$k,
                                  ci_low=(res3lfSS$b-(1.96*res3lfSS$se)),ci_up=(res3lfSS$b+(1.96*res3lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual*",estimate=res4lfSS$b, n=res4lfSS$k,
                                  ci_low=(res4lfSS$b-(1.96*res4lfSS$se)),ci_up=(res4lfSS$b+(1.96*res4lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual*",estimate=res5lfSS$b,n=res5lfSS$k,
                                  ci_low=(res5lfSS$b-(1.96*res5lfSS$se)),ci_up=(res5lfSS$b+(1.96*res5lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual*",estimate=res6lfSS$b, n=res6lfSS$k,
                                  ci_low=(res6lfSS$b-(1.96*res6lfSS$se)),ci_up=(res6lfSS$b+(1.96*res6lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual*",estimate=res7lfSS$b, n=res7lfSS$k,
                                  ci_low=(res7lfSS$b-(1.96*res7lfSS$se)),ci_up=(res7lfSS$b+(1.96*res7lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual*",estimate=res8lfSS$b,n=res8lfSS$k,
                                  ci_low=(res8lfSS$b-(1.96*res8lfSS$se)),ci_up=(res8lfSS$b+(1.96*res8lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual*",estimate=res9lfSS$b, n=res9lfSS$k,
                                  ci_low=(res9lfSS$b-(1.96*res9lfSS$se)), ci_up=(res9lfSS$b+(1.96*res9lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual*",estimate=res10lfSS$b,n=res10lfSS$k,
                                  ci_low=(res10lfSS$b-(1.96*res10lfSS$se)),ci_up=(res10lfSS$b+(1.96*res10lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual*",estimate=res11lfSS$b, n=res11lfSS$k,
                                  ci_low=(res11lfSS$b-(1.96*res11lfSS$se)),ci_up=(res11lfSS$b+(1.96*res11lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual*",estimate=res12lfSS$b, n=res12lfSS$k,
                                  ci_low=(res12lfSS$b-(1.96*res12lfSS$se)),ci_up=(res12lfSS$b+(1.96*res12lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual*",estimate=res13lfSS$b, n=res13lfSS$k,
                                  ci_low=(res13lfSS$b-(1.96*res13lfSS$se)),ci_up=(res13lfSS$b+(1.96*res13lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual*",estimate=res14lfSS$b, n=res14lfSS$k,
                                  ci_low=(res14lfSS$b-(1.96*res14lfSS$se)),ci_up=(res14lfSS$b+(1.96*res14lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual*",estimate=res15lfSS$b,n=res15lfSS$k,
                                  ci_low=(res15lfSS$b-(1.96*res15lfSS$se)),ci_up=(res15lfSS$b+(1.96*res15lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual*",estimate=res16lfSS$b, n=res16lfSS$k,
                                  ci_low=(res16lfSS$b-(1.96*res16lfSS$se)),ci_up=(res16lfSS$b+(1.96*res16lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual*",estimate=res17lfSS$b,n=res17lfSS$k,
                                  ci_low=(res17lfSS$b-(1.96*res17lfSS$se)),ci_up=(res17lfSS$b+(1.96*res17lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual*",estimate=res18lfSS$b, n=res18lfSS$k,
                                  ci_low=(res18lfSS$b-(1.96*res18lfSS$se)),ci_up=(res18lfSS$b+(1.96*res18lfSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))

data_res_figlf

##Wood fall resilience data wrangling ####

data_res_figwf <- rbind(data.frame(group="2",  season="Annual", estimate=res1wf$b, n=res1wf$k,
                                   ci_low=(res1wf$b-(1.96*res1wf$se)),ci_up=(res1wf$b+(1.96*res1wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="4", season="Annual",estimate=res2wf$b, n=res2wf$k,
                                   ci_low=(res2wf$b-(1.96*res2wf$se)),ci_up=(res2wf$b+(1.96*res2wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="6", season="Annual",estimate=res3wf$b, n=res3wf$k,
                                   ci_low=(res3wf$b-(1.96*res3wf$se)),ci_up=(res3wf$b+(1.96*res3wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="8", season="Annual",estimate=res4wf$b, n=res4wf$k,
                                   ci_low=(res4wf$b-(1.96*res4wf$se)),ci_up=(res4wf$b+(1.96*res4wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="10", season="Annual",estimate=res5wf$b,n=res5wf$k,
                                   ci_low=(res5wf$b-(1.96*res5wf$se)),ci_up=(res5wf$b+(1.96*res5wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="12", season="Annual",estimate=res6wf$b, n=res6wf$k,
                                   ci_low=(res6wf$b-(1.96*res6wf$se)),ci_up=(res6wf$b+(1.96*res6wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="14", season="Annual",estimate=res7wf$b, n=res7wf$k,
                                   ci_low=(res7wf$b-(1.96*res7wf$se)),ci_up=(res7wf$b+(1.96*res7wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="16", season="Annual",estimate=res8wf$b,n=res8wf$k,
                                   ci_low=(res8wf$b-(1.96*res8wf$se)),ci_up=(res8wf$b+(1.96*res8wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="18", season="Annual",estimate=res9wf$b, n=res9wf$k,
                                   ci_low=(res9wf$b-(1.96*res9wf$se)),ci_up=(res9wf$b+(1.96*res9wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="20", season="Annual",estimate=res10wf$b,n=res10wf$k,
                                   ci_low=(res10wf$b-(1.96*res10wf$se)),ci_up=(res10wf$b+(1.96*res10wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="22", season="Annual",estimate=res11wf$b, n=res11wf$k,
                                   ci_low=(res11wf$b-(1.96*res11wf$se)),ci_up=(res11wf$b+(1.96*res11wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="24", season="Annual",estimate=res12wf$b, n=res12wf$k,
                                   ci_low=(res12wf$b-(1.96*res12wf$se)),ci_up=(res12wf$b+(1.96*res12wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="26", season="Annual",estimate=res13wf$b, n=res13wf$k,
                                   ci_low=(res13wf$b-(1.96*res13wf$se)),ci_up=(res13wf$b+(1.96*res13wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="28", season="Annual",estimate=res14wf$b, n=res14wf$k,
                                   ci_low=(res14wf$b-(1.96*res14wf$se)),ci_up=(res14wf$b+(1.96*res14wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="30", season="Annual",estimate=res15wf$b,n=res15wf$k,
                                   ci_low=(res15wf$b-(1.96*res15wf$se)),ci_up=(res15wf$b+(1.96*res15wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="32", season="Annual",estimate=res16wf$b, n=res16wf$k,
                                   ci_low=(res16wf$b-(1.96*res16wf$se)),ci_up=(res16wf$b+(1.96*res16wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="34", season="Annual",estimate=res17wf$b,n=res17wf$k,
                                   ci_low=(res17wf$b-(1.96*res17wf$se)),ci_up=(res17wf$b+(1.96*res17wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="36", season="Annual",estimate=res18wf$b, n=res18wf$k,
                                   ci_low=(res18wf$b-(1.96*res18wf$se)),ci_up=(res18wf$b+(1.96*res18wf$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="2", season="Subannual", estimate=res1wfS$b,n=res1wfS$k, 
                                   ci_low=(res1wfS$b-(1.96*res1wfS$se)),ci_up=(res1wfS$b+(1.96*res1wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="4", season="Subannual",estimate=res2wfS$b, n=res2wfS$k,
                                   ci_low=(res2wfS$b-(1.96*res2wfS$se)),ci_up=(res2wfS$b+(1.96*res2wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="6", season="Subannual",estimate=res3wfS$b, n=res3wfS$k,
                                   ci_low=(res3wfS$b-(1.96*res3wfS$se)),ci_up=(res3wfS$b+(1.96*res3wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="8", season="Subannual",estimate=res4wfS$b, n=res4wfS$k,
                                   ci_low=(res4wfS$b-(1.96*res4wfS$se)),ci_up=(res4wfS$b+(1.96*res4wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="10", season="Subannual",estimate=res5wfS$b,n=res5wfS$k,
                                   ci_low=(res5wfS$b-(1.96*res5wfS$se)),ci_up=(res5wfS$b+(1.96*res5wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="12", season="Subannual",estimate=res6wfS$b, n=res6wfS$k,
                                   ci_low=(res6wfS$b-(1.96*res6wfS$se)),ci_up=(res6wfS$b+(1.96*res6wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="14", season="Subannual",estimate=res7wfS$b, n=res7wfS$k,
                                   ci_low=(res7wfS$b-(1.96*res7wfS$se)),ci_up=(res7wfS$b+(1.96*res7wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="16", season="Subannual",estimate=res8wfS$b,n=res8wfS$k,
                                   ci_low=(res8wfS$b-(1.96*res8wfS$se)),ci_up=(res8wfS$b+(1.96*res8wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="18", season="Subannual",estimate=res9wfS$b, n=res9wfS$k,
                                   ci_low=(res9wfS$b-(1.96*res9wfS$se)),ci_up=(res9wfS$b+(1.96*res9wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="20", season="Subannual",estimate=res10wfS$b,n=res10wfS$k,
                                   ci_low=(res10wfS$b-(1.96*res10wfS$se)),ci_up=(res10wfS$b+(1.96*res10wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="22", season="Subannual",estimate=res11wfS$b, n=res11wfS$k,
                                   ci_low=(res11wfS$b-(1.96*res11wfS$se)),ci_up=(res11wfS$b+(1.96*res11wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="24", season="Subannual",estimate=res12wfS$b, n=res12wfS$k,
                                   ci_low=(res12wfS$b-(1.96*res12wfS$se)),ci_up=(res12wfS$b+(1.96*res12wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="26", season="Subannual",estimate=res13wfS$b, n=res13wfS$k,
                                   ci_low=(res13wfS$b-(1.96*res13wfS$se)),ci_up=(res13wfS$b+(1.96*res13wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="28", season="Subannual",estimate=res14wfS$b, n=res14wfS$k,
                                   ci_low=(res14wfS$b-(1.96*res14wfS$se)),ci_up=(res14wfS$b+(1.96*res14wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="30", season="Subannual",estimate=res15wfS$b,n=res15wfS$k,
                                   ci_low=(res15wfS$b-(1.96*res15wfS$se)),ci_up=(res15wfS$b+(1.96*res15wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="32", season="Subannual",estimate=res16wfS$b, n=res16wfS$k,
                                   ci_low=(res16wfS$b-(1.96*res16wfS$se)),ci_up=(res16wfS$b+(1.96*res16wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="34", season="Subannual",estimate=res17wfS$b,n=res17wfS$k,
                                   ci_low=(res17wfS$b-(1.96*res17wfS$se)),ci_up=(res17wfS$b+(1.96*res17wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="36", season="Subannual",estimate=res18wfS$b, n=res18wfS$k,
                                   ci_low=(res18wfS$b-(1.96*res18wfS$se)),ci_up=(res18wfS$b+(1.96*res18wfS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="2",  season="Annual*", estimate=res1wfSS$b, n=res1wfSS$k,
                                   ci_low=(res1wfSS$b-(1.96*res1wfSS$se)),ci_up=(res1wfSS$b+(1.96*res1wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="4", season="Annual*",estimate=res2wfSS$b, n=res2wfSS$k,
                                   ci_low=(res2wfSS$b-(1.96*res2wfSS$se)),ci_up=(res2wfSS$b+(1.96*res2wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="6", season="Annual*",estimate=res3wfSS$b, n=res3wfSS$k,
                                   ci_low=(res3wfSS$b-(1.96*res3wfSS$se)),ci_up=(res3wfSS$b+(1.96*res3wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="8", season="Annual*",estimate=res4wfSS$b, n=res4wfSS$k,
                                   ci_low=(res4wfSS$b-(1.96*res4wfSS$se)),ci_up=(res4wfSS$b+(1.96*res4wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="10", season="Annual*",estimate=res5wfSS$b,n=res5wfSS$k,
                                   ci_low=(res5wfSS$b-(1.96*res5wfSS$se)),ci_up=(res5wfSS$b+(1.96*res5wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="12", season="Annual*",estimate=res6wfSS$b, n=res6wfSS$k,
                                   ci_low=(res6wfSS$b-(1.96*res6wfSS$se)),ci_up=(res6wfSS$b+(1.96*res6wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="14", season="Annual*",estimate=res7wfSS$b, n=res7wfSS$k,
                                   ci_low=(res7wfSS$b-(1.96*res7wfSS$se)),ci_up=(res7wfSS$b+(1.96*res7wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="16", season="Annual*",estimate=res8wfSS$b,n=res8wfSS$k,
                                   ci_low=(res8wfSS$b-(1.96*res8wfSS$se)),ci_up=(res8wfSS$b+(1.96*res8wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="18", season="Annual*",estimate=res9wfSS$b, n=res9wfSS$k,
                                   ci_low=(res9wfSS$b-(1.96*res9wfSS$se)), ci_up=(res9wfSS$b+(1.96*res9wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="20", season="Annual*",estimate=res10wfSS$b,n=res10wfSS$k,
                                   ci_low=(res10wfSS$b-(1.96*res10wfSS$se)),ci_up=(res10wfSS$b+(1.96*res10wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="22", season="Annual*",estimate=res11wfSS$b, n=res11wfSS$k,
                                   ci_low=(res11wfSS$b-(1.96*res11wfSS$se)),ci_up=(res11wfSS$b+(1.96*res11wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="24", season="Annual*",estimate=res12wfSS$b, n=res12wfSS$k,
                                   ci_low=(res12wfSS$b-(1.96*res12wfSS$se)),ci_up=(res12wfSS$b+(1.96*res12wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="26", season="Annual*",estimate=res13wfSS$b, n=res13wfSS$k,
                                   ci_low=(res13wfSS$b-(1.96*res13wfSS$se)),ci_up=(res13wfSS$b+(1.96*res13wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="28", season="Annual*",estimate=res14wfSS$b, n=res14wfSS$k,
                                   ci_low=(res14wfSS$b-(1.96*res14wfSS$se)),ci_up=(res14wfSS$b+(1.96*res14wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="30", season="Annual*",estimate=res15wfSS$b,n=res15wfSS$k,
                                   ci_low=(res15wfSS$b-(1.96*res15wfSS$se)),ci_up=(res15wfSS$b+(1.96*res15wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="32", season="Annual*",estimate=res16wfSS$b, n=res16wfSS$k,
                                   ci_low=(res16wfSS$b-(1.96*res16wfSS$se)),ci_up=(res16wfSS$b+(1.96*res16wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="34", season="Annual*",estimate=res17wfSS$b,n=res17wfSS$k,
                                   ci_low=(res17wfSS$b-(1.96*res17wfSS$se)),ci_up=(res17wfSS$b+(1.96*res17wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="36", season="Annual*",estimate=res18wfSS$b, n=res18wfSS$k,
                                   ci_low=(res18wfSS$b-(1.96*res18wfSS$se)),ci_up=(res18wfSS$b+(1.96*res18wfSS$se)),
                                   row.names=FALSE, stringsAsFactors=TRUE))

data_res_figwf

##FFS fall data wrangling for figures####

data_res_figff <- rbind(data.frame(group="2",  season="Annual", estimate=res1ff$b, n=res1ff$k,
                                  ci_low=(res1ff$b-(1.96*res1ff$se)),ci_up=(res1ff$b+(1.96*res1ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual",estimate=res2ff$b, n=res2ff$k,
                                  ci_low=(res2ff$b-(1.96*res2ff$se)),ci_up=(res2ff$b+(1.96*res2ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual",estimate=res3ff$b, n=res3ff$k,
                                  ci_low=(res3ff$b-(1.96*res3ff$se)),ci_up=(res3ff$b+(1.96*res3ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual",estimate=res4ff$b, n=res4ff$k,
                                  ci_low=(res4ff$b-(1.96*res4ff$se)),ci_up=(res4ff$b+(1.96*res4ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual",estimate=res5ff$b,n=res5ff$k,
                                  ci_low=(res5ff$b-(1.96*res5ff$se)),ci_up=(res5ff$b+(1.96*res5ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual",estimate=res6ff$b, n=res6ff$k,
                                  ci_low=(res6ff$b-(1.96*res6ff$se)),ci_up=(res6ff$b+(1.96*res6ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual",estimate=res7ff$b, n=res7ff$k,
                                  ci_low=(res7ff$b-(1.96*res7ff$se)),ci_up=(res7ff$b+(1.96*res7ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual",estimate=res8ff$b,n=res8ff$k,
                                  ci_low=(res8ff$b-(1.96*res8ff$se)),ci_up=(res8ff$b+(1.96*res8ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual",estimate=res9ff$b, n=res9ff$k,
                                  ci_low=(res9ff$b-(1.96*res9ff$se)),ci_up=(res9ff$b+(1.96*res9ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual",estimate=res10ff$b,n=res10ff$k,
                                  ci_low=(res10ff$b-(1.96*res10ff$se)),ci_up=(res10ff$b+(1.96*res10ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual",estimate=res11ff$b, n=res11ff$k,
                                  ci_low=(res11ff$b-(1.96*res11ff$se)),ci_up=(res11ff$b+(1.96*res11ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual",estimate=res12ff$b, n=res12ff$k,
                                  ci_low=(res12ff$b-(1.96*res12ff$se)),ci_up=(res12ff$b+(1.96*res12ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual",estimate=res13ff$b, n=res13ff$k,
                                  ci_low=(res13ff$b-(1.96*res13ff$se)),ci_up=(res13ff$b+(1.96*res13ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual",estimate=res14ff$b, n=res14ff$k,
                                  ci_low=(res14ff$b-(1.96*res14ff$se)),ci_up=(res14ff$b+(1.96*res14ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual",estimate=res15ff$b,n=res15ff$k,
                                  ci_low=(res15ff$b-(1.96*res15ff$se)),ci_up=(res15ff$b+(1.96*res15ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual",estimate=res16ff$b, n=res16ff$k,
                                  ci_low=(res16ff$b-(1.96*res16ff$se)),ci_up=(res16ff$b+(1.96*res16ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual",estimate=res17ff$b,n=res17ff$k,
                                  ci_low=(res17ff$b-(1.96*res17ff$se)),ci_up=(res17ff$b+(1.96*res17ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual",estimate=res18ff$b, n=res18ff$k,
                                  ci_low=(res18ff$b-(1.96*res18ff$se)),ci_up=(res18ff$b+(1.96*res18ff$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2", season="Subannual", estimate=res1ffS$b,n=res1ffS$k, 
                                  ci_low=(res1ffS$b-(1.96*res1ffS$se)),ci_up=(res1ffS$b+(1.96*res1ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Subannual",estimate=res2ffS$b, n=res2ffS$k,
                                  ci_low=(res2ffS$b-(1.96*res2ffS$se)),ci_up=(res2ffS$b+(1.96*res2ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Subannual",estimate=res3ffS$b, n=res3ffS$k,
                                  ci_low=(res3ffS$b-(1.96*res3ffS$se)),ci_up=(res3ffS$b+(1.96*res3ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Subannual",estimate=res4ffS$b, n=res4ffS$k,
                                  ci_low=(res4ffS$b-(1.96*res4ffS$se)),ci_up=(res4ffS$b+(1.96*res4ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Subannual",estimate=res5ffS$b,n=res5ffS$k,
                                  ci_low=(res5ffS$b-(1.96*res5ffS$se)),ci_up=(res5ffS$b+(1.96*res5ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Subannual",estimate=res6ffS$b, n=res6ffS$k,
                                  ci_low=(res6ffS$b-(1.96*res6ffS$se)),ci_up=(res6ffS$b+(1.96*res6ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Subannual",estimate=res7ffS$b, n=res7ffS$k,
                                  ci_low=(res7ffS$b-(1.96*res7ffS$se)),ci_up=(res7ffS$b+(1.96*res7ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Subannual",estimate=res8ffS$b,n=res8ffS$k,
                                  ci_low=(res8ffS$b-(1.96*res8ffS$se)),ci_up=(res8ffS$b+(1.96*res8ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Subannual",estimate=res9ffS$b, n=res9ffS$k,
                                  ci_low=(res9ffS$b-(1.96*res9ffS$se)),ci_up=(res9ffS$b+(1.96*res9ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Subannual",estimate=res10ffS$b,n=res10ffS$k,
                                  ci_low=(res10ffS$b-(1.96*res10ffS$se)),ci_up=(res10ffS$b+(1.96*res10ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Subannual",estimate=res11ffS$b, n=res11ffS$k,
                                  ci_low=(res11ffS$b-(1.96*res11ffS$se)),ci_up=(res11ffS$b+(1.96*res11ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Subannual",estimate=res12ffS$b, n=res12ffS$k,
                                  ci_low=(res12ffS$b-(1.96*res12ffS$se)),ci_up=(res12ffS$b+(1.96*res12ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Subannual",estimate=res13ffS$b, n=res13ffS$k,
                                  ci_low=(res13ffS$b-(1.96*res13ffS$se)),ci_up=(res13ffS$b+(1.96*res13ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Subannual",estimate=res14ffS$b, n=res14ffS$k,
                                  ci_low=(res14ffS$b-(1.96*res14ffS$se)),ci_up=(res14lfS$b+(1.96*res14lfS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Subannual",estimate=res15ffS$b,n=res15ffS$k,
                                  ci_low=(res15ffS$b-(1.96*res15ffS$se)),ci_up=(res15ffS$b+(1.96*res15ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Subannual",estimate=res16ffS$b, n=res16ffS$k,
                                  ci_low=(res16ffS$b-(1.96*res16ffS$se)),ci_up=(res16ffS$b+(1.96*res16ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Subannual",estimate=res17ffS$b,n=res17ffS$k,
                                  ci_low=(res17ffS$b-(1.96*res17ffS$se)),ci_up=(res17ffS$b+(1.96*res17ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Subannual",estimate=res18ffS$b, n=res18ffS$k,
                                  ci_low=(res18ffS$b-(1.96*res18ffS$se)),ci_up=(res18ffS$b+(1.96*res18ffS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2",  season="Annual*", estimate=res1ffSS$b, n=res1ffSS$k,
                                  ci_low=(res1ffSS$b-(1.96*res1ffSS$se)),ci_up=(res1ffSS$b+(1.96*res1ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual*",estimate=res2ffSS$b, n=res2ffSS$k,
                                  ci_low=(res2ffSS$b-(1.96*res2ffSS$se)),ci_up=(res2ffSS$b+(1.96*res2ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual*",estimate=res3ffSS$b, n=res3ffSS$k,
                                  ci_low=(res3ffSS$b-(1.96*res3ffSS$se)),ci_up=(res3ffSS$b+(1.96*res3ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual*",estimate=res4ffSS$b, n=res4ffSS$k,
                                  ci_low=(res4ffSS$b-(1.96*res4ffSS$se)),ci_up=(res4ffSS$b+(1.96*res4ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual*",estimate=res5ffSS$b,n=res5ffSS$k,
                                  ci_low=(res5ffSS$b-(1.96*res5ffSS$se)),ci_up=(res5ffSS$b+(1.96*res5ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual*",estimate=res6ffSS$b, n=res6ffSS$k,
                                  ci_low=(res6ffSS$b-(1.96*res6ffSS$se)),ci_up=(res6ffSS$b+(1.96*res6ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual*",estimate=res7ffSS$b, n=res7ffSS$k,
                                  ci_low=(res7ffSS$b-(1.96*res7ffSS$se)),ci_up=(res7ffSS$b+(1.96*res7ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual*",estimate=res8ffSS$b,n=res8ffSS$k,
                                  ci_low=(res8ffSS$b-(1.96*res8ffSS$se)),ci_up=(res8ffSS$b+(1.96*res8ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual*",estimate=res9ffSS$b, n=res9ffSS$k,
                                  ci_low=(res9ffSS$b-(1.96*res9ffSS$se)), ci_up=(res9ffSS$b+(1.96*res9ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual*",estimate=res10ffSS$b,n=res10ffSS$k,
                                  ci_low=(res10ffSS$b-(1.96*res10ffSS$se)),ci_up=(res10ffSS$b+(1.96*res10ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual*",estimate=res11ffSS$b, n=res11ffSS$k,
                                  ci_low=(res11ffSS$b-(1.96*res11ffSS$se)),ci_up=(res11ffSS$b+(1.96*res11ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual*",estimate=res12ffSS$b, n=res12ffSS$k,
                                  ci_low=(res12ffSS$b-(1.96*res12ffSS$se)),ci_up=(res12ffSS$b+(1.96*res12ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual*",estimate=res13ffSS$b, n=res13ffSS$k,
                                  ci_low=(res13ffSS$b-(1.96*res13ffSS$se)),ci_up=(res13ffSS$b+(1.96*res13ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual*",estimate=res14ffSS$b, n=res14ffSS$k,
                                  ci_low=(res14ffSS$b-(1.96*res14ffSS$se)),ci_up=(res14ffSS$b+(1.96*res14ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual*",estimate=res15ffSS$b,n=res15ffSS$k,
                                  ci_low=(res15ffSS$b-(1.96*res15ffSS$se)),ci_up=(res15ffSS$b+(1.96*res15ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual*",estimate=res16ffSS$b, n=res16ffSS$k,
                                  ci_low=(res16ffSS$b-(1.96*res16ffSS$se)),ci_up=(res16ffSS$b+(1.96*res16ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual*",estimate=res17ffSS$b,n=res17ffSS$k,
                                  ci_low=(res17ffSS$b-(1.96*res17ffSS$se)),ci_up=(res17ffSS$b+(1.96*res17ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual*",estimate=res18ffSS$b, n=res18ffSS$k,
                                  ci_low=(res18ffSS$b-(1.96*res18ffSS$se)),ci_up=(res18ffSS$b+(1.96*res18ffSS$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))


data_res_figff

####Fig6 All resilience data points####

##1 to 36 months####

p<-ggplot(data=data, aes(x=interval, y=OR, colour=Drug)) + geom_point() + geom_line()
p<-p+geom_ribbon(aes(ymin=data$lower, ymax=data$upper), linetype=2, alpha=0.1)

## Total litterfall all data points by Treatment

forrest_data_res_tot<-rbind(data.frame(ES=tot_lit_all$yi,SE=sqrt(tot_lit_all$vi),Type="Case",Site=tot_lit_all$Site, Case_study=tot_lit_all$Case_ID, Cyclone=tot_lit_all$DisturbanceName, SoilP=tot_lit_all$Other_soil_P, Region=tot_lit_all$Country,TSD=tot_lit_all$TSD_months,Treatment=tot_lit_all$Treatment))
str(forrest_data_res_tot)
forrest_data_res$Case_study=as.factor(forrest_data_res$Case_study)
forrest_data_res_tot$Case2<-factor(forrest_data_res_tot$Case_study, levels=rev(levels(forrest_data_res_tot$Case_study)))
str(forrest_data_res_tot)

## Annual

forrest_data_res<-rbind(data.frame(ES=resall.1$yi,SE=sqrt(resall.1$vi),Type="Case",Site=data_es1to36$Site, Case_study=data_es1to36$Effectsize_ID, Cyclone=data_es1to36$DisturbanceName, SoilP=data_es1to36$Other_soil_P, Region=data_es1to36$Country,TSD=data_es1to36$TSD_months,Treatment=data_es1to36$Treatment))
str(forrest_data_res)
forrest_data_res$SoilP=as.numeric(forrest_data_res$SoilP)
forrest_data_res$Case_study=as.factor(forrest_data_res$Case_study)
forrest_data_res$Case2<-factor(forrest_data_res$Case_study, levels=rev(levels(forrest_data_res$Case_study)))
str(forrest_data_res)

#+ylab(expression(Anthropogenic~SO[4]^{"2-"}~(ngm^-3)))

plot1res<-ggplot(data=forrest_data_res,aes(x=TSD,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE)))+geom_pointrange(aes(color=Region),alpha=0.6,size=1)+guides(title="Region")+scale_color_manual(values=c("#1dabe6","#b35a2d","#c3ced0","#ffa600","#665191","#af060f"))

plot2res<-plot1res+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = 0.6)#+geom_hline(aes(yintercept=3.88), lty=2, color = "black", cex=0.9, alpha = 0.6)

plot3res<-plot2res+xlab("")+ylab("")+
  #ylab(expression(Resilience~(ln~Litterfall~t[x]~t[i]^-1)))+
  theme_bw() + scale_x_continuous(breaks = c(1, 4, 8, 12, 16, 20, 24, 28, 32, 36)) + annotate("text", x = 32, y = 2.5, fontface="bold",label = "c Annual", size=6,colour="black")                                                                                   #color="black")

Fig6c<-plot3res+ylim(-2.8,2.8)+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),axis.title=element_text(size=18),axis.text.x=element_text(size=17,angle=0, hjust=0.5),axis.text.y=element_text(size=17,angle=0, hjust=1))+theme(legend.title = element_blank(), legend.text = element_text (size = 18),legend.box="horizontal",legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
                                                                                                                                                                                 legend.box.background = element_rect(colour = "white"))+
  guides(fill = guide_legend(ncol = 1, nrow = 1, byrow = TRUE))#+b1+scale_color_discrete("Dark2")

Fig6c

plot1res.1<-ggplot(data=forrest_data_res,aes(x=TSD,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE),colour=Region,shape=Treatment))+geom_pointrange(aes(color=Region),alpha=0.6,size=1)+guides(title="Region")+#scale_color_gradient(low="blue", high="orange")
scale_color_manual(values=c("#1dabe6","#b35a2d","#c3ced0","#ffa600","#665191","#af060f"))

plot2res.1<-plot1res.1+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = 0.6)
Fig6c.1<-plot2res.1+xlab("")+xlab("Time since disturbance (months)")+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[i]^-1)))+
  theme_bw() +xlim(1,14)+ylim(-2.8,2.8)+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),axis.title=element_text(size=18),axis.text.x=element_text(size=17,angle=0, hjust=0.5),axis.text.y=element_text(size=17,angle=0, hjust=1))+theme(legend.title = element_blank(), legend.text = element_text (size = 18),legend.box="horizontal",legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
                                                                                                                                                                                                                                                                                                                               legend.box.background = element_rect(colour = "white"))+
  guides(fill = guide_legend(ncol = 1, nrow = 1, byrow = TRUE))+geom_smooth(method = 'loess',alpha=0.2,se=FALSE)+theme(strip.text.x = element_text(size=16))
Fig6c.1
Fig6c.1+facet_wrap(~Region+Treatment)+ylim(-2.8,2)+xlim(1,36)

## Subannual

forrest_data_resS<-rbind(data.frame(ES=resall.1S$yi,SE=sqrt(resall.1S$vi),Type="Case",Site=data_es1to36S$Site, Case_study=data_es1to36S$Effectsize_ID, Cyclone=data_es1to36S$DisturbanceName, SoilP=data_es1to36S$Other_soil_P, Region=data_es1to36S$Country,TSD=data_es1to36S$TSD_months, Treatment=data_es1to36S$Treatment))
str(forrest_data_resS)
forrest_data_resS$SoilP=as.numeric(forrest_data_resS$SoilP)
forrest_data_resS$Case_study=as.factor(forrest_data_resS$Case_study)
forrest_data_resS$Case2<-factor(forrest_data_resS$Case_study, levels=rev(levels(forrest_data_resS$Case_study)))
str(forrest_data_res)

plot1resS<-ggplot(data=forrest_data_resS,aes(x=TSD,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE)))+geom_pointrange(aes(color=Region),alpha=0.6,size=1)+guides(title="Region")+scale_color_manual(values=c("#1dabe6","#c3ced0","#ffa600","#665191"))

plot2resS<-plot1resS+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = 0.6)#+geom_hline(aes(yintercept=3.88), lty=2, color = "black", cex=0.9, alpha = 0.6)

plot3resS<-plot2resS+xlab("")+
  #ylab("Resilience [ln(litterfall tx/t0)]")+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[i]^-1)))+theme_bw() + scale_x_continuous(breaks = c(1, 4, 8, 12, 16, 20, 24, 28, 32, 36)) + annotate("text", x = 32, y = 2.5, fontface="bold",label = "d Subannual", size=6,colour="black")                                                                                   #color="black")

Fig6d<-plot3resS+ylim(-2.8,2.8)+theme(panel.grid.major=element_blank(),panel.grid.minor = element_blank(),axis.title=element_text(size=20),axis.text.x=element_text(size=17,angle=0, hjust=0.5),axis.text.y=element_text(size=17,angle=0, hjust=1))+theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))#+b1+scale_color_discrete("Dark2")

Fig6d

plot6dres.1<-ggplot(data=forrest_data_resS,aes(x=TSD,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE),colour=Region,shape=Treatment))+geom_pointrange(aes(color=Region),alpha=0.6,size=1)+guides(title="Region")+#scale_color_gradient(low="blue", high="orange")
  scale_color_manual(values=c("#1dabe6","#c3ced0","#ffa600","#665191"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = 0.6)
Fig6d.1<-plot6dres.1+xlab("")+xlab("Time since disturbance (months)")+
  ylab(expression(Resilience~(ln~Litterfall~t[x]~t[i]^-1)))+
  theme_bw() +xlim(1,14)+ylim(-2.8,2.8)+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),axis.title=element_text(size=18),
                                              axis.text.x=element_text(size=17,angle=0, hjust=0.5),axis.text.y=element_text(size=17,angle=0, hjust=1))+
  theme(legend.title = element_blank(), legend.text = element_text (size = 18),legend.box="horizontal",legend.position="top",
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.box.background = element_rect(colour = "white"))+guides(fill = guide_legend(ncol = 1, nrow = 1, byrow = TRUE))+
  geom_smooth(method = 'loess',alpha=0.2,se=FALSE)+theme(strip.text.x = element_text(size=16))
Fig6d.1
Fig6d.1+facet_wrap(~Region+Treatment)+ylim(-2.8,2)+xlim(1,36)


forrest_data_resSS<-rbind(data.frame(ES=resall.1SS$yi,SE=sqrt(resall.1SS$vi),Type="Case",Site=data_es1to36SS$Site, Case_study=data_es1to36SS$Effectsize_ID, Cyclone=data_es1to36SS$DisturbanceName, SoilP=data_es1to36SS$Other_soil_P, Region=data_es1to36SS$Country,TSD=data_es1to36SS$TSD_months))
str(forrest_data_resSS)
forrest_data_resSS$SoilP=as.numeric(forrest_data_resSS$SoilP)
forrest_data_resSS$Case_study=as.factor(forrest_data_resSS$Case_study)
forrest_data_resSS$Case2<-factor(forrest_data_resSS$Case_study, levels=rev(levels(forrest_data_resSS$Case_study)))

plot1resSS<-ggplot(data=forrest_data_resSS,aes(x=TSD,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE)))+geom_pointrange(aes(color=Region),alpha=0.6,size=1)+guides(title="Region")+scale_color_manual(values=c("#1dabe6","#c3ced0","#ffa600","#665191"))

plot2resSS<-plot1resSS+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = 0.6)#+geom_hline(aes(yintercept=3.88), lty=2, color = "black", cex=0.9, alpha = 0.6)

plot3resSS<-plot2resSS+xlab("Time since disturbance (months)")+#ylab(expression(Resilience~(ln~Litterfall~t[x]~t[i]^-1)))+
  ylab("")+
  theme_bw() + scale_x_continuous(breaks = c(1, 4, 8, 12, 16, 20, 24, 28, 32, 36)) + annotate("text", x = 32, y = 2.5, fontface="bold",label = "e Annual*", size=6,colour="black")                                                                                   #color="black")

Fig6e<-plot3resSS+ylim(-2.8,2.8)+theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),axis.title=element_text(size=20),axis.text.x=element_text(size=17,angle=0, hjust=0.5),axis.text.y=element_text(size=17,angle=0, hjust=1))+theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))#+b1+scale_color_discrete("Dark2")

Fig6e


Fig6c<-ggplot(forrest_data_res, aes(x=group,y=ES,ymax=ES+(1.96*SE),ymin=ES-(1.96*SE), color = Region)) +
  geom_pointrange(size=0.8,position=position_dodge(width=c(0.7, 1.2))) +
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience", x="Time since disturbance (months)") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.position = c(0.12,0.9)) +scale_shape_discrete(solid=F)+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+
  scale_color_manual(values=c("#141212","#AB9F9F","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1)))+ annotate("text", x = 0.4, y = 0.5, fontface="bold",label = "b", size=8,colour="black")
#scale_y_continuous(breaks = c(-80,-60,-40,-20,0,20,40))# use theme() to change font sizes+scale_color_manual(values=c("#003f5c","#ffa600","#a05195"))+scale_color_grey(start=0.65, end=0.25)




data_res_fig6.1 <- rbind(data.frame(group="2",  season="Annual", estimate=res1$b, n=res1$k,
                                  ci_low=(res1$b-(1.96*res1$se)),ci_up=(res1$b+(1.96*res1$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", season="Annual",estimate=res2$b, n=res2$k,
                                  ci_low=(res2$b-(1.96*res2$se)),ci_up=(res2$b+(1.96*res2$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", season="Annual",estimate=res3$b, n=res3$k,
                                  ci_low=(res3$b-(1.96*res3$se)),ci_up=(res3$b+(1.96*res3$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", season="Annual",estimate=res4$b, n=res4$k,
                                  ci_low=(res4$b-(1.96*res4$se)),ci_up=(res4$b+(1.96*res4$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", season="Annual",estimate=res5$b,n=res5$k,
                                  ci_low=(res5$b-(1.96*res5$se)),ci_up=(res5$b+(1.96*res5$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", season="Annual",estimate=res6$b, n=res6$k,
                                  ci_low=(res6$b-(1.96*res6$se)),ci_up=(res6$b+(1.96*res6$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", season="Annual",estimate=res7$b, n=res7$k,
                                  ci_low=(res7$b-(1.96*res7$se)),ci_up=(res7$b+(1.96*res7$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", season="Annual",estimate=res8$b,n=res8$k,
                                  ci_low=(res8$b-(1.96*res8$se)),ci_up=(res8$b+(1.96*res8$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", season="Annual",estimate=res9$b, n=res9$k,
                                  ci_low=(res9$b-(1.96*res9$se)),ci_up=(res9$b+(1.96*res9$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", season="Annual",estimate=res10$b,n=res10$k,
                                  ci_low=(res10$b-(1.96*res10$se)),ci_up=(res10$b+(1.96*res10$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", season="Annual",estimate=res11$b, n=res11$k,
                                  ci_low=(res11$b-(1.96*res11$se)),ci_up=(res11$b+(1.96*res11$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", season="Annual",estimate=res12$b, n=res12$k,
                                  ci_low=(res12$b-(1.96*res12$se)),ci_up=(res12$b+(1.96*res12$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", season="Annual",estimate=res13$b, n=res13$k,
                                  ci_low=(res13$b-(1.96*res13$se)),ci_up=(res13$b+(1.96*res13$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", season="Annual",estimate=res14$b, n=res14$k,
                                  ci_low=(res14$b-(1.96*res14$se)),ci_up=(res14$b+(1.96*res14$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", season="Annual",estimate=res15$b,n=res15$k,
                                  ci_low=(res15$b-(1.96*res15$se)),ci_up=(res15$b+(1.96*res15$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", season="Annual",estimate=res16$b, n=res16$k,
                                  ci_low=(res16$b-(1.96*res16$se)),ci_up=(res16$b+(1.96*res16$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", season="Annual",estimate=res17$b,n=res17$k,
                                  ci_low=(res17$b-(1.96*res17$se)),ci_up=(res17$b+(1.96*res17$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", season="Annual",estimate=res18$b, n=res18$k,
                                  ci_low=(res18$b-(1.96*res18$se)),ci_up=(res18$b+(1.96*res18$se)),
                                  row.names=FALSE, stringsAsFactors=TRUE))
data_res_fig6.1

data_res3a <- rbind(data.frame(group="2", season="season", estimate=res1S$b, 
                              ci_low=res1S$ci.lb, ci_up=res1S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="4", season="season",estimate=res2S$b, 
                              ci_low=res2S$ci.lb, ci_up=res2S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="6", season="season",estimate=res3S$b, 
                              ci_low=res3S$ci.lb, ci_up=res3S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="8", season="season",estimate=res4S$b, 
                              ci_low=res4S$ci.lb, ci_up=res4S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="10", season="season",estimate=res5S$b,
                              ci_low=res5S$ci.lb, ci_up=res5S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="12", season="season",estimate=res6S$b, 
                              ci_low=res6S$ci.lb, ci_up=res6S$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="2",  season="no season", estimate=res1$b, 
                              ci_low=res1$ci.lb, ci_up=res1$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="4", season="no season",estimate=res2$b, 
                              ci_low=res2$ci.lb, ci_up=res2$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="6", season="no season",estimate=res3$b, 
                              ci_low=res3$ci.lb, ci_up=res3$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="8", season="no season",estimate=res4$b, 
                              ci_low=res4$ci.lb, ci_up=res4$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="10", season="no season",estimate=res5$b,
                              ci_low=res5$ci.lb, ci_up=res5$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE),
                   data.frame(group="12", season="no season",estimate=res6$b, 
                              ci_low=res6$ci.lb, ci_up=res6$ci.ub,
                              row.names=FALSE, stringsAsFactors=TRUE))
data_res3a

####Data Recovery Overall Effect####

model_dat_Amb2 <- rbind(data.frame(group="0.5", estimate=random0a$b, 
                                  ci_low=random0a$ci.lb, ci_up=random0a$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="2", estimate=random1$b, 
                                  ci_low=random1$ci.lb, ci_up=random1$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="4", estimate=random2$b, 
                                  ci_low=random2$ci.lb, ci_up=random2$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="6", estimate=random3$b, 
                                  ci_low=random3$ci.lb, ci_up=random3$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="8", estimate=random4$b, 
                                  ci_low=random4$ci.lb, ci_up=random4$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="10", estimate=random5$b, 
                                  ci_low=random5$ci.lb, ci_up=random5$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="12", estimate=random6$b, 
                                  ci_low=random6$ci.lb, ci_up=random6$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="14", estimate=random7$b, 
                                  ci_low=random7$ci.lb, ci_up=random7$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="16", estimate=random8$b, 
                                  ci_low=random8$ci.lb, ci_up=random8$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="18", estimate=random9$b, 
                                  ci_low=random9$ci.lb, ci_up=random9$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="20", estimate=random10$b, 
                                  ci_low=random10$ci.lb, ci_up=random10$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="22", estimate=random11$b, 
                                  ci_low=random11$ci.lb, ci_up=random11$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="24", estimate=random12$b, 
                                  ci_low=random12$ci.lb, ci_up=random12$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="26", estimate=random13$b, 
                                  ci_low=random13$ci.lb, ci_up=random13$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="28", estimate=random14$b, 
                                  ci_low=random14$ci.lb, ci_up=random14$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="30", estimate=random15$b, 
                                  ci_low=random15$ci.lb, ci_up=random15$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="32", estimate=random16$b, 
                                  ci_low=random16$ci.lb, ci_up=random16$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="34", estimate=random17$b, 
                                  ci_low=random17$ci.lb, ci_up=random17$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="36", estimate=random18$b, 
                                  ci_low=random18$ci.lb, ci_up=random18$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="38", estimate=random19$b, 
                                  ci_low=random19$ci.lb, ci_up=random19$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="40", estimate=random20$b, 
                                  ci_low=random20$ci.lb, ci_up=random20$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="42", estimate=random21$b, 
                                  ci_low=random21$ci.lb, ci_up=random21$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="44", estimate=random22$b, 
                                  ci_low=random22$ci.lb, ci_up=random22$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="46", estimate=random23$b, 
                                  ci_low=random23$ci.lb, ci_up=random23$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="48", estimate=random24$b, 
                                  ci_low=random24$ci.lb, ci_up=random24$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="50", estimate=random25$b, 
                                  ci_low=random25$ci.lb, ci_up=random25$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="52", estimate=random26$b, 
                                  ci_low=random26$ci.lb, ci_up=random26$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="54", estimate=random27$b, 
                                  ci_low=random27$ci.lb, ci_up=random27$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="56", estimate=random28$b, 
                                  ci_low=random28$ci.lb, ci_up=random28$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="58", estimate=random29$b, 
                                  ci_low=random29$ci.lb, ci_up=random29$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE),
                       data.frame(group="60", estimate=random30$b, 
                                  ci_low=random30$ci.lb, ci_up=random30$ci.ub,
                                  row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amb2

k_Amb2<-rbind(data.frame(group="0.5", estimate=random0a$k, row.names=FALSE, stringsAsFactors=TRUE),
              data.frame(group="2", estimate=random1$k, row.names=FALSE, stringsAsFactors=TRUE))
k_Amb2

model_dat_Amblf <- rbind(data.frame(group="0.5", estimate=random0lf$b, 
                                   ci_low=random0lf$ci.lb, ci_up=random0lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="2", estimate=random1lf$b, 
                                   ci_low=random1lf$ci.lb, ci_up=random1lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="4", estimate=random2lf$b, 
                                   ci_low=random2lf$ci.lb, ci_up=random2lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="6", estimate=random3lf$b, 
                                   ci_low=random3lf$ci.lb, ci_up=random3lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="8", estimate=random4lf$b, 
                                   ci_low=random4lf$ci.lb, ci_up=random4lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="10", estimate=random5lf$b, 
                                   ci_low=random5lf$ci.lb, ci_up=random5lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="12", estimate=random6lf$b, 
                                   ci_low=random6lf$ci.lb, ci_up=random6lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="14", estimate=random7lf$b, 
                                   ci_low=random7lf$ci.lb, ci_up=random7lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="16", estimate=random8lf$b, 
                                   ci_low=random8lf$ci.lb, ci_up=random8lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="18", estimate=random9lf$b, 
                                   ci_low=random9lf$ci.lb, ci_up=random9lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="20", estimate=random10lf$b, 
                                   ci_low=random10lf$ci.lb, ci_up=random10lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="22", estimate=random11lf$b, 
                                   ci_low=random11lf$ci.lb, ci_up=random11lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="24", estimate=random12lf$b, 
                                   ci_low=random12lf$ci.lb, ci_up=random12lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="26", estimate=random13lf$b, 
                                   ci_low=random13lf$ci.lb, ci_up=random13lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="28", estimate=random14lf$b, 
                                   ci_low=random14lf$ci.lb, ci_up=random14lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="30", estimate=random15lf$b, 
                                   ci_low=random15lf$ci.lb, ci_up=random15lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="32", estimate=random16lf$b, 
                                   ci_low=random16lf$ci.lb, ci_up=random16lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="34", estimate=random17lf$b, 
                                   ci_low=random17lf$ci.lb, ci_up=random17lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="36", estimate=random18lf$b, 
                                   ci_low=random18lf$ci.lb, ci_up=random18lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="38", estimate=random19lf$b, 
                                   ci_low=random19lf$ci.lb, ci_up=random19lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="40", estimate=random20lf$b, 
                                   ci_low=random20lf$ci.lb, ci_up=random20lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="42", estimate=random21lf$b, 
                                   ci_low=random21lf$ci.lb, ci_up=random21lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="44", estimate=random22lf$b, 
                                   ci_low=random22lf$ci.lb, ci_up=random22lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="46", estimate=random23lf$b, 
                                   ci_low=random23lf$ci.lb, ci_up=random23lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="48", estimate=random24lf$b, 
                                   ci_low=random24lf$ci.lb, ci_up=random24lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="50", estimate=random25lf$b, 
                                   ci_low=random25lf$ci.lb, ci_up=random25lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="52", estimate=random26lf$b, 
                                   ci_low=random26lf$ci.lb, ci_up=random26lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="54", estimate=random27lf$b, 
                                   ci_low=random27lf$ci.lb, ci_up=random27lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="56", estimate=random28lf$b, 
                                   ci_low=random28lf$ci.lb, ci_up=random28lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="58", estimate=random29lf$b, 
                                   ci_low=random29lf$ci.lb, ci_up=random29lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE),
                        data.frame(group="60", estimate=random30lf$b, 
                                   ci_low=random30lf$ci.lb, ci_up=random30lf$ci.ub,
                                   row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amblf

summary(random30lf)
#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

model_dat_Amblf2 <- rbind(data.frame(group="2", estimate=-(1-exp(random1lf$b))*100, 
                                    ci_low=-(1-exp(random1lf$ci.lb))*100, ci_up=-(1-exp(random1lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=-(1-exp(random2lf$b))*100, 
                                    ci_low=-(1-exp(random2lf$ci.lb))*100, ci_up=-(1-exp(random2lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="6", estimate=-(1-exp(random3lf$b))*100, 
                                    ci_low=-(1-exp(random3lf$ci.lb))*100, ci_up=-(1-exp(random3lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=-(1-exp(random4lf$b))*100, 
                                    ci_low=-(1-exp(random4lf$ci.lb))*100, ci_up=-(1-exp(random4lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=-(1-exp(random5lf$b))*100, 
                                    ci_low=-(1-exp(random5lf$ci.lb))*100, ci_up=-(1-exp(random5lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=-(1-exp(random6lf$b))*100, 
                                    ci_low=-(1-exp(random6lf$ci.lb))*100, ci_up=-(1-exp(random6lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=-(1-exp(random7lf$b))*100, 
                                    ci_low=-(1-exp(random7lf$ci.lb))*100, ci_up=-(1-exp(random7lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=-(1-exp(random8lf$b))*100, 
                                    ci_low=-(1-exp(random8lf$ci.lb))*100, ci_up=-(1-exp(random8lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=-(1-exp(random9lf$b))*100, 
                                    ci_low=-(1-exp(random9lf$ci.lb))*100, ci_up=-(1-exp(random9lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=-(1-exp(random10lf$b))*100, 
                                    ci_low=-(1-exp(random10lf$ci.lb))*100, ci_up=-(1-exp(random10lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=-(1-exp(random11lf$b))*100, 
                                    ci_low=-(1-exp(random11lf$ci.lb))*100, ci_up=((exp(random11lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=-(1-exp(random12lf$b))*100, 
                                    ci_low=-(1-exp(random12lf$ci.lb))*100, ci_up=-(1-exp(random12lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=-(1-exp(random13lf$b))*100, 
                                    ci_low=-(1-exp(random13lf$ci.lb))*100, ci_up=-(1-exp(random13lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=-(1-exp(random14lf$b))*100, 
                                    ci_low=-(1-exp(random14lf$ci.lb))*100, ci_up=-(1-exp(random14lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=-(1-exp(random15lf$b))*100, 
                                    ci_low=-(1-exp(random15lf$ci.lb))*100, ci_up=-(1-exp(random15lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=-(1-exp(random16lf$b))*100, 
                                    ci_low=-(1-exp(random16lf$ci.lb))*100, ci_up=-(1-exp(random16lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=-(1-exp(random17lf$b))*100, 
                                    ci_low=-(1-exp(random17lf$ci.lb))*100, ci_up=((exp(random17lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=-(1-exp(random18lf$b))*100, 
                                    ci_low=-(1-exp(random18lf$ci.lb))*100, ci_up=-(1-exp(random18lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=-(1-exp(random19lf$b))*100, 
                                    ci_low=-(1-exp(random19lf$ci.lb))*100, ci_up=-(1-exp(random19lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=-(1-exp(random20lf$b))*100, 
                                    ci_low=-(1-exp(random20lf$ci.lb))*100, ci_up=-(1-exp(random20lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=-(1-exp(random21lf$b))*100, 
                                    ci_low=-(1-exp(random21lf$ci.lb))*100, ci_up=((exp(random21lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=-(1-exp(random22lf$b))*100, 
                                    ci_low=-(1-exp(random22lf$ci.lb))*100, ci_up=((exp(random22lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=-(1-exp(random23lf$b))*100, 
                                    ci_low=-(1-exp(random23lf$ci.lb))*100, ci_up=((exp(random23lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=-(1-exp(random24lf$b))*100, 
                                    ci_low=-(1-exp(random24lf$ci.lb))*100, ci_up=((exp(random24lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=-(1-exp(random25lf$b))*100, 
                                    ci_low=-(1-exp(random25lf$ci.lb))*100, ci_up=-(1-exp(random25lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=-(1-exp(random26lf$b))*100, 
                                    ci_low=-(1-exp(random26lf$ci.lb))*100, ci_up=-(1-exp(random26lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=((exp(random27lf$b))-1)*100, 
                                    ci_low=-(1-exp(random27lf$ci.lb))*100, ci_up=((exp(random27lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=((exp(random28lf$b))-1)*100, 
                                    ci_low=((exp(random28lf$ci.lb))-1)*100, ci_up=((exp(random28lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=((exp(random29lf$b))-1)*100, 
                                    ci_low=-(1-exp(random29lf$ci.lb))*100, ci_up=((exp(random29lf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=-(1-exp(random30lf$b))*100, 
                                    ci_low=-(1-exp(random30lf$ci.lb))*100, ci_up=-(1-exp(random30lf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amblf2

model_dat_Ambwf <- rbind(data.frame(group="0.5", estimate=random0wf$b, 
                                    ci_low=random0wf$ci.lb, ci_up=random0wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="2", estimate=random1wf$b, 
                                    ci_low=random1wf$ci.lb, ci_up=random1wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=random2wf$b, 
                                    ci_low=random2wf$ci.lb, ci_up=random2wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="6", estimate=random3wf$b, 
                                    ci_low=random3wf$ci.lb, ci_up=random3wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=random4wf$b, 
                                    ci_low=random4wf$ci.lb, ci_up=random4wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=random5wf$b, 
                                    ci_low=random5wf$ci.lb, ci_up=random5wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=random6wf$b, 
                                    ci_low=random6wf$ci.lb, ci_up=random6wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=random7wf$b, 
                                    ci_low=random7wf$ci.lb, ci_up=random7wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=random8wf$b, 
                                    ci_low=random8wf$ci.lb, ci_up=random8wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=random9wf$b, 
                                    ci_low=random9wf$ci.lb, ci_up=random9wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=random10wf$b, 
                                    ci_low=random10wf$ci.lb, ci_up=random10wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=random11wf$b, 
                                    ci_low=random11wf$ci.lb, ci_up=random11wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=random12wf$b, 
                                    ci_low=random12wf$ci.lb, ci_up=random12wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=random13wf$b, 
                                    ci_low=random13wf$ci.lb, ci_up=random13wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=random14wf$b, 
                                    ci_low=random14wf$ci.lb, ci_up=random14wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=random15wf$b, 
                                    ci_low=random15wf$ci.lb, ci_up=random15wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=random16wf$b, 
                                    ci_low=random16wf$ci.lb, ci_up=random16wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=random17wf$b, 
                                    ci_low=random17wf$ci.lb, ci_up=random17wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=random18wf$b, 
                                    ci_low=random18wf$ci.lb, ci_up=random18wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=random19wf$b, 
                                    ci_low=random19wf$ci.lb, ci_up=random19wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=random20wf$b, 
                                    ci_low=random20wf$ci.lb, ci_up=random20wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=random21wf$b, 
                                    ci_low=random21wf$ci.lb, ci_up=random21wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=random22wf$b, 
                                    ci_low=random22wf$ci.lb, ci_up=random22wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=random23wf$b, 
                                    ci_low=random23wf$ci.lb, ci_up=random23wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=random24wf$b, 
                                    ci_low=random24wf$ci.lb, ci_up=random24wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=random25wf$b, 
                                    ci_low=random25wf$ci.lb, ci_up=random25wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=random26wf$b, 
                                    ci_low=random26wf$ci.lb, ci_up=random26wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=random27wf$b, 
                                    ci_low=random27wf$ci.lb, ci_up=random27wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=random28wf$b, 
                                    ci_low=random28wf$ci.lb, ci_up=random28wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=random29wf$b, 
                                    ci_low=random29wf$ci.lb, ci_up=random29wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=random30wf$b, 
                                    ci_low=random30wf$ci.lb, ci_up=random30wf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Ambwf

#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

summary(random13wf)

model_dat_Ambwf2 <- rbind(data.frame(group="2", estimate=-(1-exp(random1wf$b))*100, 
                                    ci_low=-(1-exp(random1wf$ci.lb))*100, ci_up=-(1-exp(random1wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=-(1-exp(random2wf$b))*100, 
                                    ci_low=-(1-exp(random2wf$ci.lb))*100, ci_up=-(1-exp(random2wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="6", estimate=-(1-exp(random3wf$b))*100, 
                                    ci_low=-(1-exp(random3wf$ci.lb))*100, ci_up=-(1-exp(random3wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=-(1-exp(random4wf$b))*100, 
                                    ci_low=-(1-exp(random4wf$ci.lb))*100, ci_up=-(1-exp(random4wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=-(1-exp(random5wf$b))*100, 
                                    ci_low=-(1-exp(random5wf$ci.lb))*100, ci_up=-(1-exp(random5wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=-(1-exp(random6wf$b))*100, 
                                    ci_low=-(1-exp(random6wf$ci.lb))*100, ci_up=-(1-exp(random6wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=-(1-exp(random7wf$b))*100, 
                                    ci_low=-(1-exp(random7wf$ci.lb))*100, ci_up=-(1-exp(random7wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=-(1-exp(random8wf$b))*100, 
                                    ci_low=-(1-exp(random8wf$ci.lb))*100, ci_up=((exp(random8wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=-(1-exp(random9wf$b))*100, 
                                    ci_low=-(1-exp(random9wf$ci.lb))*100, ci_up=((exp(random9wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=-(1-exp(random10wf$b))*100, 
                                    ci_low=-(1-exp(random10wf$ci.lb))*100, ci_up=((exp(random10wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=-(1-exp(random11wf$b))*100, 
                                    ci_low=-(1-exp(random11wf$ci.lb))*100, ci_up=-(1-exp(random11wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=-(1-exp(random12wf$b))*100, 
                                    ci_low=-(1-exp(random12wf$ci.lb))*100, ci_up=-(1-exp(random12wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=-(1-exp(random13wf$b))*100, 
                                    ci_low=-(1-exp(random13wf$ci.lb))*100, ci_up=((exp(random13wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=-(1-exp(random14wf$b))*100, 
                                    ci_low=-(1-exp(random14wf$ci.lb))*100, ci_up=-(1-exp(random14wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=-(1-exp(random15wf$b))*100, 
                                    ci_low=-(1-exp(random15wf$ci.lb))*100, ci_up=-(1-exp(random15wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=-(1-exp(random16wf$b))*100, 
                                    ci_low=-(1-exp(random16wf$ci.lb))*100, ci_up=-(1-exp(random16wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=-(1-exp(random17wf$b))*100, 
                                    ci_low=-(1-exp(random17wf$ci.lb))*100, ci_up=-(1-exp(random17wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=-(1-exp(random18wf$b))*100, 
                                    ci_low=-(1-exp(random18wf$ci.lb))*100, ci_up=-(1-exp(random18wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=-(1-exp(random19wf$b))*100, 
                                    ci_low=-(1-exp(random19wf$ci.lb))*100, ci_up=-(1-exp(random19wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=-(1-exp(random20wf$b))*100, 
                                    ci_low=-(1-exp(random20wf$ci.lb))*100, ci_up=-(1-exp(random20wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=-(1-exp(random21wf$b))*100, 
                                    ci_low=-(1-exp(random21wf$ci.lb))*100, ci_up=((exp(random21wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=-(1-exp(random22wf$b))*100, 
                                    ci_low=-(1-exp(random22wf$ci.lb))*100, ci_up=-(1-exp(random22wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=-(1-exp(random23wf$b))*100, 
                                    ci_low=-(1-exp(random23wf$ci.lb))*100, ci_up=-(1-exp(random23wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=-(1-exp(random24wf$b))*100, 
                                    ci_low=-(1-exp(random24wf$ci.lb))*100, ci_up=-(1-exp(random24wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=-(1-exp(random25wf$b))*100, 
                                    ci_low=-(1-exp(random25wf$ci.lb))*100, ci_up=-(1-exp(random25wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=-(1-exp(random26wf$b))*100, 
                                    ci_low=-(1-exp(random26wf$ci.lb))*100, ci_up=-(1-exp(random26wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=-(1-exp(random27wf$b))*100, 
                                    ci_low=-(1-exp(random27wf$ci.lb))*100, ci_up=-(1-exp(random27wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=-(1-exp(random28wf$b))*100, 
                                    ci_low=-(1-exp(random28wf$ci.lb))*100, ci_up=-(1-exp(random28wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=-(1-exp(random29wf$b))*100, 
                                    ci_low=-(1-exp(random29wf$ci.lb))*100, ci_up=((exp(random29wf$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=-(1-exp(random30wf$b))*100, 
                                    ci_low=-(1-exp(random30wf$ci.lb))*100, ci_up=-(1-exp(random30wf$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Ambwf2

model_dat_Ambff <- rbind(data.frame(group="0.5", estimate=random0ff$b, 
                                    ci_low=random0ff$ci.lb, ci_up=random0ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="2", estimate=random1ff$b, 
                                    ci_low=random1ff$ci.lb, ci_up=random1ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=random2ff$b, 
                                    ci_low=random2ff$ci.lb, ci_up=random2ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="6", estimate=random3ff$b, 
                                    ci_low=random3ff$ci.lb, ci_up=random3ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=random4ff$b, 
                                    ci_low=random4ff$ci.lb, ci_up=random4ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=random5ff$b, 
                                    ci_low=random5ff$ci.lb, ci_up=random5ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=random6ff$b, 
                                    ci_low=random6ff$ci.lb, ci_up=random6ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=random7ff$b, 
                                    ci_low=random7ff$ci.lb, ci_up=random7ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=random8ff$b, 
                                    ci_low=random8ff$ci.lb, ci_up=random8ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=random9ff$b, 
                                    ci_low=random9ff$ci.lb, ci_up=random9ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=random10ff$b, 
                                    ci_low=random10ff$ci.lb, ci_up=random10ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=random11ff$b, 
                                    ci_low=random11ff$ci.lb, ci_up=random11ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=random12ff$b, 
                                    ci_low=random12ff$ci.lb, ci_up=random12ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=random13ff$b, 
                                    ci_low=random13ff$ci.lb, ci_up=random13ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=random14ff$b, 
                                    ci_low=random14ff$ci.lb, ci_up=random14ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=random15ff$b, 
                                    ci_low=random15ff$ci.lb, ci_up=random15ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=random16ff$b, 
                                    ci_low=random16ff$ci.lb, ci_up=random16ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=random17ff$b, 
                                    ci_low=random17ff$ci.lb, ci_up=random17ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=random18ff$b, 
                                    ci_low=random18ff$ci.lb, ci_up=random18ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=random19ff$b, 
                                    ci_low=random19ff$ci.lb, ci_up=random19ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=random20ff$b, 
                                    ci_low=random20ff$ci.lb, ci_up=random20ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=random21ff$b, 
                                    ci_low=random21ff$ci.lb, ci_up=random21ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=random22ff$b, 
                                    ci_low=random22ff$ci.lb, ci_up=random22ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=random23ff$b, 
                                    ci_low=random23ff$ci.lb, ci_up=random23ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=random24ff$b, 
                                    ci_low=random24ff$ci.lb, ci_up=random24ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=random25ff$b, 
                                    ci_low=random25ff$ci.lb, ci_up=random25ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=random26ff$b, 
                                    ci_low=random26ff$ci.lb, ci_up=random26ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=random27ff$b, 
                                    ci_low=random27ff$ci.lb, ci_up=random27ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=random28ff$b, 
                                    ci_low=random28ff$ci.lb, ci_up=random28ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=random29ff$b, 
                                    ci_low=random29ff$ci.lb, ci_up=random29ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=random30ff$b, 
                                    ci_low=random30ff$ci.lb, ci_up=random30ff$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Ambff

#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

summary(random30ff)

model_dat_Ambff2 <- rbind(data.frame(group="2", estimate=-(1-exp(random1ff$b))*100, 
                                    ci_low=-(1-exp(random1ff$ci.lb))*100, ci_up=-(1-exp(random1ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=-(1-exp(random2ff$b))*100, 
                                    ci_low=-(1-exp(random2ff$ci.lb))*100, ci_up=-(1-exp(random2ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="6", estimate=-(1-exp(random3ff$b))*100, 
                                    ci_low=-(1-exp(random3ff$ci.lb))*100, ci_up=-(1-exp(random3ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=-(1-exp(random4ff$b))*100, 
                                    ci_low=-(1-exp(random4ff$ci.lb))*100, ci_up=-(1-exp(random4ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=-(1-exp(random5ff$b))*100, 
                                    ci_low=-(1-exp(random5ff$ci.lb))*100, ci_up=-(1-exp(random5ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=-(1-exp(random6ff$b))*100, 
                                    ci_low=-(1-exp(random6ff$ci.lb))*100, ci_up=((exp(random6ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=-(1-exp(random7ff$b))*100, 
                                    ci_low=-(1-exp(random7ff$ci.lb))*100, ci_up=-(1-exp(random7ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=-(1-exp(random8ff$b))*100, 
                                    ci_low=-(1-exp(random8ff$ci.lb))*100, ci_up=-(1-exp(random8ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=-(1-exp(random9ff$b))*100, 
                                    ci_low=-(1-exp(random9ff$ci.lb))*100, ci_up=((exp(random9ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=-(1-exp(random10ff$b))*100, 
                                    ci_low=-(1-exp(random10ff$ci.lb))*100, ci_up=-(1-exp(random10ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=-(1-exp(random11ff$b))*100, 
                                    ci_low=-(1-exp(random11ff$ci.lb))*100, ci_up=((exp(random11ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=-(1-exp(random12ff$b))*100, 
                                    ci_low=-(1-exp(random12ff$ci.lb))*100, ci_up=((exp(random12ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=-(1-exp(random13ff$b))*100, 
                                    ci_low=-(1-exp(random13ff$ci.lb))*100, ci_up=-(1-exp(random13ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=-(1-exp(random14ff$b))*100, 
                                    ci_low=-(1-exp(random14ff$ci.lb))*100, ci_up=-(1-exp(random14ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=-(1-exp(random15ff$b))*100, 
                                    ci_low=-(1-exp(random15ff$ci.lb))*100, ci_up=-(1-exp(random15ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=-(1-exp(random16ff$b))*100, 
                                    ci_low=-(1-exp(random16ff$ci.lb))*100, ci_up=-(1-exp(random16ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=-(1-exp(random17ff$b))*100, 
                                    ci_low=-(1-exp(random17ff$ci.lb))*100, ci_up=-(1-exp(random17ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=-(1-exp(random18ff$b))*100, 
                                    ci_low=-(1-exp(random18ff$ci.lb))*100, ci_up=((exp(random18ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=-(1-exp(random19ff$b))*100, 
                                    ci_low=-(1-exp(random19ff$ci.lb))*100, ci_up=-(1-exp(random19ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=-(1-exp(random20ff$b))*100, 
                                    ci_low=-(1-exp(random20ff$ci.lb))*100, ci_up=((exp(random20ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=-(1-exp(random21ff$b))*100, 
                                    ci_low=-(1-exp(random21ff$ci.lb))*100, ci_up=((exp(random21ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=((exp(random22ff$b))-1)*100, 
                                    ci_low=((exp(random22ff$ci.lb))-1)*100, ci_up=((exp(random22ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=((exp(random23ff$b))-1)*100, 
                                    ci_low=((exp(random23ff$ci.lb))-1)*100, ci_up=((exp(random23ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=-(1-exp(random24ff$b))*100, 
                                    ci_low=-(1-exp(random24ff$ci.lb))*100, ci_up=((exp(random24ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=-(1-exp(random25ff$b))*100, 
                                    ci_low=-(1-exp(random25ff$ci.lb))*100, ci_up=-(1-exp(random25ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=-(1-exp(random26ff$b))*100, 
                                    ci_low=-(1-exp(random26ff$ci.lb))*100, ci_up=-(1-exp(random26ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=-(1-exp(random27ff$b))*100, 
                                    ci_low=-(1-exp(random27ff$ci.lb))*100, ci_up=-(1-exp(random27ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=((exp(random28ff$b))-1)*100, 
                                    ci_low=((exp(random28ff$ci.lb))-1)*100, ci_up=((exp(random28ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=((exp(random29ff$b))-1)*100, 
                                    ci_low=-(1-exp(random29ff$ci.lb))*100, ci_up=((exp(random29ff$ci.ub))-1)*100,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=-(1-exp(random30ff$b))*100, 
                                    ci_low=-(1-exp(random30ff$ci.lb))*100, ci_up=-(1-exp(random30ff$ci.ub))*100,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Ambff2

model_dat_Amb_tpf <- rbind(data.frame(group="0.5", estimate=random0tpf$b,
                                    ci_low=random0tpf$ci.lb, ci_up=random0tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="2", estimate=random1tpf$b, 
                                    ci_low=random1tpf$ci.lb, ci_up=random1tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="4", estimate=random2tpf$b, 
                                    ci_low=random2tpf$ci.lb, ci_up=random2tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                          data.frame(group="6", estimate=random3tpf$b, 
                                    ci_low=random3tpf$ci.lb, ci_up=random3tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="8", estimate=random4tpf$b, 
                                    ci_low=random4tpf$ci.lb, ci_up=random4tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="10", estimate=random5tpf$b, 
                                    ci_low=random5tpf$ci.lb, ci_up=random5tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="12", estimate=random6tpf$b, 
                                    ci_low=random6tpf$ci.lb, ci_up=random6tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="14", estimate=random7tpf$b, 
                                    ci_low=random7tpf$ci.lb, ci_up=random7tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="16", estimate=random8tpf$b, 
                                    ci_low=random8tpf$ci.lb, ci_up=random8tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="18", estimate=random9tpf$b, 
                                    ci_low=random9tpf$ci.lb, ci_up=random9tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="20", estimate=random10tpf$b, 
                                    ci_low=random10tpf$ci.lb, ci_up=random10tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="22", estimate=random11tpf$b, 
                                    ci_low=random11tpf$ci.lb, ci_up=random11tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="24", estimate=random12tpf$b, 
                                    ci_low=random12tpf$ci.lb, ci_up=random12tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="26", estimate=random13tpf$b, 
                                    ci_low=random13tpf$ci.lb, ci_up=random13tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="28", estimate=random14tpf$b, 
                                    ci_low=random14tpf$ci.lb, ci_up=random14tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="30", estimate=random15tpf$b, 
                                    ci_low=random15tpf$ci.lb, ci_up=random15tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="32", estimate=random16tpf$b, 
                                    ci_low=random16tpf$ci.lb, ci_up=random16tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="34", estimate=random17tpf$b, 
                                    ci_low=random17tpf$ci.lb, ci_up=random17tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="36", estimate=random18tpf$b, 
                                    ci_low=random18tpf$ci.lb, ci_up=random18tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="38", estimate=random19tpf$b, 
                                    ci_low=random19tpf$ci.lb, ci_up=random19tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="40", estimate=random20tpf$b, 
                                    ci_low=random20tpf$ci.lb, ci_up=random20tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="42", estimate=random21tpf$b, 
                                    ci_low=random21tpf$ci.lb, ci_up=random21tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="44", estimate=random22tpf$b, 
                                    ci_low=random22tpf$ci.lb, ci_up=random22tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="46", estimate=random23tpf$b, 
                                    ci_low=random23tpf$ci.lb, ci_up=random23tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="48", estimate=random24tpf$b, 
                                    ci_low=random24tpf$ci.lb, ci_up=random24tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="50", estimate=random25tpf$b, 
                                    ci_low=random25tpf$ci.lb, ci_up=random25tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="52", estimate=random26tpf$b, 
                                    ci_low=random26tpf$ci.lb, ci_up=random26tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="54", estimate=random27tpf$b, 
                                    ci_low=random27tpf$ci.lb, ci_up=random27tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="56", estimate=random28tpf$b, 
                                    ci_low=random28tpf$ci.lb, ci_up=random28tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="58", estimate=random29tpf$b, 
                                    ci_low=random29tpf$ci.lb, ci_up=random29tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE),
                         data.frame(group="60", estimate=random30tpf$b, 
                                    ci_low=random30tpf$ci.lb, ci_up=random30tpf$ci.ub,
                                    row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amb_tpf

model_dat_Amb_tpf2 <- rbind(data.frame(group="2", estimate=random1tpf$b, 
                                      ci_low=random1tpf$ci.lb, ci_up=random1tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="4", estimate=random2tpf$b, 
                                      ci_low=random2tpf$ci.lb, ci_up=random2tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="6", estimate=random3tpf$b, 
                                      ci_low=random3tpf$ci.lb, ci_up=random3tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="8", estimate=random4tpf$b, 
                                      ci_low=random4tpf$ci.lb, ci_up=random4tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="10", estimate=random5tpf$b, 
                                      ci_low=random5tpf$ci.lb, ci_up=random5tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="12", estimate=random6tpf$b, 
                                      ci_low=random6tpf$ci.lb, ci_up=random6tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="14", estimate=random7tpf$b, 
                                      ci_low=random7tpf$ci.lb, ci_up=random7tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="16", estimate=random8tpf$b, 
                                      ci_low=random8tpf$ci.lb, ci_up=random8tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="18", estimate=random9tpf$b, 
                                      ci_low=random9tpf$ci.lb, ci_up=random9tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="20", estimate=random10tpf$b, 
                                      ci_low=random10tpf$ci.lb, ci_up=random10tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="22", estimate=random11tpf$b, 
                                      ci_low=random11tpf$ci.lb, ci_up=random11tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="24", estimate=random12tpf$b, 
                                      ci_low=random12tpf$ci.lb, ci_up=random12tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="26", estimate=random13tpf$b, 
                                      ci_low=random13tpf$ci.lb, ci_up=random13tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="28", estimate=random14tpf$b, 
                                      ci_low=random14tpf$ci.lb, ci_up=random14tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="30", estimate=random15tpf$b, 
                                      ci_low=random15tpf$ci.lb, ci_up=random15tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="32", estimate=random16tpf$b, 
                                      ci_low=random16tpf$ci.lb, ci_up=random16tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="34", estimate=random17tpf$b, 
                                      ci_low=random17tpf$ci.lb, ci_up=random17tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="36", estimate=random18tpf$b, 
                                      ci_low=random18tpf$ci.lb, ci_up=random18tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="38", estimate=random19tpf$b, 
                                      ci_low=random19tpf$ci.lb, ci_up=random19tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="40", estimate=random20tpf$b, 
                                      ci_low=random20tpf$ci.lb, ci_up=random20tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="42", estimate=random21tpf$b, 
                                      ci_low=random21tpf$ci.lb, ci_up=random21tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="44", estimate=random22tpf$b, 
                                      ci_low=random22tpf$ci.lb, ci_up=random22tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="46", estimate=random23tpf$b, 
                                      ci_low=random23tpf$ci.lb, ci_up=random23tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="48", estimate=random24tpf$b, 
                                      ci_low=random24tpf$ci.lb, ci_up=random24tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="50", estimate=random25tpf$b, 
                                      ci_low=random25tpf$ci.lb, ci_up=random25tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="52", estimate=random26tpf$b, 
                                      ci_low=random26tpf$ci.lb, ci_up=random26tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="54", estimate=random27tpf$b, 
                                      ci_low=random27tpf$ci.lb, ci_up=random27tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="56", estimate=random28tpf$b, 
                                      ci_low=random28tpf$ci.lb, ci_up=random28tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="58", estimate=random29tpf$b, 
                                      ci_low=random29tpf$ci.lb, ci_up=random29tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE),
                           data.frame(group="60", estimate=random30tpf$b, 
                                      ci_low=random30tpf$ci.lb, ci_up=random30tpf$ci.ub,
                                      row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amb_tpf2

#If negative, this is the formula: -(1-exp(random1$b))*100
#If positive, this is the formula: ((exp(random0a$b))-1)*100

summary(random30tpf)

model_dat_Amb_tpf2a <- rbind(data.frame(group="2", estimate=-(1-exp(random1tpf$b))*100, 
                                       ci_low=-(1-exp(random1tpf$ci.lb))*100, ci_up=-(1-exp(random1tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="4", estimate=-(1-exp(random2tpf$b))*100, 
                                       ci_low=-(1-exp(random2tpf$ci.lb))*100, ci_up=-(1-exp(random2tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="6", estimate=-(1-exp(random3tpf$b))*100, 
                                       ci_low=-(1-exp(random3tpf$ci.lb))*100, ci_up=-(1-exp(random3tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="8", estimate=-(1-exp(random4tpf$b))*100, 
                                       ci_low=-(1-exp(random4tpf$ci.lb))*100, ci_up=-(1-exp(random4tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="10", estimate=-(1-exp(random5tpf$b))*100, 
                                       ci_low=-(1-exp(random5tpf$ci.lb))*100, ci_up=-(1-exp(random5tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="12", estimate=-(1-exp(random6tpf$b))*100, 
                                       ci_low=-(1-exp(random6tpf$ci.lb))*100, ci_up=-(1-exp(random6tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="14", estimate=-(1-exp(random7tpf$b))*100, 
                                       ci_low=-(1-exp(random7tpf$ci.lb))*100, ci_up=-(1-exp(random7tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="16", estimate=-(1-exp(random8tpf$b))*100, 
                                       ci_low=-(1-exp(random8tpf$ci.lb))*100, ci_up=-(1-exp(random8tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="18", estimate=-(1-exp(random9tpf$b))*100, 
                                       ci_low=-(1-exp(random9tpf$ci.lb))*100, ci_up=-(1-exp(random9tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="20", estimate=-(1-exp(random10tpf$b))*100, 
                                       ci_low=-(1-exp(random10tpf$ci.lb))*100, ci_up=-(1-exp(random10tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="22", estimate=-(1-exp(random11tpf$b))*100, 
                                       ci_low=-(1-exp(random11tpf$ci.lb))*100, ci_up=-(1-exp(random11tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="24", estimate=-(1-exp(random12tpf$b))*100, 
                                       ci_low=-(1-exp(random12tpf$ci.lb))*100, ci_up=-(1-exp(random12tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="26", estimate=-(1-exp(random13tpf$b))*100, 
                                       ci_low=-(1-exp(random13tpf$ci.lb))*100, ci_up=-(1-exp(random13tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="28", estimate=-(1-exp(random14tpf$b))*100, 
                                       ci_low=-(1-exp(random14tpf$ci.lb))*100, ci_up=-(1-exp(random14tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="30", estimate=-(1-exp(random15tpf$b))*100, 
                                       ci_low=-(1-exp(random15tpf$ci.lb))*100, ci_up=-(1-exp(random15tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="32", estimate=-(1-exp(random16tpf$b))*100, 
                                       ci_low=-(1-exp(random16tpf$ci.lb))*100, ci_up=-(1-exp(random16tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="34", estimate=-(1-exp(random17tpf$b))*100, 
                                       ci_low=-(1-exp(random17tpf$ci.lb))*100, ci_up=-(1-exp(random17tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="36", estimate=-(1-exp(random18tpf$b))*100, 
                                       ci_low=-(1-exp(random18tpf$ci.lb))*100, ci_up=-(1-exp(random18tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="38", estimate=-(1-exp(random19tpf$b))*100, 
                                       ci_low=-(1-exp(random19tpf$ci.lb))*100, ci_up=-(1-exp(random19tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="40", estimate=-(1-exp(random20tpf$b))*100, 
                                       ci_low=-(1-exp(random20tpf$ci.lb))*100, ci_up=-(1-exp(random20tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="42", estimate=-(1-exp(random21tpf$b))*100, 
                                       ci_low=-(1-exp(random21tpf$ci.lb))*100, ci_up=-(1-exp(random21tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="44", estimate=-(1-exp(random22tpf$b))*100, 
                                       ci_low=-(1-exp(random22tpf$ci.lb))*100, ci_up=((exp(random22tpf$ci.ub))-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="46", estimate=-(1-exp(random23tpf$b))*100, 
                                       ci_low=-(1-exp(random23tpf$ci.lb))*100, ci_up=-(1-exp(random23tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="48", estimate=-(1-exp(random24tpf$b))*100, 
                                       ci_low=-(1-exp(random24tpf$ci.lb))*100, ci_up=-(1-exp(random24tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="50", estimate=-(1-exp(random25tpf$b))*100, 
                                       ci_low=-(1-exp(random25tpf$ci.lb))*100, ci_up=-(1-exp(random25tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="52", estimate=-(1-exp(random26tpf$b))*100, 
                                       ci_low=-(1-exp(random26tpf$ci.lb))*100, ci_up=-(1-exp(random26tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="54", estimate=-(1-exp(random27tpf$b))*100, 
                                       ci_low=-(1-exp(random27tpf$ci.lb))*100, ci_up=-(1-exp(random27tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="56", estimate=-(1-exp(random28tpf$b))*100, 
                                       ci_low=-(1-exp(random28tpf$ci.lb))*100, ci_up=((exp(random28tpf$ci.ub))-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="58", estimate=-(1-exp(random29tpf$b))*100, 
                                       ci_low=-(1-exp(random29tpf$ci.lb))*100, ci_up=-(1-exp(random29tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="60", estimate=-(1-exp(random30tpf$b))*100, 
                                       ci_low=-(1-exp(random30tpf$ci.lb))*100, ci_up=-(1-exp(random30tpf$ci.ub))*100,
                                       row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amb_tpf2a

####FIGURES FRACTIONS####
## P flux all fractions

summary(random0mpf)
model_dat_Amb_frac_P <- rbind(data.frame(group="Total", estimate=(exp(random0tpf$b)-1)*100, 
                                       ci_low=(exp(random0tpf$ci.lb)-1)*100, ci_up=(exp(random0tpf$ci.ub)-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                              data.frame(group="Wood", estimate=(exp(random0wpf$b)-1)*100, 
                                         ci_low=(exp(random0wpf$ci.lb)-1)*100, ci_up=(exp(random0wpf$ci.ub)-1)*100,
                                         row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="Leaf", estimate=(exp(random0lpf$b)-1)*100, 
                                       ci_low=(exp(random0lpf$ci.lb)-1)*100, ci_up=(exp(random0lpf$ci.ub)-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="Misc.", estimate=-(1-(exp(random0mpf$b))*100), 
                                       ci_low=-(1-(exp(random0mpf$ci.lb))*100), ci_up=(exp(random0mpf$ci.ub)-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE),
                            data.frame(group="FFS", estimate=-(1-(exp(random0ffspf$b))*100), 
                                       ci_low=-(1-(exp(random0ffspf$ci.lb))*100), ci_up=(exp(random0ffspf$ci.ub)-1)*100,
                                       row.names=FALSE, stringsAsFactors=TRUE))
model_dat_Amb_frac_P

#Pantropical figure by region


ggplot(data_es0ia, aes(x=reorder(Region, -yi),y=yi, fill = Region)) +
  geom_boxplot(alpha=0.8) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=3.7), lty=2, color = "darkblue", cex=0.8) +scale_y_continuous(breaks = c(0,1,2,3,4,5,6,7))+
  geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1) +# this adds a dotted line for effect size of 0
  labs(y="Effect size (ln RR)", x="Region") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20))#+scale_fill_brewer(palette="Dark2") # use theme() to change font sizes

full.model3SS$b
pregion<-ggplot(data_region2, aes(x=reorder(Region, -yi),y=yi, fill = season)) +
  geom_boxplot(alpha=0.8) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  scale_y_continuous(breaks = c(0,1,2,3,4,5,6,7))+
  geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1) +
  geom_hline(aes(yintercept=3.87), lty=2, color = "black", cex=1)+
  geom_hline(aes(yintercept=3.88), lty=2, color = "blue", cex=1)+
  geom_hline(aes(yintercept=3.91), lty=2, color = "green", cex=1)+# this adds a dotted line for effect size of 0
  labs(y="Resistance (ln cyclone/pre)", x="Region") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=20),
        axis.text=element_text(size=20),legend.position=c(.75,.9),legend.text =  element_text(size=18),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black")) # use theme() to change font sizes

pregion+scale_color_manual(values=wes_palette(3, name="GrandBudapest1"))
pregion+scale_color_manual(values=wes_palette(3, name="Moonrise2"))
pregion+ scale_fill_brewer(palette="Dark2")

data_region2<-data_region2%>%rename(Cyclone = Disturbanceme)

summary(full.model3S)
7/13

data_es0iaS$Region

ggplot(data_es0iaS, aes(x=reorder(Region, -yi),y=yi, fill = Region)) +
  geom_boxplot(alpha=0.8) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=3.9), lty=2, color = "black", cex=0.8) +scale_y_continuous(breaks = c(0,1,2,3,4,5,6,7))+
  geom_hline(aes(yintercept=0), lty=2, color = "darkgreen", cex=1) +# this adds a dotted line for effect size of 0
  labs(y="Effect size (ln RR)", x="Region") +
  theme_cleveland() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20)) # use theme() to change font sizes

####Figure Litterfall by Region and Site####

pr<-pr%>%rename(Cyclone = Disturbanceme)
pr$Cyclone

plotpr<-ggplot(pr, aes(x=reorder(Site, -yi),y=yi, color = Cyclone, shape=season)) +
  geom_point(alpha=1, size = 4.5) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  scale_y_continuous(breaks = c(0,1,2,3,4,5,6,7))+
  geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1) +
  geom_hline(aes(yintercept=3.87), lty=2, color = "black", cex=1)+
  geom_hline(aes(yintercept=3.88), lty=2, color = "blue", cex=1)+
  geom_hline(aes(yintercept=3.91), lty=2, color = "green", cex=1)+# this adds a dotted line for effect size of 0
  labs(y="Resistance (ln cyclone/pre)", x="Site in the Caribbean") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=20),
        axis.text=element_text(size=20))+scale_shape_discrete(solid=F)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),
        legend.position = c(.29,.71),legend.margin = margin(6, 6, 6, 6),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+
  guides(fill = guide_legend(title = "Cyclone"),legend.key.width=22)# use theme() to change font sizes
plotpr+ scale_color_brewer(palette="Dark2")

prS<-prS %>% rename(Cyclone = Disturbanceme)
prS$Cyclone

ggplot(prS, aes(x=reorder(Site, -yi),y=yi, color = Cyclone)) +
  geom_point(alpha=1, size = 4.5) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=3.7), lty=2, color = "black", cex=0.8) +scale_y_continuous(breaks = c(0,1,2,3,4,5,6,7))+
  geom_hline(aes(yintercept=0), lty=2, color = "darkgreen", cex=1) +# this adds a dotted line for effect size of 0
  labs(y="Effect size (ln RR)", x="Site in PR") +
  theme_cleveland() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20))+
  theme(legend.title = element_text (size = 24), legend.text = element_text (size = 22),
        legend.position = c(.47, .99),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+
  guides(fill = guide_legend(title = "Cyclone"),legend.key.width=22)# use theme() to change font sizes


r<-round(aggregate(yi ~ Region_ID, data=data_es0ia, FUN=function(x) c(count=count(x),mean=mean(x), sd=sd(x), min=min(x), max=max(x))),3)
r

ggplot(d, aes(x=reorder(Region, -yi),y=yi, fill = Region)) +
  geom_barplot() +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=3.5), lty=2, color = "magenta") + # this adds a dotted line for effect size of 0
  labs(y="Effect size (ln RR)", x="Region") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=24),
        axis.text=element_text(size=24)) # use theme() to change font sizes


metadat$Fraction
df_pre <- metadat %>%
  group_by(Region,Site,Holdridge_life_zone) %>% filter(Treatment == "Ambient"|Treatment == "Trim"|Treatment == "TrimDeb") %>% filter (Fraction == "TotLitfall")
df_pre

summary(df_pre$Pre_Mean)
ggplot(df_pre, aes(x=reorder(Region, -Pre_Mean),y=Pre_Mean, ymax=Pre_Mean+Pre_SD, ymin=Pre_Mean-Pre_SD,color=Site)) +
  geom_pointrange() +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=2.64), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Pre-disturbance litterfall (g/m2/day)", x="Region") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=24),
        axis.text=element_text(size=24)) # use theme() to change font sizes

####PreMean plot####

ggplot(df_pre, aes(x=reorder(Region, -Pre_Mean),y=Pre_Mean,color=Holdridge_life_zone)) +
  geom_point(size=4) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=2.64), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Pre-disturbance litterfall (g/m2/day)", x="Region") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
      axis.title.y =element_text(vjust = 1),
      axis.title=element_text(size=26),
      axis.text=element_text(size=26),
axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=26))+guides(fill = guide_legend(title = "Region"),legend.key.width=22)+
  theme(legend.title = element_text (size = 22), legend.text = element_text (size = 22), legend.position = c(.99, .99),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

ggplot(model_dat2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange() +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=0), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Effect size (log response ratio)", x="Forest type") +
  theme_minimal() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=20),
        axis.text=element_text(size=20)) # use theme() to change font sizes 

ggplot(model_dat_PM, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.2, alpha=0.8) +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=0), lty=2, size=1.2, color = "magenta") + # this adds a dotted line for effect size of 0
  labs(y="Effect size (log response ratio)", x="Parent Material") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=28),
        axis.text=element_text(size=30))+ scale_y_continuous(breaks = c(-5, -2.5,  0, 2.5, 5, 10)) 

ggplot(model_dat2L, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange() +
  coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
  geom_hline(aes(yintercept=0), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Effect size (log response ratio)", x="Forest type") +
  theme_minimal() + # ggplot2 has a few theme options, I like minimal and classic
  theme(panel.grid.minor=element_blank(), # get rid of background grid
        panel.grid.major=element_blank(),
        axis.title=element_text(size=20),
        axis.text=element_text(size=20)) # use theme() to change font sizes 

ggplot(model_datP, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
        geom_pointrange() +
        coord_flip() +  #this flips the co-ordinates so your x axis becomes your y and vice versa
        geom_hline(aes(yintercept=0), lty=2) + # this adds a dotted line for effect size of 0
        labs(y="Effect size (log response ratio)", x="Time since disturbance (months)") +
        theme_minimal() + # ggplot2 has a few theme options, I like minimal and classic
        theme(panel.grid.minor=element_blank(), # get rid of background grid
              panel.grid.major=element_blank(),
              axis.title=element_text(size=20),
              axis.text=element_text(size=20)) # use theme() to change font sizes 

#Main Figure showing Effect sizes over time since disturbance

bres <- list(annotate("rect", alpha = .2,xmin = 0, xmax = 3.5,ymin = -Inf, max = 0,fill = '#ED8A7B'))

bres2 <- list(annotate("rect", alpha = .2,xmin = 3.5, xmax = 6.5,ymin = -Inf, max = 0,fill = '#BDE2C1'))

bres3 <- list(annotate("rect", alpha = .2,xmin = 6.5, xmax = Inf,ymin = -Inf, max = 0,fill = '#3EB559'))

##Fig 6 Leaf fall####

pklf<- data_res_figlf %>% group_by(group, season,n) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop)
pklf

#Fig6a

Fig_obs_lf<-ggplot(pklf, aes(group, n, color=season,shape=season)) +
  geom_linerange(aes(x = group, ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "", y = "")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=18),axis.text.x = element_blank())+#element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=24))+ scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 1.5, y = 30, fontface="bold",label = "a Leaf fall", size=7,colour="black")#fill=NULL,size="Case studies")

Fig_obs_lf

str(data_res_figlf)

Fig6lf<-ggplot(data_res_figlf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8,stroke=1,position=position_dodge(width=c(0.7, 1.2))) +#geom_line(aes(group=group,y=estimate))+
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 0.8,size=20,hjust=0.5),
        axis.text=element_text(size=18),legend.text =  element_text(size=26),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="top") + scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+scale_shape_discrete(solid=F)+
  scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1)))+ annotate("text", x = 2, y = 0.5, fontface="bold",label = "a Leaf fall", size=7,colour="black")

Figlf<-Fig6lf+breslf+bres2lf+bres3lf
Figlf#+geom_line(aes(group=season,linetype=season),size=1)

breslf <- list(annotate("rect", alpha = .2,xmin = 0, xmax = 1.5,ymin = -Inf, max = 0,fill = '#ED8A7B'))
bres2lf <- list(annotate("rect", alpha = .2,xmin = 1.5, xmax = 5.5,ymin = -Inf, max = 0,fill = '#BDE2C1'))
bres3lf <- list(annotate("rect", alpha = .2,xmin = 5.5, xmax = Inf,ymin = -Inf, max = 0,fill = '#3EB559'))


Fig6atoc<-Fig6a.1+ Fig6bfinal3 + Figlf+plot_layout(ncol=1,heights=c(0.5,1,1))
Fig6atoc

##Fig 6 Wood fall####

pkwf<- data_res_figwf %>% group_by(group, season,n) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop)
pkwf

Fig_obs_wf<-ggplot(pkwf, aes(group, n, color=season,shape=season)) +
  geom_linerange(aes(x = group, ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "", y = "Number of observations")+scale_shape_discrete(solid=F)+
  theme_pubr()+ylim(0,30)+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=18),axis.text.x = element_blank())+#element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+scale_y_continuous(breaks=c(0,10,20,30))+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 1.5, y = 27, fontface="bold",label = "b Wood fall", size=7,colour="black")#fill=NULL,size="Case studies")

Fig_obs_wf

str(data_res_figwf)

Fig6wf<-ggplot(data_res_figwf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8,stroke=1,position=position_dodge(width=c(0.7, 1.2))) +#geom_line(aes(group=group,y=estimate))+
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience", x="") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 0.8,size=22,hjust=0.5),
        axis.text=element_text(size=18),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none") + scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+scale_shape_discrete(solid=F)+
  scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1)))+ annotate("text", x = 2, y = 0.9, fontface="bold",label = "b Wood fall", size=7,colour="black")

Figwf<-Fig6wf+breswf+bres2wf+bres3wf
Figwf#+geom_line(aes(group=season,linetype=season),size=1)

breswf <- list(annotate("rect", alpha = .2,xmin = 0, xmax = 2.5,ymin = -Inf, max = 0,fill = '#ED8A7B'))
bres2wf <- list(annotate("rect", alpha = .2,xmin = 2.5, xmax = 3.5,ymin = -Inf, max = 0,fill = '#BDE2C1'))
bres3wf <- list(annotate("rect", alpha = .2,xmin = 3.5, xmax = Inf,ymin = -Inf, max = 0,fill = '#3EB559'))

##Fig 6 FFS fall####

pkff<- data_res_figff %>% group_by(group, season,n) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop)
pkff

Fig_obs_ff<-ggplot(pkff, aes(group, n, color=season,shape=season)) +
  geom_linerange(aes(x = group, ymin = 0, ymax = n), alpha=0.2, 
                 size = 1)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4,stroke=1)+labs(x = "Time since disturbance (months)", y = "")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="none",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=26))+ scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 1.5, y = 27, fontface="bold",label = "c FFS fall", size=7,colour="black")#fill=NULL,size="Case studies")

Fig_obs_ff

Fig_obs_frac<-Fig_obs_lf+ Fig_obs_wf+Fig_obs_ff+plot_layout(ncol=1,heights=c(0.4,0.4,0.4))
Fig_obs_frac

ggsave(filename = "FigS6_obs_frac.png",
       plot = Fig_obs_frac, width = 22, height = 22, units = 'cm',
       scale = 2, dpi = 600)

Fig6ff<-ggplot(data_res_figff, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8,stroke=1,position=position_dodge(width=c(0.7, 1.2))) +#geom_line(aes(group=group,y=estimate))+
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="", x="Time since disturbance (months)") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5,size=22),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 0.8,size=20,hjust=0.5),
        axis.text=element_text(size=18),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none") + scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+scale_shape_discrete(solid=F)+
  scale_color_manual(values=c("#141212","#7E7D86","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1)))+ annotate("text", x = 2, y = 0.9, fontface="bold",label = "c FFS fall", size=7,colour="black")

Figff<-Fig6ff+bresff+bres2ff+bres3ff
Figff#+geom_line(aes(group=season,linetype=season),size=1)

bresff <- list(annotate("rect", alpha = .2,xmin = 0, xmax = 3.5,ymin = -Inf, max = 0,fill = '#ED8A7B'))
bres2ff <- list(annotate("rect", alpha = .2,xmin = 3.5, xmax = 5.5,ymin = -Inf, max = 0,fill = '#BDE2C1'))
bres3ff <- list(annotate("rect", alpha = .2,xmin = 5.5, xmax = Inf,ymin = -Inf, max = 0,fill = '#3EB559'))

Fig6_frac<-Figlf +Figwf+Figff+plot_layout(ncol=1,heights=c(0.4,0.4,0.4))
Fig6_frac

ggsave(filename = "Fig6_res_frac.png",
       plot = Fig6_frac, width = 22, height = 20, units = 'cm',
       scale = 2, dpi = 600)


##FigSuplements

pk2a<- data_res_fig6amb %>% group_by(group, season,n) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                                  lab.ypos = cumsum(prop) - 0.5*prop)
pk2a

#FigSup

Fig6a_S<-ggplot(pk2a, aes(group, n, color=season,shape=season)) +
  geom_linerange(aes(x = group, ymin = 0, ymax = n), alpha=0.4, 
                 size = 1.5)+#geom_hline(aes(yintercept=20), lty=4,size=0.8,col="#C8B9B9")+
  geom_point(size = 4)+labs(x = "", y = "")+scale_shape_discrete(solid=F)+
  theme_pubr()+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=18),axis.text.x = element_text(angle=0, hjust=0.5,size=18))+
  theme(legend.title = element_blank (), legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),
        legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.text = element_text(size=20))+ scale_color_manual(values=c("#141212","#AB9F9F","#AB9F9F"))+scale_y_continuous(breaks=c(0,10,20,30,40))+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+ 
  annotate("text", x = 0.6, y = 41, fontface="bold",label = "a", size=8,colour="black")+labs(y="Number of observations")#fill=NULL,size="Case studies")

Fig6a_S

#Fig6b

Fig6b_S<-ggplot(data_res_fig6amb, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8,position=position_dodge(width=c(0.7, 1.2))) +
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience - ambient", x="Time since disturbance (months)") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=20),
        axis.text=element_text(size=18),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.box="horizontal",legend.position="none") + scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+scale_shape_discrete(solid=F)+
  scale_color_manual(values=c("#141212","#AB9F9F","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1)))+ annotate("text", x = 0.3, y = 0.5, fontface="bold",label = "b", size=8,colour="black")
#scale_y_continuous(breaks = c(-80,-60,-40,-20,0,20,40))# use theme() to change font sizes+scale_color_manual(values=c("#003f5c","#ffa600","#a05195"))+scale_color_grey(start=0.65, end=0.25)

Fig6b_S
#shading

bres <- list(
  annotate("rect", alpha = .2,xmin = 0, xmax = 3.4,ymin = -Inf, max = 0,fill = '#ED8A7B'))

bres2 <- list(
  annotate("rect", alpha = .2,xmin = 3.4, xmax = 6.4,ymin = -Inf, max = 0,fill = '#BDE2C1'))

bres3 <- list(
  annotate("rect", alpha = .2,xmin = 6.4, xmax = Inf,ymin = -Inf, max = 0,fill = '#3EB559'))


Fig6_S<-Fig6b_S+bres+bres2+bres3
Fig6_S

library(patchwork)
Fig6Sup<-Fig6a_S+ Fig6_S + plot_layout(ncol=1,heights=c(0.6,1.3))
Fig6Sup # Ambient conditions + TrimDeb only
ggsave(filename = "Fig_Res_SupMat.png",
       plot = Fig6Sup, width = 21, height = 12, units = 'cm',
       scale = 2, dpi = 600)


Fig6ctoe<-Fig6c+Fig6d+Fig6e+ plot_layout(ncol=1)

ggsave(filename = "Fig6c-e-final.png",
       plot = Fig6ctoe, width = 20, height = 20, units = 'cm',
       scale = 2, dpi = 600)

Fig6b.1<-ggplot(data_res_fig6, aes(x=group,y=estimate, shape = season, color = season)) +
  #geom_pointrange(size=0.8, alpha=0.8,position=position_dodge(width=c(0.7, 1.2))) +
  geom_line(aes(y=estimate, group = group),linetype=2, size = 1, alpha = 0.5)+
  geom_errorbar(aes(ymax=ci_up,ymin=ci_low),position=position_dodge(width=c(0.7, 1.2)))+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience", x="Time since disturbance (months)") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.position = c(0.12,0.9)) +scale_shape_discrete(solid=F)+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+
  scale_color_manual(values=c("#141212","#AB9F9F","#AB9F9F"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(color = guide_legend(override.aes = list(size = 1.2)))+ annotate("text", x = 0.4, y = 0.5, fontface="bold",label = "b", size=8,colour="black")
#scale_y_continuous(breaks = c(-80,-60,-40,-20,0,20,40))# use theme() to change font sizes+scale_color_manual(values=c("#003f5c","#ffa600","#a05195"))+scale_color_grey(start=0.65, end=0.25)

Fig6b.1final<-Fig6b.1+bres#+geom_line(aes(y=estimate, x = group, group = season))
Fig6b.1final

Fig6<-ggplot(data_res_fig6.1, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=0.8, alpha=0.7,shape=5) +
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Pantropical resilience", x="Time since disturbance (months)") +
  theme_pubr() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=22),
        axis.text=element_text(size=20),legend.text =  element_text(size=20),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.position = c(0.12,0.9)) +scale_shape_discrete(solid=F)+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 28, 32, 36))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ scale_color_grey(start=0.65, end=0.25)+
  guides(color = guide_legend(override.aes = list(size = 1.5)))#+ annotate("text", x = 0.7, y = 0.4, label = "b", face="bold",size=8,colour="black")+ scale_color_grey(start=0.65, end=0.25)+
Fig6

ggplot(data_res3a, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8, alpha=0.8) +
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Overall resilience (ln post/pre)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=20),
        axis.text=element_text(size=18),legend.text =  element_text(size=16),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.position = c(0.88,0.92),legend.box.background = element_rect(colour = "black")) +scale_shape_discrete(solid=F)+ scale_x_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12))+scale_color_brewer(palette="Dark2")
#scale_y_continuous(breaks = c(-80,-60,-40,-20,0,20,40))# use theme() to change font sizes

ggplot(data_rt_res, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low, shape = season, color = season)) +
  geom_pointrange(size=0.8, alpha=0.8) +
  # geom_line(aes(group="group"), linetype=1, size = 1, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=0.8,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Overall resistance and resilience", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=20),
        axis.text=element_text(size=18),legend.text =  element_text(size=16),
        legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),
        legend.title = element_blank(),legend.position = c(0.88,0.92),legend.box.background = element_rect(colour = "black")) +scale_shape_discrete(solid=F)+ scale_x_discrete(breaks = c(0, 4, 8, 12, 16, 20, 24, 30, 36))+scale_color_brewer(palette="Dark2")+scale_y_continuous(breaks=c(-2,0,2,4,6))
#

ggplot(model_dat_Amb2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.7) +
geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.2,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5)) + scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes

ggplot(model_dat_Amb_tpf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5)) + scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes

ggplot(model_dat_Amb_tpf2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

summary(random28tpf)
ggplot(model_dat_Amb_tpf2a, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))

ggplot(model_dat_Amb_lpc, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5, -1, -0.5, 0, 0.5, 1.0, 1.5)) + scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

ggplot(model_dat_Amb_lpc2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

ggplot(model_dat_Amb_lpc2a, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +ylim(-50,100)+
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes


ggplot(model_dat_Amb_tnf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5)) + scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes

ggplot(model_dat_Amb_tnf2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30))+ scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

ggplot(model_dat_Amb_tnf2a, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5)+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30))+ scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
#

ggplot(model_dat_Amb_lnc, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5, -1, -0.5, 0, 0.5, 1.0, 1.5)) + scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

ggplot(model_dat_Amb_lnc2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes

ggplot(model_dat_Amb_lnc2a, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, alpha=0.8, color="darkgreen") +ylim(-50,100)+
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes


library(MASS)
model_dat_Amb2
mam.new <- data.frame(body = log10(mammals$body))
ggplot(mam.new, aes(x = body)) +
  geom_histogram(aes( y = ..density..)) +
  geom_rug() +
  stat_function(fun = dnorm, colour = "red",
                arg = list(mean = mean(mam.new$body),
                           sd = sd(mam.new$body)))

ggplot(model_dat_Amb2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5) +
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4)) # use theme() to change font sizes
# use theme() to change font sizes

ggplot(model_dat_Amblf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "darkgreen", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-1.5,-1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5))+ scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes# use theme() to change font sizes

ggplot(model_dat_Amblf2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "darkgreen", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="darkgreen")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes


ggplot(model_dat_Ambwf, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "brown", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="brown")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-2.5,-2, -1.5,-1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5))+ scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes# use theme() to change font sizes# use theme() to change font sizes

ggplot(model_dat_Ambwf2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "brown", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="brown")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) +  scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes# use theme() to change font sizes# use theme() to change font sizes


ggplot(model_dat_Ambff, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "purple", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="purple")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + scale_y_continuous(breaks = c(-3.5,-3,-2.5,-2, -1.5,-1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5))+ scale_x_discrete(breaks = c(0.5, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes
# use theme() to change font sizes# use theme() to change font sizes# use theme() to change font sizes# use theme() to change font sizes

ggplot(model_dat_Ambff2, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5, color = "purple", alpha=0.8) +
  geom_line(aes(group="group"), linetype=1, size = 1.5, alpha = 0.5, color="purple")+
  geom_hline(aes(yintercept=0), lty=2,size=1.5,col="magenta") + # this adds a dotted line for effect size of 0
  labs(y="Summary effect size (%)", x="Months since disturbance") +
  theme_bw() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=30),
        axis.text=element_text(size=30)) + ylim(-100,100)+scale_x_discrete(breaks = c(4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60))# use theme() to change font sizes


#By Holdridge Life Zone
ggplot(model_dat_Hold, aes(x=reorder(group, -estimate),y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange() +
  coord_flip() +
  geom_hline(aes(yintercept=0), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Effect size (log response ratio)", x="Holdridge life zone") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=26),
        axis.text=element_text(size=26)) # use theme() to change font sizes

#Leaf fall P CONCENTRATION effect sizes over time

ggplot(model_datL, aes(x=group,y=estimate,ymax=ci_up,ymin=ci_low)) +
  geom_pointrange(size=1.5) +
  geom_hline(aes(yintercept=0), lty=2) + # this adds a dotted line for effect size of 0
  labs(y="Effect size (log response ratio)", x="Months since disturbance") +
  theme_pubclean() + # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title.x =element_text(vjust = -0.5),
        axis.text.x =element_text(vjust = -0.3),
        axis.title.y =element_text(vjust = 1),
        axis.title=element_text(size=28),
        axis.text=element_text(size=28)) # use theme() to change font sizes

####New Resilience Data####

df_Res <- rec %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 61) %>%
  group_by(Region,Area,Site,TSD_months,Resilience) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(TSD_months))
df_Res

p1_Res <- ggplot(data=df_Res, aes(x=TSD_months, fill=Region)) +geom_density(adjust=1.5,alpha=.6) 
p1_Res+theme_classic2()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=22),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=22))+guides(fill = guide_legend(title = "Region"),legend.key.width=32)+ scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 24), legend.position = c(.9, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")+scale_color_brewer(palette="BrBG")

p1a_Res <- ggplot(data=df_Res, aes(x=TSD_months, fill=Site)) +geom_freqpoly(aes(colour = Site), binwidth = 0.1, adjust=1.5,alpha=.2, na.rm = TRUE) 
p1a_Res+theme_classic2()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=22),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=22))+guides(fill = guide_legend(title = "Region"),legend.key.width=32)+ scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 24), legend.position = c(.9, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")+scale_color_brewer(palette="BrBG")

library(tidytext)

levels(recmeta$Fraction)
df_Res2 <- recmeta %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 37)%>% filter(Resilience!="NA") %>% filter(Site!="San Felipe") %>% filter(Site!="Wooroonooran Basalt") %>% filter(Site!="Wooroonooran Schist") %>%filter(Disturbanceme!="Luis")%>%filter(Disturbanceme!="Ivor")%>%
  group_by(Region,Area,Site,TSD_months,Disturbanceme,Resilience, ResilienceS)%>% 
  mutate (Res = log(Resilience), ResS = log(ResilienceS))
df_Res2

p2_Res<-ggplot(df_Res2, aes(x=TSD_months, y=Res, color = Other_soil_P))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=FALSE, color = "darkgray")+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Resilience (ln post/pre)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .8)+ scale_color_brewer(palette = "Paired")+
   theme(legend.title = element_text (size = 20), legend.position=c(0.92,.2),legend.text = element_text (size = 18),legend.justification = c("right", "top"),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p2_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p2a_Res<-ggplot(df_Res2, aes(x=TSD_months, y=Res, color = Other_soil_P))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=T, color = "black", alpha=.7)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Resilience (ln post/pre)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.position=c(0.6,.22),legend.text = element_text (size = 16),legend.justification = c("right", "top"),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p2a_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p2a_ResS<-ggplot(df_Res2, aes(x=TSD_months, y=ResS, color = Other_soil_P))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'ga',se=T, color = "black", alpha=.7)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=14))+ labs(x="Months since disturbance", y="Resilience season (ln post/pre same month)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=1, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.position=c(0.6,.22),legend.text = element_text (size = 16),legend.justification = c("right", "top"),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p2a_ResS + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")


p1a_Res <- ggplot(data=df_Res2, aes(x=TSD_months, fill=Region)) +geom_density(adjust=1.5,alpha=.6) 
p1a_Res+theme_classic2()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=22),axis.text.x = element_text(angle=0, hjust=0.5,vjust = 1,size=22))+guides(fill = guide_legend(title = "Region"),legend.key.width=32)+ scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 24), legend.position = c(.9, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")+scale_color_brewer(palette="BrBG")

df_Res3 <- recmeta %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 37)%>% filter(ResilienceS!="NA") %>% filter(Site!="San Felipe") %>% filter(Site!="Wooroonooran Basalt") %>% filter(Site!="Wooroonooran Schist") %>%filter(Disturbanceme!="Luis")%>%filter(Disturbanceme!="Ivor")%>%
  group_by(Region,Area,Site,TSD_months,Disturbanceme,Resilience, ResilienceS,Other_soil_P) %>%
  summarise(counts = n())%>% mutate (ResS = log(ResilienceS), Res=log(Resilience), DeltaRes=Res-ResS)
df_Res3

#Resilience plot 36 months

p3_Res<-ggplot(df_Res3, aes(x=TSD_months, y=ResS, colour = Disturbanceme))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=FALSE, color = "black")+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience (%, post/pre same month)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=100), lty=2, color = "darkgreen", cex=1, alpha = .8)+ scale_color_brewer(palette = "Paired")+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p3_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

p3_ResD<-ggplot(df_Res3, aes(x=TSD_months, y=DeltaRes))+geom_point(size = 3, aes(colour=Other_soil_P))+geom_line(linetype = 2)+
  geom_area(mapping = aes(y = ifelse(DeltaRes<0 , DeltaRes, 0)), fill = "orange", alpha=0.5)+
  geom_area(mapping = aes(y = ifelse(DeltaRes>0 , DeltaRes, 0)), fill = "green", alpha=0.5)+
  #geom_area(data = pos, fill = "#3DA4AB", alpha=0.3) +
  #geom_area(data = neg, fill = "tomato", alpha=0.3)+#geom_smooth(method = 'glm',se=FALSE, color = "darkgray", alpha=0.3)
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta Resilience (No season - Season)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.7, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.5,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
p3_ResD + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")


df_Res4 <- df_Res3 %>% filter(TSD_months < 13) %>% mutate(Res = log(Resilience), ResS=log(ResilienceS), DeltaRes = Res - ResS) %>% filter(Site!="El Verde FF" & Site!="El Verde DR")
str(df_Res4)

p4_Res<-ggplot(df_Res4, aes(x=TSD_months, y=Res, colour = Disturbanceme, shape = ))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=FALSE, color = "darkgray")+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience (ln post/pre)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ scale_color_brewer(palette = "Paired")+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="right")+scale_x_continuous(breaks=c(0,2,4,6,8,10,12))
#scale_y_log10()
p4_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

p5_Res<-ggplot(df_Res4, aes(x=TSD_months, y=ResS, colour = Disturbanceme))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=FALSE, color = "darkgray")+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience (ln post/pre same month)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ scale_color_brewer(palette = "Paired")+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="right")+scale_x_continuous(breaks=c(0,2,4,6,8,10,12))
#scale_y_log10()
p5_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

p6_Res<-ggplot(df_Res4, aes(x=TSD_months, y=DeltaRes, colour = Disturbanceme))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=FALSE, color = "darkgray")+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta resilience (Resilience - ResilienceS)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+ scale_color_brewer(palette = "Paired")+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="right")+scale_x_continuous(breaks=c(0,2,4,6,8,10,12))
#scale_y_log10()
p6_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

df_Res5 <- recmeta %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 13) %>% filter(ResilienceS!="NA") %>% filter(Site!="San Felipe") %>% filter(Site!="Wooroonooran Basalt" & Site!="Wooroonooran Schist") %>%filter(Disturbanceme!="Luis" & Disturbanceme!="Ivor")%>%
  mutate(Res = log(Resilience), ResS=log(ResilienceS), DeltaRes = Res - ResS) %>% filter(Site!="El Verde FF" & Site!="El Verde DR")
df_Res5

p7_Res<-ggplot(df_Res5, aes(x=TSD_months, y=DeltaRes, colour = Disturbanceme))+geom_point(size = 3, alpha = 1)+geom_smooth(method = 'glm',se=T, color = "darkgray", alpha=.7)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta resilience (Resilience - ResilienceS)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="right")+scale_x_continuous(breaks=c(0,2,4,6,8,10,12))
#scale_y_log10()
p7_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))

df_Res5$Other_soil_P

p8_Res<-ggplot(df_Res5, aes(x=TSD_months, y=DeltaRes, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.7)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta resilience (Resilience - ResilienceS)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="right")+scale_x_continuous(breaks=c(0,2,4,6,8,10,12))
#scale_y_log10()
p8_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p9_Res<-ggplot(df_Res5, aes(x=TSD_months, y=Res, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience (ln post/pre)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.88,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(2,4,6,8,10,12))
#scale_y_log10()
p9_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p10_Res<-ggplot(df_Res5, aes(x=TSD_months, y=ResS, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience season (ln post/pre same month)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.88,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(2,4,6,8,10,12))
#scale_y_log10()
p10_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p11_ResD<-ggplot(df_Res5, aes(x=TSD_months, y=DeltaRes, color = Other_soil_P))+geom_point(size = 3)+#geom_line(linetype = 2)+
  geom_area(fill="#69b3a2", alpha=0.4)+#geom_smooth(method = 'glm',se=FALSE, color = "darkgray", alpha=0.3)
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta Resilience (Resilience - ResilienceS)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.88,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(2,4,6,8,10,12))
#scale_y_log10()
p11_ResD + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

pos <- mutate(df_Res5, DeltaRes = ifelse(DeltaRes >= 0, DeltaRes, 0.0001))
neg <- mutate(df_Res5, DeltaRes = ifelse(DeltaRes < 0, DeltaRes, -0.0001))

p12_ResD<-ggplot(df_Res5, aes(x=TSD_months, y=DeltaRes))+geom_point(size = 3, aes(colour=Other_soil_P))+geom_line(linetype = 2)+
  geom_area(mapping = aes(y = ifelse(DeltaRes<0 , DeltaRes, 0)), fill = "orange", alpha=0.5)+
  geom_area(mapping = aes(y = ifelse(DeltaRes>0 , DeltaRes, 0)), fill = "green", alpha=0.5)+
#geom_area(data = pos, fill = "#3DA4AB", alpha=0.3) +
  #geom_area(data = neg, fill = "tomato", alpha=0.3)+#geom_smooth(method = 'glm',se=FALSE, color = "darkgray", alpha=0.3)
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta Resilience (No season - Season)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.7, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.88,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(2,4,6,8,10,12))
p12_ResD + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

df_Res6 <- recmeta %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 23) %>% filter(ResilienceS!="NA") %>% filter(Site!="San Felipe") %>% filter(Site!="Wooroonooran Basalt" & Site!="Wooroonooran Schist") %>%filter(Disturbanceme!="Luis" & Disturbanceme!="Ivor")%>%
  mutate(Res = log(Resilience), ResS=log(ResilienceS), DeltaRes = Res - ResS)
df_Res6

p9a_Res<-ggplot(df_Res6, aes(x=TSD_months, y=Res, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience (ln post/pre)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.5,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,22))
#scale_y_log10()
p9a_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p10a_Res<-ggplot(df_Res6, aes(x=TSD_months, y=ResS, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Resilience season (ln post/pre same month)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.5,.1),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,22))
p10a_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p12a_ResD<-ggplot(df_Res6, aes(x=TSD_months, y=DeltaRes))+geom_point(size = 3, aes(colour=Other_soil_P))+geom_line(linetype = 2)+
  geom_area(mapping = aes(y = ifelse(DeltaRes<0 , DeltaRes, 0)), fill = "orange", alpha=0.5)+
  geom_area(mapping = aes(y = ifelse(DeltaRes>0 , DeltaRes, 0)), fill = "green", alpha=0.5)+
  #geom_area(data = pos, fill = "#3DA4AB", alpha=0.3) +
  #geom_area(data = neg, fill = "tomato", alpha=0.3)+#geom_smooth(method = 'glm',se=FALSE, color = "darkgray", alpha=0.3)
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta Resilience (No season - Season)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.7, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position=c(0.52,.12),legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,22))
p12a_ResD + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")


prega<-ggplot(metaregplot, aes(x=pred.pred, y=data_es0ia.yi,color=data_es0ia.Other_soil_P))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(x="Predicted Effect Size", y="Observed Effect Size")

prega + geom_label_repel(aes(label=data_es0ia$Basin,fill = factor(data_es0ia$Basin)), color = 'black', size = 5, alpha=0.8) +scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))


##Differences between Resilience and ResilienceSeasonal

df_Res4 <- rec %>% filter(Fraction=="TotLitfall") %>% filter (TSD_months < 37)%>% filter(ResilienceS!="NA") %>% filter(Site!="San Felipe") %>% filter(Site!="Wooroonooran Basalt") %>% filter(Site!="Wooroonooran Schist") %>%filter(Disturbanceme!="Luis")%>%filter(Disturbanceme!="Ivor")%>%
  group_by(Region,Area,Site,TSD_months,Disturbanceme,Resilience, ResilienceS) %>%
  summarise(counts = n())%>% mutate (Res = (Resilience)*100, ResS = (ResilienceS)*100, deltaRes = Res - ResS, deltaRes2 = ResS - Res)
df_Res4

p5_Res<-ggplot(df_Res4, aes(x=TSD_months, y=deltaRes, colour = Disturbanceme))+geom_point(size = 3, alpha = 1)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=16),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Delta Resilience (%)")+
  guides(legend.key.width=22)+geom_hline(aes(yintercept=0), lty=2, color = "darkgreen", cex=1, alpha = .8)+ scale_color_brewer(palette = "Paired")+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.justification = c("right", "top"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p5_Res + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))


####New Recovery Data####

names(recmeta)
#Recovery = post/cyclone

df_Rec <- recmeta %>%filter(Recovery!="NA") %>% mutate(Cyclone=Disturbanceme)%>%
  group_by(Region,Area,Site,Cyclone,TSD_months,Recovery) %>%mutate(rec = Recovery*100, rec2=log(Recovery)) %>% arrange(desc(TSD_months))
str(df_Rec)
levels(df_Rec$Site)

p1_Rec<-ggplot(df_Rec, aes(x=TSD_months, y=rec, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Recovery (%, post/cyclone)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+#geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
#scale_y_log10()
p1_Rec + facet_wrap(~Site+Region, scales = "free_y")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p2_Rec<-ggplot(df_Rec, aes(x=TSD_months, y=rec2, color = Other_soil_P))+geom_point(size = 3)+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Recovery (ln post/cyclone)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+#geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 20), legend.text = element_text (size = 18),legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))

p2_Rec + facet_wrap(~Site+Region, scales = "free")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

p3_Rec<-ggplot(df_Rec, aes(x=TSD_months, y=rec2, fill = Cyclone))+geom_point(size = 3, aes(color=Other_soil_P))+geom_smooth(method = 'glm',se=T, color = "black", alpha=0.5)+geom_line(linetype = 2)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=18),
        axis.text=element_text(size=13))+ labs(x="Months since disturbance", y="Recovery (ln post/cyclone)")+
  guides(legend.key.width=22,color = guide_legend(title = "Total soil P (mg/kg)"))+#geom_hline(aes(yintercept=0), lty=2, color = "magenta", cex=0.9, alpha = .8)+
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 18),legend.position="top",legend.background = element_rect(fill=alpha('transparent', 0.4)),legend.key=element_rect(fill=alpha('transparent', 0.4)),legend.box.background = element_rect(colour = "black"))+scale_x_continuous(breaks=c(1,6,12,18,24,30,36))
p3_Rec + facet_wrap(~Site+Region, scales = "free")+theme(strip.text.x = element_text(size=12))+scale_color_gradient(low="blue", high="red")

df_Rec2 <- recmeta %>%filter(Recovery!="NA") %>% mutate(Cyclone=Disturbanceme)%>% filter(TSD_months<23) %>%
  group_by(Region,Area,Site,Cyclone,TSD_months,Recovery) %>%mutate(rec = Recovery*100, rec2=log(Recovery)) %>% arrange(desc(TSD_months))
str(df_Rec2)

df_Rec_B<-df_Rec2 %>% filter(Site=="Bisley") %>% mutate(logrec=log10(Recovery))

lmB<-lm(rec~TSD_months, data=df_Rec_B)
summary(lmB)#intercept = 0.0419289, slope = 0.0039659 for 36 months
            #intercept = 0.016761, slope = 0.006151 for 22 months
fitB <- lm(rec~poly(TSD_months,2,raw=TRUE), data=df_Rec_B)
anova(lmB,fitB)

df_Rec_CCJ<-df_Rec2 %>% filter(Site=="Chamela-Cuixmala") %>% filter(Cyclone=="Jova")

lmCCJ<-lm(rec~TSD_months, data=df_Rec_CCJ)
summary(lmCCJ)#intercept = 12.1429, slope = 0.1071 22 months

df_Rec_CCP<-df_Rec2 %>% filter(Site=="Chamela-Cuixmala") %>% filter(Cyclone=="Patricia")

lmCCP<-lm(rec~TSD_months, data=df_Rec_CCP)
summary(lmCCP)#intercept = 2.8571, slope = 0.3929 22 months

df_Rec_EP<-df_Rec2 %>% filter(Site=="East Peak")

lmEP<-lm(rec~TSD_months, data=df_Rec_EP)
summary(lmEP)#intercept = 0.031667, slope = 0.003095 for 22 months

df_Rec_EV<-df_Rec2 %>% filter(Site=="El Verde")

lmEV<-lm(rec~TSD_months, data=df_Rec_EV)
summary(lmEV)#intercept = 0.093197, slope = 0.006269
              #intercept = 0.053224, slope = 0.010431 22 months

df_Rec_EVTD<-df_Rec2 %>% filter(Site=="El Verde TrDeb")

lmEVTD<-lm(rec~TSD_months, data=df_Rec_EVTD)
summary(lmEVTD)#intercept = 0.0204762, slope = 0.0008752
              #intercept = 0.0206494, slope = 0.0008131 22 months

df_Rec_EVT<-df_Rec2 %>% filter(Site=="El Verde Trim")

lmEVT<-lm(rec~TSD_months, data=df_Rec_EVT)
summary(lmEVT)#intercept = 0.0194444, slope = 0.0004955
              #int = 0.0211688, slope = 0.0002541

####Recovery Slope and Soil Data####

recslope<-rbind(data.frame(group = "Bisley", region="Caribbean",slope = 0.0039659, soilP = 320,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.25, soilP=330,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde", region="Caribbean", slope =0.006269, soilP = 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="East Peak", region="Caribbean", slope = 0.0015385, soilP= 260,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="El Verde TrDeb", region="Caribbean", slope = 0.0008752, soilP= 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde Trim", region="Caribbean", slope = 0.0004955, soilP=340,
                            row.names=FALSE, stringsAsFactors=TRUE))

recslope

recslope_22m<-rbind(data.frame(group = "Bisley", region="Caribbean",slope = 0.006151, soilP = 320,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.1071, soilP=330,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.3929, soilP=330,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde", region="Caribbean", slope =0.010431, soilP = 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="East Peak", region="Caribbean", slope = 0.003095, soilP= 260,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="El Verde TrDeb", region="Caribbean", slope = 0.0008131, soilP= 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde Trim", region="Caribbean", slope = 0.0002541, soilP=340,
                           row.names=FALSE, stringsAsFactors=TRUE))

recslope_22m

precslope<-ggplot(recslope, aes(x=soilP, y=slope))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=21),
        axis.text=element_text(size=20))+ labs(y="Recovery slope", x="Total soil P (mg/kg)")

precslope + geom_label_repel(aes(label=group,fill = group), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

precslope + geom_label_repel(aes(label=region,fill = region), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

precslope_22m<-ggplot(recslope_22m, aes(x=soilP, y=slope))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=20),
        axis.text=element_text(size=20))+ labs(y="Recovery slope 1-22 months", x="Total soil P (mg/kg)")

precslope_22m + geom_label_repel(aes(label=group,fill = group), color = 'black', size = 4.5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

precslope_22m + geom_label_repel(aes(label=region,fill = region), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

sl1<-lm(slope~soilP, data=recslope)
summary(sl1)

sl2<-lm(slope~soilP, data=recslope_22m)
summary(sl2)

####Resilience slope soil P####

str(df_Res5)

df_Rec_B2<-df_Res6 %>% filter(Site=="Bisley")

lmB2<-lm(Res~TSD_months, data=df_Rec_B2)
summary(lmB2)#intercept = -1.94907, slope = 0.09234
            #int = -1.75940, slope = 0.06107

lmB2a<-gam(ResS~TSD_months, data=df_Rec_B2)
summary(lmB2a)#intercept = -1.52254, slope = 0.04568

acf(residuals(lmB2), lag=40)
acf(residuals(lmB2a), lag=40)

df_Rec_CC2<-df_Res6 %>% filter(Site=="Chamela-Cuixmala") %>% filter(Disturbanceme=="Jova")

lmCC2<-lm(Res~TSD_months, data=df_Rec_CC2)#Jova
summary(lmCC2)#intercept = -0.07526, slope = -0.01875

lmCC2a<-lm(ResS~TSD_months, data=df_Rec_CC2)#Jova
summary(lmCC2a)#intercept = -0.80956, slope = 0.13854

df_Rec_CC2P<-df_Res6 %>% filter(Site=="Chamela-Cuixmala") %>% filter(Disturbanceme=="Patricia")

lmCC2P<-lm(Res~TSD_months, data=df_Rec_CC2a)#Patricia
summary(lmCC2P)#intercept = -1.34606, slope = 0.12901

lmCC2Pa<-lm(ResS~TSD_months, data=df_Rec_CC2a)#Patricia
summary(lmCC2Pa)#intercept = -1.9671  slope = 0.2864

df_Rec_EP2<-df_Res6 %>% filter(Site=="East Peak")

lmEP2<-lm(Res~TSD_months, data=df_Rec_EP2)
summary(lmEP2)#intercept = -1.416716, slope = 0.049183

lmEP2a<-lm(ResS~TSD_months, data=df_Rec_EP2)
summary(lmEP2a) #intercept = -1.57952, slope = 0.06507

df_Rec_EV2<-df_Res6 %>% filter(Site=="El Verde")

lmEV2<-lm(Res~TSD_months, data=df_Rec_EV2)
summary(lmEV2)#intercept = -1.27713, slope = 0.04396

lmEV2a<-lm(ResS~TSD_months, data=df_Rec_EV2)
summary(lmEV2a) #intercept = -0.81070 slope = 0.02338

df_Rec_EVTD2<-df_Res6 %>% filter(Site=="El Verde TrDeb")

lmEVTD2<-lm(Res~TSD_months, data=df_Rec_EVTD2)
summary(lmEVTD2)#intercept = -1.13272, slope = 0.02891

lmEVTD2a<-lm(ResS~TSD_months, data=df_Rec_EVTD2)
summary(lmEVTD2a) #intercept = -1.67272 slope = 0.04633

df_Rec_EVT2<-df_Res6 %>% filter(Site=="El Verde Trim")

lmEVT2<-lm(Res~TSD_months, data=df_Rec_EVT2)
summary(lmEVT2)#intercept = -1.56594, slope = 0.01462

lmEVT2a<-lm(ResS~TSD_months, data=df_Rec_EVT2)
summary(lmEVT2a) #intercept = -1.75528 slope = 0.03164

df_Rec_BV<-df_Res6 %>% filter(Site=="Bisley_Verde")

lmBV<-lm(Res~TSD_months, data=df_Rec_BV)
summary(lmBV)#intercept = 0.89031, slope = -0.07711

lmBVa<-lm(ResS~TSD_months, data=df_Rec_BV)
summary(lmBVa) #intercept = 1.07116 slope = -0.06350

df_Rec_EPFF<-df_Res6 %>% filter(Site=="East Peak FF")

lmEPFF<-lm(Res~TSD_months, data=df_Rec_EPFF)
summary(lmEPFF)#intercept = -1.57907, slope = 0.06179

lmEPFFa<-lm(ResS~TSD_months, data=df_Rec_EPFF)
summary(lmEPFFa) #int = -1.73037 slope = 0.07709

df_Rec_Kok<-df_Res6 %>% filter(Site=="Kokee")

lmKok<-lm(Res~TSD_months, data=df_Rec_Kok)
summary(lmKok)#intercept = 0.130955, slope = -0.009229

lmKoka<-lm(ResS~TSD_months, data=df_Rec_Kok)
summary(lmKoka) #int = 0.20003 slope = -0.01432

df_Rec_KokN<-df_Res6 %>% filter(Site=="Kokee N")

lmKokN<-lm(Res~TSD_months, data=df_Rec_KokN)
summary(lmKokN)#intercept = 0.077622, slope = 0.001136

df_Rec_KokNP<-df_Res6 %>% filter(Site=="Kokee NP")

lmKokNP<-lm(Res~TSD_months, data=df_Rec_KokNP)
summary(lmKokNP)#intercept = 0.018685, slope = -0.004072

df_Rec_KokP<-df_Res6 %>% filter(Site=="Kokee P")

lmKokP<-lm(Res~TSD_months, data=df_Rec_KokP)
summary(lmKokP)#intercept = 0.060387, slope = -0.005339

df_Rec_MS<-df_Res6 %>% filter(Site=="Mt Spec")

lmMS<-lm(Res~TSD_months, data=df_Rec_MS)
summary(lmMS)#intercept = -0.91462, slope = 0.05686

lmMSa<-lm(ResS~TSD_months, data=df_Rec_MS)
summary(lmMSa) #int = -0.55641 slope = 0.04319

df_Rec_MSD<-df_Res6 %>% filter(Site=="Mt Spec Disturbed")

lmMSD<-lm(Res~TSD_months, data=df_Rec_MSD)
summary(lmMSD)#intercept = -0.75374, slope = 0.05199

lmMSDa<-lm(ResS~TSD_months, data=df_Rec_MSD)
summary(lmMSDa)#intercept = -0.50775, slope = 0.04467

df_Rec_U<-df_Res6 %>% filter(Site=="Utuado")

lmU<-lm(Res~TSD_months, data=df_Rec_U)
summary(lmU)#intercept = -1.72254, slope = 0.06316

lmUa<-lm(ResS~TSD_months, data=df_Rec_U)
summary(lmUa)#intercept = -1.64998, slope = 0.08504

Res_slope<-rbind(data.frame(group = "Bisley", region="Caribbean",slope = 0.09234, soilP = 320,
                           row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group = "Bisley-El Verde", region="Caribbean",slope = -0.17221, soilP = 320,
                            row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.05513, soilP=330,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde", region="Caribbean", slope =0.009316, soilP = 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="East Peak", region="Caribbean", slope = 0.03509, soilP= 260,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="East Peak FF", region="Caribbean", slope = 0.05587, soilP= 260,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group ="El Verde TrDeb", region="Caribbean", slope = -0.05338, soilP= 340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="El Verde Trim", region="Caribbean", slope = -0.02489, soilP=340,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Kokee", region="Hawaii", slope = 0.02317, soilP=220,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Kokee N", region="Hawaii", slope = -0.005228, soilP=220,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Kokee NP", region="Hawaii", slope = -0.00451, soilP=220,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Kokee P", region="Hawaii", slope = 0.01868, soilP=220,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Mt Spec", region="Australia", slope = -0.06399, soilP=130,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Mt Spec Disturbed", region="Australia", slope = 0.02146, soilP=130,
                           row.names=FALSE, stringsAsFactors=TRUE),
                data.frame(group="Utuado", region="Caribbean", slope = 0.2043, soilP=330,
                           row.names=FALSE, stringsAsFactors=TRUE))

Res_slope

Res_slope2<-rbind(data.frame(group = "Bisley", region="Caribbean",slope = 0.06107, soilP = 320,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Chamela-Cuixmala", region="Mexico", slope =-0.01875, soilP=330,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.12901, soilP=330,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="El Verde", region="Caribbean", slope =0.04396, soilP = 340,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group ="East Peak", region="Caribbean", slope = 0.049183, soilP= 260,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group ="East Peak FF", region="Caribbean", slope = 0.06179, soilP= 260,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group ="El Verde TrDeb", region="Caribbean", slope = 0.02891, soilP= 340,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="El Verde Trim", region="Caribbean", slope = 0.01462, soilP=340,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Kokee", region="Hawaii", slope = -0.009229, soilP=220,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Mt Spec", region="Australia", slope = 0.05686, soilP=130,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Mt Spec Disturbed", region="Australia", slope = 0.05199, soilP=130,
                            row.names=FALSE, stringsAsFactors=TRUE),
                 data.frame(group="Utuado", region="Caribbean", slope = 0.06316, soilP=330,
                            row.names=FALSE, stringsAsFactors=TRUE))

Res_slope2
#data.frame(group = "Bisley-El Verde", region="Caribbean",slope = -0.07711, soilP = 320,
           #row.names=FALSE, stringsAsFactors=TRUE),data.frame(group="Kokee N", region="Hawaii", slope = 0.001136, soilP=220,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(group="Kokee NP", region="Hawaii", slope = -0.004072, soilP=220,
           #row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(group="Kokee P", region="Hawaii", slope = -0.005339, soilP=220,
           #row.names=FALSE, stringsAsFactors=TRUE),

Res_slope2S<-rbind(data.frame(group = "Bisley", region="Caribbean",slope = 0.04568, soilP = 320,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.13854, soilP=330,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Chamela-Cuixmala", region="Mexico", slope =0.2864, soilP=330,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="El Verde", region="Caribbean", slope =0.02338, soilP = 340,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group ="East Peak", region="Caribbean", slope = 0.06507, soilP= 260,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group ="East Peak FF", region="Caribbean", slope = 0.07709, soilP= 260,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group ="El Verde TrDeb", region="Caribbean", slope = 0.04633, soilP= 340,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="El Verde Trim", region="Caribbean", slope = 0.03164, soilP=340,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Kokee", region="Hawaii", slope = -0.009229, soilP=220,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Mt Spec", region="Australia", slope = 0.04319, soilP=130,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Mt Spec Disturbed", region="Australia", slope = 0.04467, soilP=130,
                             row.names=FALSE, stringsAsFactors=TRUE),
                  data.frame(group="Utuado", region="Caribbean", slope = 0.08504, soilP=330,
                             row.names=FALSE, stringsAsFactors=TRUE))

Res_slope2S

#data.frame(group="Kokee N", region="Hawaii", slope = 0.001136, soilP=220,row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(group="Kokee NP", region="Hawaii", slope = -0.004072, soilP=220,
           #row.names=FALSE, stringsAsFactors=TRUE),
#data.frame(group="Kokee P", region="Hawaii", slope = -0.005339, soilP=220,
           #row.names=FALSE, stringsAsFactors=TRUE),

Reslm<-lm(slope~soilP+region, data=Res_slope2)
summary(Reslm)

pRes_slope<-ggplot(Res_slope, aes(x=soilP, y=slope))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=21),
        axis.text=element_text(size=20))+ labs(y="Resilience slope", x="Total soil P (mg/kg)")

pRes_slope + geom_label_repel(aes(label=region,fill = region), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

Reslm<-lm(slope~soilP+region, data=Res_slope2)
summary(Reslm)

pRes_slope2<-ggplot(Res_slope2, aes(x=soilP, y=slope))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=21),
        axis.text=element_text(size=20))+ labs(y="Resilience slope", x="Total soil P (mg/kg)")

pRes_slope2 + geom_label_repel(aes(label=region,fill = region), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

pRes_slope2 + geom_label_repel(aes(label=group,fill = group), color = 'black', size = 4.5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

pRes_slope2S<-ggplot(Res_slope2S, aes(x=soilP, y=slope))+geom_point(size=3.5)+geom_smooth(method = 'lm', col="black", alpha=0.3)+
  theme_bw()+ # ggplot2 has a few theme options, I like minimal and classic
  theme(axis.title=element_text(size=21),
        axis.text=element_text(size=20))+ labs(y="Resilience season slope", x="Total soil P (mg/kg)")

pRes_slope2S + geom_label_repel(aes(label=region,fill = region), color = 'black', size = 5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))

pRes_slope2S + geom_label_repel(aes(label=group,fill = group), color = 'black', size = 4.5, alpha=0.8) +#scale_color_gradient(low="blue", high="red")+#scale_color_gradientn(colours = rainbow(5))+#+scale_color_gradient(low="blue", high="red")
  theme(legend.title = element_text (size = 18), legend.text = element_text (size = 16),legend.position = "right",legend.justification = c("right", "top"))


lmRes<-lm(slope~soilP, data=Res_slope2)
summary(lmRes)

lmResS<-lm(slope~soilP, data=Res_slope2S)
summary(lmResS)

p2_3 <- ggplot(data=df_TSD3, aes(x=TSD_months, fill=Holdridge_life_zone)) +geom_density(adjust=1.5,alpha=0.3) 
p2_3+ylim(0,0.075)+theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+guides(fill = guide_legend(title = "Holdridge life zone"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 32), legend.text = element_text (size = 30), legend.position = c(.95, .80),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")

metadat$Dist_type
df_TSD4 <- metadat %>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Disturbance,TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(TSD_months))
df_TSD4

df_TSD4a <- metadat %>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Dist_type,TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(TSD_months))
df_TSD4a

p2_4 <- ggplot(data=df_TSD4, aes(x=TSD_months, fill=Disturbance)) +geom_density(adjust=1.5,alpha=0.2) 
p2_4+ylim(0,0.1)+theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=24),axis.text.x = element_text(angle=0, hjust=1,size=24))+guides(fill = guide_legend(title = "Wind disturbance"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 38), legend.text = element_text (size = 34), legend.position = c(.75, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))

p2_4a <- ggplot(data=df_TSD4a, aes(x=TSD_months, fill=Dist_type)) +geom_density(adjust=1.5,alpha=0.3) 
p2_4a+ylim(0,0.1)+theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+guides(fill = guide_legend(title = "Type of wind disturbance"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 32), legend.text = element_text (size = 30), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")


df_TSD5 <- metadat %>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Site,TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(TSD_months))
df_TSD5

p2_5 <- ggplot(data=df_TSD5, aes(x=TSD_months, fill=Site)) +geom_density(adjust=1.5,alpha=0.3) 
p2_5+ ylim(0,0.1) + theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=24),axis.text.x = element_text(angle=0, hjust=1,size=24))+guides(fill = guide_legend(title = "Site"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 32), legend.text = element_text (size = 30), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")


p2<-ggplot(df_TSD2, aes(x=TSD_months, y=counts))
p2+geom_bar(fill="#0073C2FF",stat="identity") +
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=45, hjust=1))

p2 <- ggplot(data=df_TSD2, aes(x=TSD_months, fill=TSD_months)) +geom_density(adjust=1.5,alpha=.7) 
p2+theme_pubclean()+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+guides(fill = guide_legend(title = "Region"))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 22), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

#Nutrient flux by time since disturbance

df_nutTSD <- nutmeta %>% filter(Variable=="P"|Variable=="N")%>% filter(Raw_Unit=="mg/g")%>%
  group_by(Region, TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)
df_nutTSD

pPmgg <- ggplot(data=df_nutTSD, aes(x=TSD_months, group=Region, fill=Region)) +geom_density(adjust=1.5,alpha=0.7) 
pPmgg+theme_pubr()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=0.5,size=20))+guides(fill = guide_legend(title = "Region"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 24), legend.position = c(.85, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")

df_nutTSD2 <- nutmeta %>% filter(Raw_Unit == "mg/m2/day"|Raw_Unit=="mg/g")%>%
  group_by(Region, TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)
df_nutTSD2

pnut2_2 <- ggplot(data=df_nutTSD2, aes(x=TSD_months, group=Region, fill=Region)) +geom_density(adjust=1.5,alpha=.3) 
pnut2_2+theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=24),axis.text.x = element_text(angle=0, hjust=1,size=24))+guides(fill = guide_legend(title = "Region"),legend.key.width=20)+ scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 34), legend.text = element_text (size = 30), legend.position = c(.75, .70),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")


df_TSD_0.5 <- metadat %>%
  group_by(Region,TSD_months) %>%
  filter(Cat_TSD_months=="0-0.5") %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(TSD_months))
df_TSD_0.5

p_TSD_0.5 <- ggplot(data=df_TSD_0.5, aes(x=TSD_months, group = Region, fill=Region)) +geom_density(adjust=1.5,alpha=.7) 
p_TSD_0.5+theme_pubclean()+theme(axis.title=element_text(size=20),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+guides(fill = guide_legend(title = "Region"))+
  theme(legend.title = element_text (size = 26), legend.text = element_text (size = 22), legend.position = c(.25, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

df <- df %>%
  arrange(desc(cut)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)

pk<- model_kdat_Amb_k %>% group_by(group, studies) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(prop = round(counts*100/sum(counts), 1),
                                    lab.ypos = cumsum(prop) - 0.5*prop)
pk
pk %>% ggplot(mapping = aes(x=studies)) + geom_density(adjust=1.5,alpha=.7)+theme_bw()
ggdensity(pk, x = "studies", 
          fill = "#0073C2FF", color = "#0073C2FF",rug = TRUE)

 df_TSD2%>%ggplot( aes(x=TSD_months)) +
  geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8)
 
 ggplot(pk, aes(group, studies)) +
   geom_linerange(
     aes(x = group, ymin = 0, ymax = studies), 
     color = "darkgray", size = 1.5)+geom_point(aes(color = group), size = 3)+labs(x = "Number of studies", y = "")+
   theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+
   theme(legend.title = element_blank (), legend.text = element_blank(), legend.key=element_blank())+scale_color_brewer(palette="Dark2")
 
 ggplot(df_TSD, aes(TSD_months, counts)) +
  geom_linerange(
    aes(x = TSD_months, ymin = 0, ymax = counts), 
    color = "lightgray", size = 1.5
  )+
  geom_point(aes(color = TSD_months), size = 2)+
  ggpubr::color_palette("jco")+
  theme_pubclean()

dfex2 <- df_2 %>%
  arrange(desc(Trf_TSD_months)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfex2, 4)

pd2<-ggplot(dfex2, aes(x=Trf_TSD_months, y=counts))
pd2+geom_bar(fill="#0073C2FF",stat="identity") +
  geom_text(aes(label = counts), vjust = -0.3, size=7, color="purple")+
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=45, hjust=1))


#Litterfall mass by SSHWS Category
levels(metadat$Trf_TSD_months)
metadat$SSHWS_Cat=as.factor(metadat$SSHWS_Cat)
names(metadat)

df_3 <- metadat%>%
  group_by(Site,SSHWS_Cat, Distance_to_Disturb_km,Disturb_Rainfall_mm) %>%
  summarise(counts = n())%>% arrange(desc(counts))
df_3
df_3$SSHWS_Cat=as.factor(df_3$SSHWS_Cat)

plot_3<-ggplot(df_3, aes(x=reorder(Site,-counts),y=counts, fill = SSHWS_Cat)) 
plot_3+geom_bar(stat = "identity")+
  scale_fill_brewer(palette = "Set3")+
  theme_pubclean()+theme(axis.title=element_text(size=24),
                         axis.text=element_text(size=24),axis.text.x = element_text(angle=45, hjust=1))+guides(fill = guide_legend(title = "SSHWS"))+labs(x = "Saffir-Simpson Hurricane Wind Scale", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))


df_SS <- metadat %>%
  group_by(Region, SSHWS_Cat) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(counts))
df_SS

plot_SSCAT<-ggplot(df_SS, aes(x=SSHWS_Cat,y=counts, fill = Region)) 
plot_SSCAT+geom_bar(stat="identity")+
  scale_fill_brewer(palette = "Set3")+
  theme_pubclean()+theme(axis.title=element_text(size=24),
                         axis.text=element_text(size=24),axis.text.x = element_text(angle=0, hjust=1))+guides(fill = guide_legend(title = "Region"))+labs(x = "Saffir-Simpson Hurricane Wind Scale", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

names(metadat)
df_TSD5 <- metadat %>% filter(Fraction=="TotLitfall")%>%filter(TSD_months<61)%>%
  group_by(Country,TSD_months) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(counts))
df_TSD5
rlang::last_error()

p2_5 <- ggplot(data=df_TSD5, aes(x=TSD_months, fill=Site)) +geom_density(adjust=1.5,alpha=0.3) 
p2_5+ylim(0,0.1)+theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=20),axis.text.x = element_text(angle=0, hjust=1,size=20))+guides(fill = guide_legend(title = "Site"),legend.key.width=20)+scale_x_continuous(name="Months since disturbance", breaks = c(0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84))+
  theme(legend.title = element_text (size = 32), legend.text = element_text (size = 30), legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+labs(y = "Density",x = "Months since disturbance")

str(metadat$SSHWS_Cat)

df_SS_2 <- metadat %>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Disturbance, SSHWS_Cat) %>%
  summarise(counts = n())%>% mutate(percent = (counts/sum(counts))*100)%>%
  arrange(desc(counts))
df_SS_2

nb.cols <- 20
mycolors <- colorRampPalette(brewer.pal(8, "Set3"))(nb.cols)

plot_SSCAT_2<-ggplot(df_SS_2, aes(x=SSHWS_Cat,y=counts, fill = Disturbance)) 
plot_SSCAT_2+geom_bar(stat="identity")+
  scale_fill_manual(values = mycolors) +
  theme_pubclean()+theme(axis.title=element_text(size=28),
                         axis.text=element_text(size=26),axis.text.x = element_text(angle=0, hjust=1))+guides(fill = guide_legend(title = "Disturbance"))+labs(x = "Saffir-Simpson Hurricane Wind Scale", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.99, .99),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+ scale_x_continuous(breaks=c(0, 1, 2, 3, 4,5))



dfex3 <- df_3 %>%
  arrange(desc(SSHWS_Category)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfex3, 4)

pe<-ggplot(dfex3, aes(x=SSHWS_Category, y=counts))
pe+geom_bar(fill="#0073C2FF",stat="identity") +
  geom_text(aes(label = counts), vjust = -0.3, size=7, color="purple")+
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=0, hjust=1))

#Litterfall mass by Parent Material

levels(metadat$Par_Mat)
str(metadat)

df_4 <- metadat %>% filter(Site!="Tanguro")%>% group_by(RockPClass, Rock_type)%>%dplyr::summarise(counts = dplyr::n())%>%mutate(percent = (counts/sum(counts))*100)
df_4
rlang::last_error()

levels(metadat$USDA_Soil_Order)
metadat$USDA_Soil_Order= factor(metadat$USDA_Soil_Order,levels(metadat$USDA_Soil_Order)[c(8,2,5,7,6,3,4,1)])

levels(metadat$Par_Mat)
metadat$Par_Mat= factor(metadat$Par_Mat,levels(metadat$Par_Mat)[c(8,3,11,6,9,7,2,5,10,13,4,14,1,12)])

library(dplyr)
df_4 <- metadat %>%filter(Site!="Tanguro")%>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Other_soil_P,RockPClass, Rock_type,Par_Mat) %>%
  dplyr::summarise(counts = dplyr::n())%>% mutate(percent = (counts/sum(counts))*100)
df_4

# Install
install.packages("wesanderson")
# Load
library(wesanderson)
library(RColorBrewer)
nb.cols <- 20
mycolors <- colorRampPalette(brewer.pal(10, "Dark2"))(nb.cols)

plot_ParMat<-ggplot(df_4, aes(y=counts, x = USDA_Soil_Order, fill=Holdridge_life_zone)) 
plot_ParMat+geom_bar(stat="identity")+scale_fill_brewer(palette = "Paired")+
  #scale_fill_manual(values = mycolors) +
  theme_pubclean()+theme(axis.title=element_text(size=28),
                         axis.text=element_text(size=26),axis.text.x = element_text(angle=30, hjust=1))+guides(fill = guide_legend(title = "Holdridge life zone"))+labs(x = "USDA Soil order", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.5, .96),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

plot_ParMat<-ggplot(df_4, aes(y=counts, x = Par_Mat, fill=USDA_Soil_Order)) 
plot_ParMat+geom_bar(stat="identity")+scale_fill_brewer(palette = "Paired")+
  #scale_fill_manual(values = mycolors) +
  theme_pubclean()+theme(axis.title=element_text(size=28),
                         axis.text=element_text(size=26),axis.text.x = element_text(angle=30, hjust=1))+guides(fill = guide_legend(title = "USDA soil order"))+labs(x = "Soil parent material", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.35, .96),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))+scale_y_continuous(breaks=c(0,200,400,600,800))

df_rock <- metadat %>%
  group_by(Rock_type) %>%
  dplyr::summarise(counts = dplyr::n())%>% dplyr::mutate(percent = (counts/sum(counts))*100)%>%arrange(desc(Rock_type))
df_rock

df_4a <- metadat %>%filter(Treatment=="Ambient"|Treatment=="TrimDeb"|Treatment=="Trim")%>% filter(Fraction=="TotLitfall")%>%
  group_by(Holdridge_life_zone, RockPClass,USDA_Soil_Order,TempPrec_ratio_x10.2_Cmmyr,Other_soil_P,Site) %>%
  dplyr::summarise(counts = dplyr::n()) %>% dplyr::mutate(percent = (counts/sum(counts))*100) %>%
  arrange(desc(counts))
df_4a<-df_4a %>% rename(Parent.material = Par_Mat)
df_4a

plot_ParMata<-ggplot(df_4a, aes(y=counts, x = RockPClass, fill=USDA_Soil_Order)) 
plot_ParMata+geom_bar(stat="identity")+scale_fill_brewer(palette = "Paired")+
  #scale_fill_manual(values = mycolors) +
  theme_pubclean()+theme(axis.title=element_text(size=28),
                         axis.text=element_text(size=26),axis.text.x = element_text(angle=60, hjust=1))+guides(fill = guide_legend(title = "USDA soil order"))+labs(x = "Soil parent material", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.24, .97),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

plot_ParMatb<-ggplot(df_4a, aes(y=counts, x = USDA_Soil_Order, fill=Holdridge_life_zone)) 
plot_ParMatb+geom_bar(stat="identity")+scale_fill_brewer(palette = "Paired")+
  #scale_fill_manual(values = mycolors) +
  theme_pubclean()+theme(axis.title=element_text(size=28),
                         axis.text=element_text(size=26),axis.text.x = element_text(angle=30, hjust=1))+guides(fill = guide_legend(title = "Holdridge life zone"))+labs(x = "USDA Soil order", y = "Number of observations")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.4, .96),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))


plot_4a<-ggplot(df_4a, aes(x=Other_soil_P,y=TempPrec_ratio_x10.2_Cmmyr, color = Holdridge_life_zone)) 
plot_4a+geom_point(size=4)+scale_fill_brewer(palette = "Set3")+
  theme_pubclean()+theme(axis.title=element_text(size=24),
                         axis.text=element_text(size=24),axis.text.x = element_text(angle=40, hjust=1))+guides(fill = guide_legend(title = "Holdridge life zone"))+labs(x="Total soil P", y="MAT / MAP x 100")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.8,.9),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

plot_4a+geom_point(size=4)+scale_fill_brewer(palette = "Set3")+xlim(0,1000)+
  theme_pubclean()+theme(axis.title=element_text(size=24),
                         axis.text=element_text(size=24),axis.text.x = element_text(angle=30, hjust=1))+guides(fill = guide_legend(title = "Holdridge life zone"))+labs(x="Total soil P", y="MAT / MAP x 100")+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 26), legend.position = c(.8,.9),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6))

#Soil Phosphorus plot

ggplot(df_4a, aes(x=RockPClass, y=Other_soil_P,color=RockPClass)) +
geom_linerange(aes(x = RockPClass, ymin = 0, ymax = Other_soil_P), color = "lightgray", size = 1.5)+
  geom_point(aes(color = RockPClass), size = 4)+labs(x = "Parent material P category", y = "Total soil P (mg/kg)")+
  theme_pubclean()+theme(axis.title=element_text(size=28),axis.text.y=element_text(size=28),axis.text.x = element_text(angle=0, hjust=0.5,size=24))+guides(fill = guide_legend(title = "Soil order"))+
  theme(legend.title = element_text (size = 28), legend.text = element_text (size = 28), legend.position = c(.99, .99),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6), legend.key = element_blank())+
  scale_y_continuous(breaks=c(0,200,400,600,800,1000,1200, 1400, 1600,1800,2000,2200,2400,2600,2800,3000))

ggplot(df_4a, aes(x=RockPClass, y=Other_soil_P,color=RockPClass)) +geom_boxplot()
  
  #geom_linerange(aes(x = RockPClass, ymin = 0, ymax = Other_soil_P), color = "lightgray", size = 1.5)+
  #geom_point(aes(color = RockPClass), size = 4)+labs(x = "Parent material P category", y = "Total soil P (mg/kg)")+
  #theme_pubclean()+theme(axis.title=element_text(size=28),axis.text.y=element_text(size=28),axis.text.x = element_text(angle=0, hjust=0.5,size=24))+guides(fill = guide_legend(title = "Soil order"))+
  #theme(legend.title = element_text (size = 28), legend.text = element_text (size = 28), legend.position = c(.99, .99),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6), legend.key = element_blank())+
  #scale_y_continuous(breaks=c(0,200,400,600,800,1000,1200, 1400, 1600,1800,2000,2200,2400,2600,2800,3000))


ggplot(df_4a, aes(x=USDA_Soil_Order, y=Other_soil_P,color=Parent.material)) +
  geom_linerange(aes(x = USDA_Soil_Order, ymin = 0, ymax = Other_soil_P), color = "darkgray", size = 1.5)+
  geom_point(aes(color = Parent.material), size = 4)+labs(x = "Soil order", y = "Total soil P (mg/kg)")+
  theme_pubclean()+theme(axis.title=element_text(size=24),axis.text.y=element_text(size=24),axis.text.x = element_text(angle=0, hjust=0.5,size=24))+guides(fill = guide_legend(title = "Parent Material"))+
  theme(legend.title = element_text (size = 30), legend.text = element_text (size = 28), legend.position = c(.4, .97),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6), legend.key = element_blank())+ylim(0,100)


dfex4 <- df_4 %>%
  arrange(desc(Par_Mat)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfex4, 4)

pg<-ggplot(dfex4, aes(x=reorder(Par_Mat,-counts), y=counts))
pg+geom_bar(fill="#0073C2FF",stat="identity") +
  geom_text(aes(label = counts), vjust = -0.3, size=7, color="purple")+
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=45, hjust=1))



#Litterfall mass by Soil P
levels(metadat$Trf_TSD_months)
str(metadat)
names(metadat)
metadat$Total_Soil_P..Bicarb....NaOH.Pt.=as.numeric(metadat$Total_Soil_P..Bicarb....NaOH.Pt.)

df_P <- metadat%>%
  group_by(Total_Soil_P..Bicarb....NaOH.Pt.) %>%
  summarise(counts = n())
df_P

dfP<- df_P %>%
  arrange(desc(Total_Soil_P..Bicarb....NaOH.Pt.)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfP, 4)

pf<-ggplot(dfP, aes(x=Total_Soil_P..Bicarb....NaOH.Pt., y=prop))
pf+geom_bar(fill="#0073C2FF",stat="identity") +
  geom_text(aes(label = prop), vjust = -0.3, size=7, color="purple")+
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=0, hjust=1))

#Litterfall mass by Total Soil P
levels(metadat$Trf_TSD_months)
str(metadat)
names(metadat)
metadat$Other_Soil_P=as.numeric(metadat$Other_Soil_P)

df_Pt <- metadat%>%
  group_by(Other_Soil_P) %>%
  summarise(counts = n())
df_Pt

dfPt<- df_Pt %>%
  arrange(desc(Other_Soil_P)) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfPt, 4)

pg<-ggplot(dfPt, aes(x=Other_Soil_P, y=prop))
pg+geom_bar(fill="#0073C2FF",stat="identity") +
  geom_text(aes(label = prop), vjust = -0.3, size=7, color="purple")+
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=0, hjust=1))


#Litterfall mass by Distance to disturbance
levels(metadat$Trf_TSD_months)
str(metadat)
names(metadat)
metadat$Other_Soil_P=as.numeric(metadat$Other_Soil_P)

dfD <- metadat%>%
  group_by(Distance_to_Dist_km) %>%
  summarise(counts = n())
dfD

dfDex<- tot_lit_all %>%
  arrange(desc(Other_soil_P),Treatment) %>%
  mutate(prop = round(counts*100/sum(counts), 1),
         lab.ypos = cumsum(prop) - 0.5*prop)
head(dfDex, 4)

pg<-ggplot(tot_lit_all, aes(y=Treatment))
pg+geom_histogram() +
  theme_pubclean()+theme(axis.title=element_text(size=20),
                         axis.text=element_text(size=16),axis.text.x = element_text(angle=0, hjust=0.5))

